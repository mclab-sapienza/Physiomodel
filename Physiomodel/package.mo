within ;
package Physiomodel "Mammalian physiology model"
  extends Physiolibrary.Icons.GolemLib;

  package Hormones "Hormones"
    extends Physiolibrary.Icons.HormonesLib;

    package Insulin_Physiolibrary = Physiolibrary(Types(
      redeclare type Concentration = Real(quantity="Insulin Concentration",unit="1/m3",displayUnit="iu/l"),
      redeclare type AmountOfSubstance = Real(quantity="Unsulin AmountOfSubstance",unit="1",displayUnit="iu"),
      redeclare type MolarFlowRate = Real(quantity="Insulin Flow Rate",unit="1/s",displayUnit="iu/min"),
      redeclare type MolarEnergy = Real(quantity="Insulin Internal Energy",unit="J",displayUnit="cal/iu")));

    package EPO_Physiolibrary = Physiolibrary(Types(
      redeclare type Concentration = Real(quantity="EPO Concentration",unit="1/m3",displayUnit="iu/l"),
      redeclare type AmountOfSubstance = Real(quantity="EPO AmountOfSubstance",unit="1",displayUnit="iu"),
      redeclare type MolarFlowRate = Real(quantity="EPO Flow Rate",unit="1/s",displayUnit="iu/min"),
      redeclare type MolarEnergy = Real(quantity="EPO Internal Energy",unit="J",displayUnit="cal/iu")));

    package TSH_Physiolibrary = Physiolibrary(Types(
      redeclare type Concentration = Real(quantity="TSH Concentration",unit="1/m3",displayUnit="iu/l"),
      redeclare type AmountOfSubstance = Real(quantity="TSH AmountOfSubstance",unit="1",displayUnit="iu"),
      redeclare type MolarFlowRate = Real(quantity="TSH Flow Rate",unit="1/s",displayUnit="iu/min"),
      redeclare type MolarEnergy = Real(quantity="TSH Internal Energy",unit="J",displayUnit="cal/iu")));

  /*  package ADH_Physiolibrary = Physiolibrary(Types(
    redeclare type Concentration = Real(quantity="ADH Concentration",unit="1/m3",displayUnit="iu/l"),
    redeclare type AmountOfSubstance = Real(quantity="ADH AmountOfSubstance",unit="1",displayUnit="iu"),
    redeclare type MolarFlowRate = Real(quantity="ADH Flow Rate",unit="1/s",displayUnit="iu/min"),
    redeclare type MolarEnergy = Real(quantity="ADH Internal Energy",unit="J",displayUnit="cal/iu")));
*/
    package Renin_Physiolibrary = Physiolibrary(Types(
      redeclare type Concentration = Real(quantity="Renin Goldblat Concentration",unit="1/m3",displayUnit="Gu/l"),
      redeclare type AmountOfSubstance = Real(quantity="Renin Goldblat AmountOfSubstance",unit="1",displayUnit="Gu"),
      redeclare type MolarFlowRate = Real(quantity="Renin Goldblat Flow Rate",unit="1/s",displayUnit="Gu/min"),
      redeclare type MolarEnergy = Real(quantity="Renin Goldblat Internal Energy",unit="J",displayUnit="cal/Gu")));

   //  constant Physiolibrary.Types.MolarMass ADHMolarMass=1.084 "kDa = molar mass of arginine vassopressin";

    model Insulin
      extends Physiolibrary.Icons.Pancreas;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

    Insulin_Physiolibrary.Chemical.Components.Substance InsulinPool(
      stateName="InsulinPool.Mass",
      useNormalizedVolume=false,
        NominalSolute(displayUnit="U_Insulin") = 1e-6,
        solute_start(displayUnit="U_Insulin") = 0.324)
      "0.021 mU/ml * 15000 ml  = 307 mU .. all initial extracellular insulin"
      annotation (Placement(transformation(extent={{-86,-26},{-66,-6}})));
    Insulin_Physiolibrary.Chemical.Components.SolutePump secretion(useSoluteFlowInput=
          true)
      annotation (Placement(transformation(extent={{32,-14},{12,6}})));
    Insulin_Physiolibrary.Chemical.Sources.UnlimitedSolutePump synthesis(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{90,-14},{70,6}})));
    Insulin_Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-54,-16},{-34,-36}})));
      Insulin_Physiolibrary.Chemical.Sensors.IncrementalFlowConcentrationMeasure
        PortalVeinConcentration(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-66,2},{-46,22}})));
    Insulin_Physiolibrary.Chemical.Components.Substance InsulinStorage(
      stateName="InsulinStorage.Mass",
      NominalSolute(displayUnit="U_Insulin") = Substances.Insulin.molpIU,
        solute_start(displayUnit="U_Insulin") = 1.95491) "initial 1954.91 mU"
                           annotation (Placement(transformation(
          extent={{-10,10},{10,-10}},
          rotation=180,
          origin={52,-4})));
      Modelica.Blocks.Math.Gain gain(k=0.0571413755/60)
        annotation (Placement(transformation(extent={{-64,-42},{-58,-36}})));
    Physiolibrary.Blocks.Factors.Spline KAEffect(data={{0.0,0.6,0},{0.5,1.0,
          0.05},{50.0,2.0,0}}, Xscale=0.01/Substances.KetoAcids.mw)
      "0.5 mg/dl = 0.005 kg/m3"
      annotation (Placement(transformation(extent={{12,0},{32,20}})));
    Physiolibrary.Blocks.Interpolation.Curve MassEffect(
      data={{0,200,0},{2000,17,-0.02},{3000,0,0}},
      Xscale=1e-3,
      Yscale=1e-3/60)
      "base insulin storage mass 2000 miu caused synthesis of 17 miu/min"
      annotation (Placement(transformation(extent={{58,62},{78,82}})));
    Physiolibrary.Blocks.Factors.Spline GlucoseEffect(data={{0,0.0,0},{105,1.0,
          0.01},{600,50.0,0}}, Xscale=0.01/Substances.Glucose.mw)
      "105 mg/dl = 1.05 kg/m3"
      annotation (Placement(transformation(extent={{12,4},{32,24}})));
    Physiolibrary.Blocks.Factors.Normalization FunctionEffect
      annotation (Placement(transformation(extent={{12,-4},{32,16}})));
    Physiolibrary.Blocks.Factors.Normalization BasicFraction
      annotation (Placement(transformation(extent={{32,8},{12,28}})));
    Physiolibrary.Types.Constants.FrequencyConst            Constant(k=
          0.00014166666666667)
      annotation (Placement(transformation(extent={{56,12},{44,24}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-108,30},{-88,50}}), iconTransformation(
            extent={{-90,-70},{-70,-50}})));
      Insulin_Physiolibrary.Types.RealIO.ConcentrationOutput
                                            Insulin( displayUnit="uU_Insulin/ml")
                        annotation (Placement(transformation(extent={{-88,-70},
                {-68,-50}}), iconTransformation(extent={{80,-20},{120,20}})));
    Insulin_Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1
         annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-84,2})));
    Physiolibrary.Blocks.Math.Integrator integrator(
      stateName="InsulinSynthesis.Rate",
      k=(1/20)/60,
      NominalValue=Substances.Insulin.molpIU,
      y_start=18.1363e-3/60)
      "base synthesis 17 miu/min; tau of synthesis adaptation = 20 min"
                                              annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          rotation=270,
          origin={80,24})));
      Modelica.Blocks.Math.Feedback feedback annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={90,56})));
    equation
    connect(InsulinPool.solute, gain.u) annotation (Line(
        points={{-70,-26},{-70,-39},{-64.6,-39}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(gain.y, clearance.soluteFlow) annotation (Line(
        points={{-57.7,-39},{-40,-39},{-40,-30}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(secretion.soluteFlow, FunctionEffect.y) annotation (Line(
          points={{18,0},{22,0},{22,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FunctionEffect.yBase, KAEffect.y) annotation (Line(
          points={{22,8},{22,6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(KAEffect.yBase, GlucoseEffect.y) annotation (Line(
          points={{22,12},{22,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GlucoseEffect.yBase, BasicFraction.y) annotation (Line(
          points={{22,16},{22,14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, BasicFraction.u) annotation (Line(
          points={{42.5,18},{30,18}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.Glucose, GlucoseEffect.u) annotation (Line(
          points={{-98,40},{-6,40},{-6,14},{14,14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.GITractFunctionEffect, FunctionEffect.u) annotation (Line(
          points={{-98,40},{-5.9,40},{-5.9,6},{14,6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(InsulinPool.q_out, PortalVeinConcentration.q_in) annotation (Line(
          points={{-76,-16},{-76,12},{-66,12}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(InsulinPool.q_out, secretion.q_out) annotation (Line(
          points={{-76,-16},{-58,-16},{-58,-4},{12,-4}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(secretion.q_in, InsulinStorage.q_out) annotation (Line(
          points={{32,-4},{52,-4}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(InsulinStorage.q_out, synthesis.q_out) annotation (Line(
          points={{52,-4},{70,-4}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(clearance.q_in, InsulinPool.q_out) annotation (Line(
          points={{-54,-26},{-58,-26},{-58,-16},{-76,-16}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));

      connect(busConnector.PortalVein_PlasmaFlow, PortalVeinConcentration.solutionFlow)
        annotation (Line(
          points={{-98,40},{-56,40},{-56,19}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-3,3},{-3,3}}));
    connect(busConnector.ECFV_Vol, InsulinPool.solutionVolume) annotation (Line(
        points={{-98,40},{-98,-12},{-80,-12}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      connect(concentrationMeasure1.concentration, Insulin) annotation (Line(
          points={{-84,-6},{-84,10},{-90,10},{-90,-60},{-78,-60}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(InsulinPool.q_out, concentrationMeasure1.q_in) annotation (Line(
          points={{-76,-16},{-80,-16},{-80,2},{-84,2}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure1.concentration, busConnector.Insulin)
        annotation (Line(
          points={{-84,-6},{-84,40},{-98,40}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(feedback.y,integrator. u) annotation (Line(
          points={{90,47},{90,38},{80,38},{80,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(integrator.y,feedback. u2) annotation (Line(
          points={{80,13},{80,4},{62,4},{62,56},{82,56}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(integrator.y, synthesis.soluteFlow) annotation (Line(
        points={{80,13},{80,0},{76,0}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(PortalVeinConcentration.concentration, busConnector.PortalVein_Insulin)
        annotation (Line(
          points={{-56,5.8},{-26,5.8},{-26,40},{-98,40}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(FunctionEffect.y, PortalVeinConcentration.addition) annotation (Line(
          points={{22,2},{-22,2},{-22,24},{-50,24},{-50,16}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(MassEffect.val, feedback.u1) annotation (Line(
          points={{78,72},{90,72},{90,64}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(InsulinStorage.solute, MassEffect.u) annotation (Line(
          points={{46,-14},{46,-20},{40,-20},{40,72},{58,72}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(InsulinStorage.solute, BasicFraction.yBase) annotation (Line(
          points={{46,-14},{46,-20},{40,-20},{40,30},{22,30},{22,20}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(busConnector.KAPool, KAEffect.u) annotation (Line(
        points={{-98,40},{-6,40},{-6,10},{14,10}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-100,80},{100,100}},
              lineColor={0,0,255},
              textString="%name")}));
    end Insulin;

    model Glucagon
     extends Physiolibrary.Icons.Pancreas;
     // outer parameter Real ECF_Vol(final displayUnit="ml");

      Modelica.Blocks.Math.Gain gain(k=0.05/60)
        annotation (Placement(transformation(extent={{-44,-32},{-38,-26}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-34,-6},{-14,-26}})));
    Physiolibrary.Chemical.Components.Substance GlucagonPool(
      stateName="GlucagonPool.Mass",
      useNormalizedVolume=false,
      solute_start=(990.792e-12)/Substances.Glucagon.mw,
        NominalSolute=1e-09)
      "66.2 pg/ml * 15000 ml * 0.001 ng/pg = 993 ng .. all initial extracellular glucagon"
      annotation (Placement(transformation(extent={{-66,-16},{-46,4}})));
      Physiolibrary.Chemical.Sensors.IncrementalFlowConcentrationMeasure
        PortalVeinConcentration(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-54,8},{-34,28}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump synthesis(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{78,-16},{58,4}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant_pG(k(
          displayUnit="ng/min") = (50e-12)/Substances.Glucagon.mw/60)
      "50 ng/min"
      annotation (Placement(transformation(extent={{80,18},{72,26}})));
    Physiolibrary.Blocks.Factors.Spline InsulinEffect(data={{0,6.0,0},{7,1.3,-0.020},
          {20,1.0,-0.006},{100,0.6,0}}, Xscale=Substances.Insulin.molpIU)
      annotation (Placement(transformation(extent={{78,0},{58,20}})));
    Physiolibrary.Blocks.Factors.Spline GlucoseEffect(data={{0,2.5,0},{70,1.1,-0.005},
          {110,1.0,-0.001},{400,0.6,0}}, Xscale=0.01/Substances.Glucose.mw)
      annotation (Placement(transformation(extent={{58,4},{78,24}})));
    Physiolibrary.Blocks.Factors.Normalization FunctionEffect
      annotation (Placement(transformation(extent={{58,-4},{78,16}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-98,68},{-78,88}}), iconTransformation(extent=
             {{-90,-70},{-70,-50}})));
      Insulin_Physiolibrary.Types.RealIO.ConcentrationInput Insulin(
                                            displayUnit="uU_insulin/ml") annotation (Placement(
            transformation(extent={{58,34},{78,54}}), iconTransformation(extent={{-100,40},
                {-60,80}})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          origin={-60,8})));
      Physiolibrary.Types.RealIO.ConcentrationOutput
                                            Glucagon( displayUnit=
               "ng/l")  annotation (Placement(transformation(extent={{-78,-60},
                {-58,-40}}), iconTransformation(extent={{80,-20},{120,20}})));
    equation

    connect(GlucagonPool.solute, gain.u) annotation (Line(
        points={{-50,-16},{-50,-29},{-44.6,-29}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(gain.y, clearance.soluteFlow) annotation (Line(
        points={{-37.7,-29},{-20,-29},{-20,-20}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(clearance.q_in, GlucagonPool.q_out) annotation (Line(
          points={{-34,-16},{-38,-16},{-38,-6},{-56,-6}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(GlucagonPool.q_out, PortalVeinConcentration.q_in) annotation (
          Line(
          points={{-56,-6},{-54,-6},{-54,18}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(PortalVeinConcentration.concentration, busConnector.PortalVein_Glucagon)
        annotation (Line(
          points={{-44,11.8},{4.1,11.8},{4.1,78},{-88,78}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.GITractFunctionEffect, FunctionEffect.u) annotation (Line(
          points={{-88,78},{12.1,78},{12.1,6},{60,6}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(busConnector.Glucose, GlucoseEffect.u) annotation (Line(
          points={{-88,78},{12,78},{12,14},{60,14}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(InsulinEffect.yBase, GlucoseEffect.y) annotation (Line(
          points={{68,12},{68,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(InsulinEffect.y, FunctionEffect.yBase) annotation (Line(
          points={{68,6},{68,8}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(synthesis.soluteFlow, FunctionEffect.y) annotation (Line(
        points={{64,-2},{64,0},{68,0},{68,2}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(hormoneFlowConstant_pG.y, GlucoseEffect.yBase) annotation (Line(
          points={{71,22},{68,22},{68,16}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(synthesis.q_out, GlucagonPool.q_out) annotation (Line(
          points={{58,-6},{-56,-6}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));

      connect(Insulin, InsulinEffect.u) annotation (Line(
          points={{68,44},{90,44},{90,10},{76,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GlucagonPool.q_out, concentrationMeasure.q_in) annotation (Line(
          points={{-56,-6},{-54,-6},{-54,8},{-60,8}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Glucagon) annotation (Line(
          points={{-60,0},{-80,0},{-80,-50},{-68,-50}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.Glucagon_conc, concentrationMeasure.concentration)
        annotation (Line(
          points={{-88,78},{-88,0},{-60,0}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(FunctionEffect.y, PortalVeinConcentration.addition) annotation (Line(
          points={{68,2},{8,2},{8,28},{-38,28},{-38,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.PortalVein_PlasmaFlow, PortalVeinConcentration.solutionFlow)
        annotation (Line(
          points={{-88,78},{-44,78},{-44,25}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.ECFV_Vol, GlucagonPool.solutionVolume) annotation (Line(
          points={{-88,78},{-92,78},{-92,-2},{-60,-2}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-100,80},{100,100}},
              lineColor={0,0,255},
              textString="%name")}));
    end Glucagon;

    model ADH
      extends Physiolibrary.Icons.Hypophysis;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

      constant Physiolibrary.Types.Volume NormalMedullaVolume = 31e-6
      "Normal kidney medulla volume (31ml)";
      constant Physiolibrary.Types.Volume NormalECFVolume = 14.3610097207699e-3
      "normal volume of extracellular fluid (15L)";

    Physiolibrary.Chemical.Components.Substance ADHPool(
      stateName="ADHPool.Mass",
      useNormalizedVolume=false,
      solute_start(displayUnit="pmol") = 30e-12/Substances.Vasopressin.mw,
      NominalSolute(displayUnit="mol") = 1e-11)
      "2e-6 g/m3 * 15e-3 m3 = 30e-9 g  .. all initial extracellular insulin"
      annotation (Placement(transformation(extent={{-88,-24},{-68,-4}})));
    Physiolibrary.Chemical.Components.SolutePump secretion(useSoluteFlowInput=
          true)
      annotation (Placement(transformation(extent={{-24,-14},{-44,6}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump synthesis(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{98,-14},{78,6}})));
    Physiolibrary.Chemical.Components.Clearance Liver_clearance(
        useSolutionFlowInput=true, K=0.5)
      annotation (Placement(transformation(extent={{-34,-42},{-14,-22}})));
    Physiolibrary.Blocks.Factors.Spline NeuralEffect(data={{0.50,0.4,0},{1.00,
          1.0,0.4},{1.20,2.0,5.0},{1.50,20.0,0}})
      annotation (Placement(transformation(extent={{-48,8},{-28,28}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k(
          displayUnit="mol/min") = (3.2e-12)/60/Substances.Vasopressin.mw)
      "3.2 ng/min = 3.2/60 ng/s =3.2e-12/60 kg/s"
      annotation (Placement(transformation(extent={{96,20},{90,26}})));
    Physiolibrary.Blocks.Factors.Spline OsmEffect(data={{0.243,0.0,0},{0.253,
          1.0,180},{0.263,5.0,0}}, Xscale=1000)
      annotation (Placement(transformation(extent={{-48,16},{-28,36}})));
    Physiolibrary.Blocks.Factors.Normalization BasicFraction(NormalValue=3.2e-9
          /Substances.Vasopressin.mw)
      annotation (Placement(transformation(extent={{-28,24},{-48,44}})));
    Physiolibrary.Chemical.Components.Clearance Kidney_clearance(
        useSolutionFlowInput=true, K=0.59)
      annotation (Placement(transformation(extent={{-34,-70},{-14,-50}})));
    Physiolibrary.Chemical.Components.Clearance Other_clearance(
        useSolutionFlowInput=true, K=1)
      annotation (Placement(transformation(extent={{-34,-100},{-14,-80}})));
      Physiolibrary.Chemical.Components.Substance           SlowMass(
                                     stateName="ADHSlowMass.Mass",
      solute_start(displayUnit="nmol") = 1.57e-08,
      NominalSolute(displayUnit="mol") = 1e-08)
        annotation (Placement(transformation(extent={{-10,10},{10,-10}},
            rotation=180,
            origin={66,-4})));
      Physiolibrary.Chemical.Components.Substance           FastMass(
                                     stateName="ADHFastMass.Mass",
      solute_start(displayUnit="nmol") = 2.95e-09,
      NominalSolute(displayUnit="mol") = 1e-9)
        annotation (Placement(transformation(extent={{-10,10},{10,-10}},
            rotation=180,
            origin={6,-4})));
    Physiolibrary.Blocks.Factors.Spline Feedback(data={{0,4.0,0},{17000,1.0,-0.0003},
          {20000,0.0,0}}, Xscale=(1e-12)/Substances.Vasopressin.mw)
      annotation (Placement(transformation(extent={{74,2},{94,22}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-100,18},{-80,38}}), iconTransformation(
            extent={{-90,-70},{-70,-50}})));
    Physiolibrary.Chemical.Components.SolutePump fluxDown(useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{28,6},{38,16}})));
    Physiolibrary.Chemical.Components.SolutePump fluxUp(useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{38,-14},{28,-24}})));
      Modelica.Blocks.Math.Gain gain1(k(unit="1/s")=0.0043/60)
        annotation (Placement(transformation(extent={{-5,-5},{5,5}},
            rotation=270,
            origin={35,25})));
      Modelica.Blocks.Math.Gain gain3(k(unit="1/s")=0.001/60)
        annotation (Placement(transformation(extent={{-5,-5},{5,5}},
            rotation=90,
            origin={31,-35})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant1(k(
          displayUnit="mol/min") = (3.2e-12)/60/Substances.Vasopressin.mw)
      annotation (Placement(transformation(extent={{-22,42},{-28,48}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1
        annotation (Placement(transformation(extent={{-94,-6},{-74,14}})));
    equation
      connect(NeuralEffect.yBase, OsmEffect.y) annotation (Line(
          points={{-38,20},{-38,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(OsmEffect.yBase, BasicFraction.y)     annotation (Line(
          points={{-38,28},{-38,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.Osmreceptors, OsmEffect.u)
                                        annotation (Line(
          points={{-90,28},{-90,26},{-46,26}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(busConnector.SympsCNS_PituitaryNA, NeuralEffect.u)
                                  annotation (Line(
          points={{-90,28},{-90.9,28},{-90.9,18},{-46,18}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(ADHPool.q_out, secretion.q_out)     annotation (Line(
          points={{-78,-14},{-58,-14},{-58,-4},{-44,-4}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(Liver_clearance.q_in, ADHPool.q_out)
                                                 annotation (Line(
          points={{-34,-32},{-58,-32},{-58,-14},{-78,-14}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(ADHPool.q_out, Kidney_clearance.q_in) annotation (Line(
          points={{-78,-14},{-58,-14},{-58,-60},{-34,-60}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(ADHPool.q_out, Other_clearance.q_in) annotation (Line(
          points={{-78,-14},{-58,-14},{-58,-90},{-34,-90}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(NeuralEffect.y, secretion.soluteFlow) annotation (Line(
          points={{-38,14},{-38,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(secretion.q_in, FastMass.q_out) annotation (Line(
          points={{-24,-4},{6,-4}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(SlowMass.q_out, synthesis.q_out) annotation (Line(
          points={{66,-4},{78,-4}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
    connect(Feedback.y, synthesis.soluteFlow) annotation (Line(
        points={{84,8},{84,0}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(Feedback.yBase, hormoneFlowConstant.y) annotation (Line(
          points={{84,14},{84,23},{89.25,23}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SlowMass.solute, Feedback.u) annotation (Line(
          points={{60,-14},{60,-16},{70,-16},{70,12},{76,12}},
          color={0,0,127},
          smooth=Smooth.None));

    connect(busConnector.Kidney_BloodFlow, Kidney_clearance.solutionFlow)
      annotation (Line(
        points={{-90,28},{-96,28},{-96,-53},{-24,-53}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.OtherTissue_BloodFlow, Other_clearance.solutionFlow)
      annotation (Line(
        points={{-90,28},{-96,28},{-96,-83},{-24,-83}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      connect(gain1.y, fluxDown.soluteFlow) annotation (Line(
          points={{35,19.5},{35,13}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FastMass.solute, gain1.u) annotation (Line(
          points={{-8.88178e-016,-14},{-8.88178e-016,38},{35,38},{35,31}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain3.y, fluxUp.soluteFlow) annotation (Line(
          points={{31,-29.5},{31,-21}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain3.u, SlowMass.solute) annotation (Line(
          points={{31,-41},{31,-46},{60,-46},{60,-14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(fluxDown.q_out, SlowMass.q_out) annotation (Line(
          points={{38,11},{46,11},{46,-4},{66,-4}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(fluxUp.q_in, SlowMass.q_out) annotation (Line(
          points={{38,-19},{46,-19},{46,-4},{66,-4}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(FastMass.q_out, fluxDown.q_in) annotation (Line(
          points={{6,-4},{24,-4},{24,11},{28,11}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
      connect(FastMass.q_out, fluxUp.q_out) annotation (Line(
          points={{6,-4},{24,-4},{24,-19},{28,-19}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
    connect(busConnector.GITract_BloodFlow, Liver_clearance.solutionFlow)
      annotation (Line(
        points={{-90,28},{-96,28},{-96,-25},{-24,-25}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(ADHPool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
        points={{-82,-10},{-82,-6},{-94,-6},{-94,28},{-90,28}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      connect(hormoneFlowConstant1.y, BasicFraction.yBase) annotation (Line(
          points={{-28.75,45},{-38,45},{-38,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BasicFraction.u, FastMass.solute) annotation (Line(
          points={{-30,34},{-12,34},{-12,-18},{-8.88178e-016,-18},{
            -8.88178e-016,-14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ADHPool.q_out, concentrationMeasure1.q_in) annotation (Line(
          points={{-78,-14},{-78,4},{-84,4}},
          color={107,45,134},
          thickness=1,
          smooth=Smooth.None));
    connect(concentrationMeasure1.concentration, busConnector.Vasopressin)
      annotation (Line(
        points={{-84,-4},{-84,28},{-90,28}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation (      Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-112,120},{122,98}},
              lineColor={0,0,255},
              textString="%name")}));
    end ADH;

    model Aldosterone
      extends Physiolibrary.Icons.AdrenalGland;

    Physiolibrary.Chemical.Components.Substance AldoPool(
      stateName="AldoPool.Mass",
      useNormalizedVolume=false,
      solute_start(displayUnit="pmol") = 1.34779e-08,
      NominalSolute=1e-09)
      " 0.33 pmol/ml * 43000 ml = 14190.0 pmol .. all initial extracellular insulin"
      annotation (Placement(transformation(extent={{-50,-26},{-30,-6}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump adrenalCortex(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{66,-14},{46,6}})));
    Physiolibrary.Chemical.Components.Clearance Clearance(K=0.78,
        useSolutionFlowInput=true)
      annotation (Placement(transformation(extent={{2,-42},{22,-22}})));
    Physiolibrary.Blocks.Factors.Spline KEffect(data={{3.0,0.3,0},{4.4,1.0,1.0},
          {6.0,3.0,0}})
      annotation (Placement(transformation(extent={{46,0},{66,20}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k(displayUnit="mol/min") = 5.5e-12)
      annotation (Placement(transformation(extent={{68,26},{60,34}})));
    Physiolibrary.Blocks.Factors.Spline A2Effect(
      data={{0.0,0.4,0},{1.3,1.0,1.0},{4.0,4.0,0}},
      Xscale=1e-9/Substances.AngiotensinII.mw,
      UsePositiveLog10=true)
      annotation (Placement(transformation(extent={{46,4},{66,24}})));
    Physiolibrary.Blocks.Factors.Normalization FunctionEffect
      annotation (Placement(transformation(extent={{46,8},{66,28}})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
         annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-44,-2})));                                               //(toAnotherUnitCoef=1000, unitsString="pmol/l")
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{0,-68},{20,-48}})));
      Modelica.Blocks.Math.Gain DegradeK(k=0.0007/60)
        annotation (Placement(transformation(extent={{-3,-3},{3,3}},
            origin={-3,-49})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-100,80},{-80,100}}), iconTransformation(
            extent={{-90,-70},{-70,-50}})));
      Modelica.Blocks.Interfaces.RealInput AngiotensinII annotation (Placement(transformation(extent={{-28,4},{
              -8,24}}), iconTransformation(extent={{-100,40},{-60,80}})));
      Modelica.Blocks.Interfaces.RealOutput Aldo(
                                          quantity="Concentration", final displayUnit=
            "pmol/l")   annotation (Placement(transformation(extent={{-36,34},{-16,54}}),
                             iconTransformation(extent={{80,-20},{120,20}})));
                                                                    //(toAnotherUnitCoef=36, unitsString="ng/dl")
    equation
     connect(KEffect.yBase, A2Effect.y)       annotation (Line(
          points={{56,12},{56,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(A2Effect.yBase, FunctionEffect.y)     annotation (Line(
          points={{56,16},{56,14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(AldoPool.q_out, adrenalCortex.q_out)
                                                  annotation (Line(
          points={{-40,-16},{-22,-16},{-22,-4},{46,-4}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(Clearance.q_in, AldoPool.q_out)    annotation (Line(
          points={{2,-32},{-22,-32},{-22,-16},{-40,-16}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure.q_in, AldoPool.q_out)    annotation (Line(
          points={{-44,-4},{-39.2,-4},{-39.2,-16},{-40,-16}},
          color={200,0,0},
          smooth=Smooth.None));
      connect(AldoPool.q_out, Degradation.q_in) annotation (Line(
          points={{-40,-16},{-22,-16},{-22,-58},{0,-58}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(busConnector.BodyH2O_Vol, AldoPool.solutionVolume) annotation (Line(
        points={{-90,90},{-90,-12},{-44,-12}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.Liver_BloodFlow, Clearance.solutionFlow) annotation (
        Line(
        points={{-90,90},{12,90},{12,-25}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(AldoPool.solute, DegradeK.u) annotation (Line(
        points={{-34,-26},{-34,-49},{-6.6,-49}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(FunctionEffect.u, busConnector. OtherTissueFunctionEffect) annotation (Line(
          points={{48,18},{12,18},{12,90},{-90,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%second",
     index=1,
     extent={{6,3},{6,3}}));
    connect(adrenalCortex.soluteFlow, KEffect.y) annotation (Line(
        points={{52,0},{52,2},{56,2},{56,6}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(FunctionEffect.yBase, hormoneFlowConstant.y) annotation (Line(
          points={{56,20},{56,30},{59,30}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(Degradation.soluteFlow, DegradeK.y) annotation (Line(
        points={{14,-54},{14,-49},{0.3,-49}},
        color={0,0,127},
        smooth=Smooth.None));

    connect(AngiotensinII, A2Effect.u)
      annotation (Line(
        points={{-18,14},{48,14}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(concentrationMeasure.concentration, Aldo) annotation (Line(
        points={{-44,2},{-44,44},{-26,44}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.Aldosterone, concentrationMeasure.concentration) annotation (Line(
        points={{-90,90},{-90,2},{-44,2}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.KPool, KEffect.u) annotation (Line(
        points={{-90,90},{12,90},{12,10},{48,10}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-116,104},{118,82}},
              lineColor={0,0,255},
              textString="%name")}));
    end Aldosterone;

    model ANP
      extends Physiolibrary.Icons.Heart;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

    Physiolibrary.Chemical.Components.Substance ANPPool(
      stateName="ANPPool.Mass",
      useNormalizedVolume=false,
        solute_start(displayUnit="pmol") = 2.85895e-10,
      NominalSolute=1e-12) "default = 20 pmol/l"
      annotation (Placement(transformation(extent={{-30,-42},{-10,-22}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{48,-54},{28,-34}})));
    Physiolibrary.Blocks.Factors.Spline LAPEffect(data={{0.0,0.0,0},{8.0,1.0,
          0.4},{20.0,10.0,0}}, Xscale=101325/760)
      annotation (Placement(transformation(extent={{54,60},{34,80}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k=
          6.8333333333333e-13)
      annotation (Placement(transformation(extent={{6,82},{-2,90}})));
    Physiolibrary.Blocks.Factors.Spline RAPEffect(data={{0.0,0.0,0},{4.0,1.0,
          0.4},{20.0,10.0,0}}, Xscale=101325/760)
      annotation (Placement(transformation(extent={{-16,60},{4,80}})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-26,-16})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{12,-86},{32,-66}})));
      Modelica.Blocks.Math.Gain DegradeK(k=0.223/60)
        annotation (Placement(transformation(extent={{-3,-3},{3,3}},
            origin={7,-65})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant1(k=
          4.3333333333333e-13)
      annotation (Placement(transformation(extent={{56,82},{48,90}})));
      Modelica.Blocks.Math.Add SteadyState annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={38,42})));
    Physiolibrary.Blocks.Math.Integrator integrator(
      stateName="ANPSecretion.NaturalRate",
      k=(1/20)/60,
      y_start=67e-12/60)
                   annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          rotation=270,
          origin={38,-14})));
      Modelica.Blocks.Math.Feedback feedback annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={38,18})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-104,84},{-84,104}}), iconTransformation(
            extent={{-90,-70},{-70,-50}})));
      Modelica.Blocks.Interfaces.RealOutput ANP(
                                         quantity="Concentration", final displayUnit=
            "pmol/l",
      nominal=1e-8)                                           annotation (
          Placement(transformation(extent={{-24,2},{-4,22}}),
            iconTransformation(extent={{80,-20},{120,20}})));
    Physiolibrary.Blocks.Math.Log10AsEffect log10_1
      annotation (Placement(transformation(extent={{-32,6},{-44,18}})));
    Physiolibrary.Blocks.Math.Log10AsEffect log10_2
      annotation (Placement(transformation(extent={{-52,-88},{-64,-76}})));
    Physiolibrary.Blocks.Math.Integrator integrator1(
      stateName="NephronANP.[ANPDelayed]",
      k=(1/20)/60,
      y_start=20e-9) "initial 20 pmol/l"
                   annotation (Placement(transformation(
          extent={{-5,-5},{5,5}},
          rotation=270,
          origin={-35,-65})));
      Modelica.Blocks.Math.Feedback feedback1
                                             annotation (Placement(
            transformation(
            extent={{-7,-7},{7,7}},
            rotation=270,
            origin={-35,-47})));
      Modelica.Blocks.Interfaces.RealOutput NephronANP_Log10Conc
                        annotation (Placement(transformation(extent={{-94,-64},
                {-74,-44}}), iconTransformation(extent={{80,-60},{120,-20}})));
    equation
      connect(ANPPool.q_out, secretion.q_out)     annotation (Line(
          points={{-20,-32},{-2,-32},{-2,-44},{28,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure.q_in, ANPPool.q_out)     annotation (Line(
          points={{-26,-18},{-19.2,-18},{-19.2,-32},{-20,-32}},
          color={200,0,0},
          smooth=Smooth.None));
      connect(ANPPool.q_out, Degradation.q_in) annotation (Line(
          points={{-20,-32},{-2,-32},{-2,-76},{12,-76}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(ANPPool.solute, DegradeK.u) annotation (Line(
        points={{-14,-42},{-14,-65},{3.4,-65}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(Degradation.soluteFlow, DegradeK.y) annotation (Line(
        points={{26,-72},{26,-65},{10.3,-65}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(hormoneFlowConstant1.y, LAPEffect.yBase) annotation (Line(
          points={{47,86},{44,86},{44,72}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hormoneFlowConstant.y, RAPEffect.yBase) annotation (Line(
          points={{-3,86},{-6,86},{-6,72}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(RAPEffect.y, SteadyState.u2) annotation (Line(
          points={{-6,66},{-6,60},{32,60},{32,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(LAPEffect.y, SteadyState.u1) annotation (Line(
          points={{44,66},{44,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(feedback.y,integrator. u) annotation (Line(
          points={{38,9},{38,-2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(integrator.y,feedback. u2) annotation (Line(
          points={{38,-25},{38,-34},{14,-34},{14,18},{30,18}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SteadyState.y, feedback.u1) annotation (Line(
          points={{38,31},{38,26}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(integrator.y, secretion.soluteFlow) annotation (Line(
        points={{38,-25},{38,-40},{34,-40}},
        color={0,0,127},
        smooth=Smooth.None));

    connect(concentrationMeasure.concentration, ANP) annotation (Line(
        points={{-26,-12},{-26,12},{-14,12}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(concentrationMeasure.concentration, log10_1.u) annotation (Line(
        points={{-26,-12},{-26,12},{-30.8,12}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.NephronANP_Log10Conc, log10_2.y) annotation (Line(
          points={{-94,94},{-94,-82},{-64.6,-82}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.ANPPool_Log10Conc, log10_1.y) annotation (Line(
          points={{-94,94},{-94,12},{-44.6,12}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
    connect(busConnector.ANP, concentrationMeasure.concentration) annotation (
        Line(
        points={{-94,94},{-94,-8},{-26,-8},{-26,-12}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.ECFV_Vol, ANPPool.solutionVolume) annotation (Line(
        points={{-94,94},{-94,-28},{-24,-28}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      connect(feedback1.y, integrator1.u)
                                        annotation (Line(
          points={{-35,-53.3},{-36,-54},{-35,-54},{-35,-59}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(integrator1.y, feedback1.u2)
                                         annotation (Line(
          points={{-35,-70.5},{-35,-74},{-50,-74},{-50,-47},{-40.6,-47}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(integrator1.y, log10_2.u) annotation (Line(
          points={{-35,-70.5},{-35,-82},{-50.8,-82}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, feedback1.u1) annotation (Line(
        points={{-26,-12},{-26,-8},{-35,-8},{-35,-41.4}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(log10_2.y, NephronANP_Log10Conc) annotation (Line(
          points={{-64.6,-82},{-94,-82},{-94,-54},{-84,-54}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(busConnector.rightAtrium_TMP, RAPEffect.u) annotation (Line(
        points={{-94,94},{-94,70},{-14,70},{-14,70}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(LAPEffect.u, busConnector.leftAtrium_TMP) annotation (Line(
        points={{52,70},{86,70},{86,94},{-94,94}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-120,94},{114,72}},
              lineColor={0,0,255},
              textString="%name")}));
    end ANP;

    model EPO
      extends Physiolibrary.Icons.Kidney;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

    EPO_Physiolibrary.Chemical.Components.Substance EPOPool(
      stateName="EPOPool.Mass",
      useNormalizedVolume=false,
      solute_start=(20e3*14361.0097207699*0.4)*1e-6)
      "default = 20 iu/l = 20e3 iu/m3 "
      annotation (Placement(transformation(extent={{-50,-54},{-30,-34}})));
      //NominalSolute=Substances.Erythropoietin.molpIU

    EPO_Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
    Physiolibrary.Blocks.Factors.Normalization CountEffect
      annotation (Placement(transformation(extent={{56,24},{76,44}})));
    Physiolibrary.Types.Constants.FractionConst             hormoneFlowConstant(k=1)
             annotation (Placement(transformation(extent={{-4,32},{-12,40}})));
    Physiolibrary.Blocks.Factors.Spline PO2Effect(data={{0.0,4.0,0},{35.0,0.0,-0.14},
          {60.0,-1.0,0}}, Xscale=101325/760)
      "cortex pO2=50 mmHg; medulla pO2 = 10-20 mmHg [Brezis&Rosen1995]; erythropoietin-producing cells are in the interstitium of the cortex and outer medulla [Maxwell1993]"
      annotation (Placement(transformation(extent={{-24,14},{-4,34}})));
    EPO_Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
         annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-38,-32})));                                              //(toAnotherUnitCoef=1000, unitsString="U/l")
    EPO_Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
      Modelica.Blocks.Math.Gain K(k(unit="1/s")=0.00555/60)
        annotation (Placement(transformation(extent={{-3,-3},{3,3}},
            origin={-31,-77})));
    EPO_Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant1(k=(
          0.67)/60)
      annotation (Placement(transformation(extent={{82,42},{70,54}})));
      Modelica.Blocks.Math.Gain VODIST(k=0.4)
        annotation (Placement(transformation(extent={{-6,-6},{6,6}},
            origin={-64,-40})));
    Physiolibrary.Blocks.Math.Power avg1
      annotation (Placement(transformation(extent={{-8,10},{0,18}})));
    Physiolibrary.Blocks.Factors.Normalization FunctionEffect
      annotation (Placement(transformation(extent={{56,14},{76,34}})));
    Physiolibrary.Blocks.Factors.Normalization PO2Effect_
      annotation (Placement(transformation(extent={{56,4},{76,24}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-88,78},{-68,98}}), iconTransformation(extent=
             {{-90,-70},{-70,-50}})));
      EPO_Physiolibrary.Types.RealIO.ConcentrationOutput
                                            Erythropoetin                  annotation (
          Placement(transformation(extent={{-2,-38},{18,-18}}),
            iconTransformation(extent={{80,-20},{120,20}})));
    equation
      connect(EPOPool.q_out, secretion.q_out)     annotation (Line(
          points={{-40,-44},{56,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure.q_in,EPOPool. q_out)     annotation (Line(
          points={{-38,-34},{-38,-44},{-40,-44}},
          color={200,0,0},
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, busConnector.Erythropoietin) annotation (
        Line(
        points={{-38,-28},{-37,-28},{-37,88},{-78,88}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      connect(EPOPool.q_out, Clearance.q_in)   annotation (Line(
          points={{-40,-44},{-54,-44},{-54,-88},{-30,-88}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(EPOPool.solute, K.u) annotation (Line(
        points={{-34,-54},{-34,-77},{-34.6,-77}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(Clearance.soluteFlow, K.y) annotation (Line(
        points={{-16,-84},{-16,-77},{-27.7,-77}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.KidneyO2_TubulePO2, PO2Effect.u)
                                            annotation (Line(
          points={{-78,88},{-64.9,88},{-64.9,24},{-22,24}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(busConnector.Kidney_NephronCount_Total_xNormal, CountEffect.u)
                                           annotation (Line(
          points={{-78,88},{5.1,88},{5.1,34},{58,34}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(hormoneFlowConstant1.y, CountEffect.yBase)
                                                       annotation (Line(
          points={{68.5,48},{66,48},{66,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hormoneFlowConstant.y,PO2Effect. yBase) annotation (Line(
          points={{-13,36},{-14,36},{-14,26}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ECFV_Vol, VODIST.u) annotation (Line(
          points={{-78,88},{-90.6,88},{-90.6,-40},{-71.2,-40}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));

      connect(CountEffect.y, FunctionEffect.yBase) annotation (Line(
          points={{66,30},{66,26}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FunctionEffect.y, PO2Effect_.yBase) annotation (Line(
          points={{66,20},{66,16}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(PO2Effect_.y, secretion.soluteFlow) annotation (Line(
        points={{66,10},{66,-16},{66,-40},{62,-40}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(avg1.y, PO2Effect_.u) annotation (Line(
          points={{0.4,14},{58,14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FunctionEffect.u, busConnector. KidneyFunctionEffect) annotation (Line(
          points={{58,24},{5.1,24},{5.1,88},{-78,88}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%second",
     index=1,
     extent={{6,3},{6,3}}));

    connect(concentrationMeasure.concentration, Erythropoetin) annotation (Line(
        points={{-38,-28},{8,-28}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(VODIST.y, EPOPool.solutionVolume) annotation (Line(
        points={{-57.4,-40},{-44,-40}},
        color={0,0,127},
        smooth=Smooth.None));

      connect(PO2Effect.y, avg1.exponent)
        annotation (Line(
          points={{-14,20},{-14,11.6},{-8,11.6}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-116,104},{118,82}},
              lineColor={0,0,255},
              textString="%name")}));
    end EPO;

    model Thyroxine
     extends Physiolibrary.Icons.ThyroidGland;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

    Physiolibrary.Chemical.Components.Substance ThyroidPool(
      stateName="ThyroidPool.Mass",
      useNormalizedVolume=false,
      solute_start=1168.05e-9/Substances.Thyroxine.mw,
      NominalSolute=1e-09)
      "default = 8.6 ug/dl = 8.6e-2 kg/m3, initial 1168.05 ug"
      annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k(
          displayUnit="ng/min") = 8.33e-13/Substances.Thyroxine.mw)
      "typical degradation: 72 ug/day = 8.33e-13 kg/s (T3 .. 33.5 ug/day, T4 .. 87 ug/day)"
      annotation (Placement(transformation(extent={{80,-24},{68,-12}})));
    Physiolibrary.Blocks.Factors.Spline TSHEffect(data={{0.0,0.0,0},{4.0,1.0,
          0.4},{30.0,10.0,0}}) "4 uIU/ml = 4 IU/m3"
      annotation (Placement(transformation(extent={{56,-40},{76,-20}})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-76,-30})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
      Modelica.Blocks.Math.Gain K(k(unit="1/s")=0.000041/60,y(unit="mol/s"))
      "typical degradation: 72 ug/day (T3 .. 33.5 ug/day, T4 .. 87 ug/day)"
        annotation (Placement(transformation(extent={{-3,-3},{3,3}},
            origin={-35,-77})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-88,78},{-68,98}}), iconTransformation(extent=
             {{-90,70},{-70,90}})));
      TSH_Physiolibrary.Types.RealIO.ConcentrationInput TSH(displayUnit=
            "uU_TSH/ml") "thyrotropin" annotation (Placement(transformation(extent=
                {{4,-40},{24,-20}}), iconTransformation(extent={{-100,0},{-60,
                40}})));
      Physiolibrary.Types.RealIO.ConcentrationOutput Thyroxine annotation (Placement(transformation(extent={{-50,-18},
                {-30,2}}),   iconTransformation(extent={{80,-20},{120,20}})));
    Physiolibrary.Blocks.Interpolation.Curve curve(
      x={0,8,40},
      y={0.7,1.0,1.5},
      slope={0,0.4,0},
      Xscale=1e-5/Substances.Thyroxine.mw) "8 ug/dl = 8e-9/1e-4 kg/m3"
      annotation (Placement(transformation(extent={{-54,18},{-34,38}})));
    equation
     connect(ThyroidPool.q_out, secretion.q_out) annotation (Line(
          points={{-72,-44},{56,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure.q_in, ThyroidPool.q_out) annotation (Line(
          points={{-76,-30},{-71.2,-30},{-71.2,-44},{-72,-44}},
          color={200,0,0},
          smooth=Smooth.None));
      connect(ThyroidPool.q_out, Clearance.q_in)
                                               annotation (Line(
          points={{-72,-44},{-54,-44},{-54,-88},{-30,-88}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(ThyroidPool.solute, K.u) annotation (Line(
        points={{-66,-54},{-66,-77},{-38.6,-77}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(Clearance.soluteFlow, K.y) annotation (Line(
        points={{-16,-84},{-16,-77},{-31.7,-77}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(hormoneFlowConstant.y,TSHEffect. yBase) annotation (Line(
          points={{66.5,-18},{66,-18},{66,-28}},
          color={0,0,127},
          smooth=Smooth.None));

    connect(secretion.soluteFlow, TSHEffect.y) annotation (Line(
        points={{62,-40},{62,-38},{66,-38},{66,-34}},
        color={0,0,127},
        smooth=Smooth.None));

      connect(TSH, TSHEffect.u) annotation (Line(
          points={{14,-30},{58,-30}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(busConnector.ECFV_Vol, ThyroidPool.solutionVolume) annotation (Line(
        points={{-78,88},{-94,88},{-94,-40},{-76,-40}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      connect(concentrationMeasure.concentration, Thyroxine) annotation (Line(
          points={{-76,-38},{-76,-8},{-40,-8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(concentrationMeasure.concentration, curve.u) annotation (Line(
          points={{-76,-38},{-76,28},{-54,28}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, busConnector.Thyroxine)
      annotation (Line(
        points={{-76,-38},{-76,88},{-78,88}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-124,114},{118,90}},
              lineColor={0,0,255},
              textString="%name")}));
    end Thyroxine;

    model Thyrotropin
      extends Physiolibrary.Icons.Hypophysis;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

    TSH_Physiolibrary.Types.Constants.ConcentrationConst hormoneConstant(k=4)
      "4 uU/ml"
      annotation (Placement(transformation(extent={{-8,30},{-20,42}})));
    Physiolibrary.Blocks.Factors.Spline ThyroxineEffect(data={{0.0,8.0,0},{8.0,
          1.0,-0.2},{20.0,0.0,0}}, Xscale=1e-5/Substances.Thyroxine.mw)
      "8 ug/dl = 8e-9/1e-4 kg/m3"
      annotation (Placement(transformation(extent={{-34,12},{-14,32}})));
    Physiolibrary.Blocks.Factors.Normalization HypothalamusTSH
      annotation (Placement(transformation(extent={{-14,2},{-34,22}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{44,28},{64,48}}), iconTransformation(extent={
              {-90,-70},{-70,-50}})));
      TSH_Physiolibrary.Types.RealIO.ConcentrationOutput
                                            TSH "thyrotropin" annotation (Placement(transformation(extent={{-20,-18},
              {0,2}}),                iconTransformation(extent={{80,-20},{120,
                20}})));
      Physiolibrary.Types.RealIO.ConcentrationInput
                                           Thyroxine annotation (Placement(transformation(extent={{-78,12},
              {-58,32}}),  iconTransformation(extent={{-100,60},{-60,100}})));
    Physiolibrary.Blocks.Factors.Spline TemperatureEffect_(data={{-2.0,4.0,0},{
          0.0,1.0,-1.0},{2.0,0.2,0}})
      annotation (Placement(transformation(extent={{46,14},{26,34}})));
      Modelica.Blocks.Math.Feedback feedback
        annotation (Placement(transformation(extent={{66,18},{54,30}})));
    Physiolibrary.Types.Constants.TemperatureConst temperatureConstant(k=310.15)
      annotation (Placement(transformation(extent={{80,10},{72,18}})));
    equation
    connect(hormoneConstant.y, ThyroxineEffect.yBase) annotation (Line(
        points={{-21.5,36},{-24,36},{-24,24}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(ThyroxineEffect.y, HypothalamusTSH.yBase)   annotation (Line(
          points={{-24,18},{-24,14}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(HypothalamusTSH.y, TSH)   annotation (Line(
          points={{-24,8},{-24,-8},{-10,-8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Thyroxine, ThyroxineEffect.u) annotation (Line(
          points={{-68,22},{-32,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.brain_FunctionEffect, TemperatureEffect_.yBase)
        annotation (Line(
          points={{54,38},{36,38},{36,26}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(TemperatureEffect_.u, feedback.y) annotation (Line(
          points={{44,24},{54.6,24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(feedback.u1, busConnector.HeatCore_Temp) annotation (Line(
          points={{64.8,24},{90,24},{90,38},{54,38}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(feedback.u2, temperatureConstant.y) annotation (Line(
          points={{60,19.2},{60,14},{71,14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(TemperatureEffect_.y, HypothalamusTSH.u) annotation (Line(
          points={{36,20},{36,12},{-16,12}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-118,122},{116,100}},
              lineColor={0,0,255},
              textString="%name")}));
    end Thyrotropin;

    model Renin
      extends Physiolibrary.Icons.Kidney;
    // outer parameter Real ECF_Vol(final displayUnit="ml");

    Renin_Physiolibrary.Chemical.Components.Substance ReninPool(
      stateName="ReninPool.Mass",
      useNormalizedVolume=false,
      NominalSolute=Substances.Renin.molpGU,
      solute_start(displayUnit="GU_PRA") = 17153.7)
      " 2 GU/ml * 0.6 * 15000 ml =  18000 GU , initial: 17153.7 GU"
      annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
    Renin_Physiolibrary.Chemical.Components.SolutePump secretion(useSoluteFlowInput=
          true)
      annotation (Placement(transformation(extent={{12,-54},{-8,-34}})));
    Physiolibrary.Blocks.Factors.Normalization CountEffect
      annotation (Placement(transformation(extent={{36,62},{56,82}})));
    Physiolibrary.Types.Constants.FrequencyConst            hormoneFlowConstant(k(
          displayUnit="1/min") = 5.5e-05)
      annotation (Placement(transformation(extent={{-20,-10},{-12,-2}})));
    Physiolibrary.Blocks.Factors.Spline TGFEffect(data={{0.0,8.0,0},{0.5,2.0,-4.0},
          {1.0,1.0,-1.0},{3.0,0.5,0}})
      annotation (Placement(transformation(extent={{12,-22},{-8,-2}})));
      Renin_Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
       annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          origin={-62,-32})));                                                //(unitsString="GU/ml")
    Renin_Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
      Modelica.Blocks.Math.Gain K(k=0.0161/60)
        annotation (Placement(transformation(extent={{-3,-3},{3,3}},
            origin={-35,-59})));
    Renin_Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant1(k(
          displayUnit="GU_PRA/min") = 290/60) "290 GU/min"
      annotation (Placement(transformation(extent={{62,76},{50,88}})));
      Modelica.Blocks.Math.Gain VODIST(k=0.6)
        annotation (Placement(transformation(extent={{-6,-6},{6,6}},
            origin={-68,-2})));
    Physiolibrary.Blocks.Factors.Normalization FunctionEffect
      annotation (Placement(transformation(extent={{36,56},{56,76}})));
    Physiolibrary.Blocks.Factors.Normalization BaseFraction
      annotation (Placement(transformation(extent={{-8,-16},{12,4}})));
    Renin_Physiolibrary.Chemical.Components.Substance ReninFree(
      stateName="ReninFree.Mass",
      useNormalizedVolume=true,
      NominalSolute=Substances.Renin.molpGU,
      solute_start(displayUnit="GU_PRA") = 87000) "initial: 87000 GU"
                                             annotation (Placement(
          transformation(
          extent={{-10,10},{10,-10}},
          rotation=180,
          origin={36,-44})));
    Renin_Physiolibrary.Chemical.Components.Substance ReninGranules(
      stateName="ReninGranules.Mass",
      useNormalizedVolume=true,
      NominalSolute=Substances.Renin.molpGU,
      solute_start(displayUnit="GU_PRA") = 870000) "initial: 870000 GU"
                                             annotation (Placement(
          transformation(
          extent={{-10,10},{10,-10}},
          rotation=180,
          origin={86,-44})));
    Renin_Physiolibrary.Chemical.Sources.UnlimitedSolutePump synthesis(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{56,-30},{36,-10}})));
    Physiolibrary.Blocks.Factors.Spline TGFEffect1(data={{0.0,10.0,0},{0.6,2.0,
          -4.0},{1.0,1.0,-1.0},{2.0,0.3,0}})
      annotation (Placement(transformation(extent={{56,34},{36,54}})));
    Physiolibrary.Blocks.Math.Integrator integrator(
      stateName="ReninSynthesis.Rate",
      k=(1/60)/60,
      y_start=(290/60)) "initial 290 GU/min"
      annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          rotation=270,
          origin={46,6})));
      Modelica.Blocks.Math.Feedback feedback annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={46,28})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-88,80},{-68,100}}), iconTransformation(
            extent={{-90,-70},{-70,-50}})));
      Renin_Physiolibrary.Types.RealIO.ConcentrationOutput Renin(displayUnit="GU_Renin/ml") annotation (Placement(
            transformation(extent={{-48,-46},{-28,-26}}), iconTransformation(extent={{80,-20},{120,20}})));
      Nerves.BetaReceptorsActivityFactor betaReceptorsActivityFactor
        annotation (Placement(transformation(extent={{-12,14},{8,34}})));
    Physiolibrary.Blocks.Factors.Spline NaEffect(data={{0,0.0,0.0},{48,1.0,0.03},
          {100,2.0,0.0}})
      annotation (Placement(transformation(extent={{82,54},{62,74}})));
    Physiolibrary.Blocks.Factors.Spline ANPEffect(data={{0.0,1.2,0.0},{1.3,1.0,
          -0.3},{2.7,0.8,0.0}},
        Xscale=1e-9,
        UsePositiveLog10=true) "normal ANP .. 20 pmol/l"
      annotation (Placement(transformation(extent={{82,50},{62,70}})));
    Physiolibrary.Blocks.Factors.Spline A2Effect(
      data={{0.0,0.9,0.0},{1.3,1.0,0.1},{2.5,2.0,2.0},{3.5,5.0,0.0}},
      Xscale=1e-9/Substances.AngiotensinII.mw,
      UsePositiveLog10=true) "normal ... 20 pg/ml = 20 ug/m3"
      annotation (Placement(transformation(extent={{82,46},{62,66}})));
    Physiolibrary.Blocks.Factors.Spline FurosemideEffect(data={{0.0,1.0,0.0},{
          1.3,0.2,0.0}}, Xscale=1e-3/Substances.Furosemide.mw)
      "mg/l = 1e-3 kg/m3"
      annotation (Placement(transformation(extent={{82,42},{62,62}})));
    Physiolibrary.Types.Constants.FractionConst             Constant2(k=1)
      annotation (Placement(transformation(extent={{60,68},{66,74}})));
    Physiolibrary.Blocks.Factors.Spline SympsEffect(data={{0.0,0.5,0},{1.0,1.0,
          1.0},{3.0,4.0,0}})
      annotation (Placement(transformation(extent={{-8,-34},{12,-14}})));
    Physiolibrary.Types.Constants.FractionConst             Constant3(k=1)
      annotation (Placement(transformation(extent={{-12,36},{-6,42}})));
    Physiolibrary.Blocks.Factors.Spline SympsEffect1(data={{0.0,0.5,0},{1.0,1.0,
          1.0},{2.5,4.0,0}})
      annotation (Placement(transformation(extent={{36,44},{56,64}})));
    Renin_Physiolibrary.Chemical.Components.SolutePump fluxReninFree(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{60,-44},{70,-34}})));
    Renin_Physiolibrary.Chemical.Components.SolutePump fluxReninGranules(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{70,-46},{60,-56}})));
      Modelica.Blocks.Math.Gain gain1(k=0.01/60)
        annotation (Placement(transformation(extent={{-5,-5},{5,5}},
            rotation=270,
            origin={65,-27})));
      Modelica.Blocks.Math.Gain gain3(k=0.001/60)
        annotation (Placement(transformation(extent={{-5,-5},{5,5}},
            rotation=90,
            origin={65,-63})));
      Modelica.Blocks.Interfaces.RealInput Angiotensin2 annotation (Placement(transformation(extent={{70,68},{
              90,88}}), iconTransformation(extent={{-100,20},{-60,60}})));
    equation
       connect(ReninPool.q_out, secretion.q_out)   annotation (Line(
          points={{-72,-44},{-8,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(concentrationMeasure.q_in, ReninPool.q_out)   annotation (Line(
          points={{-62,-32},{-71.2,-32},{-71.2,-44},{-72,-44}},
          color={200,0,0},
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, busConnector.Renin) annotation (
       Line(
        points={{-62,-40},{-47,-40},{-47,90},{-78,90}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      connect(ReninPool.q_out, Clearance.q_in) annotation (Line(
          points={{-72,-44},{-54,-44},{-54,-88},{-30,-88}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(ReninPool.solute, K.u) annotation (Line(
        points={{-66,-54},{-66,-59},{-38.6,-59}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(Clearance.soluteFlow, K.y) annotation (Line(
        points={{-16,-84},{-16,-59},{-31.7,-59}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.Kidney_NephronCount_Total_xNormal, CountEffect.u)
                                           annotation (Line(
          points={{-78,90},{-28.9,90},{-28.9,72},{38,72}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(hormoneFlowConstant1.y, CountEffect.yBase)
                                                       annotation (Line(
          points={{48.5,82},{46,82},{46,74}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ECFV_Vol, VODIST.u) annotation (Line(
          points={{-78,90},{-94.6,90},{-94.6,-2},{-75.2,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
    connect(VODIST.y, ReninPool.solutionVolume) annotation (Line(
        points={{-61.4,-2},{-56,-2},{-56,-16},{-90,-16},{-90,-40},{-76,-40}},
        color={0,0,127},
        smooth=Smooth.None));

      connect(CountEffect.y, FunctionEffect.yBase) annotation (Line(
          points={{46,68},{46,68}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BaseFraction.y, TGFEffect.yBase) annotation (Line(
          points={{2,-10},{2,-10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hormoneFlowConstant.y, BaseFraction.u) annotation (Line(
          points={{-11,-6},{-6,-6}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(ReninFree.solute, BaseFraction.yBase) annotation (Line(
        points={{30,-54},{30,-58},{18,-58},{18,0},{2,0},{2,-4}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(feedback.y,integrator. u) annotation (Line(
          points={{46,19},{46,18}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(integrator.y,feedback. u2) annotation (Line(
          points={{46,-5},{46,-8},{28,-8},{28,28},{38,28}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(integrator.y, synthesis.soluteFlow) annotation (Line(
        points={{46,-5},{46,-16},{42,-16}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(secretion.q_in, ReninFree.q_out) annotation (Line(
          points={{12,-44},{36,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(ReninFree.q_out, synthesis.q_out) annotation (Line(
          points={{36,-44},{36,-20}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));

      connect(concentrationMeasure.concentration, Renin) annotation (Line(
          points={{-62,-40},{-52,-40},{-52,-36},{-38,-36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.BetaPool_Effect, betaReceptorsActivityFactor.BetaPool_Effect)
        annotation (Line(
          points={{-78,90},{-42,90},{-42,30},{-11.8,30}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.BetaBlocade_Effect, betaReceptorsActivityFactor.BetaBlockade_Effect)
        annotation (Line(
          points={{-78,90},{-42,90},{-42,24},{-11.8,24}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.GangliaKidney_NA, betaReceptorsActivityFactor.GangliaGeneral_NA)
        annotation (Line(
          points={{-78,90},{-42,90},{-42,18},{-11.8,18}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(Constant2.y, NaEffect.yBase) annotation (Line(
          points={{66.75,71},{72,71},{72,66}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(NaEffect.y, ANPEffect.yBase) annotation (Line(
          points={{72,60},{72,62}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ANPEffect.y, A2Effect.yBase) annotation (Line(
          points={{72,56},{72,58}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(A2Effect.y, FurosemideEffect.yBase) annotation (Line(
          points={{72,52},{72,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.KidneyFunctionEffect, FunctionEffect.u) annotation (
          Line(
          points={{-78,90},{-28,90},{-28,66},{38,66}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(TGFEffect1.y, feedback.u1) annotation (Line(
          points={{46,40},{46,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FurosemideEffect.y, TGFEffect1.u) annotation (Line(
          points={{72,48},{72,44},{54,44}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FurosemideEffect.u, busConnector.FurosemidePool_Loss) annotation (
         Line(
          points={{80,52},{98,52},{98,90},{-78,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(TGFEffect.u, FurosemideEffect.y) annotation (Line(
          points={{10,-12},{72,-12},{72,48}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(TGFEffect.y, SympsEffect.yBase) annotation (Line(
          points={{2,-16},{2,-22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsEffect.y, secretion.soluteFlow) annotation (Line(
          points={{2,-28},{2,-34},{2,-40},{-2,-40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(betaReceptorsActivityFactor.y, SympsEffect.u) annotation (Line(
          points={{-2,17},{-2,6},{-28,6},{-28,-24},{-6,-24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant3.y, betaReceptorsActivityFactor.yBase) annotation (Line(
          points={{-5.25,39},{-2,39},{-2,31}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsEffect1.y, TGFEffect1.yBase) annotation (Line(
          points={{46,50},{46,46}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FunctionEffect.y, SympsEffect1.yBase) annotation (Line(
          points={{46,62},{46,56}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(betaReceptorsActivityFactor.y, SympsEffect1.u) annotation (Line(
          points={{-2,17},{-2,6},{18,6},{18,54},{38,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(NaEffect.u, busConnector.MD_Na) annotation (Line(
          points={{80,64},{98,64},{98,90},{-78,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(gain1.y, fluxReninFree.soluteFlow)
                                            annotation (Line(
          points={{65,-32.5},{67,-34},{67,-37}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain3.y, fluxReninGranules.soluteFlow)
                                          annotation (Line(
          points={{65,-57.5},{65,-53},{63,-53}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(fluxReninFree.q_out, ReninGranules.q_out) annotation (Line(
          points={{70,-39},{74,-39},{74,-44},{86,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(fluxReninGranules.q_in, ReninGranules.q_out) annotation (Line(
          points={{70,-51},{74,-51},{74,-44},{86,-44}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(ReninFree.q_out, fluxReninFree.q_in) annotation (Line(
          points={{36,-44},{48,-44},{48,-39},{60,-39}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(ReninFree.q_out, fluxReninGranules.q_out) annotation (Line(
          points={{36,-44},{48,-44},{48,-51},{60,-51}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(ReninGranules.solute, gain3.u) annotation (Line(
        points={{80,-54},{80,-72},{64,-72},{64,-69},{65,-69}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(ReninFree.solute, gain1.u) annotation (Line(
        points={{30,-54},{30,-58},{58,-58},{58,-16},{65,-16},{65,-21}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(ANPEffect.u, busConnector.ANP) annotation (Line(
          points={{80,60},{98,60},{98,90},{-78,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(Angiotensin2, A2Effect.u) annotation (Line(
        points={{80,78},{98,78},{98,56},{80,56}},
        color={0,0,127},
        smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-112,108},{122,86}},
              lineColor={0,0,255},
              textString="%name")}));
    end Renin;

    model Angiotensine2
    //  extends Library.Interfaces.Tissues.Liver;
    //  extends Library.Interfaces.Tissues.Kidney;
      extends Physiolibrary.Icons.Lungs;

    // outer parameter Real ECF_Vol(final displayUnit="ml");

    Physiolibrary.Blocks.Factors.Normalization A2 annotation (Placement(transformation(extent={{-2,-2},{18,18}})));
    Physiolibrary.Types.Constants.ConcentrationConst A2CONC(k=0.3333e-9/
          Substances.AngiotensinII.mw) "0.3333 pg/ml = 0.3333*1e-15/1e-6 kg/m3"
      annotation (Placement(transformation(extent={{-24,52},{-4,72}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-88,78},{-68,98}}), iconTransformation(extent=
             {{-90,-70},{-70,-50}})));
      Modelica.Blocks.Interfaces.RealInput Renin annotation (Placement(transformation(extent={{-74,8},{-54,28}}),
            iconTransformation(extent={{-100,20},{-60,60}})));
      Modelica.Blocks.Interfaces.RealOutput Angiotensine2(
                                                   final displayUnit="pg/ml", quantity="Concentration")
                                                              annotation (
          Placement(transformation(extent={{18,-66},{38,-46}}),
            iconTransformation(extent={{80,-20},{120,20}})));
    Renin_Physiolibrary.Types.Constants.ConcentrationConst
                                                     CEBase_ReninConc(k=1e6/30)
      "1 Gu/ml = 1e6 Gu/m3"
      annotation (Placement(transformation(extent={{-66,-12},{-46,8}})));
      Modelica.Blocks.Math.Division EndogenousRate
        annotation (Placement(transformation(extent={{-30,-2},{-10,18}})));
    equation
      connect(A2CONC.y, A2.yBase)
        annotation (Line(
          points={{-1.5,62},{8,62},{8,10}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(CEBase_ReninConc.y, EndogenousRate.u2) annotation (Line(
          points={{-43.5,-2},{-40,-2},{-40,2},{-32,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Renin, EndogenousRate.u1) annotation (Line(
          points={{-64,18},{-40,18},{-40,14},{-32,14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(A2.u, EndogenousRate.y)
        annotation (Line(
          points={{0,8},{-9,8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(A2.y, Angiotensine2)
        annotation (Line(
          points={{8,4},{8,-56},{28,-56}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(A2.y, busConnector.Angiotensin2) annotation (Line(
          points={{8,4},{8,-10},{28,-10},{28,88},{-78,88}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(A2.y, busConnector.AngiotensinII) annotation (Line(
        points={{8,4},{10,4},{10,-2},{72,-2},{72,88},{-78,88}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-128,102},{106,80}},
              lineColor={0,0,255},
              textString="%name")}));
    end Angiotensine2;

  model Leptin
     extends Physiolibrary.Icons.Fat;
     // outer parameter Real ECF_Vol(final displayUnit="ml");

      Modelica.Blocks.Math.Gain gain(                        y(unit="mol/s"), k(unit=
            "1/s") = 0.01/60)
        annotation (Placement(transformation(extent={{-44,-32},{-38,-26}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-34,-6},{-14,-26}})));
    Physiolibrary.Chemical.Components.Substance LeptinPool(
      stateName="LeptinPool.Mass",
      useNormalizedVolume=false,
      solute_start=(8e-6/Substances.Leptin.mw)*0.0143610097207699)
      "8 ng/ml = 8e-6 kg/m3, in 14.36 liter of extracellular fluid"
      annotation (Placement(transformation(extent={{-66,-18},{-46,2}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{78,-16},{58,4}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant_pG(k(
          displayUnit="pmol/min") = 1.2e-9/(60*Substances.Leptin.mw))
      "1.2 ug/min = 1.2e-9/60 kg/s"
      annotation (Placement(transformation(extent={{80,18},{72,26}})));
    Physiolibrary.Blocks.Factors.Spline AdiposeEffect(data={{0,0.0,0},{13300,
          1.0,0.00008},{100000,6.0,0}}, Xscale=1e-3/Substances.FattyAcids.mw)
      "13300 g = 13.3 kg"
      annotation (Placement(transformation(extent={{78,0},{58,20}})));
    Physiolibrary.Blocks.Factors.Normalization FunctionEffect
      annotation (Placement(transformation(extent={{58,-4},{78,16}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-98,68},{-78,88}}), iconTransformation(extent=
             {{-90,-70},{-70,-50}})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
         annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          origin={-60,8})));
      Physiolibrary.Types.RealIO.ConcentrationOutput
                                            Leptin(displayUnit=
               "ng/ml") annotation (Placement(transformation(extent={{-78,-62},{-58,
              -42}}),        iconTransformation(extent={{80,-20},{120,20}})));
  equation

    connect(LeptinPool.solute, gain.u) annotation (Line(
        points={{-50,-18},{-50,-29},{-44.6,-29}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(gain.y, clearance.soluteFlow) annotation (Line(
        points={{-37.7,-29},{-20,-29},{-20,-20}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(clearance.q_in, LeptinPool.q_out)   annotation (Line(
          points={{-34,-16},{-38,-16},{-38,-8},{-56,-8}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector.FatFunctionEffect, FunctionEffect.u) annotation (Line(
          points={{-88,78},{12.1,78},{12.1,6},{60,6}},
          color={0,0,127},
          smooth=Smooth.None), Text(
     string="%first",
     index=-1,
     extent={{-6,3},{-6,3}}));
      connect(AdiposeEffect.y, FunctionEffect.yBase) annotation (Line(
          points={{68,6},{68,8}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(secretion.soluteFlow, FunctionEffect.y) annotation (Line(
        points={{64,-2},{64,0},{68,0},{68,2}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(secretion.q_out, LeptinPool.q_out)   annotation (Line(
          points={{58,-6},{2,-6},{2,-8},{-56,-8}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));

      connect(LeptinPool.q_out, concentrationMeasure.q_in)   annotation (Line(
          points={{-56,-8},{-54,-8},{-54,6},{-60,6}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(hormoneFlowConstant_pG.y, AdiposeEffect.yBase) annotation (Line(
          points={{71,22},{68,22},{68,12}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, Leptin) annotation (Line(
        points={{-60,12},{-60,20},{-82,20},{-82,-52},{-68,-52}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(concentrationMeasure.concentration, busConnector.Leptin)
      annotation (Line(
        points={{-60,12},{-60,78},{-88,78}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
    connect(busConnector.ECFV_Vol, LeptinPool.solutionVolume) annotation (Line(
        points={{-88,78},{-90,78},{-90,2},{-60,2},{-60,-4}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(AdiposeEffect.u, busConnector.LipidDepositsFA) annotation (Line(
        points={{76,10},{94,10},{94,78},{-88,78}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-100,80},{100,100}},
              lineColor={0,0,255},
              textString="%name")}));
  end Leptin;

    model PTH
      extends Physiolibrary.Icons.ThyroidGland;
    Physiolibrary.Chemical.Components.Substance PTH_Pool(useNormalizedVolume=
          false, solute_start=(3.85*14361.0097207699*0.001)/1000)
      annotation (Placement(transformation(extent={{14,-58},{34,-38}})));
      Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                     annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            origin={-2,-40})));
    Physiolibrary.Types.BusConnector busConnector
      annotation (Placement(transformation(extent={{-92,76},{-72,96}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut clearance(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{52,-46},{72,-66}})));
        Modelica.Blocks.Math.Gain gain(k=7.143)
          annotation (Placement(transformation(extent={{42,-72},{48,-66}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{72,-38},{52,-18}})));
      Electrolytes.Calcium2.Factors.H_minus H4_10to7_minus(
        alpha=96.25,
        delta=3.037,
        gamma=11.74,
        ro=6249) annotation (Placement(transformation(extent={{52,-30},{72,-10}})));
    Physiolibrary.Blocks.Factors.Normalization simpleMultiply
      annotation (Placement(transformation(extent={{52,-10},{72,10}})));
    Physiolibrary.Blocks.Factors.Normalization simpleMultiply1
      annotation (Placement(transformation(extent={{52,-20},{72,0}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=2)
      annotation (Placement(transformation(extent={{36,-4},{44,4}})));
    Physiomodel.Metabolism.deprecated.MolarStorageCompartment PT_max_capacity(
        initialSoluteMass=1)
      annotation (Placement(transformation(extent={{-36,8},{-16,28}})));
        Modelica.Blocks.Math.Gain gain1(k=0.0001604)
          annotation (Placement(transformation(extent={{-18,0},{-12,6}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut clearance1(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-12,28},{8,8}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion1(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-62,8},{-42,28}})));
      Electrolytes.Calcium2.Factors.H_minus H6_11_minus1(
        alpha=4.103,
        delta=69,
        gamma=12.5,
        ro=0.9) annotation (Placement(transformation(extent={{-62,18},{-42,38}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=
          0.0001604)
      annotation (Placement(transformation(extent={{-64,36},{-56,44}})));

      model PT

        Modelica.Blocks.Interfaces.RealInput Calcitriol
          annotation (Placement(transformation(extent={{-110,40},{-70,80}})));
        Modelica.Blocks.Interfaces.RealInput Ca
          annotation (Placement(transformation(extent={{-110,-64},{-70,-24}})));
        Modelica.Blocks.Interfaces.RealOutput PT_pool
          annotation (Placement(transformation(extent={{56,-18},{96,22}})));

        Real T64m;
        Real T64p;

        parameter Real initialPT(displayUnit="1") = 0.5
        "initial pool of PT gland";

      initial equation
      //  PT_pool = initialPT;
        der( PT_pool) = 0;
      equation
        der( PT_pool)   = (1-PT_pool)*0.01*(0.85*T64m+0.15) - PT_pool*0.01*(0.85*T64p+0.15);
        T64m = 1-(exp(0.03*(Calcitriol - 90*(2.35/Ca))) - exp(-0.03*(Calcitriol - 90*(2.35/Ca)))) / (exp(0.03*(Calcitriol - 90*(2.35/Ca))) + exp(-0.03*(Calcitriol - 90*(2.35/Ca))));
        T64p = 1+(exp(0.03*(Calcitriol - 90*(2.35/Ca))) - exp(-0.03*(Calcitriol - 90*(2.35/Ca)))) / (exp(0.03*(Calcitriol - 90*(2.35/Ca))) + exp(-0.03*(Calcitriol - 90*(2.35/Ca))));
      end PT;

      PT PT_pool
        annotation (Placement(transformation(extent={{36,46},{56,66}})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        unitsString="pmol/l") annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          origin={34,-36})));
    equation
      connect(busConnector.ECFV_Vol,mlTOlitre. u) annotation (Line(
          points={{-82,86},{-82,-40},{-6.8,-40}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
    connect(mlTOlitre.y, PTH_Pool.solutionVolume) annotation (Line(
        points={{2.4,-40},{9.2,-40},{9.2,-44},{20,-44}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(gain.y, clearance.soluteFlow) annotation (Line(
        points={{48.3,-69},{66,-69},{66,-60}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(PTH_Pool.q_out, clearance.q_in) annotation (Line(
          points={{24,-48},{46,-48},{46,-56},{52,-56}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(PTH_Pool.solute, gain.u) annotation (Line(
        points={{30,-58},{30,-69},{41.4,-69}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(secretion.q_out, PTH_Pool.q_out) annotation (Line(
          points={{52,-28},{46,-28},{46,-48},{24,-48}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(H4_10to7_minus.y, secretion.soluteFlow) annotation (Line(
        points={{62,-24},{58,-24}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.CaPool_conc_per_liter, H4_10to7_minus.u) annotation (
          Line(
          points={{-82,86},{-82,-20},{52.2,-20}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(simpleMultiply1.y, H4_10to7_minus.yBase) annotation (Line(
          points={{62,-14},{62,-18}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(simpleMultiply.y, simpleMultiply1.yBase) annotation (Line(
          points={{62,-4},{62,-8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, simpleMultiply.u) annotation (Line(
          points={{45,0},{54,0}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(gain1.y, clearance1.soluteFlow) annotation (Line(
        points={{-11.7,3},{2,3},{2,14}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(PT_max_capacity.q_out, clearance1.q_in) annotation (Line(
          points={{-26,18},{-8,18}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(PT_max_capacity.soluteMass, gain1.u) annotation (Line(
          points={{-26,10.6},{-26,3},{-18.6,3}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(secretion1.q_out, PT_max_capacity.q_out) annotation (Line(
          points={{-46,18},{-26,18}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(H6_11_minus1.y, secretion1.soluteFlow) annotation (Line(
        points={{-52,24},{-52,24},{-52,22},{-48,22}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.Calcitriol, H6_11_minus1.u) annotation (Line(
          points={{-82,86},{-82,28},{-61.8,28}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(PT_max_capacity.soluteMass, simpleMultiply1.u) annotation (Line(
          points={{-26,10.6},{-26,-10},{52.2,-10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant1.y, H6_11_minus1.yBase) annotation (Line(
          points={{-55,40},{-52,40},{-52,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(PT_pool.PT_pool, simpleMultiply.yBase) annotation (Line(
          points={{53.6,56.2},{62,56.2},{62,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.Calcitriol, PT_pool.Calcitriol) annotation (Line(
          points={{-82,86},{-82,62},{37,62}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CaPool_conc_per_liter, PT_pool.Ca) annotation (Line(
          points={{-82,86},{-82,51.6},{37,51.6}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(PTH_Pool.q_out, concentrationMeasure.q_in) annotation (Line(
          points={{24,-48},{28,-48},{28,-38},{34,-38}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, busConnector.PTH) annotation (
        Line(
        points={{34,-32},{34,-28},{-82,-28},{-82,86}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-102,88},{98,108}},
              lineColor={0,0,255},
              textString="%name")}));
    end PTH;

    model Calcitriol
      extends Physiolibrary.Icons.Kidney;
    Physiolibrary.Types.BusConnector busConnector
      annotation (Placement(transformation(extent={{-86,72},{-66,92}})));

      model One_alpha_OH

        function H
        input Real x;
        input Real alpha;
        input Real delta;
        input Real gamma=1;
        output Real value;
        algorithm
        value:=alpha*x^gamma/(delta^gamma+x^gamma);
        end H;

      function H_minus
        input Real x;
        input Real alpha;
        input Real delta;
        input Real gamma=1;
        input Real ro;
        output Real value;
      algorithm
        value:=alpha-(alpha-ro)*x^gamma/(delta^gamma+x^gamma);
      end H_minus;

        Modelica.Blocks.Interfaces.RealInput PO4
          annotation (Placement(transformation(extent={{-110,-64},{-70,-24}}),
              iconTransformation(extent={{-100,-60},{-60,-20}})));
        Modelica.Blocks.Interfaces.RealInput PTH
          annotation (Placement(transformation(extent={{-110,40},{-70,80}}),
              iconTransformation(extent={{-100,40},{-60,80}})));
        Modelica.Blocks.Interfaces.RealOutput One_alpha_OH
          annotation (Placement(transformation(extent={{56,-18},{96,22}}),
              iconTransformation(extent={{60,-20},{100,20}})));

      initial equation
        //One_alpha_OH = 126;
        der( One_alpha_OH)  = 0;
      equation
        der( One_alpha_OH)  = 6.3*H(PTH, 1.90371, 1.549,0.1112)*( if PO4<=16.8/14 then 1 else H_minus(PO4,1.525,1.302,8.252,-1.78249))  -0.05 *One_alpha_OH;
        //H7,9:alpha was calculated,
      end One_alpha_OH;
      One_alpha_OH one_alpha_OH
        annotation (Placement(transformation(extent={{-26,16},{-6,36}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion1(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{-6,-10},{14,10}})));
    Physiolibrary.Chemical.Components.Substance Calcitriol_pool(
      stateName="Calcitriol.Mass",
      useNormalizedVolume=false,
      solute_start=(1260)/1000)
      annotation (Placement(transformation(extent={{10,-32},{30,-12}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut clearance1(
        useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{60,-12},{80,-32}})));
        Modelica.Blocks.Math.Gain gain1(k=0.1)
          annotation (Placement(transformation(extent={{54,-40},{60,-34}})));
      Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                     annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            origin={-2,-16})));
    Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
         annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          origin={30,0})));
    equation

    connect(gain1.y, clearance1.soluteFlow) annotation (Line(
        points={{60.3,-37},{74,-37},{74,-26}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(Calcitriol_pool.solute, gain1.u) annotation (Line(
        points={{26,-32},{26,-37},{53.4,-37}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.ECFV_Vol,mlTOlitre. u) annotation (Line(
          points={{-76,82},{-76,-16},{-6.8,-16}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
    connect(mlTOlitre.y, Calcitriol_pool.solutionVolume) annotation (Line(
        points={{2.4,-16},{10,-16},{10,-18},{16,-18}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(secretion1.q_out, Calcitriol_pool.q_out) annotation (Line(
          points={{14,0},{20,0},{20,-22}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(Calcitriol_pool.q_out, clearance1.q_in) annotation (Line(
          points={{20,-22},{60,-22}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(one_alpha_OH.One_alpha_OH, secretion1.soluteFlow) annotation (Line(
        points={{-8,26},{8,26},{8,4}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.PTH, one_alpha_OH.PTH) annotation (Line(
          points={{-76,82},{-76,32},{-24,32}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.ctPO4, one_alpha_OH.PO4) annotation (Line(
          points={{-76,82},{-76,22},{-24,22}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(concentrationMeasure.q_in, Calcitriol_pool.q_out) annotation (
          Line(
          points={{30,-2},{20,-2},{20,-22}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(concentrationMeasure.concentration, busConnector.Calcitriol)
      annotation (Line(
        points={{30,4},{30,78},{-76,78},{-76,82}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=false, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-96,94},{104,114}},
              lineColor={0,0,255},
              textString="%name")}));
    end Calcitriol;

    package Catechols "Epinephrine and Norepinephrine"
      extends Physiolibrary.Icons.AdrenalGland;

      model Epinephrine
        extends Physiolibrary.Icons.AdrenalGland;
      // outer parameter Real ECF_Vol(final displayUnit="ml");

      Physiolibrary.Chemical.Components.Substance EpiPool(
        stateName="EpiPool.Mass",
        useNormalizedVolume=false,
        solute_start=(571.791)*1e-12/Substances.Epinephrine.mw)
        "0.040 ng/ml * 15000 ml =  600 ng "
        annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{48,-54},{28,-34}})));
      Physiolibrary.Types.Constants.MassFlowRateConst hormoneFlowConstant(k=375e-12
            /Substances.Epinephrine.mw/60) "376 ng/min"
        annotation (Placement(transformation(extent={{50,-10},{42,-2}})));
      Physiolibrary.Blocks.Factors.Spline AdrenalNerveEffect(data={{2.0,1.0,0},
            {8.0,20.0,0}})
        annotation (Placement(transformation(extent={{28,-32},{48,-12}})));
        Physiolibrary.Types.RealIO.FractionInput
                                           OtherTissueFunctionEffect
                           annotation (Placement(transformation(
                extent={{0,-36},{8,-28}}),   iconTransformation(extent={{-100,40},{-80,
                  60}})));
        Physiolibrary.Types.RealIO.VolumeInput
                                           ECFV_Vol( displayUnit="ml")
          annotation (Placement(transformation(extent={{-98,-30},{-90,-22}}),
              iconTransformation(extent={{-100,80},{-80,100}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
           annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-76,-26})));
        Physiolibrary.Types.RealIO.ConcentrationOutput
                                            Epinephrine( displayUnit=
                 "pg/ml")             annotation (Placement(
              transformation(extent={{-82,-20},{-90,-12}}),
                                                         iconTransformation(
                extent={{100,-10},{120,10}})));
        Physiolibrary.Types.RealIO.FractionInput
                                           AdrenalNerve_NA( displayUnit="Hz")
                           annotation (Placement(transformation(
                extent={{6,-26},{14,-18}}),  iconTransformation(extent={{-100,0},{-80,
                  20}})));
      Physiolibrary.Chemical.Components.Clearance Clearance(K=1,
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-28,-96},{-8,-76}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst flowConstant(k(
            displayUnit="l/min") = 0.00015666666666667)
        annotation (Placement(transformation(extent={{-30,-76},{-22,-68}})));
      Physiolibrary.Blocks.Factors.Normalization FunctionEffect
        annotation (Placement(transformation(extent={{28,-42},{48,-22}})));
      equation
        connect(EpiPool.q_out, secretion.q_out)     annotation (Line(
            points={{-72,-44},{28,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, EpiPool.q_out)     annotation (Line(
            points={{-76,-28},{-71.2,-28},{-71.2,-44},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Epinephrine) annotation (Line(
          points={{-76,-22},{-76,-16},{-86,-16}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ECFV_Vol, EpiPool.solutionVolume) annotation (Line(
          points={{-94,-26},{-88,-26},{-88,-40},{-76,-40}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(AdrenalNerve_NA, AdrenalNerveEffect.u)
                                              annotation (Line(
            points={{10,-22},{30,-22}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant.y, AdrenalNerveEffect.yBase)
                                                        annotation (Line(
            points={{41,-6},{38,-6},{38,-20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EpiPool.q_out, Clearance.q_in)          annotation (Line(
            points={{-72,-44},{-42,-44},{-42,-86},{-28,-86}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(flowConstant.y, Clearance.solutionFlow) annotation (Line(
          points={{-21,-72},{-18,-72},{-18,-79}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(OtherTissueFunctionEffect, FunctionEffect.u) annotation (Line(
            points={{4,-32},{30,-32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(AdrenalNerveEffect.y, FunctionEffect.yBase) annotation (Line(
            points={{38,-26},{38,-30}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(FunctionEffect.y, secretion.soluteFlow) annotation (Line(
          points={{38,-36},{38,-40},{34,-40}},
          color={0,0,127},
          smooth=Smooth.None));
      end Epinephrine;

      model Norepinephrine
        extends Physiolibrary.Icons.AdrenalGland;
      // outer parameter Real ECF_Vol(final displayUnit="ml");

      Physiolibrary.Chemical.Components.Substance NEPool(
        stateName="NEPool.Mass",
        useNormalizedVolume=false,
        solute_start=3430.74e-12/Substances.Norepinephrine.mw)
        "0.240 ng/ml * 15000 ml =  3600 ng "
        annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump secretion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{48,-54},{28,-34}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k(
            displayUnit="mmol/min") = 220e-12/Substances.Norepinephrine.mw/60)
        "220 ng/min"
        annotation (Placement(transformation(extent={{50,-10},{42,-2}})));
      Physiolibrary.Blocks.Factors.Spline AdrenalNerveEffect(data={{2.0,1.0,0},
            {8.0,20.0,0}})
        annotation (Placement(transformation(extent={{28,-32},{48,-12}})));
        Physiolibrary.Types.RealIO.FractionInput
                                           OtherTissueFunctionEffect
                           annotation (Placement(transformation(
                extent={{0,-36},{8,-28}}),   iconTransformation(extent={{-100,-40},{-80,
                  -20}})));
        Physiolibrary.Types.RealIO.VolumeInput
                                           ECFV_Vol( displayUnit="ml")
          annotation (Placement(transformation(extent={{-98,-30},{-90,-22}}),
              iconTransformation(extent={{-100,80},{-80,100}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
           annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-78,-20})));
        Physiolibrary.Types.RealIO.ConcentrationOutput
                                            Norepinephrine( displayUnit="pg/ml")
                                      annotation (Placement(
              transformation(extent={{-80,-16},{-88,-8}}),
                                                         iconTransformation(
                extent={{100,-10},{120,10}})));
        Physiolibrary.Types.RealIO.FractionInput
                                           AdrenalNerve_NA( displayUnit="Hz")
                           annotation (Placement(transformation(
                extent={{6,-26},{14,-18}}),  iconTransformation(extent={{-100,40},{-80,
                  60}})));
      Physiolibrary.Chemical.Components.Clearance Clearance(K=1,
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-28,-96},{-8,-76}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst flowConstant(k(displayUnit="ml/min") = 7.5e-05)
        annotation (Placement(transformation(extent={{-30,-76},{-22,-68}})));
      Physiolibrary.Blocks.Factors.Normalization FunctionEffect
        annotation (Placement(transformation(extent={{28,-42},{48,-22}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Spillover(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{50,18},{30,38}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant1(k=
            570.0e-12/Substances.Norepinephrine.mw/60) "570 ng/min"
        annotation (Placement(transformation(extent={{52,50},{44,58}})));
      Physiolibrary.Blocks.Factors.Normalization SpilloverK
        annotation (Placement(transformation(extent={{30,28},{50,48}})));
        Physiolibrary.Types.RealIO.FractionInput
                                           GangliaGeneral_NA( displayUnit="Hz")
                           annotation (Placement(transformation(
                extent={{8,34},{16,42}}),    iconTransformation(extent={{-100,0},{-80,
                  20}})));
      equation
        connect(NEPool.q_out, secretion.q_out)      annotation (Line(
            points={{-72,-44},{28,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, NEPool.q_out)      annotation (Line(
            points={{-78,-22},{-71.2,-22},{-71.2,-44},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Norepinephrine) annotation (
          Line(
          points={{-78,-16},{-78,-12},{-84,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ECFV_Vol, NEPool.solutionVolume) annotation (Line(
          points={{-94,-26},{-88,-26},{-88,-40},{-76,-40}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(AdrenalNerve_NA, AdrenalNerveEffect.u)
                                              annotation (Line(
            points={{10,-22},{30,-22}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant.y, AdrenalNerveEffect.yBase)
                                                        annotation (Line(
            points={{41,-6},{38,-6},{38,-20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(NEPool.q_out, Clearance.q_in)           annotation (Line(
            points={{-72,-44},{-42,-44},{-42,-86},{-28,-86}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(flowConstant.y, Clearance.solutionFlow) annotation (Line(
          points={{-21,-72},{-18,-72},{-18,-82}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(OtherTissueFunctionEffect, FunctionEffect.u) annotation (Line(
            points={{4,-32},{30,-32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(AdrenalNerveEffect.y, FunctionEffect.yBase) annotation (Line(
            points={{38,-26},{38,-30}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(FunctionEffect.y, secretion.soluteFlow) annotation (Line(
          points={{38,-36},{38,-38},{38,-40},{34,-40}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(NEPool.q_out, Spillover.q_out)      annotation (Line(
            points={{-72,-44},{-21,-44},{-21,28},{30,28}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(GangliaGeneral_NA, SpilloverK.u)
                                              annotation (Line(
            points={{12,38},{32,38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant1.y, SpilloverK.yBase)
                                                        annotation (Line(
            points={{43,54},{40,54},{40,40}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(SpilloverK.y, Spillover.soluteFlow) annotation (Line(
          points={{40,34},{40,34},{40,32},{36,32}},
          color={0,0,127},
          smooth=Smooth.None));
      end Norepinephrine;

      model Catechols
        extends Physiolibrary.Icons.AdrenalGland;
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-88,78},{-68,98}}), iconTransformation(
              extent={{-90,-70},{-70,-50}})));

        Epinephrine epinephrine
          annotation (Placement(transformation(extent={{-30,46},{-10,66}})));
        Norepinephrine norepinephrine
          annotation (Placement(transformation(extent={{-30,14},{-10,34}})));
        Modelica.Blocks.Interfaces.RealOutput EpinephrineConc(             quantity="Concentration", final displayUnit=
                 "pg/ml")                                       annotation (
            Placement(transformation(extent={{38,46},{58,66}}),
              iconTransformation(extent={{80,-40},{120,0}})));
        Modelica.Blocks.Interfaces.RealOutput NorepinephrineConc(
                                                          quantity="Concentration", final displayUnit=
                 "pg/ml")                                       annotation (
            Placement(transformation(extent={{38,14},{58,34}}),
              iconTransformation(extent={{80,0},{120,40}})));
      Physiolibrary.Blocks.Math.Log10AsEffect log10_1
        annotation (Placement(transformation(extent={{10,-66},{30,-46}})));
        Modelica.Blocks.Math.Add3 AlphaTotal(
          k3=5,
        k1=0.021*Substances.Norepinephrine.mw/(1e-9),
        k2=0.125*Substances.Epinephrine.mw/(1e-9))
          annotation (Placement(transformation(extent={{-28,-66},{-8,-46}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Desglymidodrine(k=
           0)
        annotation (Placement(transformation(extent={{-62,-68},{-54,-60}})));
        Modelica.Blocks.Math.Add BetaTotal(k1=0.021*Substances.Norepinephrine.mw
            /(1e-9), k2=0.125*Substances.Epinephrine.mw/(1e-9))
        "1 pg/ml = 1e-9 kg/m3"
          annotation (Placement(transformation(extent={{-24,-32},{-8,-16}})));
      Physiolibrary.Types.Constants.FractionConst             Constant(k=1)
        annotation (Placement(transformation(extent={{32,-66},{40,-58}})));
      Physiolibrary.Types.Constants.FractionConst             Constant1(k=1)
        annotation (Placement(transformation(extent={{26,-34},{34,-26}})));
      Physiolibrary.Blocks.Math.Log10AsEffect log10_2
        annotation (Placement(transformation(extent={{4,-34},{24,-14}})));
      equation
        connect(busConnector.ECFV_Vol, epinephrine.ECFV_Vol) annotation (Line(
            points={{-78,88},{-78,65},{-29,65}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ECFV_Vol, norepinephrine.ECFV_Vol) annotation (
            Line(
            points={{-78,88},{-78,33},{-29,33}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.AdrenalNerve_NA, epinephrine.AdrenalNerve_NA)
          annotation (Line(
            points={{-78,88},{-78,57},{-29,57}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.OtherTissueFunctionEffect, epinephrine.OtherTissueFunctionEffect)
          annotation (Line(
            points={{-78,88},{-78,61},{-29,61}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.OtherTissueFunctionEffect, norepinephrine.OtherTissueFunctionEffect)
          annotation (Line(
            points={{-78,88},{-78,21},{-29,21}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.AdrenalNerve_NA, norepinephrine.AdrenalNerve_NA)
          annotation (Line(
            points={{-78,88},{-78,29},{-29,29}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.GangliaGeneral_NA, norepinephrine.GangliaGeneral_NA)
          annotation (Line(
            points={{-78,88},{-78,25},{-29,25}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(epinephrine.Epinephrine, busConnector.Epinephrine) annotation (
            Line(
            points={{-9,56},{32,56},{32,88},{-78,88}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(norepinephrine.Norepinephrine, NorepinephrineConc) annotation (Line(
            points={{-9,24},{48,24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(epinephrine.Epinephrine, EpinephrineConc) annotation (Line(
            points={{-9,56},{48,56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(log10_1.y, busConnector.AlphaPool_Effect) annotation (Line(
            points={{31,-56},{78,-56},{78,90},{-78,90},{-78,88}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(AlphaTotal.y, log10_1.u) annotation (Line(
            points={{-7,-56},{8,-56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(AlphaTotal.u1, norepinephrine.Norepinephrine) annotation (Line(
            points={{-30,-48},{-36,-48},{-36,-2},{-4,-2},{-4,24},{-9,24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(epinephrine.Epinephrine, AlphaTotal.u2) annotation (Line(
            points={{-9,56},{16,56},{16,2},{-40,2},{-40,-56},{-30,-56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Desglymidodrine.y, AlphaTotal.u3) annotation (Line(
            points={{-53,-64},{-30,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(BetaTotal.u1, norepinephrine.Norepinephrine) annotation (Line(
            points={{-25.6,-19.2},{-36,-19.2},{-36,-2},{-4,-2},{-4,24},{-9,24}},
            color={0,0,127},
            smooth=Smooth.None));

        connect(BetaTotal.u2, epinephrine.Epinephrine) annotation (Line(
            points={{-25.6,-28.8},{-40,-28.8},{-40,2},{16,2},{16,56},{-9,56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(BetaTotal.y, log10_2.u) annotation (Line(
            points={{-7.2,-24},{2,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(log10_2.y, busConnector.BetaPool_Effect) annotation (Line(
            points={{25,-24},{78,-24},{78,88},{-78,88}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Constant.y, busConnector.AlphaBlocade_Effect) annotation (Line(
            points={{41,-62},{78,-62},{78,88},{-78,88}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant1.y, busConnector.BetaBlocade_Effect) annotation (Line(
            points={{35,-30},{78,-30},{78,88},{-78,88}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(norepinephrine.Norepinephrine, busConnector.Norepinephrine)
        annotation (Line(
          points={{-9,24},{26,24},{26,88},{-78,88}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
                extent={{-100,-100},{100,100}}), graphics={Text(
                extent={{-100,80},{100,100}},
                lineColor={0,0,255},
                textString="%name")}));
      end Catechols;
      annotation (Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
    end Catechols;

    package FemaleSexHormones "Ovarian Cycle Driving Hormones"
        extends Physiolibrary.Icons.FemaleSex;
      model Estradiol

        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          estradiol(
            q_out(conc(final displayUnit="nMol/ml"), q(final displayUnit="nMol/min")),
            concentration=0.00015,
          stateName="Estradiol.Mass")
          annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump
        CorpusLuteum_OvariesSecretion(useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k=
            5.0000000000001e-012)
        annotation (Placement(transformation(extent={{80,-24},{68,-12}})));
      Physiolibrary.Blocks.Factors.Spline MassEffect2(data={{0.0,0.0,0.0},{
            4000.0,10.0,0.0}})
        annotation (Placement(transformation(extent={{56,-40},{76,-20}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="nMol/l"),
        toAnotherUnitCoef=1000,
        unitsString="nMol/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-78,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.11)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump
        Follicle_OvariesSecretion(useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-98},{56,-78}})));
      Physiolibrary.Blocks.Factors.Spline MassEffect(data={{0.0,0.0,0.0},{
            4000.0,10.0,0.0}})
        annotation (Placement(transformation(extent={{56,-80},{76,-60}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant1(k=
            5.0000000000001e-012)
        annotation (Placement(transformation(extent={{82,-66},{70,-54}})));
        Physiolibrary.Factors.ZeroIfFalse onlyIf
          annotation (Placement(transformation(extent={{56,-88},{76,-68}})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit=
              "ml") "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,
                  -40},{-92,-32}}),   iconTransformation(extent={{-120,60},{-80,
                  100}})));
        Modelica.Blocks.Interfaces.BooleanInput IsFollicular
          annotation (Placement(transformation(extent={{22,-82},{30,-74}}),
              iconTransformation(extent={{-120,20},{-80,60}})));
        Modelica.Blocks.Interfaces.RealInput OvariesFollicleMass(
                                                          quantity="Mass",
            final displayUnit="mg")     annotation (Placement(transformation(extent={{22,-74},
                  {30,-66}}),         iconTransformation(extent={{-120,-60},{
                  -80,-20}})));
        Modelica.Blocks.Interfaces.RealInput CorpusLuteumMass(
                                                       quantity="Mass", final displayUnit=
                 "mg")           annotation (Placement(transformation(extent={{22,-34},
                  {30,-26}}),         iconTransformation(extent={{-120,-20},{
                  -80,20}})));
        Modelica.Blocks.Interfaces.RealOutput Estradiol(
                                                 quantity="Concentration",
            final displayUnit="nMol/l") annotation (Placement(transformation(extent={{
                  -64,-2},{-56,6}}), iconTransformation(extent={{80,-40},{120,0}})));
      equation
        connect(estradiol.q_out, CorpusLuteum_OvariesSecretion.q_out)
                                                   annotation (Line(
            points={{-72,-44},{60,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in,estradiol. q_out)   annotation (Line(
            points={{-78,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(estradiol.q_out, Degradation.q_in)
                                                 annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(estradiol.soluteMass, K.u)      annotation (Line(
            points={{-72,-51.8},{-72,-77},{-38.6,-77}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(hormoneFlowConstant.y, MassEffect2.yBase)
                                                        annotation (Line(
            points={{67.4,-18},{66,-18},{66,-28}},
            color={0,0,127},
            smooth=Smooth.None));

      connect(CorpusLuteum_OvariesSecretion.soluteFlow, MassEffect2.y)
        annotation (Line(
          points={{66,-40},{66,-32}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(Follicle_OvariesSecretion.q_out,estradiol. q_out) annotation (
            Line(
            points={{60,-88},{-4,-88},{-4,-44},{-72,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(MassEffect.yBase, hormoneFlowConstant1.y) annotation (Line(
            points={{66,-68},{66,-60},{69.4,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(MassEffect.y, onlyIf.yBase)        annotation (Line(
            points={{66,-72},{66,-76}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(onlyIf.y, Follicle_OvariesSecretion.soluteFlow) annotation (Line(
          points={{66,-80},{66,-84}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(EFCV_Vol, estradiol.SolventVolume) annotation (Line(
            points={{-96,-36},{-82,-36}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(IsFollicular, onlyIf.condition) annotation (Line(
            points={{26,-78},{56.2,-78}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(OvariesFollicleMass, MassEffect.u) annotation (Line(
            points={{26,-70},{56.2,-70}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(MassEffect2.u, CorpusLuteumMass) annotation (Line(
            points={{56.2,-30},{26,-30}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Estradiol) annotation (Line(
          points={{-78,-18},{-78,2},{-60,2}},
          color={0,0,127},
          smooth=Smooth.None));
      end Estradiol;

      model FemaleSexHormones
        extends Physiolibrary.Icons.FemaleSex;
        OvarianCycle ovarianCycle
          annotation (Placement(transformation(extent={{14,-60},{34,-40}})));
        OvariesFollicle ovariesFollicle
          annotation (Placement(transformation(extent={{42,-52},{62,-32}})));
        CorpusLuteum corpusLuteum
          annotation (Placement(transformation(extent={{72,-52},{92,-32}})));
        FSH fSH annotation (Placement(transformation(extent={{-18,-16},{2,4}})));
        Progesterone progesterone
          annotation (Placement(transformation(extent={{-18,-56},{2,-36}})));
        LH lH annotation (Placement(transformation(extent={{-18,10},{2,30}})));
        hCG hCG_
          annotation (Placement(transformation(extent={{42,-28},{62,-8}})));
        Estradiol estradiol
          annotation (Placement(transformation(extent={{-66,20},{-46,40}})));
        GnRH gnRH
          annotation (Placement(transformation(extent={{-66,-4},{-46,16}})));
        Testosterone testosterone
          annotation (Placement(transformation(extent={{-66,-36},{-46,-16}})));
        Inhibin inhibin
          annotation (Placement(transformation(extent={{-66,-60},{-46,-40}})));
        Modelica.Blocks.Interfaces.BooleanInput
                                              Cycling
                                 annotation (Placement(transformation(extent={{-4,-4},
                  {4,4}},
              origin={0,-80}),        iconTransformation(extent={{-120,20},{-80,
                  60}})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit=
              "ml") "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,44},
                  {-92,52}}),         iconTransformation(extent={{-120,60},{-80,
                  100}})));

        DayCounter dayCounter
          annotation (Placement(transformation(extent={{50,16},{70,36}})));
      equation
          connect(ovarianCycle.IsFollicular, ovariesFollicle.IsFollicular)
          annotation (Line(
            points={{34,-42},{42,-42}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(ovarianCycle.IsOvulatory, ovariesFollicle.IsOvulatory)
          annotation (Line(
            points={{34,-46},{42,-46}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(ovarianCycle.IsLuteal, ovariesFollicle.IsLuteal) annotation (
            Line(
            points={{34,-50},{42,-50}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(progesterone.Progesterone, ovarianCycle.Progesterone)
          annotation (Line(
            points={{2,-48},{14,-48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(fSH.FSH_Circulating, ovarianCycle.FSH_Circulating) annotation (
            Line(
            points={{2,-8},{10,-8},{10,-40},{14,-40}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lH.LH_Circulating, ovarianCycle.LH_Circulating) annotation (
            Line(
            points={{2,18},{6,18},{6,-44},{14,-44}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ovariesFollicle.FollicleMass, ovarianCycle.FollicleMass)
          annotation (Line(
            points={{62,-44},{68,-44},{68,-66},{6,-66},{6,-56},{14,-56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(fSH.FSH_Circulating, ovariesFollicle.FSH_Circulating)
          annotation (Line(
            points={{2,-8},{10,-8},{10,-34},{42,-34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ovariesFollicle.Atresia, corpusLuteum.OvariesFollicleAtresia)
          annotation (Line(
            points={{62,-38},{72,-38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(corpusLuteum.CorpusLuteumMass, ovarianCycle.CorpusLuteumMass)
          annotation (Line(
            points={{92,-44},{96,-44},{96,-70},{4,-70},{4,-52},{14,-52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hCG_.hCG, corpusLuteum.hCG) annotation (Line(
            points={{62,-20},{66,-20},{66,-34},{72,-34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(estradiol.Estradiol, fSH.Estradiol) annotation (Line(
            points={{-46,28},{-40,28},{-40,-14},{-17.8,-14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ovarianCycle.IsFollicular, estradiol.IsFollicular) annotation (
            Line(
            points={{34,-42},{36,-42},{36,42},{-70,42},{-70,34},{-66,34}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(ovariesFollicle.FollicleMass, estradiol.OvariesFollicleMass)
          annotation (Line(
            points={{62,-44},{68,-44},{68,-66},{-78,-66},{-78,26},{-66,26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(gnRH.GnRH_period, fSH.GnRH_Period) annotation (Line(
            points={{-46,-2},{-17.8,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(testosterone.Testosterone, fSH.Testosterone) annotation (Line(
            points={{-46,-28},{-32,-28},{-32,-6},{-17.8,-6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(inhibin.Inhibin, fSH.Inhibin) annotation (Line(
            points={{-46,-52},{-36,-52},{-36,-10},{-17.8,-10}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(corpusLuteum.CorpusLuteumMass, progesterone.CorpusLuteumMass)
          annotation (Line(
            points={{92,-44},{96,-44},{96,-70},{-24,-70},{-24,-42},{-18,-42}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lH.Estradiol, estradiol.Estradiol) annotation (Line(
            points={{-18,24},{-32,24},{-32,28},{-46,28}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lH.GnRH_Period, gnRH.GnRH_period) annotation (Line(
            points={{-18,20},{-28,20},{-28,-2},{-46,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(corpusLuteum.CorpusLuteumMass, inhibin.CorpusLuteumMass)
          annotation (Line(
            points={{92,-44},{96,-44},{96,-70},{-82,-70},{-82,-54},{-66,-54}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ovarianCycle.IsFollicular, inhibin.IsFollicular) annotation (
            Line(
            points={{34,-42},{36,-42},{36,42},{-86,42},{-86,-46},{-66,-46}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(estradiol.Estradiol, gnRH.Estradiol) annotation (Line(
            points={{-46,28},{-40,28},{-40,-14},{-74,-14},{-74,14},{-66,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(testosterone.Testosterone, gnRH.Testosterone) annotation (Line(
            points={{-46,-28},{-32,-28},{-32,-6},{-72,-6},{-72,2},{-66,2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lH.Inhibin, inhibin.Inhibin) annotation (Line(
            points={{-18,12},{-36,12},{-36,-52},{-46,-52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lH.Testosterone, testosterone.Testosterone) annotation (Line(
            points={{-18,16},{-32,16},{-32,-28},{-46,-28}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Cycling, ovarianCycle.Cycling) annotation (Line(
            points={{0,-80},{8,-80},{8,-60},{14,-60}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(EFCV_Vol, estradiol.EFCV_Vol) annotation (Line(
            points={{-96,48},{-90,48},{-90,38},{-66,38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, testosterone.EFCV_Vol) annotation (Line(
            points={{-96,48},{-90,48},{-90,-18},{-66,-18}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, inhibin.EFCV_Vol) annotation (Line(
            points={{-96,48},{-90,48},{-90,-42},{-66,-42}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, lH.EFCV_Vol) annotation (Line(
            points={{-96,48},{-24,48},{-24,28},{-18.2,28}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, fSH.EFCV_Vol) annotation (Line(
            points={{-96,48},{-24,48},{-24,2},{-17.8,2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, progesterone.EFCV_Vol) annotation (Line(
            points={{-96,48},{-24,48},{-24,-38},{-18,-38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, hCG_.EFCV_Vol) annotation (Line(
            points={{-96,48},{32,48},{32,-10},{42,-10}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ovariesFollicle.FollicleMass, inhibin.OvariesFollicleMass)
          annotation (Line(
            points={{62,-44},{68,-44},{68,-66},{-78,-66},{-78,-50},{-66,-50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(corpusLuteum.CorpusLuteumMass, estradiol.CorpusLuteumMass)
          annotation (Line(
            points={{92,-44},{96,-44},{96,-70},{-82,-70},{-82,30},{-66,30}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(estradiol.Estradiol, ovariesFollicle.Estradiol) annotation (
            Line(
            points={{-46,28},{-40,28},{-40,36},{28,36},{28,-38},{42,-38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ovarianCycle.IsFollicular, dayCounter.Reset) annotation (Line(
            points={{34,-42},{36,-42},{36,26},{50,26}},
            color={255,0,255},
            smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={                            Text(
                extent={{-100,-100},{102,-122}},
                lineColor={0,0,255},
                textString="%name")}));
      end FemaleSexHormones;

      model OvariesFollicle

        Modelica.Blocks.Interfaces.RealInput FSH_Circulating(
                                                      quantity="Concentration",
            final displayUnit="IU/l") annotation (Placement(transformation(extent={{-70,6},{-62,
                  14}}),              iconTransformation(extent={{-120,60},{-80,
                  100}})));
      Physiolibrary.Blocks.Factors.Spline FSHEffect(data={{0.0,0.8,0.0},{5.0,
            2.0,0.2},{15.0,3.0,0.0}})
        annotation (Placement(transformation(extent={{-50,0},{-30,20}})));
      Physiolibrary.Blocks.Factors.Spline EstradiolEffect(data={{0.0,1.0,0.0},{
            3.0,3.0,0.0}})
        annotation (Placement(transformation(extent={{-50,-6},{-30,14}})));
      Physiolibrary.Blocks.Factors.Spline MassEffect(data={{0.0,1.0,0.005},{
            4000.0,10.0,0.0}})
        annotation (Placement(transformation(extent={{-50,-12},{-30,8}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant BasicGrowth(k=
            0.02)
        annotation (Placement(transformation(extent={{-52,16},{-44,24}})));
        Physiolibrary.Factors.ZeroIfFalse OnlyIf
          annotation (Placement(transformation(extent={{-50,-18},{-30,2}})));
        Modelica.Blocks.Interfaces.RealInput Estradiol(
                                                quantity="Concentration",
            final displayUnit="nMol/l") annotation (Placement(transformation(extent={{-78,0},
                  {-70,8}}),          iconTransformation(extent={{-120,20},{-80,
                  60}})));
        Physiolibrary.Factors.ZeroIfFalse OnlyIf2
          annotation (Placement(transformation(extent={{30,-16},{50,4}})));
      Physiolibrary.Blocks.Factors.Spline MassEffect1(data={{0.0,0.0,0.0},{
            200.0,1.0,0.0}})
        annotation (Placement(transformation(extent={{30,-10},{50,10}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=0.5)
        annotation (Placement(transformation(extent={{28,4},{36,12}})));
        Modelica.Blocks.Math.Feedback Change
          annotation (Placement(transformation(extent={{30,-30},{50,-50}})));
        Modelica.Blocks.Interfaces.BooleanInput IsFollicular
          annotation (Placement(transformation(extent={{-78,-12},{-70,-4}}),
              iconTransformation(extent={{-120,-20},{-80,20}})));
        Modelica.Blocks.Interfaces.BooleanInput IsOvulatory
          annotation (Placement(transformation(extent={{-8,-8},{0,0}}),
              iconTransformation(extent={{-120,-60},{-80,-20}})));
        Modelica.Blocks.Interfaces.BooleanInput IsLuteal
          annotation (Placement(transformation(extent={{-8,-16},{0,-8}}),
              iconTransformation(extent={{-120,-100},{-80,-60}})));
        Modelica.Blocks.Logical.Or or1
          annotation (Placement(transformation(extent={{12,-10},{20,-2}})));
      Physiolibrary.Blocks.IntegratorWithRestart Mass(y_start=65, k=1/Physiomodel.Metabolism.deprecated.SecPerMin)
        annotation (Placement(transformation(extent={{60,-50},{80,-30}})));
        Modelica.Blocks.Logical.Edge edge1
          annotation (Placement(transformation(extent={{-4,-84},{16,-64}})));
        Modelica.Blocks.Interfaces.RealOutput Atresia
                                               annotation (Placement(transformation(
                extent={{44,-26},{54,-16}}), iconTransformation(extent={{80,20},{120,60}})));
        Modelica.Blocks.Interfaces.RealOutput FollicleMass(
                                                    quantity="Mass", final displayUnit="mg")
          annotation (Placement(transformation(extent={{86,-44},{94,-36}}),
              iconTransformation(extent={{80,-40},{120,0}})));
      equation
        connect(EstradiolEffect.y, MassEffect.yBase) annotation (Line(
            points={{-40,2},{-40,0}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FSHEffect.y, EstradiolEffect.yBase) annotation (Line(
            points={{-40,8},{-40,6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(BasicGrowth.y, FSHEffect.yBase) annotation (Line(
            points={{-43.6,20},{-40,20},{-40,12}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FSHEffect.u, FSH_Circulating) annotation (Line(
            points={{-49.8,10},{-66,10}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(MassEffect.y, OnlyIf.yBase)        annotation (Line(
            points={{-40,-4},{-40,-6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EstradiolEffect.u, Estradiol) annotation (Line(
            points={{-49.8,4},{-74,4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(MassEffect1.y, OnlyIf2.yBase)   annotation (Line(
            points={{40,-2},{40,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant1.y, MassEffect1.yBase) annotation (Line(
            points={{36.4,8},{40,8},{40,2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Change.y, Mass.u) annotation (Line(
            points={{49,-40},{58,-40}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Change.u1, OnlyIf.y)        annotation (Line(
            points={{32,-40},{-40,-40},{-40,-10}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(OnlyIf.condition, IsFollicular) annotation (Line(
            points={{-49.8,-8},{-74,-8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(or1.y, OnlyIf2.condition)   annotation (Line(
            points={{20.4,-6},{30.2,-6}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(IsOvulatory, or1.u1) annotation (Line(
            points={{-4,-4},{4,-4},{4,-6},{11.2,-6}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(IsLuteal, or1.u2) annotation (Line(
            points={{-4,-12},{4,-12},{4,-9.2},{11.2,-9.2}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(Mass.y, MassEffect1.u) annotation (Line(
            points={{81,-40},{86,-40},{86,36},{24,36},{24,0},{30.2,0}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Mass.y, MassEffect.u) annotation (Line(
            points={{81,-40},{86,-40},{86,36},{-92,36},{-92,-2},{-49.8,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(OnlyIf2.y, Change.u2)   annotation (Line(
            points={{40,-8},{40,-32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(IsFollicular, edge1.u) annotation (Line(
            points={{-74,-8},{-60,-8},{-60,-74},{-6,-74}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(edge1.y, Mass.restart) annotation (Line(
            points={{17,-74},{52,-74},{52,-48},{58,-48}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(OnlyIf2.y, Atresia) annotation (Line(
            points={{40,-8},{40,-21},{49,-21}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Mass.y, FollicleMass) annotation (Line(
            points={{81,-40},{90,-40}},
            color={0,0,127},
            smooth=Smooth.None));
      end OvariesFollicle;

      model OvarianCycle

        Modelica.StateGraph.InitialStepWithSignal FOLLICULAR(
                                                   nIn=3)
          annotation (Placement(transformation(extent={{-94,18},{-74,38}})));
        Modelica.StateGraph.TransitionWithSignal Follicle
          annotation (Placement(transformation(extent={{-68,38},{-48,18}})));
        Modelica.StateGraph.StepWithSignal OVULATORY(
                                           nOut=2)
          annotation (Placement(transformation(extent={{-42,18},{-22,38}})));
        Modelica.StateGraph.TransitionWithSignal Ovulation
          annotation (Placement(transformation(extent={{-10,38},{10,18}})));
        Modelica.StateGraph.StepWithSignal LUTEAL(
                                        nOut=2)
          annotation (Placement(transformation(extent={{16,18},{36,38}})));
        Modelica.StateGraph.StepWithSignal IDLE
          annotation (Placement(transformation(extent={{74,18},{94,38}})));
        Modelica.StateGraph.TransitionWithSignal CorpusLuteum
          annotation (Placement(transformation(extent={{48,38},{68,18}})));
        Modelica.StateGraph.TransitionWithSignal PrimaryFollicleFromIdle
          annotation (Placement(transformation(extent={{88,-20},{68,0}})));
        Modelica.StateGraph.TransitionWithSignal PrimaryFollicleFromLuteal
          annotation (Placement(transformation(extent={{38,-20},{18,0}})));
        Modelica.StateGraph.TransitionWithSignal PrimaryFollicleFromOvulation
          annotation (Placement(transformation(extent={{-20,-20},{-40,0}})));
        Modelica.Blocks.Interfaces.RealInput FSH_Circulating(
                                                      quantity="Concentration",
            final displayUnit="IU/l") annotation (Placement(transformation(extent={{24,-92},{
                  32,-84}}),          iconTransformation(extent={{-120,80},{-80,
                  120}})));
        Modelica.Blocks.Interfaces.RealInput LH_Circulating(
                                                     quantity="Concentration",
            final displayUnit="IU/l") annotation (Placement(transformation(extent={{-96,90},{
                  -88,98}}),          iconTransformation(extent={{-120,40},{-80,
                  80}})));
        Modelica.Blocks.Interfaces.BooleanInput
                                              Cycling
                                 annotation (Placement(transformation(extent={{-4,-4},
                  {4,4}},
              rotation=90,
              origin={82,-90}),       iconTransformation(extent={{-120,-120},{-80,-80}})));
        Modelica.Blocks.Logical.GreaterThreshold greaterThreshold(threshold=3)
          annotation (Placement(transformation(extent={{44,-92},{52,-84}})));
        Modelica.Blocks.Interfaces.RealInput FollicleMass(
                                                   quantity="Mass", final displayUnit="mg")
                                 annotation (Placement(transformation(extent={{-96,78},
                  {-88,86}}),         iconTransformation(extent={{-120,-80},{-80,-40}})));
        Modelica.Blocks.Interfaces.RealInput CorpusLuteumMass(
                                                       quantity="Mass", final displayUnit="mg")
                                 annotation (Placement(transformation(extent={{16,78},
                  {24,86}}),          iconTransformation(extent={{-120,-40},{-80,0}})));
        Modelica.Blocks.Math.Add mass
          annotation (Placement(transformation(extent={{22,-66},{30,-58}})));
        Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold(threshold=400)
          annotation (Placement(transformation(extent={{44,-66},{52,-58}})));
        Modelica.Blocks.Logical.And and1
          annotation (Placement(transformation(extent={{62,-80},{72,-70}})));
        Modelica.Blocks.Logical.And and2 annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=90,
              origin={78,-58})));
        Modelica.Blocks.Logical.GreaterThreshold greaterThreshold1(threshold=20)
          annotation (Placement(transformation(extent={{-74,90},{-66,98}})));
        Modelica.Blocks.Logical.GreaterThreshold greaterThreshold2(threshold=2800)
          annotation (Placement(transformation(extent={{-74,78},{-66,86}})));
        Modelica.Blocks.Logical.And and3 annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={-58,70})));
        Modelica.Blocks.Interfaces.RealInput Progesterone(
                                                   quantity="Concentration", final displayUnit=
                 "nMol/l")     annotation (Placement(transformation(extent={{-32,90},{
                  -24,98}}),          iconTransformation(extent={{-120,0},{-80,
                  40}})));
        Modelica.Blocks.Logical.GreaterEqualThreshold greaterEqualThreshold(threshold=
             8) annotation (Placement(transformation(extent={{-14,90},{-6,98}})));
        Modelica.Blocks.Logical.LessThreshold greaterThreshold3(threshold=100)
          annotation (Placement(transformation(
              extent={{4,-4},{-4,4}},
              rotation=180,
              origin={46,82})));
        Modelica.Blocks.Logical.And and4 annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={58,72})));
        Modelica.Blocks.Interfaces.BooleanOutput IsFollicular annotation (Placement(
              transformation(extent={{-78,4},{-72,10}}), iconTransformation(extent={{80,
                  60},{120,100}})));
        Modelica.Blocks.Interfaces.BooleanOutput IsOvulatory annotation (Placement(
              transformation(extent={{-24,8},{-18,14}}), iconTransformation(extent={{80,
                  20},{120,60}})));
        Modelica.Blocks.Interfaces.BooleanOutput IsLuteal annotation (Placement(
              transformation(extent={{32,10},{38,16}}), iconTransformation(extent={{80,
                  -20},{120,20}})));
        Modelica.Blocks.Interfaces.BooleanOutput IsIdle annotation (Placement(
              transformation(extent={{90,10},{96,16}}), iconTransformation(extent={{80,
                  -60},{120,-20}})));
      equation
        connect(FOLLICULAR.outPort[1], Follicle.inPort) annotation (Line(
            points={{-73.5,28},{-62,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(Follicle.outPort, OVULATORY.inPort[1]) annotation (Line(
            points={{-56.5,28},{-43,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(OVULATORY.outPort[1], Ovulation.inPort) annotation (Line(
            points={{-21.5,28.25},{-6.75,28.25},{-6.75,28},{-4,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(Ovulation.outPort, LUTEAL.inPort[1]) annotation (Line(
            points={{1.5,28},{15,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(LUTEAL.outPort[1], CorpusLuteum.inPort) annotation (Line(
            points={{36.5,28.25},{54,28.25},{54,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(CorpusLuteum.outPort, IDLE.inPort[1]) annotation (Line(
            points={{59.5,28},{73,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(IDLE.outPort[1], PrimaryFollicleFromIdle.inPort) annotation (
            Line(
            points={{94.5,28},{96,28},{96,-10},{82,-10}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(PrimaryFollicleFromLuteal.outPort, FOLLICULAR.inPort[1])
          annotation (Line(
            points={{26.5,-10},{10,-10},{10,-34},{-98,-34},{-98,28.6667},{-95,
                28.6667}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(PrimaryFollicleFromIdle.outPort, FOLLICULAR.inPort[2])
          annotation (Line(
            points={{76.5,-10},{62,-10},{62,-34},{-98,-34},{-98,28},{-95,28}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(OVULATORY.outPort[2], PrimaryFollicleFromOvulation.inPort)
          annotation (Line(
            points={{-21.5,27.75},{-12,27.75},{-12,-10},{-26,-10}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(LUTEAL.outPort[2], PrimaryFollicleFromLuteal.inPort)
          annotation (Line(
            points={{36.5,27.75},{46,27.75},{46,-10},{32,-10}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(PrimaryFollicleFromOvulation.outPort, FOLLICULAR.inPort[3])
          annotation (Line(
            points={{-31.5,-10},{-50,-10},{-50,-34},{-98,-34},{-98,28},{-94,28},
                {-94,27.3333},{-95,27.3333}},
            color={0,0,0},
            smooth=Smooth.None));
        connect(FSH_Circulating, greaterThreshold.u) annotation (Line(
            points={{28,-88},{43.2,-88}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(mass.y, lessEqualThreshold.u) annotation (Line(
            points={{30.4,-62},{43.2,-62}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lessEqualThreshold.y, and1.u1) annotation (Line(
            points={{52.4,-62},{56,-62},{56,-75},{61,-75}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(greaterThreshold.y, and1.u2) annotation (Line(
            points={{52.4,-88},{56,-88},{56,-79},{61,-79}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(and2.y, PrimaryFollicleFromIdle.condition) annotation (Line(
            points={{78,-53.6},{78,-22}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(and2.y, PrimaryFollicleFromLuteal.condition) annotation (Line(
            points={{78,-53.6},{78,-30},{28,-30},{28,-22}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(and2.y, PrimaryFollicleFromOvulation.condition) annotation (Line(
            points={{78,-53.6},{78,-30},{-30,-30},{-30,-22}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(greaterThreshold1.u, LH_Circulating) annotation (Line(
            points={{-74.8,94},{-92,94}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FollicleMass, greaterThreshold2.u) annotation (Line(
            points={{-92,82},{-74.8,82}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(greaterThreshold1.y, and3.u1) annotation (Line(
            points={{-65.6,94},{-58,94},{-58,74.8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(greaterThreshold2.y, and3.u2) annotation (Line(
            points={{-65.6,82},{-61.2,82},{-61.2,74.8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(and1.y, and2.u1) annotation (Line(
            points={{72.5,-75},{78,-75},{78,-62.8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(Cycling, and2.u2) annotation (Line(
            points={{82,-90},{82,-62.8},{81.2,-62.8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(and3.y, Follicle.condition) annotation (Line(
            points={{-58,65.6},{-58,40}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(Progesterone, greaterEqualThreshold.u) annotation (Line(
            points={{-28,94},{-14.8,94}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(greaterEqualThreshold.y, Ovulation.condition) annotation (Line(
            points={{-5.6,94},{0,94},{0,40}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(greaterThreshold3.u, CorpusLuteumMass) annotation (Line(
            points={{41.2,82},{20,82}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CorpusLuteumMass, mass.u2) annotation (Line(
            points={{20,82},{38,82},{38,92},{100,92},{100,-98},{10,-98},{10,-64.4},{21.2,
                -64.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FollicleMass, mass.u1) annotation (Line(
            points={{-92,82},{-84,82},{-84,70},{-100,70},{-100,-59.6},{21.2,-59.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(greaterThreshold3.y, and4.u2) annotation (Line(
            points={{50.4,82},{54,82},{54,76.8},{54.8,76.8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(CorpusLuteum.condition, and4.y) annotation (Line(
            points={{58,40},{58,67.6}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(Cycling, and4.u1) annotation (Line(
            points={{82,-90},{82,-72},{98,-72},{98,82},{58,82},{58,76.8}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(IsFollicular, FOLLICULAR.active) annotation (Line(
            points={{-75,7},{-84,7},{-84,17}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(OVULATORY.active, IsOvulatory) annotation (Line(
            points={{-32,17},{-32,11},{-21,11}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(LUTEAL.active, IsLuteal) annotation (Line(
            points={{26,17},{26,13},{35,13}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(IDLE.active, IsIdle) annotation (Line(
            points={{84,17},{84,13},{93,13}},
            color={255,0,255},
            smooth=Smooth.None));
      end OvarianCycle;

      model CorpusLuteum

        Modelica.Blocks.Interfaces.RealInput hCG(
                                          quantity="Concentration", final displayUnit="IU/l")
                               annotation (Placement(transformation(extent={{-42,34},{
                  -34,42}}),          iconTransformation(extent={{-120,60},{-80,100}})));
        Modelica.Blocks.Interfaces.RealInput OvariesFollicleAtresia(
                                                             quantity="MassChange",
            final displayUnit="mg/min")
                               annotation (Placement(transformation(extent={{-46,2},{-38,
                  10}}),              iconTransformation(extent={{-120,20},{-80,60}})));
      Physiolibrary.Blocks.Factors.Normalization massEffect
        annotation (Placement(transformation(extent={{-26,22},{-6,42}})));
      Physiolibrary.Blocks.Factors.Spline hCGEffect(data={{0.0,1.0,0.0},{100.0,
            -0.5,0.0}})
        annotation (Placement(transformation(extent={{-26,28},{-6,48}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=
            0.0001)
        annotation (Placement(transformation(extent={{-28,42},{-20,50}})));
        Modelica.Blocks.Math.Feedback Change
          annotation (Placement(transformation(extent={{-26,16},{-6,-4}})));
      Modelica.Blocks.Continuous.Integrator Mass(k=1/Physiomodel.Metabolism.deprecated.SecPerMin,
          final y_start=0)
        annotation (Placement(transformation(extent={{8,-4},{28,16}})));
        Modelica.Blocks.Interfaces.RealOutput CorpusLuteumMass(
                                                        quantity="Mass", final displayUnit="mg")
          annotation (Placement(transformation(extent={{48,2},{56,10}}),
              iconTransformation(extent={{80,-40},{120,0}})));
      equation
        connect(hCGEffect.y, massEffect.yBase)  annotation (Line(
            points={{-16,36},{-16,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant1.y, hCGEffect.yBase)   annotation (Line(
            points={{-19.6,46},{-16,46},{-16,40}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Change.y, Mass.u) annotation (Line(
            points={{-7,6},{6,6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(massEffect.y, Change.u2)
                                        annotation (Line(
            points={{-16,30},{-16,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(OvariesFollicleAtresia, Change.u1) annotation (Line(
            points={{-42,6},{-24,6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hCG, hCGEffect.u) annotation (Line(
            points={{-38,38},{-25.8,38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Mass.y, massEffect.u) annotation (Line(
            points={{29,6},{36,6},{36,60},{-46,60},{-46,32},{-25.8,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Mass.y, CorpusLuteumMass) annotation (Line(
            points={{29,6},{52,6}},
            color={0,0,127},
            smooth=Smooth.None));
      end CorpusLuteum;

      model Progesterone

        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          progesterone(q_out(conc(final displayUnit="nMol/ml"), q(final displayUnit=
                  "nMol/min")), concentration=0.0001,
          stateName="Progesterone.Mass")
          annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump OvariesSecretion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k=
            3.3333333333334e-010)
        annotation (Placement(transformation(extent={{80,-24},{68,-12}})));
      Physiolibrary.Blocks.Factors.Spline MassEffect2(data={{0.0,0.0,0.0},{
            4000.0,10.0,0.0}})
        annotation (Placement(transformation(extent={{56,-40},{76,-20}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="nMol/l"),
        toAnotherUnitCoef=1000,
        unitsString="nMol/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-76,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.16)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit=
              "ml") "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,
                  -40},{-92,-32}}),   iconTransformation(extent={{-120,60},{-80,
                  100}})));
        Modelica.Blocks.Interfaces.RealInput CorpusLuteumMass(
                                                       quantity="Mass", final displayUnit=
                 "mg")           annotation (Placement(transformation(extent={{34,-34},
                  {42,-26}}),         iconTransformation(extent={{-120,20},{-80,
                  60}})));
        Modelica.Blocks.Interfaces.RealOutput Progesterone(
                                                    quantity="Concentration",
            final displayUnit="nMol/l") annotation (Placement(transformation(extent={{
                  -60,-10},{-52,-2}}), iconTransformation(extent={{80,-40},{120,
                  0}})));
      equation
        connect(progesterone.q_out, OvariesSecretion.q_out)
                                                   annotation (Line(
            points={{-72,-44},{60,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, progesterone.q_out)
                                                              annotation (Line(
            points={{-76,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(progesterone.q_out, Degradation.q_in)
                                                 annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(progesterone.soluteMass, K.u)   annotation (Line(
            points={{-72,-51.8},{-72,-77},{-38.6,-77}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(hormoneFlowConstant.y, MassEffect2.yBase)
                                                        annotation (Line(
            points={{67.4,-18},{66,-18},{66,-28}},
            color={0,0,127},
            smooth=Smooth.None));

      connect(OvariesSecretion.soluteFlow, MassEffect2.y) annotation (Line(
          points={{66,-40},{66,-32}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(EFCV_Vol, progesterone.SolventVolume) annotation (Line(
            points={{-96,-36},{-82,-36}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CorpusLuteumMass, MassEffect2.u) annotation (Line(
            points={{38,-30},{56.2,-30}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Progesterone) annotation (
          Line(
          points={{-76,-18},{-76,-6},{-56,-6}},
          color={0,0,127},
          smooth=Smooth.None));
      end Progesterone;

      model LH
                                             //Library.Interfaces.Tissues.Hypothalamus;

      Physiolibrary.Chemical.Components.Substance LH_Circulating_Mass(
        q_out(conc(final displayUnit="IU/ml"), q(final displayUnit="IU/min")),
        stateName="LH-Circulating.Mass",
        useNormalizedVolume=false)
        annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="IU/l"),
        toAnotherUnitCoef=1,
        unitsString="IU/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-78,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.005)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump AnteriorPituitary(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Blocks.Factors.Spline InhibinEffect(data={{0.0,1.0,0.0},{
            7000.0,0.4,0.0}})
        annotation (Placement(transformation(extent={{56,-36},{76,-16}})));
      Physiolibrary.Types.Constants.MassFlowRateConst hormoneFlowConstant1(k=(
            0.6)/60*MassPerIU)
        annotation (Placement(transformation(extent={{82,0},{70,12}})));
      Physiolibrary.Blocks.Factors.Spline EstradiolEffect(data={{0.0,1.0,0.0},{
            0.4,0.5,0.0},{1.5,0.5,0.0},{2.0,20.0,0.0}})
        annotation (Placement(transformation(extent={{56,-26},{76,-6}})));
      Physiolibrary.Blocks.Factors.Spline GnRHEffect(data={{0.0,2.0,0.0},{80.0,
            1.0,-0.01},{200.0,0.2,0.0}})
        annotation (Placement(transformation(extent={{56,-16},{76,4}})));
      Physiolibrary.Blocks.Factors.Spline TestosteroneEffect(data={{0.0,0.999,
            0.0},{50.0,0.2,0.0}})
        annotation (Placement(transformation(extent={{56,-44},{76,-24}})));
        Modelica.Blocks.Interfaces.RealInput Estradiol(
                                                quantity="Concentration", final displayUnit="nMol/l")
                               annotation (Placement(transformation(extent={{38,-20},{
                  46,-12}}),          iconTransformation(extent={{-120,20},{-80,
                  60}})));
        Modelica.Blocks.Interfaces.RealInput Inhibin(
                                              quantity="Concentration", final displayUnit="IU/l")
                               annotation (Placement(transformation(extent={{38,-30},{
                  46,-22}}),          iconTransformation(extent={{-120,-100},{-80,-60}})));
        Modelica.Blocks.Interfaces.RealInput Testosterone(
                                                   quantity="Concentration", final displayUnit=
                 "nMol/l")     annotation (Placement(transformation(extent={{38,-38},{
                  46,-30}}),          iconTransformation(extent={{-120,-60},{-80,-20}})));
        Modelica.Blocks.Interfaces.RealInput GnRH_Period(
                                                  quantity="Time", final displayUnit="min")
                               annotation (Placement(transformation(extent={{38,-10},{
                  46,-2}}),           iconTransformation(extent={{-120,-20},{-80,20}})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit="ml")
        "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,-40},
                  {-92,-32}}),        iconTransformation(extent={{-122,60},{-82,
                  100}})));
        Modelica.Blocks.Interfaces.RealOutput LH_Circulating(
                                                      quantity="Concentration",
            final displayUnit="IU/l") annotation (Placement(transformation(extent={{-64,-8},{
                  -56,0}}), iconTransformation(extent={{80,-40},{120,0}})));
        Modelica.Blocks.Math.Gain gain(k=0.001) "ml to l"
          annotation (Placement(transformation(extent={{-90,-38},{-84,-32}})));
      equation
        connect(concentrationMeasure.q_in, LH_Circulating_Mass.q_out)
                                                              annotation (Line(
            points={{-78,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(LH_Circulating_Mass.q_out, Degradation.q_in)
                                                 annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(LH_Circulating_Mass.solute, K.u) annotation (Line(
          points={{-72,-51.8},{-72,-77},{-38.6,-77}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(AnteriorPituitary.q_out, LH_Circulating_Mass.q_out)
                                                                  annotation (
            Line(
            points={{60,-44},{-72,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(TestosteroneEffect.y, AnteriorPituitary.soluteFlow) annotation (
          Line(
          points={{66,-36},{66,-40}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(InhibinEffect.y, TestosteroneEffect.yBase) annotation (Line(
            points={{66,-28},{66,-32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EstradiolEffect.y, InhibinEffect.yBase) annotation (Line(
            points={{66,-18},{66,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GnRHEffect.y, EstradiolEffect.yBase) annotation (Line(
            points={{66,-8},{66,-14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant1.y, GnRHEffect.yBase) annotation (Line(
            points={{69.4,6},{66,6},{66,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EstradiolEffect.u, Estradiol) annotation (Line(
            points={{56.2,-16},{42,-16}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(InhibinEffect.u, Inhibin) annotation (Line(
            points={{56.2,-26},{42,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TestosteroneEffect.u, Testosterone) annotation (Line(
            points={{56.2,-34},{42,-34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GnRHEffect.u, GnRH_Period) annotation (Line(
            points={{56.2,-6},{42,-6}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, LH_Circulating) annotation (
          Line(
          points={{-78,-18},{-78,-4},{-60,-4}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(EFCV_Vol, gain.u) annotation (Line(
            points={{-96,-36},{-92,-36},{-92,-35},{-90.6,-35}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(gain.y, LH_Circulating_Mass.solutionVolume) annotation (Line(
          points={{-83.7,-35},{-83.7,-35.5},{-80,-35.5},{-80,-38}},
          color={0,0,127},
          smooth=Smooth.None));
      end LH;

      model FSH

      Physiolibrary.Chemical.Components.Substance FSH_Circulating_(
        q_out(conc(final displayUnit="IU/ml"), q(final displayUnit="IU/min")),
        stateName="FSH-Circulating.Mass",
        useNormalizedVolume=false)
        annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="IU/l"),
        toAnotherUnitCoef=1,
        unitsString="IU/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-76,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.0009)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump AnteriorPituitary(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Blocks.Factors.Spline InhibinEffect(data={{0.0,1.0,0.0},{
            7000.0,0.4,0.0}})
        annotation (Placement(transformation(extent={{56,-36},{76,-16}})));
      Physiolibrary.Types.Constants.MassFlowRateConst hormoneFlowConstant1(k=(
            0.05)/60*MassPerIU)
        annotation (Placement(transformation(extent={{82,0},{70,12}})));
      Physiolibrary.Blocks.Factors.Spline GnRHEffect(data={{0.0,2.0,0.0},{80.0,
            1.0,-0.01},{200.0,0.2,0.0}})
        annotation (Placement(transformation(extent={{56,-16},{76,4}})));
      Physiolibrary.Blocks.Factors.Spline TestosteroneEffect(data={{0.0,0.999,
            0.0},{50.0,0.2,0.0}})
        annotation (Placement(transformation(extent={{56,-44},{76,-24}})));
        Modelica.Blocks.Interfaces.RealInput Estradiol(
                                                quantity="Concentration", final displayUnit="nMol/l")
                               annotation (Placement(transformation(extent={{38,-20},{
                  46,-12}}),          iconTransformation(extent={{-118,-100},{
                  -78,-60}})));
        Modelica.Blocks.Interfaces.RealInput Inhibin(
                                              quantity="Concentration", final displayUnit="IU/l")
                               annotation (Placement(transformation(extent={{38,-30},{
                  46,-22}}),          iconTransformation(extent={{-118,-60},{
                  -78,-20}})));
        Modelica.Blocks.Interfaces.RealInput Testosterone(
                                                   quantity="Concentration", final displayUnit=
                 "nMol/l")     annotation (Placement(transformation(extent={{38,-38},{
                  46,-30}}),          iconTransformation(extent={{-118,-20},{
                  -78,20}})));
        Modelica.Blocks.Interfaces.RealInput GnRH_Period(
                                                  quantity="Time", final displayUnit="min")
                               annotation (Placement(transformation(extent={{38,-10},{
                  46,-2}}),           iconTransformation(extent={{-118,20},{-78,
                  60}})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit="ml")
        "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,-40},
                  {-92,-32}}),        iconTransformation(extent={{-118,60},{-78,
                  100}})));
        Modelica.Blocks.Interfaces.RealOutput FSH_Circulating(
                                                       quantity="Concentration",
            final displayUnit="IU/l") annotation (Placement(transformation(extent={{-62,-6},{
                  -54,2}}), iconTransformation(extent={{80,-40},{120,0}})));
      Physiomodel.Metabolism.deprecated.Input2EffectDelayed EstradiolEffectDelayed(Tau=
           10, data={{0.0,1.0,0.0},{0.4,0.6,0.0},{1.5,0.6,0.0},{2.0,5.0,0.0}})
        annotation (Placement(transformation(extent={{56,-26},{76,-6}})));
        Modelica.Blocks.Math.Gain gain(k=0.001) "ml to l"
          annotation (Placement(transformation(extent={{-90,-38},{-84,-32}})));
      equation
        connect(concentrationMeasure.q_in, FSH_Circulating_.q_out)
                                                              annotation (Line(
            points={{-76,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(FSH_Circulating_.q_out, Degradation.q_in)
                                                 annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(FSH_Circulating_.solute, K.u) annotation (Line(
          points={{-72,-51.8},{-72,-77},{-38.6,-77}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(AnteriorPituitary.q_out, FSH_Circulating_.q_out)  annotation (
            Line(
            points={{60,-44},{-72,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(TestosteroneEffect.y, AnteriorPituitary.soluteFlow) annotation (
          Line(
          points={{66,-36},{66,-40}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(InhibinEffect.y, TestosteroneEffect.yBase) annotation (Line(
            points={{66,-28},{66,-32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant1.y, GnRHEffect.yBase) annotation (Line(
            points={{69.4,6},{66,6},{66,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(InhibinEffect.u, Inhibin) annotation (Line(
            points={{56.2,-26},{42,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TestosteroneEffect.u, Testosterone) annotation (Line(
            points={{56.2,-34},{42,-34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GnRHEffect.u, GnRH_Period) annotation (Line(
            points={{56.2,-6},{42,-6}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, FSH_Circulating) annotation (
          Line(
          points={{-76,-18},{-76,-2},{-58,-2}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(GnRHEffect.y, EstradiolEffectDelayed.yBase) annotation (Line(
            points={{66,-8},{66,-14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EstradiolEffectDelayed.y, InhibinEffect.yBase) annotation (Line(
            points={{66,-18},{66,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Estradiol, EstradiolEffectDelayed.u) annotation (Line(
            points={{42,-16},{50,-16},{50,-16},{56.2,-16}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EFCV_Vol, gain.u) annotation (Line(
            points={{-96,-36},{-92,-36},{-92,-35},{-90.6,-35}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(gain.y, FSH_Circulating_.solutionVolume) annotation (Line(
          points={{-83.7,-35},{-83.7,-35.5},{-80,-35.5},{-80,-38}},
          color={0,0,127},
          smooth=Smooth.None));
      end FSH;

      model GnRH

      Physiolibrary.Types.Constants.TimeConst hormoneFlowConstant1(k=4800)
        annotation (Placement(transformation(extent={{30,40},{18,52}})));
      Physiolibrary.Blocks.Factors.Spline EstradiolEffect(data={{0.0,1.0,0.0},{
            1.0,1.5,0.0},{2.0,0.5,0.0}})
        annotation (Placement(transformation(extent={{4,14},{24,34}})));
      Physiolibrary.Blocks.Factors.Spline TestosteroneEffect(data={{5.0,1.0,0.0},
            {20.0,2.0,0.0}})
        annotation (Placement(transformation(extent={{4,-4},{24,16}})));
        Modelica.Blocks.Interfaces.RealInput Estradiol(
                                                quantity="Concentration", final displayUnit="nMol/l")
                               annotation (Placement(transformation(extent={{-14,20},{
                  -6,28}}),           iconTransformation(extent={{-120,60},{-80,100}})));
        Modelica.Blocks.Interfaces.RealInput Testosterone(
                                                   quantity="Concentration", final displayUnit=
                 "nMol/l")     annotation (Placement(transformation(extent={{-14,2},{-6,
                  10}}),              iconTransformation(extent={{-120,-60},{-80,-20}})));
        Modelica.Blocks.Interfaces.RealOutput GnRH_period(
                                                   quantity="Time", final displayUnit="min")
          annotation (Placement(transformation(extent={{24,-24},{32,-16}}),
              iconTransformation(extent={{80,-100},{120,-60}})));
      equation

        connect(EstradiolEffect.u, Estradiol) annotation (Line(
            points={{4.2,24},{-10,24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TestosteroneEffect.u, Testosterone) annotation (Line(
            points={{4.2,6},{-10,6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TestosteroneEffect.y, GnRH_period) annotation (Line(
            points={{14,4},{14,-20},{28,-20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant1.y, EstradiolEffect.yBase) annotation (Line(
            points={{17.4,46},{14,46},{14,26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(EstradiolEffect.y, TestosteroneEffect.yBase) annotation (Line(
            points={{14,22},{14,8}},
            color={0,0,127},
            smooth=Smooth.None));
      end GnRH;

      model Inhibin

        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          inhibin(
            q_out(conc(final displayUnit="IU/ml"), q(final displayUnit="IU/min")),
            concentration=0.027,
          stateName="Inhibin.Mass")
          annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump A(useSoluteFlowInput=
            true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Types.Constants.MassFlowRateConst hormoneFlowConstant(k=(
            0.28)/60*MassPerIU)
        annotation (Placement(transformation(extent={{80,-24},{68,-12}})));
      Physiolibrary.Blocks.Factors.Normalization MassEffect2
        annotation (Placement(transformation(extent={{56,-40},{76,-20}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="IU/l"),
        toAnotherUnitCoef=1000,
        unitsString="IU/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-76,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.008)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit=
              "ml") "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,
                  -40},{-92,-32}}),   iconTransformation(extent={{-120,60},{-80,
                  100}})));
        Modelica.Blocks.Interfaces.RealInput CorpusLuteumMass(
                                                       quantity="Mass", final displayUnit=
                 "mg")           annotation (Placement(transformation(extent={{34,-34},
                  {42,-26}}),         iconTransformation(extent={{-120,-60},{
                  -80,-20}})));
        Modelica.Blocks.Interfaces.RealOutput Inhibin(
                                               quantity="Concentration", final displayUnit=
                 "IU/l") annotation (Placement(transformation(extent={{-60,-10},
                  {-52,-2}}), iconTransformation(extent={{80,-40},{120,0}})));
      Physiolibrary.Blocks.Factors.Normalization MassEffect1
        annotation (Placement(transformation(extent={{56,-86},{76,-66}})));
      Physiolibrary.Types.Constants.MassFlowRateConst hormoneFlowConstant1(k=(
            0.28)/60*MassPerIU)
        annotation (Placement(transformation(extent={{82,-72},{70,-60}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump B(useSoluteFlowInput=
            true)
        annotation (Placement(transformation(extent={{76,-104},{56,-84}})));
        Modelica.Blocks.Interfaces.RealInput OvariesFollicleMass(
                                                          quantity="Mass",
            final displayUnit="mg")     annotation (Placement(transformation(extent={{34,-80},
                  {42,-72}}),         iconTransformation(extent={{-120,-20},{
                  -80,20}})));
        Physiolibrary.Factors.ZeroIfFalse zeroIfFalse
          annotation (Placement(transformation(extent={{56,-94},{76,-74}})));
        Modelica.Blocks.Interfaces.BooleanInput IsFollicular
          annotation (Placement(transformation(extent={{34,-88},{42,-80}}),
              iconTransformation(extent={{-120,20},{-80,60}})));
      equation
        connect(inhibin.q_out, A.q_out)            annotation (Line(
            points={{-72,-44},{60,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, inhibin.q_out)     annotation (Line(
            points={{-76,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(inhibin.q_out, Degradation.q_in) annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(inhibin.soluteMass, K.u)        annotation (Line(
            points={{-72,-51.8},{-72,-77},{-38.6,-77}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(hormoneFlowConstant.y, MassEffect2.yBase)
                                                        annotation (Line(
            points={{67.4,-18},{66,-18},{66,-28}},
            color={0,0,127},
            smooth=Smooth.None));

      connect(A.soluteFlow, MassEffect2.y) annotation (Line(
          points={{66,-40},{66,-32}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(EFCV_Vol, inhibin.SolventVolume) annotation (Line(
            points={{-96,-36},{-82,-36}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CorpusLuteumMass, MassEffect2.u) annotation (Line(
            points={{38,-30},{56.2,-30}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Inhibin) annotation (Line(
          points={{-76,-18},{-76,-6},{-56,-6}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(hormoneFlowConstant1.y, MassEffect1.yBase) annotation (Line(
            points={{69.4,-66},{66,-66},{66,-74}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(OvariesFollicleMass, MassEffect1.u) annotation (Line(
            points={{38,-76},{56.2,-76}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(zeroIfFalse.condition, IsFollicular) annotation (Line(
            points={{56.2,-84},{38,-84}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(MassEffect1.y, zeroIfFalse.yBase) annotation (Line(
            points={{66,-78},{66,-82}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(zeroIfFalse.y, B.soluteFlow) annotation (Line(
          points={{66,-86},{66,-90}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(B.q_out, inhibin.q_out) annotation (Line(
            points={{60,-94},{22,-94},{22,-44},{-72,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      end Inhibin;

      model Testosterone

        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          testosterone(q_out(conc(final displayUnit="nMol/ml"), q(final displayUnit=
                  "nMol/min")), concentration=0.0006,
          stateName="Testosterone.Mass")
          annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump OvariesSecretion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst hormoneFlowConstant(k=
            4.16666666666675e-012)
        annotation (Placement(transformation(extent={{84,-34},{72,-22}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="nMol/l"),
        toAnotherUnitCoef=1000,
        unitsString="nMol/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-78,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.043)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit=
              "ml") "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,
                  -40},{-92,-32}}),   iconTransformation(extent={{-120,60},{-80,
                  100}})));
        Modelica.Blocks.Interfaces.RealOutput Testosterone(
                                                    quantity="Concentration",
            final displayUnit="nMol/l") annotation (Placement(transformation(extent={{
                  -60,-10},{-52,-2}}), iconTransformation(extent={{80,-40},{120,
                  0}})));
      equation
        connect(testosterone.q_out, OvariesSecretion.q_out)
                                                   annotation (Line(
            points={{-72,-44},{60,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, testosterone.q_out)
                                                              annotation (Line(
            points={{-78,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(testosterone.q_out, Degradation.q_in)
                                                 annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(testosterone.soluteMass, K.u)   annotation (Line(
            points={{-72,-51.8},{-72,-77},{-38.6,-77}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(EFCV_Vol, testosterone.SolventVolume) annotation (Line(
            points={{-96,-36},{-82,-36}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, Testosterone) annotation (
          Line(
          points={{-78,-18},{-78,-6},{-56,-6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hormoneFlowConstant.y, OvariesSecretion.soluteFlow) annotation (
          Line(
          points={{71.4,-28},{66,-28},{66,-40}},
          color={0,0,127},
          smooth=Smooth.None));
      end Testosterone;

      model hCG

        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          hCG_Pool(
            q_out(conc(final displayUnit="IU/ml"), q(final displayUnit="IU/min")),
            concentration=0.001,
          stateName="hCG.Mass")
          annotation (Placement(transformation(extent={{-82,-54},{-62,-34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump OvariesSecretion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{76,-54},{56,-34}})));
      Physiolibrary.Types.Constants.MassFlowRateConst hormoneFlowConstant(k=(
            0.009)/60*MassPerIU)
        annotation (Placement(transformation(extent={{84,-34},{72,-22}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
        concentration(final displayUnit="IU/l"),
        toAnotherUnitCoef=1000,
        unitsString="IU/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-76,-22})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Degradation(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-30,-98},{-10,-78}})));
        Modelica.Blocks.Math.Gain K(k=0.0009)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              origin={-35,-77})));
        Modelica.Blocks.Interfaces.RealInput EFCV_Vol(
                                               quantity="Volume", final displayUnit=
              "ml") "extracellular fluid volume"
                               annotation (Placement(transformation(extent={{-100,
                  -40},{-92,-32}}),   iconTransformation(extent={{-120,60},{-80,
                  100}})));
        Modelica.Blocks.Interfaces.RealOutput hCG(
                                           quantity="Concentration", final displayUnit=
             "IU/l") annotation (Placement(transformation(extent={{-60,-10},{
                  -52,-2}}), iconTransformation(extent={{80,-40},{120,0}})));
      equation
        connect(hCG_Pool.q_out, OvariesSecretion.q_out)
                                                   annotation (Line(
            points={{-72,-44},{60,-44}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, hCG_Pool.q_out)    annotation (Line(
            points={{-76,-22},{-72,-22},{-72,-44}},
            color={200,0,0},
            smooth=Smooth.None));
        connect(hCG_Pool.q_out, Degradation.q_in)
                                                 annotation (Line(
            points={{-72,-44},{-54,-44},{-54,-88},{-26,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(hCG_Pool.soluteMass, K.u)       annotation (Line(
            points={{-72,-51.8},{-72,-77},{-38.6,-77}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Degradation.soluteFlow, K.y) annotation (Line(
          points={{-20,-84},{-20,-77},{-31.7,-77}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(EFCV_Vol, hCG_Pool.SolventVolume) annotation (Line(
            points={{-96,-36},{-82,-36}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, hCG) annotation (Line(
          points={{-76,-18},{-76,-6},{-56,-6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hormoneFlowConstant.y, OvariesSecretion.soluteFlow) annotation (
          Line(
          points={{71.4,-28},{66,-28},{66,-40}},
          color={0,0,127},
          smooth=Smooth.None));
      end hCG;

      model DayCounter

        Modelica.Blocks.Interfaces.BooleanInput Reset
        "restart counter on rising edge"
          annotation (Placement(transformation(extent={{-68,-2},{-60,6}}),
              iconTransformation(extent={{-120,-20},{-80,20}})));

       discrete Real startTime(start=0);
        Modelica.Blocks.Interfaces.RealOutput dayInCycle
          annotation (Placement(transformation(extent={{100,-20},{140,20}}),
              iconTransformation(extent={{100,-20},{140,20}})));
      equation
       when edge(Reset) then
         startTime=time;
       end when;
       dayInCycle = floor((time-startTime)/(60*60*24));
        annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                  -100},{100,100}}), graphics={Rectangle(
                extent={{-100,40},{100,-40}},
                fillColor={215,215,215},
                fillPattern=FillPattern.Solid,
                pattern=LinePattern.None), Text(
                extent={{-76,18},{98,-18}},
                lineColor={0,0,0},
                textString="day in cycle")}));
      end DayCounter;

      package test
        model T
          FemaleSexHormones femaleSexHormones
            annotation (Placement(transformation(extent={{-26,-12},{-6,8}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=1430)
          annotation (Placement(transformation(extent={{-72,20},{-64,28}})));
        Modelica.Blocks.Sources.BooleanConstant booleanConstant
          annotation (Placement(transformation(extent={{-80,-10},{-60,10}})));
        equation
          connect(booleanConstant.y, femaleSexHormones.Cycling) annotation (
              Line(
              points={{-59,0},{-42,0},{-42,2},{-26,2}},
              color={255,0,255},
              smooth=Smooth.None));
          connect(Constant.y, femaleSexHormones.EFCV_Vol) annotation (Line(
              points={{-63.6,24},{-44,24},{-44,6},{-26,6}},
              color={0,0,127},
              smooth=Smooth.None));
        end T;
      end test;
      annotation (Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
    end FemaleSexHormones;

    model Hormones
      extends Physiolibrary.Icons.Hormones;
      Aldosterone aldosterone
        annotation (Placement(transformation(extent={{20,72},{40,92}})));
      Angiotensine2 angiotensine2
        annotation (Placement(transformation(extent={{-44,68},{-24,88}})));
      Renin renin
        annotation (Placement(transformation(extent={{-80,72},{-60,92}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-98,20},{-78,40}}), iconTransformation(extent=
             {{-80,40},{-42,78}})));
      Catechols.Catechols catechols
        annotation (Placement(transformation(extent={{20,-14},{40,6}})));
    equation
      connect(busConnector, aldosterone.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,76},{22,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, angiotensine2.busConnector)   annotation (Line(
          points={{-88,30},{-48,30},{-48,72},{-42,72}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, renin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,76},{-78,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, catechols.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,-10},{22,-10}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));

    connect(renin.Renin, angiotensine2.Renin)
      annotation (Line(
        points={{-60,82},{-42,82}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(angiotensine2.Angiotensine2, aldosterone.AngiotensinII) annotation (Line(
        points={{-24,78},{8,78},{8,88},{22,88}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(angiotensine2.Angiotensine2, renin.Angiotensin2) annotation (Line(
        points={{-24,78},{-10,78},{-10,96},{-94,96},{-94,86},{-78,86}},
        color={0,0,127},
        smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={                  Text(
              extent={{-120,-98},{122,-132}},
              lineColor={0,0,255},
              textString="%name")}));
    end Hormones;

    model Hormones2
      extends Physiolibrary.Icons.Hormones;
      Aldosterone aldosterone
        annotation (Placement(transformation(extent={{20,72},{40,92}})));
      Angiotensine2 angiotensine2
        annotation (Placement(transformation(extent={{-28,72},{-8,92}})));
      ANP atriopeptin
        annotation (Placement(transformation(extent={{-78,-28},{-58,-8}})));
      EPO erythropoietin
              annotation (Placement(transformation(extent={{-78,0},{-58,20}})));
      Glucagon glucagon
        annotation (Placement(transformation(extent={{-28,-64},{-8,-44}})));
      Insulin insulin
        annotation (Placement(transformation(extent={{-78,-64},{-58,-44}})));
      Renin renin
        annotation (Placement(transformation(extent={{-80,72},{-60,92}})));
      Thyrotropin thyrotropin
        annotation (Placement(transformation(extent={{-78,-96},{-58,-76}})));
      Thyroxine thyroxine
        annotation (Placement(transformation(extent={{-28,-96},{-8,-76}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-98,20},{-78,40}}), iconTransformation(extent=
             {{-80,40},{-42,78}})));
      Catechols.Catechols catechols
        annotation (Placement(transformation(extent={{20,-14},{40,6}})));
      Leptin leptin
        annotation (Placement(transformation(extent={{22,-62},{42,-42}})));
    equation
      connect(busConnector, aldosterone.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,76},{22,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, angiotensine2.busConnector)   annotation (Line(
          points={{-88,30},{-34,30},{-34,76},{-26,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, renin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,76},{-78,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, erythropoietin.busConnector)
                                              annotation (Line(
          points={{-88,30},{-84,30},{-84,4},{-76,4}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, glucagon.busConnector) annotation (Line(
          points={{-88,30},{-34,30},{-34,-60},{-26,-60}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, thyroxine.busConnector) annotation (Line(
          points={{-88,30},{-34,30},{-34,-94},{-26,-94},{-26,-78}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, atriopeptin.busConnector)
                                              annotation (Line(
          points={{-88,30},{-84,30},{-84,-24},{-76,-24}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, insulin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,-60},{-76,-60}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, thyrotropin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,-92},{-76,-92}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(renin.ReninPool_PRA, angiotensine2.ReninPool_PRA) annotation (
          Line(
          points={{-60,82},{-52,82},{-52,86},{-26,86}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(angiotensine2.A2Pool_Log10Conc, aldosterone.A2Pool_Log10Conc)
        annotation (Line(
          points={{-8,78},{2,78},{2,88},{22,88}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(insulin.Insulin, glucagon.Insulin) annotation (Line(
          points={{-58,-54},{-36,-54},{-36,-48},{-26,-48}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector, catechols.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,-10},{22,-10}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(thyrotropin.TSH, thyroxine.TSH) annotation (Line(
          points={{-58,-86},{-36,-86},{-36,-84},{-26,-84}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(thyroxine.Thyroxine, thyrotropin.Thyroxine) annotation (Line(
          points={{-8,-86},{0,-86},{0,-72},{-80,-72},{-80,-78},{-76,-78}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector, leptin.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,-58},{24,-58}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={                  Text(
              extent={{-120,-98},{122,-132}},
              lineColor={0,0,255},
              textString="%name")}));
    end Hormones2;

    model Hormones3
      extends Physiolibrary.Icons.Hormones;
      Aldosterone aldosterone
        annotation (Placement(transformation(extent={{20,72},{40,92}})));
      Angiotensine2 angiotensine2
        annotation (Placement(transformation(extent={{-28,72},{-8,92}})));
      ANP atriopeptin
        annotation (Placement(transformation(extent={{-78,-28},{-58,-8}})));
      EPO erythropoietin
              annotation (Placement(transformation(extent={{-78,0},{-58,20}})));
      Glucagon glucagon
        annotation (Placement(transformation(extent={{-28,-64},{-8,-44}})));
      Insulin insulin
        annotation (Placement(transformation(extent={{-78,-64},{-58,-44}})));
      Renin renin
        annotation (Placement(transformation(extent={{-80,72},{-60,92}})));
      Thyrotropin thyrotropin
        annotation (Placement(transformation(extent={{-78,-96},{-58,-76}})));
      Thyroxine thyroxine
        annotation (Placement(transformation(extent={{-28,-96},{-8,-76}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-98,20},{-78,40}}), iconTransformation(extent=
             {{-80,40},{-42,78}})));
      Physiomodel.Hormones.FemaleSexHormones.FemaleSexHormones femaleSexHormones
        annotation (Placement(transformation(extent={{42,26},{62,46}})));
      Catechols.Catechols catechols
        annotation (Placement(transformation(extent={{20,-14},{40,6}})));
    Modelica.Blocks.Sources.BooleanConstant Cycling
      annotation (Placement(transformation(extent={{20,24},{30,34}})));
      Leptin leptin
        annotation (Placement(transformation(extent={{22,-62},{42,-42}})));
    equation
      connect(busConnector, aldosterone.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,76},{22,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, angiotensine2.busConnector)   annotation (Line(
          points={{-88,30},{-34,30},{-34,76},{-26,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, renin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,76},{-78,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, erythropoietin.busConnector)
                                              annotation (Line(
          points={{-88,30},{-84,30},{-84,4},{-76,4}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, glucagon.busConnector) annotation (Line(
          points={{-88,30},{-34,30},{-34,-60},{-26,-60}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, thyroxine.busConnector) annotation (Line(
          points={{-88,30},{-34,30},{-34,-94},{-26,-94},{-26,-78}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, atriopeptin.busConnector)
                                              annotation (Line(
          points={{-88,30},{-84,30},{-84,-24},{-76,-24}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, insulin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,-60},{-76,-60}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, thyrotropin.busConnector) annotation (Line(
          points={{-88,30},{-84,30},{-84,-92},{-76,-92}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(renin.ReninPool_PRA, angiotensine2.ReninPool_PRA) annotation (
          Line(
          points={{-60,82},{-52,82},{-52,86},{-26,86}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(angiotensine2.A2Pool_Log10Conc, aldosterone.A2Pool_Log10Conc)
        annotation (Line(
          points={{-8,78},{2,78},{2,88},{22,88}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(insulin.Insulin, glucagon.Insulin) annotation (Line(
          points={{-58,-54},{-36,-54},{-36,-48},{-26,-48}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector, catechols.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,-10},{22,-10}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(thyrotropin.TSH, thyroxine.TSH) annotation (Line(
          points={{-58,-86},{-36,-86},{-36,-84},{-26,-84}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(thyroxine.Thyroxine, thyrotropin.Thyroxine) annotation (Line(
          points={{-8,-86},{0,-86},{0,-72},{-80,-72},{-80,-78},{-76,-78}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.ECFV_Vol, femaleSexHormones.EFCV_Vol) annotation (
          Line(
          points={{-88,30},{16,30},{16,44},{42,44}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(Cycling.y, femaleSexHormones.Cycling) annotation (Line(
          points={{30.5,29},{36,29},{36,40},{42,40}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(busConnector, leptin.busConnector) annotation (Line(
          points={{-88,30},{16,30},{16,-58},{24,-58}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={                  Text(
              extent={{-120,-98},{122,-132}},
              lineColor={0,0,255},
              textString="%name")}));
    end Hormones3;

    package IO_Bus
       extends Physiolibrary.Types.IO_Bus;

      redeclare model extends Variables
        extends Physiolibrary.Icons.Hormones;

      T.Concentration A2Pool(varName="A2Pool.[A2(pMol/L)]", storeUnit="pmol/l")
        "Angiotensin 2 extracelular concentration."
      annotation (Placement(transformation(extent={{-40,-62},{-34,-56}})));
      T.Concentration AldoPool_Aldo(varName="AldoPool.[Aldo(pMol/L)]", storeUnit="pmol/l")
        "Body aldosterone concentration."
      annotation (Placement(transformation(extent={{-40,-2},{-34,4}})));
      T.Fraction AlphaBlocade_Effect(varName="AlphaBlockade.Effect")
        "Effect of alpha blocators."
      annotation (Placement(transformation(extent={{-40,8},{-34,14}})));
      T.Fraction AlphaPool_Effect(varName="AlphaPool.Effect")
        "Humoral and neural effect on alpha receptor stimulation."
      annotation (Placement(transformation(extent={{-40,18},{-34,24}})));
      T.Fraction BetaBlocade_Effect(varName="BetaBlockade.Effect")
        "Effect of beta blocators."
      annotation (Placement(transformation(extent={{-40,28},{-34,34}})));
      T.Fraction BetaPool_Effect(varName="BetaPool.Effect")
        "Humoral and neural effect on beta receptor stimulation."
      annotation (Placement(transformation(extent={{-40,38},{-34,44}})));
      //Variable NephronADH_conc(varName="NephronADH.[ADH]")
      //    "Nephron vasopresine concentration. [ng/l]"
      //annotation (Placement(transformation(extent={{-36,170},{-30,176}})));

      T.Concentration Epinephrine(varName="EpiPool.[Epi(nMol/L)]", storeUnit=
            "nmol/l") "Epinephrine extracelular concentration."
        annotation (Placement(transformation(extent={{-40,-28},{-34,-22}})));
      T.Concentration Norepinephrine(storeUnit="nmol/l", varName=
            "NEPool.[NE(nMol/L)]") "Norepinephrine extracelular concentration."
        annotation (Placement(transformation(extent={{-40,-36},{-34,-30}})));
      equation
      connect(AlphaBlocade_Effect.y, busConnector.AlphaBlocade_Effect) annotation (Line(
       points={{-33.7,11},{90,11},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(AlphaPool_Effect.y, busConnector.AlphaPool_Effect) annotation (Line(
       points={{-33.7,21},{90,21},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(BetaBlocade_Effect.y, busConnector.BetaBlocade_Effect) annotation (Line(
       points={{-33.7,31},{90,31},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(BetaPool_Effect.y, busConnector.BetaPool_Effect) annotation (Line(
       points={{-33.7,41},{90,41},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

        connect(A2Pool.y, busConnector.Angiotensin2) annotation (Line(
            points={{-33.7,-59},{90,-59},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(AldoPool_Aldo.y, busConnector.Aldosterone) annotation (Line(
          points={{-33.7,1},{90,1},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Epinephrine.y, busConnector.Epinephrine) annotation (Line(
          points={{-33.7,-25},{90,-25},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Norepinephrine.y, busConnector.Norepinephrine) annotation (Line(
          points={{-33.7,-33},{90,-33},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{18,138},{100,100}},
                lineColor={0,0,0},
                textString="vars"), Text(
                extent={{-118,-104},{124,-138}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model Hormones_test
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile
                                                nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.Hormones  hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Hormones.IO_Bus.OutputComparison hormones_dif
          annotation (Placement(transformation(extent={{64,10},{84,30}})));
        Physiomodel.Hormones.IO_Bus.OutputToFile hormones_varsToFile
          annotation (Placement(transformation(extent={{10,8},{30,28}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,21.9},{43.9,21.9}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(hormones.busConnector, hormones_varsToFile.busConnector)
          annotation (Line(
            points={{43.9,21.9},{30.95,21.9},{30.95,18},{20,18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(hormones.busConnector, hormones_dif.busConnector) annotation (
            Line(
            points={{43.9,21.9},{58.95,21.9},{58.95,20},{74,20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Hormones_test;

      model Hormones_test_SI
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI
                                                nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile_SI electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.Hormones  hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Hormones.IO_Bus.OutputComparison_SI hormones_dif
          annotation (Placement(transformation(extent={{64,10},{84,30}})));
        Physiomodel.Hormones.IO_Bus.OutputToFile_SI hormones_varsToFile
          annotation (Placement(transformation(extent={{10,8},{30,28}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,21.9},{43.9,21.9}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(hormones.busConnector, hormones_varsToFile.busConnector)
          annotation (Line(
            points={{43.9,21.9},{30.95,21.9},{30.95,18},{20,18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(hormones.busConnector, hormones_dif.busConnector) annotation (
            Line(
            points={{43.9,21.9},{58.95,21.9},{58.95,20},{74,20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Hormones_test_SI;
    end IO_Bus;

    package IO_EPO
        extends Physiolibrary.Types.IO_Bus( redeclare package
        PhysiolibTypesRealTypes =
          EPO_Physiolibrary.Types.RealTypes);
      redeclare model extends Variables
        extends Physiolibrary.Icons.Hormones;

      //Variable NephronADH_conc(varName="NephronADH.[ADH]")
      //    "Nephron vasopresine concentration. [ng/l]"
      //annotation (Placement(transformation(extent={{-36,170},{-30,176}})));

      T.Concentration EPOPool(
        varName="EPOPool.[EPO]", storeUnit="iu/l")
        "Erythropoetin concentration."
        annotation (Placement(transformation(extent={{-40,48},{-34,54}})));
      equation

        connect(EPOPool.y, busConnector.Erythropoietin) annotation (Line(
            points={{-33.7,51},{90,51},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{18,138},{100,100}},
                lineColor={0,0,0},
                textString="vars"), Text(
                extent={{-118,-104},{124,-138}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model EPO_test
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI
                                                nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile_SI electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.EPO EPO
          annotation (Placement(transformation(extent={{40,8},{60,28}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Hormones.IO_EPO.OutputComparison_SI outputComparison_SI
          annotation (Placement(transformation(extent={{72,2},{92,22}})));
      equation
        connect(setup.busConnector, EPO.busConnector) annotation (Line(
            points={{-6,-96},{-6,12},{42,12}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(EPO.busConnector, outputComparison_SI.busConnector) annotation (
            Line(
            points={{42,12},{82,12}},
            color={255,204,51},
            thickness=0.5,
            smooth=Smooth.None));
      end EPO_test;
    end IO_EPO;

    package IO_Insulin
       extends Physiolibrary.Types.IO_Bus(
                             PhysiolibTypesRealTypes=Insulin_Physiolibrary.Types.RealTypes);
      redeclare model extends Variables
        extends Physiolibrary.Types.IO_Bus.IVariables;
        extends Physiolibrary.Icons.NutrientsMetabolism;

      T.Concentration         Insulin(varName="InsulinPool.[Insulin]", storeUnit="uiu/ml")
        "Insulin extracellular concentration."
      annotation (Placement(transformation(extent={{-68,2},{-62,8}})));
      T.Concentration         PortalVein_Insulin(varName="PortalVein-Insulin.[Insulin]", storeUnit="uiu/ml")
        "Insulin portal vein concentration."
      annotation (Placement(transformation(extent={{-70,-14},{-64,-8}})));
      equation
      connect(PortalVein_Insulin.y, busConnector.PortalVein_Insulin) annotation (Line(
       points={{-63.7,-11},{90,-11},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Insulin.y, busConnector.Insulin) annotation (Line(
       points={{-61.7,5},{90,5},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={
                                    Text(
                extent={{-120,-104},{122,-138}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;
    end IO_Insulin;

    annotation (Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2008-2015</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: HumMod 1.6, University of Mississippi Medical Center</p></td>
</tr>
</table>
<p>Copyright &copy; 2008-2015 Marek Matejak, Charles University in Prague.</p>
</html>", info="<html>
<p>Vasopressin (Antidiuretic hormone, ADH)</p>
<p>book about ADH [Glickson1974], pharmacological properties[Berde1968]</p>
<p>effect on collecting duct [Lankford1991,Young1977]</p>
<p>effect on hemodynamics [Erwald1978]</p>
<p>water regulation [Baldes1934]</p>
<p>infusion[Atherton1971]</p>
<p><br>Atrial Natriuretic Peptide (ANP)</p>
<p>synthesis [Ruskoaho1992]</p>
<p>release [Ruskoaho1992,Metzler1986,Raine1986]</p>
<p>degradation [Yandle1986,Ruskoaho1992,Schreij1996]</p>
<p>general[deZeeuw1992], properties [Maack1985]</p>
<p>effect on salt excretion [Conte1992, Mizelle1990]</p>
<p>effect on hemodynamics [Nishikimi1994]</p>
<p>salt regulations [Nicholls1987,Renkin1996,Weidmann1986]</p>
<p>infusion[Tikkanen1985]</p>
<p><br>Renin</p>
<p>release [Seeliger1999,Almgard1975,Wine1969,Roarty1988]</p>
<p>degradation [Devaux1968,Hannon1969,Christlieb1968]</p>
<p>inhibition [Brunner1979,Case1977]</p>
<p>enzimatic activity [Morton1980]</p>
<p>tubuloglomerular feedback(TGF) [Braam1993]</p>
<p>RAAS [Krekels1997,MacGregor1981,Regoli 1962]</p>
<p><br>Angiotensin</p>
<p>receptor blockage [Mazzolai1999]</p>
<p>effect on hemodynamics [Hakkinen1995,Symons1999]</p>
<p>effect on nerves [Kumagai1994]</p>
<p>effect on kidney [Hall1979] - natriuresis[Olsen1985]</p>
<p>effect on aldosterone secretion [Scholer1973]</p>
<p>infusion [Ames1965, Symons1999] </p>
<p><br>Aldosterone</p>
<p>secretion on AngiotensinII and blood pressure [Deheneffe1976,Oelkrs1974,Scholer1973]</p>
<p>secretion on salts and osmolarity [Schneider1985]</p>
<p>effect on Na+, K+ and water excretion [Ganong1958,Barger1958]</p>
<p>effect in skeletal muscle[1970]</p>
<p><br>Insulin</p>
<p>Glucagon</p>
<p>EPO</p>
<p>Thyroxine</p>
<p>Thyrotropin</p>
<p>Leptin</p>
<p><br>Catecholamins (Adrenalin and Noradrenalin)</p>
</html>"));
  end Hormones;


  package Electrolytes "Body Electrolytes"
    extends Physiolibrary.Icons.ElectrolytesLib;
    package AcidBase "Body Acid-Base Balance"

      partial model BloodPhBase
        import Modelica.Math;

        Physiolibrary.Types.Concentration betaX "buffer value of blood";
                                               //(unit = "mEq/l")
        Physiolibrary.Types.Concentration betaP "buffer value of plasma";
                                               //(unit = "mEq/l")

        Physiolibrary.Types.Concentration _cTH
        "total concentration of tiratable hydrogen ions";
                                             //( displayUnit="mEq/l")
        Physiolibrary.Types.Concentration _BE "base excess";
                                            //( displayUnit="mEq/l")

        Physiolibrary.Types.Concentration _BEox
        "base excess in fully oxygenated blood";
                                              //( displayUnit="mEq/l")
        Physiolibrary.Types.Concentration _cTHox
        "total concentration of tiratable hydrogen ions in fully oxygenated blood";
                                               //( displayUnit="mEq/l")

         Physiolibrary.Types.RealIO.pHOutput pH( start=7.4) "plasma pH"    annotation (Placement(transformation(
                extent={{30,-98},{70,-58}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-20,-120})));
        Physiolibrary.Types.RealIO.pHOutput pH_ery
        "intracellular erytrocytes pH"                                              annotation (Placement(
              transformation(extent={{-14,-98},{26,-58}}),iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={20,-120})));

        Physiolibrary.Types.RealIO.ConcentrationInput cHCO3(
                                             displayUnit="mmol/l")
        "concentration of plasma HCO3 ions (default=24.5mmol/l)"
                                         annotation (Placement(transformation(extent={{50,18},
                  {90,58}}),            iconTransformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,80})));
        Physiolibrary.Types.RealIO.ConcentrationInput ctHb(
                                                displayUnit="mmol/l")
        "concentration of total haemoglobin in whole blood (9.3)"
                                         annotation (Placement(transformation(extent={{50,58},
                  {90,98}}),            iconTransformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,40})));
        parameter Physiolibrary.Types.Concentration  cHb(displayUnit="mmol/l")=43
        "an empirical parameter accounting for erythrocyte plasma distributions = concentration of Hb inside erythrocytes divided by (1-0.57)";

        Physiolibrary.Types.RealIO.FractionInput sO2 "oxygen saturation"
                                         annotation (Placement(transformation(extent={{-100,60},
                  {-60,100}}),          iconTransformation(extent={{-10,-10},{10,10}},
              rotation=270,
              origin={60,110})));

        Physiolibrary.Types.RealIO.ConcentrationInput ctAlb(
                                             displayUnit="mmol/l")
        "concentration of total plasma albumins(dofault=0.65mmol/l)"                   annotation (Placement(transformation(extent={{52,-26},
                  {92,14}}),            iconTransformation(extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,0})));

        Physiolibrary.Types.RealIO.MassConcentrationInput ctGlb(
                                             displayUnit="g/l")
        "concentration of total plasma globulins"                                      annotation (Placement(transformation(extent={{52,-60},
                  {92,-20}}),           iconTransformation(extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,-40})));
        Physiolibrary.Types.RealIO.ConcentrationInput ctPO4(
                                             displayUnit="mmol/l")
        "concentration of total inorganic phosphate in plasma"                         annotation (Placement(transformation(extent={{54,-92},
                  {94,-52}}),           iconTransformation(extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,-80})));

      equation
        //Van Slyke equation:  - T=37
        _cTH = -(1-ctHb/cHb)*((cHCO3-24.5)+betaX*(pH-7.4));
      //  _cTH = -(1-(1-0.57)*(0.44))*((cHCO3-24.5)+betaX*(pH-7.4));

        betaX = 2.3*ctHb + betaP;
        betaP =  8*ctAlb + 0.075*ctGlb + 0.309*ctPO4;

      //  _betaX = 0.11 * plasmaProteinConc(displayUnit="g/l"); //mmol/l

      //Haldane effect:
        _cTH = homotopy(_cTHox - 0.3 * (1-sO2),_cTHox);

      //base excess
        _BEox = - _cTHox;
        _BE = - _cTH;

        //erythrocytes:
        pH_ery = homotopy(7.19 + 0.77*(pH-7.4) + 0.035*(1-sO2),7.19 + 0.77*(pH-7.4));

        annotation (
          preferredView = text,
          Documentation(info="<html>
<pre>Blood pH calculation by
<i><b>Van Slyke equation</b></i>,
<i><b>Haldame</b></i> effect
and plasma-<i><b>erythrocytes</b></i> acidity distribution.</pre>
</html>",
       revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>dec 2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"),Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,-100},{
                  100,100}}), graphics={
              Text(
                extent={{-72,-56},{76,-92}},
                lineColor={0,0,255},
                textString="%name"),
              Rectangle(
                extent={{-100,100},{100,-100}},
                lineColor={0,0,255},
                fillColor={215,215,215},
                fillPattern=FillPattern.Solid),
              Text(
                extent={{-96,-62},{98,-94}},
                lineColor={0,0,255},
                textString="%name")}));
      end BloodPhBase;

      model BloodPhMeassure
        extends Physiomodel.Electrolytes.AcidBase.BloodPhBase;
        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput
                                           BEox
                                        annotation (Placement(transformation(extent={{
                  -102,90},{-62,130}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-80,100})));
      equation
        _BEox = BEox / Modelica.Constants.F;

      //  cTHox.conc*1000 = _cTHox;

        annotation (          Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2013</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end BloodPhMeassure;

      model NormalSID
       // extends BloodPhBase;

       Physiolibrary.Types.RealIO.ConcentrationInput ctAlb(
                                                 final displayUnit="mmol/l")
        "concentration of total plasma albumins(dofault=0.65mmol/l)"                  annotation (Placement(transformation(extent={{-120,72},
                  {-80,112}}),         iconTransformation(extent={{-10,-10},{10,10}},
             rotation=180,
             origin={90,80})));

       Physiolibrary.Types.RealIO.MassConcentrationInput ctGlb(
                                                 final displayUnit="g/l")
        "concentration of total plasma globulins"                                     annotation (Placement(transformation(extent={{-120,42},
                  {-80,82}}),          iconTransformation(extent={{-10,-10},{10,10}},
             rotation=180,
             origin={90,50})));
       Physiolibrary.Types.RealIO.ConcentrationInput ctPO4_P(
                                                   final displayUnit="mmol/l")
        "concentration of total inorganic phosphate in plasma"                        annotation (Placement(transformation(extent={{-120,12},
                  {-80,52}}),          iconTransformation(extent={{-10,-10},{10,10}},
             rotation=180,
             origin={90,20})));

        Physiolibrary.Types.RealIO.VolumeDensityOfChargeOutput
                                            NSID
                                          annotation (Placement(transformation(extent={{80,0},{
                  120,40}}),           iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=180,
              origin={-120,-60})));
       Physiolibrary.Types.RealIO.FractionInput Hct "hematocrit"
                                        annotation (Placement(transformation(extent={{-120,
                -14},{-80,26}}),       iconTransformation(extent={{-10,-10},{10,10}},
             rotation=180,
             origin={90,-70})));
        Buffers.Bicarbonate bicarbonate
          annotation (Placement(transformation(extent={{-38,10},{-18,30}})));
        Buffers.Albumin albumin
          annotation (Placement(transformation(extent={{-38,78},{-18,98}})));
        Modelica.Blocks.Math.Sum NSIDP(nin=4, y(unit="C/m3", displayUnit=
              "mEq/l"))
          annotation (Placement(transformation(extent={{26,72},{46,92}})));
        Buffers.Globulins globulins
          annotation (Placement(transformation(extent={{-38,56},{-18,76}})));
        Buffers.Phosphates phosphates
          annotation (Placement(transformation(extent={{-38,34},{-18,54}})));
        Buffers.Haemoglobin haemoglobin
          annotation (Placement(transformation(extent={{-38,-68},{-18,-48}})));
        Buffers.OtherRBCBuffers
                           phosphates1
          annotation (Placement(transformation(extent={{-38,-96},{-18,-76}})));
        Modelica.Blocks.Math.Sum NSIDE(nin=3, y(unit="C/m3", displayUnit=
              "mEq/l"))
          annotation (Placement(transformation(extent={{12,-78},{32,-58}})));
        Modelica.Blocks.Math.Feedback Pct      annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={26,56})));
        Modelica.Blocks.Math.Product product1(y(unit="C/m3", displayUnit=
              "mEq/l"))                       annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=90,
              origin={50,-2})));
        Modelica.Blocks.Math.Product product2(y(unit="C/m3", displayUnit=
              "mEq/l"))                       annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={50,38})));
        Modelica.Blocks.Math.Add add(k1=-1, k2=-1)
          annotation (Placement(transformation(extent={{70,10},{90,30}})));
      Physiolibrary.Types.Constants.FractionConst             const(k=1)
        annotation (Placement(transformation(extent={{-2,50},{10,62}})));
      Physiolibrary.Types.Constants.pHConst                   n_pH_P(k=7.4)
        annotation (Placement(transformation(extent={{-82,44},{-70,56}})));
      Physiolibrary.Types.Constants.PressureConst             n_pCO2(k=
            5332.8954966)
        annotation (Placement(transformation(extent={{-82,14},{-70,26}})));
       Physiolibrary.Types.RealIO.TemperatureInput T "temperature"
                                        annotation (Placement(transformation(extent={{-120,
                  -40},{-80,0}}),      iconTransformation(extent={{-10,-10},{10,10}},
             rotation=180,
             origin={90,-40})));
        Buffers.Bicarbonate bicarbonate1
          annotation (Placement(transformation(extent={{-38,-40},{-18,-20}})));
      Physiolibrary.Types.Constants.pHConst                   n_pH_E(k=7.19)
        "should be calculated, but how?"
        annotation (Placement(transformation(extent={{-86,-42},{-74,-30}})));
       Physiolibrary.Types.RealIO.ConcentrationInput tHb_E
        "haemoglobin concentration in erythrocyte"
                                        annotation (Placement(transformation(extent={{-120,
                  -68},{-80,-28}}),    iconTransformation(extent={{-10,-10},{10,10}},
             rotation=180,
             origin={90,-10})));
      Physiolibrary.Types.Constants.FractionConst n_sO2(k=1)
        annotation (Placement(transformation(extent={{-86,-66},{-74,-54}})));
      equation
        connect(ctAlb, albumin.tAlb) annotation (Line(
            points={{-100,92},{-70,92},{-70,88},{-38,88}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(bicarbonate.y, NSIDP.u[1])          annotation (Line(
            points={{-18,12},{-8,12},{-8,80.5},{24,80.5}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(albumin.y, NSIDP.u[2])          annotation (Line(
            points={{-18,80},{-6,80},{-6,81.5},{24,81.5}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(globulins.y, NSIDP.u[3])          annotation (Line(
            points={{-18,58},{-8,58},{-8,82.5},{24,82.5}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(phosphates.y, NSIDP.u[4])          annotation (Line(
            points={{-18,36},{-8,36},{-8,83.5},{24,83.5}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Hct, Pct.u2)      annotation (Line(
            points={{-100,6},{26,6},{26,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(add.y, NSID)
                            annotation (Line(
            points={{91,20},{100,20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(product1.y, add.u2) annotation (Line(
            points={{50,9},{50,14},{68,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(product2.y, add.u1) annotation (Line(
            points={{50,27},{50,26},{68,26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Pct.y, product2.u2)      annotation (Line(
            points={{35,56},{44,56},{44,50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Hct, product1.u1) annotation (Line(
            points={{-100,6},{26,6},{26,-20},{44,-20},{44,-14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(NSIDE.y, product1.u2)                annotation (Line(
            points={{33,-68},{56,-68},{56,-14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(NSIDP.y, product2.u1)          annotation (Line(
            points={{47,82},{56,82},{56,50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(const.y, Pct.u1)      annotation (Line(
            points={{11.5,56},{18,56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_P.y, albumin.pH)    annotation (Line(
            points={{-68.5,50},{-62,50},{-62,94},{-38,94}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_P.y, globulins.pH)    annotation (Line(
            points={{-68.5,50},{-62,50},{-62,72},{-38,72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_P.y, phosphates.pH)    annotation (Line(
            points={{-68.5,50},{-38,50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_P.y, bicarbonate.pH)    annotation (Line(
            points={{-68.5,50},{-62,50},{-62,26},{-38,26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(T, bicarbonate.T) annotation (Line(
            points={{-100,-20},{-56,-20},{-56,16},{-38,16}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(bicarbonate1.y, NSIDE.u[1])                annotation (Line(
            points={{-18,-38},{-4,-38},{-4,-69.3333},{10,-69.3333}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(haemoglobin.y, NSIDE.u[2])                annotation (Line(
            points={{-18,-66},{-4,-66},{-4,-68},{10,-68}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(phosphates1.y, NSIDE.u[3])                annotation (Line(
            points={{-18,-94},{-4,-94},{-4,-66.6667},{10,-66.6667}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pCO2.y, bicarbonate.pCO2)      annotation (Line(
            points={{-68.5,20},{-38,20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pCO2.y, bicarbonate1.pCO2)      annotation (Line(
            points={{-68.5,20},{-64,20},{-64,-30},{-38,-30}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_E.y, bicarbonate1.pH)        annotation (Line(
            points={{-72.5,-36},{-60,-36},{-60,-24},{-38,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_E.y, haemoglobin.pH)        annotation (Line(
            points={{-72.5,-36},{-60,-36},{-60,-52},{-38,-52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pH_E.y, phosphates1.pH)        annotation (Line(
            points={{-72.5,-36},{-60,-36},{-60,-80},{-38,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(T, bicarbonate1.T) annotation (Line(
            points={{-100,-20},{-56,-20},{-56,-34},{-38,-34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ctPO4_P, phosphates.tPO4) annotation (Line(
            points={{-100,32},{-74,32},{-74,34},{-48,34},{-48,44},{-38,44}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(tHb_E, haemoglobin.tHb_E) annotation (Line(
            points={{-100,-48},{-70,-48},{-70,-56},{-38,-56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(n_pCO2.y, haemoglobin.pCO2)      annotation (Line(
            points={{-68.5,20},{-64,20},{-64,-64},{-38,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(T, haemoglobin.T) annotation (Line(
            points={{-100,-20},{-56,-20},{-56,-68},{-38,-68}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ctGlb, globulins.ctGlb) annotation (Line(
            points={{-100,62},{-69,62},{-69,64},{-38,64}},
            color={0,0,127},
            smooth=Smooth.None));

      //  NBB = (1-Hct)( [HCO3]P(40mmHg,7.4) + tAlbP*-zAlbP(7.4) + tGlbP*-zGlb(7.4) + tPO4P*-zPO4(7.4) + tORGP*-zORG(7.4) + .. ) + Hct ( [HCO3]E(40mmHg,NpHE) + tHb*-zHb(sO2,sCO2,NpHE) + tPO4E*-zPO4(NpHE) ..)
      //  NBB = 0;//_cTHox;

      connect(n_sO2.y, haemoglobin.sO2) annotation (Line(
          points={{-72.5,-60},{-38,-60}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation (        Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2013</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end NormalSID;

      model Urine

        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qPO4(displayUnit="mmol/min")
        "total phosphates outflow to urine"                                                         annotation (Placement(
              transformation(
              extent={{-20,-20},{20,20}},
              origin={-100,100}),
                                iconTransformation(
              extent={{-10,-10},{10,10}},
              origin={-90,-50})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qKA(displayUnit="mmol/min")
        "total keto-acids outflow to urine"                                                         annotation (Placement(
              transformation(extent={{-120,42},{-80,82}}),  iconTransformation(
              extent={{-10,-10},{10,10}},
              origin={-90,-70})));
        Physiolibrary.Types.RealIO.pHOutput PHU(start=5.7) "urine pH" annotation (Placement(
              transformation(extent={{70,-61},{100,-31}}),iconTransformation(extent={{86,-16},
                  {118,16}})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qNa(displayUnit="mmol/min")
        "total sodium outflow to urine"                                                                annotation (Placement(transformation(
                extent={{-120,-30},{-80,10}}), iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,90})));

        parameter Real CO2_solubility(displayUnit="(mmol/l)/Pa")=0.00023;
        parameter Real pKaCO2=6.1 "CO2 acid dissociation constant";
        parameter Real pKaHCO3=10.329 "HCO3 acid dissociation constant";
        parameter Real pKaH3PO4=1.91 "H3PO4 acid dissociation constant";
        parameter Real pKaH2PO4=6.66 "H2PO4 acid dissociation constant";
        parameter Real pKaHPO4=11.78 "HPO4 acid dissociation constant";
        parameter Real pKaKA=4.3
        "average Keto-acids acid dissociation constant";
        //constant Real ml2l = 0.001;

        Real zPO4 "average charge of one phosphate in urine";
                 //(displayUnit="Eq/Mol")

        Real zKA "average charge of one keto acid in purine";
                //(displayUnit="Eq/Mol")

        Real zCO2_qCO2 "charge outflow in (bi)carbonates to urine";
                      //(displayUnit="Eq/min")
        Physiolibrary.Types.RealIO.PressureInput
                                           pCO2(displayUnit="mmHg")
        "partial CO2 pressure"                   annotation (Placement(transformation(
                extent={{-120,-120},{-80,-80}}),
                                               iconTransformation(extent={{-100,-100},
                  {-80,-80}})));
        Physiolibrary.Types.RealIO.VolumeFlowRateInput
                                           qH2O(displayUnit="ml/min")
        "water flow to urine"                    annotation (Placement(transformation(
                extent={{-120,-140},{-80,-100}}),
                                               iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,-110})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput qCl(displayUnit="mmol/min")
        "chloride flow to urine"                 annotation (Placement(transformation(
                extent={{-120,-128},{-80,-88}}),
                                               iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,-10})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qSO4(displayUnit="mmol/min")
        "sulfate flow to urine"                  annotation (Placement(transformation(
                extent={{-120,-128},{-80,-88}}),
                                               iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,-30})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qK(displayUnit="mmol/min")
        "total potassium outflow to urine"                                                          annotation (Placement(transformation(
                extent={{-120,-30},{-80,10}}), iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,70})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qNH4(displayUnit="mmol/min")
        "total amonium outflow to urine"                                                            annotation (Placement(transformation(
                extent={{-120,-30},{-80,10}}), iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,50})));
       Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qMg(displayUnit="mmol/min")
        "chloride flow to urine"                 annotation (Placement(transformation(
                extent={{-120,-128},{-80,-88}}),
                                               iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,30})));
        Physiolibrary.Types.RealIO.MolarFlowRateInput
                                           qCa(displayUnit="mmol/min")
        "chloride flow to urine"                 annotation (Placement(transformation(
                extent={{-120,-128},{-80,-88}}),
                                               iconTransformation(extent={{-10,-10},{10,
                  10}},
              origin={-90,10})));
        parameter Physiolibrary.Types.MolarFlowRate  qX(displayUnit="mmol/min") = -5.6666666666666666666666666666667e-7
        "other acids/electrolytes charge outflow";
      equation

          zPO4 = -(1+2*10^(PHU-pKaH2PO4)+ 3*10^(2*PHU-pKaH2PO4 -pKaHPO4)) / (10^(pKaH3PO4-PHU)+1+10^(PHU-pKaH2PO4)+ 10^(2*PHU-pKaH2PO4-pKaHPO4));

          zKA = - 1/(10^(pKaKA-PHU)+1);

          zCO2_qCO2 = -CO2_solubility*pCO2*(10^(PHU-pKaCO2))*(qH2O);

          qX + 1*qNa + 1*qK + 2*qMg + 2*qCa + 1*qNH4 + (-1)*qCl + (-2)*qSO4 + zPO4*qPO4 + zKA*qKA + zCO2_qCO2 = 0;  // electroneutrality of urine outflow

        annotation (
          Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,-120},{100,100}}),
                               graphics={
              Rectangle(
                extent={{-100,100},{100,-120}},
                lineColor={0,0,255},
                lineThickness=0.5,
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid),
              Text(
                extent={{118,70},{-36,96}},
                lineColor={0,0,255},
                lineThickness=0.5,
                textString="Urine pH")}),
          Diagram(coordinateSystem(preserveAspectRatio=true, extent={{-100,-120},{100,
                  100}}), graphics),
          Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2013</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Medsoft 2013, 146-147</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end Urine;

      package Tissues
      "Acidity of tissue veins, interstitium or intracellular space"

        model Interstitia

        Interstitium.SkeletalMuscleInterstitialPh skeletalMuscle
          annotation (Placement(transformation(extent={{-54,66},{-34,86}})));

        Interstitium.BoneInterstitialPh bone
          annotation (Placement(transformation(extent={{-54,36},{-34,56}})));

        Interstitium.FatInterstitialPh fat
          annotation (Placement(transformation(extent={{-54,-54},{-34,-34}})));

        Interstitium.BrainInterstitialPh brain
          annotation (Placement(transformation(extent={{52,28},{72,48}})));

        Interstitium.RightHeartInterstitialPh rightHeart
          annotation (Placement(transformation(extent={{52,-92},{72,-72}})));

        Interstitium.RespiratoryMuscleInterstitialPh respiratoryMuscle
          annotation (Placement(transformation(extent={{-54,-24},{-34,-4}})));

        Interstitium.OtherTissueInterstitialPh otherTissue
          annotation (Placement(transformation(extent={{-54,6},{-34,26}})));

        Interstitium.LiverInterstitialPh liver
          annotation (Placement(transformation(extent={{52,60},{72,80}})));

        Interstitium.LeftHeartInterstitialPh leftHeart
          annotation (Placement(transformation(extent={{52,-62},{72,-42}})));

        Interstitium.KidneyInterstitialPh kidney
          annotation (Placement(transformation(extent={{52,-32},{72,-12}})));

        Interstitium.GITractInterstitialPh GITract
          annotation (Placement(transformation(extent={{52,-2},{72,18}})));

        Physiolibrary.Types.BusConnector busConnector
          annotation (Placement(transformation(extent={{-108,72},{-68,112}})));
        Interstitium.SkinInterstitialPh skin
          annotation (Placement(transformation(extent={{-54,-84},{-34,-64}})));

        equation
          connect(busConnector.bone_cHCO3_interstitial, bone.cHCO3)        annotation (
             Line(
              points={{-88,92},{-88,42},{-53,42}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain_cHCO3_interstitial, brain.cHCO3)
            annotation (Line(
              points={{-88,92},{6,92},{6,34},{53,34}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat_cHCO3_interstitial, fat.cHCO3)      annotation (
              Line(
              points={{-88,92},{-88,-48},{-53,-48}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract_cHCO3_interstitial, GITract.cHCO3)
            annotation (Line(
              points={{-88,92},{6,92},{6,4},{53,4}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_cHCO3_interstitial, kidney.cHCO3)
            annotation (Line(
              points={{-88,92},{6,92},{6,-26},{53,-26}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_cHCO3_interstitial, leftHeart.cHCO3)
            annotation (Line(
              points={{-88,92},{6,92},{6,-56},{53,-56}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_cHCO3_interstitial, liver.cHCO3)
            annotation (Line(
              points={{-88,92},{6,92},{6,66},{53,66}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue_cHCO3_interstitial, otherTissue.cHCO3)
            annotation (Line(
              points={{-88,92},{-88,12},{-53,12}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle_cHCO3_interstitial, respiratoryMuscle.cHCO3)
            annotation (Line(
              points={{-88,92},{-88,-18},{-53,-18}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_cHCO3_interstitial, rightHeart.cHCO3)
            annotation (Line(
              points={{-88,92},{6,92},{6,-86},{53,-86}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_cHCO3_interstitial, skin.cHCO3)      annotation (
             Line(
              points={{-88,92},{-88,-78},{-53,-78}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle_cHCO3_interstitial, skeletalMuscle.cHCO3)
            annotation (Line(
              points={{-88,92},{-87.5,92},{-87.5,72},{-53,72}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

         connect(busConnector.bone.pCO2, bone.pCO2)        annotation (
             Line(
              points={{-88,92},{-88,54},{-53,54}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain.pCO2, brain.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,46},{53,46}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat.pCO2, fat.pCO2)      annotation (
              Line(
              points={{-88,92},{-88,-36},{-53,-36}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract.pCO2, GITract.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,16},{53,16}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_pCO2, kidney.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,-14},{53,-14}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_pCO2, leftHeart.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,-44},{53,-44}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_pCO2, liver.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,78},{53,78}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue.pCO2, otherTissue.pCO2)
            annotation (Line(
              points={{-88,92},{-88,24},{-53,24}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle.pCO2, respiratoryMuscle.pCO2)
            annotation (Line(
              points={{-88,92},{-88,-6},{-53,-6}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_pCO2, rightHeart.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,-74},{53,-74}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_pCO2, skin.pCO2)      annotation (
             Line(
              points={{-88,92},{-88,-66},{-53,-66}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle.pCO2, skeletalMuscle.pCO2)
            annotation (Line(
              points={{-88,92},{-87.5,92},{-87.5,84},{-53,84}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

         connect(busConnector.bone_T, bone.T)        annotation (
             Line(
              points={{-88,92},{-88,38.8},{-53,38.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain_T, brain.T)
            annotation (Line(
              points={{-88,92},{6,92},{6,30.8},{53,30.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat_T, fat.T)      annotation (
              Line(
              points={{-88,92},{-88,-51.2},{-53,-51.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract_T, GITract.T)
            annotation (Line(
              points={{-88,92},{6,92},{6,0.8},{53,0.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_T, kidney.T)
            annotation (Line(
              points={{-88,92},{6,92},{6,-29.2},{53,-29.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_T, leftHeart.T)
            annotation (Line(
              points={{-88,92},{6,92},{6,-59.2},{53,-59.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_T, liver.T)
            annotation (Line(
              points={{-88,92},{6,92},{6,62.8},{53,62.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue_T, otherTissue.T)
            annotation (Line(
              points={{-88,92},{-88,8.8},{-53,8.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle_T, respiratoryMuscle.T)
            annotation (Line(
              points={{-88,92},{-88,-21.2},{-53,-21.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_T, rightHeart.T)
            annotation (Line(
              points={{-88,92},{6,92},{6,-89.2},{53,-89.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_T, skin.T)      annotation (
             Line(
              points={{-88,92},{-88,-81.2},{-53,-81.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle_T, skeletalMuscle.T)
            annotation (Line(
              points={{-88,92},{-87.5,92},{-87.5,68.8},{-53,68.8}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

        connect(bone.pH_interstitial, busConnector.bone_pH_interstitial) annotation (Line(
              points={{-38,34},{6,34},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(brain.pH_interstitial, busConnector.brain_pH_interstitial) annotation (Line(
              points={{68,26},{6,26},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(fat.pH_interstitial, busConnector.fat_pH_interstitial) annotation (Line(
              points={{-38,-56},{6,-56},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(GITract.pH_interstitial, busConnector.GITract_pH_interstitial) annotation (Line(
              points={{68,-4},{6,-4},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(kidney.pH_interstitial, busConnector.kidney_pH_interstitial) annotation (Line(
              points={{68,-34},{6,-34},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(leftHeart.pH_interstitial, busConnector.leftHeart_pH_interstitial) annotation (Line(
              points={{68,-64},{6,-64},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(liver.pH_interstitial, busConnector.liver_pH_interstitial) annotation (Line(
              points={{68,58},{6,58},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(otherTissue.pH_interstitial, busConnector.otherTissue_pH_interstitial) annotation (Line(
              points={{-38,4},{6,4},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(rightHeart.pH_interstitial, busConnector.rightHeart_pH_interstitial) annotation (Line(
              points={{68,-94},{6,-94},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(respiratoryMuscle.pH_interstitial, busConnector.respiratoryMuscle_pH_interstitial) annotation (Line(
              points={{-38,-26},{6,-26},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(skin.pH_interstitial, busConnector.skin_pH_interstitial) annotation (Line(
              points={{-38,-86},{6,-86},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(skeletalMuscle.pH_interstitial, busConnector.skeletalMuscle_pH_interstitial) annotation (Line(
              points={{-38,64},{6,64},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));

          annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                    -100},{100,100}}), graphics={
                Rectangle(
                  extent={{-100,100},{100,-100}},
                  lineColor={0,0,255},
                  fillColor={215,215,215},
                  fillPattern=FillPattern.Solid),
                Text(
                  extent={{-96,-62},{98,-94}},
                  lineColor={0,0,255},
                  textString="%name"),
                Text(
                  extent={{-88,6},{-24,34}},
                  lineColor={0,0,0},
                  textString="IST"),
                Text(
                  extent={{30,36},{96,-18}},
                  lineColor={0,0,0},
                  textString="pH")}),
            Documentation(info="<html>
<p>BE_interstitial is base excess in the interstitium of the tissue. The standard value is 0, when strong acid concentration increase, then BE value decrease with the same concentration. </p>
<p>Meaning might be interpreted like what amount of hydrogen iont must be added to sollution if the end poit of titration will be pH=7.4 and pCO2=5.3kPa.</p>
<p>For any tissue can be simplified with difference of lactate concentration from its normal value.</p>
</html>",         revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end Interstitia;

        model InterstitiumBase

          Physiolibrary.Types.RealIO.ConcentrationInput cHCO3
          "tissue interstitial bicarbonate concentration"
                                           annotation (Placement(transformation(extent={{-106,-4},
                    {-90,12}}),           iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,-40})));                         //(final displayUnit="mEq/ml")
          Physiolibrary.Types.RealIO.pHOutput pH_interstitial
          "tissue interstitial pH"                                                      annotation (Placement(
                transformation(extent={{24,-16},{44,4}}),   iconTransformation(
                extent={{-20,-20},{20,20}},
                rotation=270,
                origin={60,-120})));
          Gases.CO2.TissueHCO3 interstitium
          annotation (Placement(transformation(extent={{-22,2},{-2,22}})));
          Modelica.Blocks.Math.InverseBlockConstraints inverseBlockConstraints
            annotation (Placement(transformation(extent={{-34,-16},{8,38}})));
          Physiolibrary.Types.RealIO.TemperatureInput T(
                                          displayUnit="degC")
          "tissue interstitial bicarbonate concentration"
                                           annotation (Placement(transformation(extent={{62,24},
                    {40,2}}),             iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,-72})));
          Physiolibrary.Types.RealIO.PressureInput pCO2(
                                             displayUnit="mmHg")
          "tissue interstitial bicarbonate concentration"
                                           annotation (Placement(transformation(extent={
                    {-56,18},{-38,36}}), iconTransformation(
                extent={{-10,-10},{10,10}},
                origin={-90,80})));
        equation

          connect(interstitium.cHCO3, inverseBlockConstraints.u2) annotation (Line(
              points={{-4,0},{-4,-8},{-26,-8},{-26,11},{-29.8,11}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(interstitium.pH, inverseBlockConstraints.y2) annotation (Line(
              points={{-21,20},{-24,20},{-24,30},{2,30},{2,11},{4.85,11}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(interstitium.T, T) annotation (Line(
              points={{-3,20},{30,20},{30,13},{51,13}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(inverseBlockConstraints.y1, pH_interstitial) annotation (Line(
              points={{9.05,11},{24,11},{24,-6},{34,-6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(cHCO3, inverseBlockConstraints.u1) annotation (Line(
              points={{-98,4},{-68,4},{-68,11},{-36.1,11}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(interstitium.pCO2_, pCO2) annotation (Line(
            points={{-21,16.2},{-30.5,16.2},{-30.5,27},{-47,27}},
            color={0,0,127},
            smooth=Smooth.None));
          annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
                  extent={{-100,-100},{100,100}}), graphics={
                Rectangle(extent={{-100,100},{100,-100}}, lineColor={0,0,0}),
                Text(
                  extent={{34,102},{100,48}},
                  lineColor={0,0,0},
                  textString="pH"),
                Text(
                  extent={{-84,72},{-20,100}},
                  lineColor={0,0,0},
                  textString="IST")}),
            Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end InterstitiumBase;

        package Interstitium
          model FatInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.Fat;
          end FatInterstitialPh;

          model LiverInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.Liver;
          end LiverInterstitialPh;

          model SkinInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.Skin;
          end SkinInterstitialPh;

          model BrainInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.Brain;
          end BrainInterstitialPh;

          model LeftHeartInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.LeftHeart;
          end LeftHeartInterstitialPh;

          model GITractInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.GITract;
          end GITractInterstitialPh;

          model KidneyInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.Kidney;
          end KidneyInterstitialPh;

          model BoneInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.Bone;
          end BoneInterstitialPh;

          model OtherTissueInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.OtherTissue;
          end OtherTissueInterstitialPh;

          model SkeletalMuscleInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.SkeletalMuscle;
          end SkeletalMuscleInterstitialPh;

          model RespiratoryMuscleInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.RespiratoryMuscle;
          end RespiratoryMuscleInterstitialPh;

          model RightHeartInterstitialPh
            extends InterstitiumBase;
            extends Physiolibrary.Icons.RightHeart;
          end RightHeartInterstitialPh;

         model SkeletalMuscleAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="SkeletalMuscleLactateMass"), inputPump1(
                q_out(conc(start=5e-5)), useSoluteFlowInput=true));
            extends Physiolibrary.Icons.SkeletalMuscle;
         end SkeletalMuscleAcidity;

          model OtherTissueAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="OtherTissueLactateMass"));
            extends Physiolibrary.Icons.OtherTissue;
          end OtherTissueAcidity;

          model RespiratoryMuscleAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="RespiratoryMuscleLactateMass"));
            extends Physiolibrary.Icons.RespiratoryMuscle;
          end RespiratoryMuscleAcidity;

          model BoneAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="BoneLactateMass"));
            extends Physiolibrary.Icons.Bone;
          end BoneAcidity;

          model FatAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="FatLactateMass"));
            extends Physiolibrary.Icons.Fat;
          end FatAcidity;

          model SkinAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="SkinLactateMass"));
            extends Physiolibrary.Icons.Skin;
          end SkinAcidity;

          model LiverAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="LiverLactateMass"));
            extends Physiolibrary.Icons.Liver;
          end LiverAcidity;

          model BrainAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="BrainLactateMass"));
            extends Physiolibrary.Icons.Brain;
          end BrainAcidity;

          model GITractAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="GITractLactateMass"));
            extends Physiolibrary.Icons.GITract;
          end GITractAcidity;

          model KidneyAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="KidneyLactateMass"));
            extends Physiolibrary.Icons.Kidney;
          end KidneyAcidity;

          model LeftHeartAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="LeftHeartLactateMass"));
            extends Physiolibrary.Icons.LeftHeart;
          end LeftHeartAcidity;

          model RightHeartAcidity
            extends Physiomodel.Electrolytes.AcidBase.Tissues.old.Tissue_cTH(
              interstitium(stateName="RightHeartLactateMass"));
            extends Physiolibrary.Icons.RightHeart;
          end RightHeartAcidity;
        end Interstitium;

        model Bloods

          Blood.SkeletalMuscleBloodPh skeletalMuscle
            annotation (Placement(transformation(extent={{-54,66},{-34,86}})));

          Blood.BoneBloodPh bone
            annotation (Placement(transformation(extent={{-54,36},{-34,56}})));

          Blood.FatBloodPh fat
            annotation (Placement(transformation(extent={{-54,-54},{-34,-34}})));

          Blood.BrainBloodPh brain
            annotation (Placement(transformation(extent={{52,28},{72,48}})));

          Blood.RightHeartBloodPh rightHeart
            annotation (Placement(transformation(extent={{52,-92},{72,-72}})));

          Blood.RespiratoryMuscleBloodPh respiratoryMuscle
            annotation (Placement(transformation(extent={{-54,-24},{-34,-4}})));

          Blood.OtherTissueBloodPh otherTissue
            annotation (Placement(transformation(extent={{-54,6},{-34,26}})));

          Blood.LiverBloodPh liver
            annotation (Placement(transformation(extent={{52,60},{72,80}})));

          Blood.LeftHeartBloodPh leftHeart
            annotation (Placement(transformation(extent={{52,-62},{72,-42}})));

          Blood.KidneyBloodPh kidney
            annotation (Placement(transformation(extent={{52,-32},{72,-12}})));

          Blood.GITractBloodPh GITract
            annotation (Placement(transformation(extent={{52,-2},{72,18}})));

        Physiolibrary.Types.BusConnector busConnector
          annotation (Placement(transformation(extent={{-108,74},{-68,114}})));
          Blood.SkinBloodPh skin
            annotation (Placement(transformation(extent={{-54,-84},{-34,-64}})));

          Modelica.Blocks.Math.Add cTH_lessLactate(k1=-1, k2=-1)
            annotation (Placement(transformation(extent={{-92,114},{-72,134}})));
        equation
          connect(busConnector.bone_sO2, bone.sO2)        annotation (
             Line(
              points={{-88,94},{-88,57},{-38,57}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain_sO2, brain.sO2)
            annotation (Line(
              points={{-88,94},{6,94},{6,49},{68,49}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat_sO2, fat.sO2)      annotation (
              Line(
              points={{-88,94},{-88,-33},{-38,-33}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract_sO2, GITract.sO2)
            annotation (Line(
              points={{-88,94},{6,94},{6,19},{68,19}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_sO2, kidney.sO2)
            annotation (Line(
              points={{-88,94},{6,94},{6,-11},{68,-11}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_sO2, leftHeart.sO2)
            annotation (Line(
              points={{-88,94},{6,94},{6,-41},{68,-41}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_sO2, liver.sO2)
            annotation (Line(
              points={{-88,94},{6,94},{6,81},{68,81}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue_sO2, otherTissue.sO2)
            annotation (Line(
              points={{-88,94},{-88,27},{-38,27}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle_sO2, respiratoryMuscle.sO2)
            annotation (Line(
              points={{-88,94},{-88,-3},{-38,-3}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_sO2, rightHeart.sO2)
            annotation (Line(
              points={{-88,94},{6,94},{6,-71},{68,-71}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_sO2, skin.sO2)      annotation (
             Line(
              points={{-88,94},{-88,-63},{-38,-63}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle_sO2, skeletalMuscle.sO2)
            annotation (Line(
              points={{-88,94},{-87.5,94},{-87.5,87},{-38,87}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

         connect(busConnector.bone_T, bone.T)        annotation (
             Line(
              points={{-88,94},{-88,38.8},{-53,38.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain_T, brain.T)
            annotation (Line(
              points={{-88,94},{6,94},{6,30.8},{53,30.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat_T, fat.T)      annotation (
              Line(
              points={{-88,94},{-88,-51.2},{-53,-51.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract_T, GITract.T)
            annotation (Line(
              points={{-88,94},{6,94},{6,0.8},{53,0.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_T, kidney.T)
            annotation (Line(
              points={{-88,94},{6,94},{6,-29.2},{53,-29.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_T, leftHeart.T)
            annotation (Line(
              points={{-88,94},{6,94},{6,-59.2},{53,-59.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_T, liver.T)
            annotation (Line(
              points={{-88,94},{6,94},{6,62.8},{53,62.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue_T, otherTissue.T)
            annotation (Line(
              points={{-88,94},{-88,8.8},{-53,8.8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle_T, respiratoryMuscle.T)
            annotation (Line(
              points={{-88,94},{-88,-21.2},{-53,-21.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_T, rightHeart.T)
            annotation (Line(
              points={{-88,94},{6,94},{6,-89.2},{53,-89.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_T, skin.T)      annotation (
             Line(
              points={{-88,94},{-88,-81.2},{-53,-81.2}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle_T, skeletalMuscle.T)
            annotation (Line(
              points={{-88,94},{-87.5,94},{-87.5,68.8},{-53,68.8}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

         connect(cTH_lessLactate.y, bone.ctHox_lessLactate)        annotation (
             Line(
              points={{-71,124},{-71,46},{-53,46}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, brain.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{6,124},{6,38},{53,38}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, fat.ctHox_lessLactate)      annotation (
              Line(
              points={{-71,124},{-71,-44},{-53,-44}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, GITract.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{6,124},{6,8},{53,8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, kidney.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{6,124},{6,-22},{53,-22}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, leftHeart.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{6,124},{6,-52},{53,-52}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, liver.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{6,124},{6,70},{53,70}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, otherTissue.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{-71,16},{-53,16}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, respiratoryMuscle.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{-71,-14},{-53,-14}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, rightHeart.ctHox_lessLactate)
            annotation (Line(
              points={{-71,124},{6,124},{6,-82},{53,-82}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(cTH_lessLactate.y, skin.ctHox_lessLactate)      annotation (
             Line(
              points={{-71,124},{-71,-74},{-53,-74}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

         connect(busConnector.bone_cLactate, bone.cLactate)        annotation (
             Line(
              points={{-88,94},{-88,50},{-53,50}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain_cLactate, brain.cLactate)
            annotation (Line(
              points={{-88,94},{6,94},{6,42},{53,42}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat_cLactate, fat.cLactate)      annotation (
              Line(
              points={{-88,94},{-88,-40},{-53,-40}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract_cLactate, GITract.cLactate)
            annotation (Line(
              points={{-88,94},{6,94},{6,12},{53,12}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_cLactate, kidney.cLactate)
            annotation (Line(
              points={{-88,94},{6,94},{6,-18},{53,-18}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_cLactate, leftHeart.cLactate)
            annotation (Line(
              points={{-88,94},{6,94},{6,-48},{53,-48}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_cLactate, liver.cLactate)
            annotation (Line(
              points={{-88,94},{6,94},{6,74},{53,74}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue_cLactate, otherTissue.cLactate)
            annotation (Line(
              points={{-88,94},{-88,20},{-53,20}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle_cLactate, respiratoryMuscle.cLactate)
            annotation (Line(
              points={{-88,94},{-88,-10},{-53,-10}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_cLactate, rightHeart.cLactate)
            annotation (Line(
              points={{-88,94},{6,94},{6,-78},{53,-78}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_cLactate, skin.cLactate)      annotation (
             Line(
              points={{-88,94},{-88,-70},{-53,-70}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle_cLactate, skeletalMuscle.cLactate)
            annotation (Line(
              points={{-88,94},{-87.5,94},{-87.5,80},{-53,80}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

          connect(bone.ctHb, busConnector.ctHb)       annotation (
             Line(
              points={{-35,50},{6,50},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(brain.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{71,42},{98,42},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(fat.ctHb, busConnector.ctHb)     annotation (
              Line(
              points={{-35,-40},{6,-40},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(GITract.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{71,12},{98,12},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(kidney.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{71,-18},{98,-18},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(leftHeart.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{71,-48},{98,-48},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(liver.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{71,74},{98,74},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(otherTissue.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{-35,20},{6,20},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(respiratoryMuscle.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{-35,-10},{6,-10},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(rightHeart.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{71,-78},{98,-78},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skin.ctHb, busConnector.ctHb)     annotation (
             Line(
              points={{-35,-70},{6,-70},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skeletalMuscle.ctHb, busConnector.ctHb)
            annotation (Line(
              points={{-35,80},{5.5,80},{5.5,94},{-88,94}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));

          connect(bone.ctAlb, busConnector.ctAlb)       annotation (
             Line(
              points={{-35,46},{6,46},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(brain.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{71,38},{98,38},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(fat.ctAlb, busConnector.ctAlb)     annotation (
              Line(
              points={{-35,-44},{6,-44},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(GITract.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{71,8},{98,8},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(kidney.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{71,-22},{98,-22},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(leftHeart.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{71,-52},{98,-52},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(liver.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{71,70},{98,70},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(otherTissue.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{-35,16},{6,16},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(respiratoryMuscle.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{-35,-14},{6,-14},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(rightHeart.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{71,-82},{98,-82},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skin.ctAlb, busConnector.ctAlb)     annotation (
             Line(
              points={{-35,-74},{6,-74},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skeletalMuscle.ctAlb, busConnector.ctAlb)
            annotation (Line(
              points={{-35,76},{5.5,76},{5.5,94},{-88,94}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));

         connect(bone.ctGlb, busConnector.ctGlb)       annotation (
             Line(
              points={{-35,42},{6,42},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(brain.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{71,34},{98,34},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(fat.ctGlb, busConnector.ctGlb)     annotation (
              Line(
              points={{-35,-48},{6,-48},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(GITract.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{71,4},{98,4},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(kidney.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{71,-26},{98,-26},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(leftHeart.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{71,-56},{98,-56},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(liver.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{71,66},{98,66},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(otherTissue.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{-35,12},{6,12},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(respiratoryMuscle.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{-35,-18},{6,-18},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(rightHeart.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{71,-86},{98,-86},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skin.ctGlb, busConnector.ctGlb)     annotation (
             Line(
              points={{-35,-78},{6,-78},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skeletalMuscle.ctGlb, busConnector.ctGlb)
            annotation (Line(
              points={{-35,72},{5.5,72},{5.5,94},{-88,94}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));

         connect(bone.ctPO4, busConnector.ctPO4)       annotation (
             Line(
              points={{-35,38},{6,38},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(brain.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{71,30},{98,30},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(fat.ctPO4, busConnector.ctPO4)     annotation (
              Line(
              points={{-35,-52},{6,-52},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(GITract.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{71,0},{98,0},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(kidney.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{71,-30},{98,-30},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(leftHeart.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{71,-60},{98,-60},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(liver.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{71,62},{98,62},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(otherTissue.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{-35,8},{6,8},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(respiratoryMuscle.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{-35,-22},{6,-22},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(rightHeart.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{71,-90},{98,-90},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skin.ctPO4, busConnector.ctPO4)     annotation (
             Line(
              points={{-35,-82},{6,-82},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skeletalMuscle.ctPO4, busConnector.ctPO4)
            annotation (Line(
              points={{-35,68},{5.5,68},{5.5,94},{-88,94}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));

          connect(bone.cHCO3, busConnector.bone_cHCO3)        annotation (
             Line(
              points={{-35,54},{6,54},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(brain.cHCO3, busConnector.brain_cHCO3)
            annotation (Line(
              points={{71,46},{98,46},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(fat.cHCO3, busConnector.fat_cHCO3)     annotation (
              Line(
              points={{-35,-36},{6,-36},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(GITract.cHCO3, busConnector.GITract_cHCO3)
            annotation (Line(
              points={{71,16},{98,16},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(kidney.cHCO3, busConnector.kidney_cHCO3)
            annotation (Line(
              points={{71,-14},{98,-14},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(leftHeart.cHCO3, busConnector.leftHeart_cHCO3)
            annotation (Line(
              points={{71,-44},{98,-44},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(liver.cHCO3, busConnector.liver_cHCO3)
            annotation (Line(
              points={{71,78},{98,78},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(otherTissue.cHCO3, busConnector.otherTissue_cHCO3)
            annotation (Line(
              points={{-35,24},{6,24},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(respiratoryMuscle.cHCO3, busConnector.respiratoryMuscle_cHCO3)
            annotation (Line(
              points={{-35,-6},{6,-6},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(rightHeart.cHCO3, busConnector.rightHeart_cHCO3)
            annotation (Line(
              points={{71,-74},{98,-74},{98,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skin.cHCO3, busConnector.skin_cHCO3)     annotation (
             Line(
              points={{-35,-66},{6,-66},{6,94},{-88,94}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));
          connect(skeletalMuscle.cHCO3, busConnector.skeletalMuscle_cHCO3)
            annotation (Line(
              points={{-35,84},{5.5,84},{5.5,94},{-88,94}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{5,2},{5,2}}));

          connect(bone.pH_ery, busConnector.bone_pH_ery) annotation (Line(
              points={{-42,34},{6,34},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(brain.pH_ery, busConnector.brain_pH_ery) annotation (Line(
              points={{64,26},{6,26},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(fat.pH_ery, busConnector.fat_pH_ery) annotation (Line(
              points={{-42,-56},{6,-56},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(GITract.pH_ery, busConnector.GITract_pH_ery) annotation (Line(
              points={{64,-4},{6,-4},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(kidney.pH_ery, busConnector.kidney_pH_ery) annotation (Line(
              points={{64,-34},{6,-34},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(leftHeart.pH_ery, busConnector.leftHeart_pH_ery) annotation (Line(
              points={{64,-64},{6,-64},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(liver.pH_ery, busConnector.liver_pH_ery) annotation (Line(
              points={{64,58},{6,58},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(otherTissue.pH_ery, busConnector.otherTissue_pH_ery) annotation (Line(
              points={{-42,4},{6,4},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(rightHeart.pH_ery, busConnector.rightHeart_pH_ery) annotation (Line(
              points={{64,-94},{6,-94},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(respiratoryMuscle.pH_ery, busConnector.respiratoryMuscle_pH_ery) annotation (Line(
              points={{-42,-26},{6,-26},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(skin.pH_ery, busConnector.skin_pH_ery) annotation (Line(
              points={{-42,-86},{6,-86},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(skeletalMuscle.pH_ery, busConnector.skeletalMuscle_pH_ery) annotation (Line(
              points={{-42,64},{6,64},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));

         connect(bone.pH, busConnector.bone_pH_plasma) annotation (Line(
              points={{-46,34},{6,34},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
           connect(brain.pH, busConnector.brain_pH_plasma) annotation (Line(
              points={{60,26},{6,26},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
           connect(fat.pH, busConnector.fat_pH_plasma) annotation (Line(
              points={{-46,-56},{6,-56},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
               connect(GITract.pH, busConnector.GITract_pH_plasma) annotation (Line(
              points={{60,-4},{6,-4},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
           connect(kidney.pH, busConnector.kidney_pH_plasma) annotation (Line(
              points={{60,-34},{6,-34},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
           connect(leftHeart.pH, busConnector.leftHeart_pH_plasma) annotation (Line(
              points={{60,-64},{6,-64},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
           connect(liver.pH, busConnector.liver_pH_plasma) annotation (Line(
              points={{60,58},{6,58},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(otherTissue.pH, busConnector.otherTissue_pH_plasma) annotation (Line(
              points={{-46,4},{6,4},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
           connect(rightHeart.pH, busConnector.rightHeart_pH_plasma) annotation (Line(
              points={{60,-94},{6,-94},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(respiratoryMuscle.pH, busConnector.respiratoryMuscle_pH_plasma) annotation (Line(
              points={{-46,-26},{6,-26},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(skin.pH, busConnector.skin_pH_plasma) annotation (Line(
              points={{-46,-86},{6,-86},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(skeletalMuscle.pH, busConnector.skeletalMuscle_pH_plasma) annotation (Line(
              points={{-46,64},{6,64},{6,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None));

          connect(busConnector.Blood_BEox, cTH_lessLactate.u1) annotation (Line(
              points={{-88,94},{-114,94},{-114,130},{-94,130}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(cTH_lessLactate.y, skeletalMuscle.ctHox_lessLactate) annotation (Line(
              points={{-71,124},{-66,124},{-66,76},{-53,76}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(busConnector.LacPool, cTH_lessLactate.u2) annotation (Line(
            points={{-88,94},{-114,94},{-114,118},{-94,118}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
          annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,-100},
                    {100,140}}),       graphics={
                Rectangle(
                  extent={{-100,100},{100,-100}},
                  lineColor={0,0,255},
                  fillColor={215,215,215},
                  fillPattern=FillPattern.Solid),
                Text(
                  extent={{-96,-62},{98,-94}},
                  lineColor={0,0,255},
                  textString="%name"),
                Text(
                  extent={{-94,12},{-10,40}},
                  lineColor={0,0,0},
                  textString="Blood"),
                Text(
                  extent={{32,40},{98,-14}},
                  lineColor={0,0,0},
                  textString="pH")}),
                                   Diagram(coordinateSystem(preserveAspectRatio=false,
                          extent={{-100,-100},{100,140}}), graphics),
            Documentation(info="<html>
<p>BE_interstitial is base excess in the interstitium of the tissue. The standard value is 0, when strong acid concentration increase, then BE value decrease with the same concentration. </p>
<p>Meaning might be interpreted like what amount of hydrogen iont must be added to sollution if the end poit of titration will be pH=7.4 and pCO2=5.3kPa.</p>
<p>For any tissue can be simplified with difference of lactate concentration from its normal value.</p>
</html>",         revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>dec 2013</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end Bloods;

        model BloodBase
          extends Physiomodel.Electrolytes.AcidBase.BloodPhBase;

          Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput ctHox_lessLactate(
                                              displayUnit="mEq/l")
          "titratable acidity of oxygenated blood"
                                           annotation (Placement(transformation(extent={{-54,62},
                    {-14,102}}),          iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,0})));
          Physiolibrary.Types.RealIO.TemperatureInput T(
                                           displayUnit="degC")
          "tissue interstitial bicarbonate concentration"
                                           annotation (Placement(transformation(extent={{62,24},
                    {40,2}}),             iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,-72})));
          Physiolibrary.Types.RealIO.ConcentrationInput cLactate
          "titratable acidity of oxygenated blood"
                                           annotation (Placement(transformation(extent={{-6,66},
                    {34,106}}),           iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,40})));                             //(final displayUnit="mEq/l")
        equation

        //base excess
          ctHox_lessLactate/Modelica.Constants.F + cLactate = _cTHox;

         // cTH_interstitial = -(1-((ctHb_ery/3)/43))*((cHCO3_interstitial-24.5)+betaX*(pH_interstitial-7.42));

          annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
                  extent={{-100,-100},{100,100}}), graphics={Text(
                  extent={{30,100},{96,46}},
                  lineColor={0,0,0},
                  textString="pH"), Text(
                  extent={{-96,72},{-12,100}},
                  lineColor={0,0,0},
                  textString="Blood")}),
            Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2013</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end BloodBase;

        package Blood
          model SkeletalMuscleBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.SkeletalMuscle;
          end SkeletalMuscleBloodPh;

          model BoneBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.Bone;
          end BoneBloodPh;

          model OtherTissueBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.OtherTissue;
          end OtherTissueBloodPh;

          model RespiratoryMuscleBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.RespiratoryMuscle;
          end RespiratoryMuscleBloodPh;

          model FatBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.Fat;
          end FatBloodPh;

          model LeftHeartBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.LeftHeart;
          end LeftHeartBloodPh;

          model SkinBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.Skin;
          end SkinBloodPh;

          model LiverBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.Liver;
          end LiverBloodPh;

          model BrainBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.Brain;
          end BrainBloodPh;

          model GITractBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.GITract;
          end GITractBloodPh;

          model KidneyBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.Kidney;
          end KidneyBloodPh;

          model RightHeartBloodPh
            extends BloodBase;
            extends Physiolibrary.Icons.RightHeart;
          end RightHeartBloodPh;
        end Blood;

        model Cells

        Cell.SkeletalMuscleIntracellularPh skeletalMuscle
          annotation (Placement(transformation(extent={{-54,64},{-34,84}})));

        Cell.BoneIntracellularPh bone
          annotation (Placement(transformation(extent={{-54,36},{-34,56}})));

        Cell.FatIntracellularPh fat
          annotation (Placement(transformation(extent={{-54,-54},{-34,-34}})));

        Cell.BrainIntracellularPh brain
          annotation (Placement(transformation(extent={{52,28},{72,48}})));

        Cell.RightHeartIntracellularPh rightHeart
          annotation (Placement(transformation(extent={{52,-92},{72,-72}})));

        Cell.RespiratoryMuscleIntracellularPh respiratoryMuscle
          annotation (Placement(transformation(extent={{-54,-24},{-34,-4}})));

        Cell.OtherTissueIntracellularPh otherTissue
          annotation (Placement(transformation(extent={{-54,6},{-34,26}})));

        Cell.LiverIntracellularPh liver
          annotation (Placement(transformation(extent={{52,60},{72,80}})));

        Cell.LeftHeartIntracellularPh leftHeart
          annotation (Placement(transformation(extent={{52,-62},{72,-42}})));

        Cell.KidneyIntracellularPh kidney
          annotation (Placement(transformation(extent={{52,-32},{72,-12}})));

        Cell.GITractIntracellularPh GITract
          annotation (Placement(transformation(extent={{52,-2},{72,18}})));

        Physiolibrary.Types.BusConnector busConnector
          annotation (Placement(transformation(extent={{-108,72},{-68,112}})));
        Cell.SkinIntracellularPh skin
          annotation (Placement(transformation(extent={{-54,-84},{-34,-64}})));

        equation
          connect(busConnector.KCell_conc, bone.KCell)      annotation (
             Line(
              points={{-88,92},{-88,46},{-53,46}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, brain.KCell)
            annotation (Line(
              points={{-88,92},{6,92},{6,38},{53,38}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, fat.KCell)      annotation (
              Line(
              points={{-88,92},{-88,-44},{-53,-44}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, GITract.KCell)
            annotation (Line(
              points={{-88,92},{6,92},{6,8},{53,8}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, kidney.KCell)
            annotation (Line(
              points={{-88,92},{6,92},{6,-22},{53,-22}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, leftHeart.KCell)
            annotation (Line(
              points={{-88,92},{6,92},{6,-52},{53,-52}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, liver.KCell)
            annotation (Line(
              points={{-88,92},{6,92},{6,70},{53,70}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, otherTissue.KCell)
            annotation (Line(
              points={{-88,92},{-88,16},{-53,16}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, respiratoryMuscle.KCell)
            annotation (Line(
              points={{-88,92},{-88,-14},{-53,-14}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, rightHeart.KCell)
            annotation (Line(
              points={{-88,92},{6,92},{6,-82},{53,-82}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, skin.KCell)      annotation (
             Line(
              points={{-88,92},{-88,-74},{-53,-74}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.KCell_conc, skeletalMuscle.KCell)
            annotation (Line(
              points={{-88,92},{-87.5,92},{-87.5,74},{-53,74}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

          connect(busConnector.bone_cLactate, bone.cLactate)        annotation (
             Line(
              points={{-88,92},{-88,42},{-53,42}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain_cLactate, brain.cLactate)
            annotation (Line(
              points={{-88,92},{6,92},{6,34},{53,34}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat_cLactate, fat.cLactate)      annotation (
              Line(
              points={{-88,92},{-88,-48},{-53,-48}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract_cLactate, GITract.cLactate)
            annotation (Line(
              points={{-88,92},{6,92},{6,4},{53,4}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_cLactate, kidney.cLactate)
            annotation (Line(
              points={{-88,92},{6,92},{6,-26},{53,-26}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_cLactate, leftHeart.cLactate)
            annotation (Line(
              points={{-88,92},{6,92},{6,-56},{53,-56}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_cLactate, liver.cLactate)
            annotation (Line(
              points={{-88,92},{6,92},{6,66},{53,66}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue_cLactate, otherTissue.cLactate)
            annotation (Line(
              points={{-88,92},{-88,12},{-53,12}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle_cLactate, respiratoryMuscle.cLactate)
            annotation (Line(
              points={{-88,92},{-88,-18},{-53,-18}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_cLactate, rightHeart.cLactate)
            annotation (Line(
              points={{-88,92},{6,92},{6,-86},{53,-86}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_cLactate, skin.cLactate)      annotation (
             Line(
              points={{-88,92},{-88,-78},{-53,-78}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle_cLactate, skeletalMuscle.cLactate)
            annotation (Line(
              points={{-88,92},{-87.5,92},{-87.5,70},{-53,70}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

         connect(busConnector.bone.pCO2, bone.pCO2)        annotation (
             Line(
              points={{-88,92},{-88,54},{-53,54}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.brain.pCO2, brain.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,46},{53,46}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.fat.pCO2, fat.pCO2)      annotation (
              Line(
              points={{-88,92},{-88,-36},{-53,-36}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.GITract.pCO2, GITract.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,16},{53,16}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.kidney_pCO2, kidney.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,-14},{53,-14}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.leftHeart_pCO2, leftHeart.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,-44},{53,-44}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.liver_pCO2, liver.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,78},{53,78}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.otherTissue.pCO2, otherTissue.pCO2)
            annotation (Line(
              points={{-88,92},{-88,24},{-53,24}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.respiratoryMuscle.pCO2, respiratoryMuscle.pCO2)
            annotation (Line(
              points={{-88,92},{-88,-6},{-53,-6}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.rightHeart_pCO2, rightHeart.pCO2)
            annotation (Line(
              points={{-88,92},{6,92},{6,-74},{53,-74}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skin_pCO2, skin.pCO2)      annotation (
             Line(
              points={{-88,92},{-88,-66},{-53,-66}},
              color={0,127,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));
          connect(busConnector.skeletalMuscle.pCO2, skeletalMuscle.pCO2)
            annotation (Line(
              points={{-88,92},{-87.5,92},{-87.5,82},{-53,82}},
              color={127,0,0},
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-5,2},{-5,2}}));

        connect(bone.pH, busConnector.bone_pH_intracellular) annotation (Line(
              points={{-38,34},{6,34},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(brain.pH, busConnector.brain_pH_intracellular) annotation (Line(
              points={{68,26},{6,26},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(fat.pH, busConnector.fat_pH_intracellular) annotation (Line(
              points={{-38,-56},{6,-56},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(GITract.pH, busConnector.GITract_pH_intracellular) annotation (Line(
              points={{68,-4},{6,-4},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(kidney.pH, busConnector.kidney_pH_intracellular) annotation (Line(
              points={{68,-34},{6,-34},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(leftHeart.pH, busConnector.leftHeart_pH_intracellular) annotation (Line(
              points={{68,-64},{6,-64},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(liver.pH, busConnector.liver_pH_intracellular) annotation (Line(
              points={{68,58},{6,58},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(otherTissue.pH, busConnector.otherTissue_pH_intracellular) annotation (Line(
              points={{-38,4},{6,4},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(rightHeart.pH, busConnector.rightHeart_pH_intracellular) annotation (Line(
              points={{68,-94},{6,-94},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(respiratoryMuscle.pH, busConnector.respiratoryMuscle_pH_intracellular) annotation (Line(
              points={{-38,-26},{6,-26},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(skin.pH, busConnector.skin_pH_intracellular) annotation (Line(
              points={{-38,-86},{6,-86},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));
         connect(skeletalMuscle.pH, busConnector.skeletalMuscle_pH_intracellular) annotation (Line(
              points={{-38,62},{6,62},{6,92},{-88,92}},
              color={0,0,127},
              smooth=Smooth.None));

          annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                    -100},{100,100}}), graphics={
                Rectangle(
                  extent={{-100,100},{100,-100}},
                  lineColor={0,0,255},
                  fillColor={215,215,215},
                  fillPattern=FillPattern.Solid),
                Text(
                  extent={{-96,-62},{98,-94}},
                  lineColor={0,0,255},
                  textString="%name"),
                Text(
                  extent={{-90,0},{-26,28}},
                  lineColor={0,0,0},
                  textString="ICF"),
                Text(
                  extent={{28,30},{94,-24}},
                  lineColor={0,0,0},
                  textString="pH")}),
            Documentation(info="<html>
<p>BE_interstitial is base excess in the interstitium of the tissue. The standard value is 0, when strong acid concentration increase, then BE value decrease with the same concentration. </p>
<p>Meaning might be interpreted like what amount of hydrogen iont must be added to sollution if the end poit of titration will be pH=7.4 and pCO2=5.3kPa.</p>
<p>For any tissue can be simplified with difference of lactate concentration from its normal value.</p>
</html>",         revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end Cells;

        model CellBase
         parameter Real CellSID_OtherCations(final displayUnit="mEq/l") = 12;
         parameter Real CellSID_StrongAnions(final displayUnit="mEq/l") = 117;
          Physiolibrary.Types.RealIO.ConcentrationInput KCell(
                                              final displayUnit="mEq/l")
          "tissue interstitial titratable acidity"
                                           annotation (Placement(transformation(extent={{-94,4},
                    {-54,44}}),           iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,0})));
          Physiolibrary.Types.RealIO.ConcentrationInput cLactate(
                                                 final displayUnit="mEq/l")
          "tissue lactate concentration"   annotation (Placement(transformation(extent={{-78,-86},
                    {-62,-70}}),          iconTransformation(extent={{-10,-10},{10,10}},
                origin={-90,-40})));
          Physiolibrary.Types.RealIO.pHOutput pH "tissue intracellular pH"            annotation (Placement(
                transformation(extent={{66,-42},{86,-22}}), iconTransformation(
                extent={{-20,-20},{20,20}},
                rotation=270,
                origin={60,-120})));
          Physiolibrary.Types.RealIO.PressureInput pCO2(
                                             final displayUnit="mmHg")
          "tissue partial CO2 pressure"    annotation (Placement(transformation(extent={{-28,-38},
                    {-10,-20}}),         iconTransformation(
                extent={{-10,-10},{10,10}},
                origin={-90,80})));
          Modelica.Blocks.Math.Add cations                                                                                                 annotation (Placement(transformation(extent={{-28,8},
                    {-8,28}})));
          Modelica.Blocks.Math.Add anions                                                                                                   annotation (Placement(transformation(extent={{-32,-82},
                    {-12,-62}})));
          Modelica.Blocks.Math.Feedback SID "intracellular"                                                                                          annotation (Placement(transformation(extent={{-4,8},{
                    16,28}})));
        Physiolibrary.Types.Constants.ConcentrationConst
          electrolytesConcentrationConstant_per_l1(k=(CellSID_OtherCations))
          annotation (Placement(transformation(extent={{-76,-12},{-56,8}})));
        Physiolibrary.Types.Constants.ConcentrationConst
          electrolytesConcentrationConstant_per_l2(k=(CellSID_StrongAnions))
          annotation (Placement(transformation(extent={{-76,-60},{-56,-40}})));
          Modelica.Blocks.Math.Division division
            annotation (Placement(transformation(extent={{32,2},{52,22}})));
          Modelica.Blocks.Math.Log10 log10_1
            annotation (Placement(transformation(extent={{66,2},{86,22}})));
          Modelica.Blocks.Math.Add add1
            annotation (Placement(transformation(extent={{46,-42},{66,-22}})));
        Physiolibrary.Types.Constants.pHConst                   const(k=7.15 -
              log10(760/101325))
          "The RQ in brain calculation from KA/Glu ratio instead of 0.8 gives 1.25 time more CO2!"
          annotation (Placement(transformation(extent={{14,-48},{34,-28}})));
          Modelica.Blocks.Math.Max max
            annotation (Placement(transformation(extent={{16,-18},{24,-10}})));
        Physiolibrary.Types.Constants.PressureConst             PCO2_min_value(k(
              displayUnit="mmHg") = 0.133322387415)
          annotation (Placement(transformation(extent={{-10,-12},{-2,-4}})));
        Physiolibrary.Types.Constants.ConcentrationConst maxH(k=10^(-7.15)*(760
              /101325))
          annotation (Placement(transformation(extent={{28,52},{36,60}})));
          Modelica.Blocks.Math.Max max1
            annotation (Placement(transformation(extent={{54,46},{62,54}})));
        equation

          connect(anions.y, SID.u2)                                                                                                   annotation (Line(       points={{-11,-72},
                  {6,-72},{6,10}},                                                                                                    color={0,0,127},       smooth=Smooth.None));
          connect(cations.y, SID.u1)                                                                                                 annotation (Line(       points={{-7,18},
                  {-2,18}},                                                                                                   color={0,0,127},       smooth=Smooth.None));
          connect(electrolytesConcentrationConstant_per_l1.y, cations.u2)                                                                                                 annotation (Line(       points={{-53.5,
                -2},{-36,-2},{-36,12},{-30,12}},                                                                                                  color={0,0,127},       smooth=Smooth.None));
          connect(electrolytesConcentrationConstant_per_l2.y, anions.u1)                                                                                                   annotation (Line(       points={{-53.5,
                -50},{-42,-50},{-42,-66},{-34,-66}},                                                                                                 color={0,0,127},       smooth=Smooth.None));
          connect(KCell, cations.u1)
                                 annotation (Line(
              points={{-74,24},{-30,24}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(cLactate, anions.u2)
                                     annotation (Line(
              points={{-70,-78},{-34,-78}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(log10_1.y, add1.u1) annotation (Line(
              points={{87,12},{92,12},{92,-6},{40,-6},{40,-26},{44,-26}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(add1.y, pH) annotation (Line(
              points={{67,-32},{76,-32}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(const.y, add1.u2) annotation (Line(
              points={{36.5,-38},{44,-38}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(SID.y, division.u1) annotation (Line(
              points={{15,18},{30,18}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(max.y, division.u2) annotation (Line(
              points={{24.4,-14},{26,-14},{26,6},{30,6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(pCO2, max.u2) annotation (Line(
              points={{-19,-29},{-3.5,-29},{-3.5,-16.4},{15.2,-16.4}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(PCO2_min_value.y, max.u1) annotation (Line(
              points={{-1,-8},{8.2,-8},{8.2,-11.6},{15.2,-11.6}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(maxH.y, max1.u1) annotation (Line(
            points={{37,56},{46,56},{46,52.4},{53.2,52.4}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(max1.u2, division.y) annotation (Line(
              points={{53.2,47.6},{53.2,29.8},{53,29.8},{53,12}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(max1.y, log10_1.u) annotation (Line(
              points={{62.4,50},{64,50},{64,12}},
              color={0,0,127},
              smooth=Smooth.None));
          annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
                  extent={{-100,-100},{100,100}}), graphics={
                Text(
                  extent={{34,102},{100,48}},
                  lineColor={0,0,0},
                  textString="pH"),
                Text(
                  extent={{-84,72},{-20,100}},
                  lineColor={0,0,0},
                  textString="ICF"),
                Rectangle(extent={{-100,100},{100,-100}}, lineColor={0,0,0})}),
            Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end CellBase;

        package Cell
           model SkeletalMuscleIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.SkeletalMuscle;
           end SkeletalMuscleIntracellularPh;

          model BoneIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.Bone;
          end BoneIntracellularPh;

          model OtherTissueIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.OtherTissue;
          end OtherTissueIntracellularPh;

          model RespiratoryMuscleIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.RespiratoryMuscle;
          end RespiratoryMuscleIntracellularPh;

          model FatIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.Fat;
          end FatIntracellularPh;

          model SkinIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.Skin;
          end SkinIntracellularPh;

          model LiverIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.Liver;
          end LiverIntracellularPh;

          model BrainIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.Brain;
          end BrainIntracellularPh;

          model GITractIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.GITract;
          end GITractIntracellularPh;

          model KidneyIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.Kidney;
          end KidneyIntracellularPh;

          model LeftHeartIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.LeftHeart;
          end LeftHeartIntracellularPh;

          model RightHeartIntracellularPh
            extends CellBase;
            extends Physiolibrary.Icons.RightHeart;
          end RightHeartIntracellularPh;
        end Cell;

        package old
          model TissuesPh
          Blood.SkeletalMuscleBloodPh skeletalMuscle
            annotation (Placement(transformation(extent={{-54,66},{-34,86}})));

          Blood.BoneBloodPh bone
            annotation (Placement(transformation(extent={{-54,36},{-34,56}})));

          Blood.FatBloodPh fat annotation (Placement(transformation(extent={{-54,
                    -54},{-34,-34}})));

          Blood.BrainBloodPh brain
            annotation (Placement(transformation(extent={{52,28},{72,48}})));

          Blood.RightHeartBloodPh rightHeart
            annotation (Placement(transformation(extent={{52,-92},{72,-72}})));

          Blood.RespiratoryMuscleBloodPh respiratoryMuscle
            annotation (Placement(transformation(extent={{-54,-24},{-34,-4}})));

          Blood.OtherTissueBloodPh otherTissue
            annotation (Placement(transformation(extent={{-54,6},{-34,26}})));

          Blood.LiverBloodPh liver
            annotation (Placement(transformation(extent={{52,60},{72,80}})));

          Blood.LeftHeartBloodPh leftHeart
            annotation (Placement(transformation(extent={{52,-62},{72,-42}})));

          Blood.KidneyBloodPh kidney
            annotation (Placement(transformation(extent={{52,-32},{72,-12}})));

          Blood.GITractBloodPh GITract
            annotation (Placement(transformation(extent={{52,-2},{72,18}})));

          Physiolibrary.Types.BusConnector busConnector annotation (Placement(
                transformation(extent={{-108,72},{-68,112}})));
          Blood.SkinBloodPh skin annotation (Placement(transformation(extent={{
                    -54,-84},{-34,-64}})));

          equation
            connect(busConnector.bone_sO2, bone.sO2)        annotation (
               Line(
                points={{-88,92},{-88,57},{-38,57}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.brain_sO2, brain.sO2)
              annotation (Line(
                points={{-88,92},{6,92},{6,49},{68,49}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.fat_sO2, fat.sO2)      annotation (
                Line(
                points={{-88,92},{-88,-33},{-38,-33}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.GITract_sO2, GITract.sO2)
              annotation (Line(
                points={{-88,92},{6,92},{6,19},{68,19}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.kidney_sO2, kidney.sO2)
              annotation (Line(
                points={{-88,92},{6,92},{6,-11},{68,-11}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.leftHeart_sO2, leftHeart.sO2)
              annotation (Line(
                points={{-88,92},{6,92},{6,-41},{68,-41}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.liver_sO2, liver.sO2)
              annotation (Line(
                points={{-88,92},{6,92},{6,81},{68,81}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.otherTissue_sO2, otherTissue.sO2)
              annotation (Line(
                points={{-88,92},{-88,27},{-38,27}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.respiratoryMuscle_sO2, respiratoryMuscle.sO2)
              annotation (Line(
                points={{-88,92},{-88,-3},{-38,-3}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.rightHeart_sO2, rightHeart.sO2)
              annotation (Line(
                points={{-88,92},{6,92},{6,-71},{68,-71}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.skin_sO2, skin.sO2)      annotation (
               Line(
                points={{-88,92},{-88,-63},{-38,-63}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.skeletalMuscle_sO2, skeletalMuscle.sO2)
              annotation (Line(
                points={{-88,92},{-87.5,92},{-87.5,87},{-38,87}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));

           connect(busConnector.bone_T, bone.T)        annotation (
               Line(
                points={{-88,92},{-88,38.8},{-53,38.8}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.brain_T, brain.T)
              annotation (Line(
                points={{-88,92},{6,92},{6,30.8},{53,30.8}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.fat_T, fat.T)      annotation (
                Line(
                points={{-88,92},{-88,-51.2},{-53,-51.2}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.GITract_T, GITract.T)
              annotation (Line(
                points={{-88,92},{6,92},{6,0.8},{53,0.8}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.kidney_T, kidney.T)
              annotation (Line(
                points={{-88,92},{6,92},{6,-29.2},{53,-29.2}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.leftHeart_T, leftHeart.T)
              annotation (Line(
                points={{-88,92},{6,92},{6,-59.2},{53,-59.2}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.liver_T, liver.T)
              annotation (Line(
                points={{-88,92},{6,92},{6,62.8},{53,62.8}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.otherTissue_T, otherTissue.T)
              annotation (Line(
                points={{-88,92},{-88,8.8},{-53,8.8}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.respiratoryMuscle_T, respiratoryMuscle.T)
              annotation (Line(
                points={{-88,92},{-88,-21.2},{-53,-21.2}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.rightHeart_T, rightHeart.T)
              annotation (Line(
                points={{-88,92},{6,92},{6,-89.2},{53,-89.2}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.skin_T, skin.T)      annotation (
               Line(
                points={{-88,92},{-88,-81.2},{-53,-81.2}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.skeletalMuscle_T, skeletalMuscle.T)
              annotation (Line(
                points={{-88,92},{-87.5,92},{-87.5,68.8},{-53,68.8}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));

           connect(busConnector.bone_cTH_interstitial, bone.ctHox)        annotation (
               Line(
                points={{-88,92},{-88,50},{-53,50}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.brain_cTH_interstitial, brain.ctHox)
              annotation (Line(
                points={{-88,92},{6,92},{6,42},{53,42}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.fat_cTH_interstitial, fat.ctHox)      annotation (
                Line(
                points={{-88,92},{-88,-40},{-53,-40}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.GITract_cTH_interstitial, GITract.ctHox)
              annotation (Line(
                points={{-88,92},{6,92},{6,12},{53,12}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.kidney_cTH_interstitial, kidney.ctHox)
              annotation (Line(
                points={{-88,92},{6,92},{6,-18},{53,-18}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.leftHeart_cTH_interstitial, leftHeart.ctHox)
              annotation (Line(
                points={{-88,92},{6,92},{6,-48},{53,-48}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.liver_cTH_interstitial, liver.ctHox)
              annotation (Line(
                points={{-88,92},{6,92},{6,74},{53,74}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.otherTissue_cTH_interstitial, otherTissue.ctHox)
              annotation (Line(
                points={{-88,92},{-88,20},{-53,20}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.respiratoryMuscle_cTH_interstitial, respiratoryMuscle.ctHox)
              annotation (Line(
                points={{-88,92},{-88,-10},{-53,-10}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.rightHeart_cTH_interstitial, rightHeart.ctHox)
              annotation (Line(
                points={{-88,92},{6,92},{6,-78},{53,-78}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.skin_cTH_interstitial, skin.ctHox)      annotation (
               Line(
                points={{-88,92},{-88,-70},{-53,-70}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));
            connect(busConnector.skeletalMuscle_cTH_interstitial, skeletalMuscle.ctHox)
              annotation (Line(
                points={{-88,92},{-87.5,92},{-87.5,80},{-53,80}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%first",
                index=-1,
                extent={{-5,2},{-5,2}}));

            connect(bone.ctHb, busConnector.ctHb)       annotation (
               Line(
                points={{-35,50},{6,50},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{71,42},{98,42},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.ctHb, busConnector.ctHb)     annotation (
                Line(
                points={{-35,-40},{6,-40},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{71,12},{98,12},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{71,-18},{98,-18},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{71,-48},{98,-48},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{71,74},{98,74},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{-35,20},{6,20},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{-35,-10},{6,-10},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{71,-78},{98,-78},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.ctHb, busConnector.ctHb)     annotation (
               Line(
                points={{-35,-70},{6,-70},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.ctHb, busConnector.ctHb)
              annotation (Line(
                points={{-35,80},{5.5,80},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

            connect(bone.ctAlb, busConnector.ctAlb)       annotation (
               Line(
                points={{-35,46},{6,46},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{71,38},{98,38},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.ctAlb, busConnector.ctAlb)     annotation (
                Line(
                points={{-35,-44},{6,-44},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{71,8},{98,8},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{71,-22},{98,-22},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{71,-52},{98,-52},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{71,70},{98,70},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{-35,16},{6,16},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{-35,-14},{6,-14},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{71,-82},{98,-82},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.ctAlb, busConnector.ctAlb)     annotation (
               Line(
                points={{-35,-74},{6,-74},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.ctAlb, busConnector.ctAlb)
              annotation (Line(
                points={{-35,76},{5.5,76},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

           connect(bone.ctGlb, busConnector.ctGlb)       annotation (
               Line(
                points={{-35,42},{6,42},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{71,34},{98,34},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.ctGlb, busConnector.ctGlb)     annotation (
                Line(
                points={{-35,-48},{6,-48},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{71,4},{98,4},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{71,-26},{98,-26},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{71,-56},{98,-56},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{71,66},{98,66},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{-35,12},{6,12},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{-35,-18},{6,-18},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{71,-86},{98,-86},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.ctGlb, busConnector.ctGlb)     annotation (
               Line(
                points={{-35,-78},{6,-78},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.ctGlb, busConnector.ctGlb)
              annotation (Line(
                points={{-35,72},{5.5,72},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

           connect(bone.ctPO4, busConnector.ctPO4)       annotation (
               Line(
                points={{-35,38},{6,38},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{71,30},{98,30},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.ctPO4, busConnector.ctPO4)     annotation (
                Line(
                points={{-35,-52},{6,-52},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{71,0},{98,0},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{71,-30},{98,-30},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{71,-60},{98,-60},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{71,62},{98,62},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{-35,8},{6,8},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{-35,-22},{6,-22},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{71,-90},{98,-90},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.ctPO4, busConnector.ctPO4)     annotation (
               Line(
                points={{-35,-82},{6,-82},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.ctPO4, busConnector.ctPO4)
              annotation (Line(
                points={{-35,68},{5.5,68},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

            connect(bone.cHCO3, busConnector.bone_cHCO3)        annotation (
               Line(
                points={{-35,54},{6,54},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.cHCO3, busConnector.brain_cHCO3)
              annotation (Line(
                points={{71,46},{98,46},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.cHCO3, busConnector.fat_cHCO3)     annotation (
                Line(
                points={{-35,-36},{6,-36},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.cHCO3, busConnector.GITract_cHCO3)
              annotation (Line(
                points={{71,16},{98,16},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.cHCO3, busConnector.kidney_cHCO3)
              annotation (Line(
                points={{71,-14},{98,-14},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.cHCO3, busConnector.leftHeart_cHCO3)
              annotation (Line(
                points={{71,-44},{98,-44},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.cHCO3, busConnector.liver_cHCO3)
              annotation (Line(
                points={{71,78},{98,78},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.cHCO3, busConnector.otherTissue_cHCO3)
              annotation (Line(
                points={{-35,24},{6,24},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.cHCO3, busConnector.respiratoryMuscle_cHCO3)
              annotation (Line(
                points={{-35,-6},{6,-6},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.cHCO3, busConnector.rightHeart_cHCO3)
              annotation (Line(
                points={{71,-74},{98,-74},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.cHCO3, busConnector.skin_cHCO3)     annotation (
               Line(
                points={{-35,-66},{6,-66},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.cHCO3, busConnector.skeletalMuscle_cHCO3)
              annotation (Line(
                points={{-35,84},{5.5,84},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

            connect(bone.pH_ery, busConnector.bone_pH_ery) annotation (Line(
                points={{-42,34},{6,34},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(brain.pH_ery, busConnector.brain_pH_ery) annotation (Line(
                points={{64,26},{6,26},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(fat.pH_ery, busConnector.fat_pH_ery) annotation (Line(
                points={{-42,-56},{6,-56},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(GITract.pH_ery, busConnector.GITract_pH_ery) annotation (Line(
                points={{64,-4},{6,-4},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(kidney.pH_ery, busConnector.kidney_pH_ery) annotation (Line(
                points={{64,-34},{6,-34},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(leftHeart.pH_ery, busConnector.leftHeart_pH_ery) annotation (Line(
                points={{64,-64},{6,-64},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(liver.pH_ery, busConnector.liver_pH_ery) annotation (Line(
                points={{64,58},{6,58},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(otherTissue.pH_ery, busConnector.otherTissue_pH_ery) annotation (Line(
                points={{-42,4},{6,4},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(rightHeart.pH_ery, busConnector.rightHeart_pH_ery) annotation (Line(
                points={{64,-94},{6,-94},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(respiratoryMuscle.pH_ery, busConnector.respiratoryMuscle_pH_ery) annotation (Line(
                points={{-42,-26},{6,-26},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(skin.pH_ery, busConnector.skin_pH_ery) annotation (Line(
                points={{-42,-86},{6,-86},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(skeletalMuscle.pH_ery, busConnector.skeletalMuscle_pH_ery) annotation (Line(
                points={{-42,64},{6,64},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));

           connect(bone.pH, busConnector.bone_pH_plasma) annotation (Line(
                points={{-46,34},{6,34},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(brain.pH, busConnector.brain_pH_plasma) annotation (Line(
                points={{60,26},{6,26},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(fat.pH, busConnector.fat_pH_plasma) annotation (Line(
                points={{-46,-56},{6,-56},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
                 connect(GITract.pH, busConnector.GITract_pH_plasma) annotation (Line(
                points={{60,-4},{6,-4},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(kidney.pH, busConnector.kidney_pH_plasma) annotation (Line(
                points={{60,-34},{6,-34},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(leftHeart.pH, busConnector.leftHeart_pH_plasma) annotation (Line(
                points={{60,-64},{6,-64},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(liver.pH, busConnector.liver_pH_plasma) annotation (Line(
                points={{60,58},{6,58},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(otherTissue.pH, busConnector.otherTissue_pH_plasma) annotation (Line(
                points={{-46,4},{6,4},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(rightHeart.pH, busConnector.rightHeart_pH_plasma) annotation (Line(
                points={{60,-94},{6,-94},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(respiratoryMuscle.pH, busConnector.respiratoryMuscle_pH_plasma) annotation (Line(
                points={{-46,-26},{6,-26},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(skin.pH, busConnector.skin_pH_plasma) annotation (Line(
                points={{-46,-86},{6,-86},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(skeletalMuscle.pH, busConnector.skeletalMuscle_pH_plasma) annotation (Line(
                points={{-46,64},{6,64},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));

            annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                      -100},{100,100}}), graphics={
                  Rectangle(
                    extent={{-100,100},{100,-100}},
                    lineColor={0,0,255},
                    fillColor={215,215,215},
                    fillPattern=FillPattern.Solid),
                  Text(
                    extent={{-96,-62},{98,-94}},
                    lineColor={0,0,255},
                    textString="%name"),
                  Text(
                    extent={{-94,12},{-10,40}},
                    lineColor={0,0,0},
                    textString="Blood"),
                  Text(
                    extent={{32,40},{98,-14}},
                    lineColor={0,0,0},
                    textString="pH")}),
              Documentation(info="<html>
<p>BE_interstitial is base excess in the interstitium of the tissue. The standard value is 0, when strong acid concentration increase, then BE value decrease with the same concentration. </p>
<p>Meaning might be interpreted like what amount of hydrogen iont must be added to sollution if the end poit of titration will be pH=7.4 and pCO2=5.3kPa.</p>
<p>For any tissue can be simplified with difference of lactate concentration from its normal value.</p>
</html>",           revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>dec 2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
          end TissuesPh;

          model Tissues_cTH
           extends Physiolibrary.Icons.Tissues;
          Interstitium.SkeletalMuscleAcidity skeletalMuscle
            annotation (Placement(transformation(extent={{-54,66},{-34,86}})));

          Interstitium.BoneAcidity bone
            annotation (Placement(transformation(extent={{-54,36},{-34,56}})));

          Interstitium.FatAcidity fat annotation (Placement(transformation(
                  extent={{-54,-54},{-34,-34}})));

          Interstitium.BrainAcidity brain
            annotation (Placement(transformation(extent={{52,22},{72,42}})));

          Interstitium.RightHeartAcidity rightHeart
            annotation (Placement(transformation(extent={{52,-98},{72,-78}})));

          Interstitium.RespiratoryMuscleAcidity respiratoryMuscle
            annotation (Placement(transformation(extent={{-54,-24},{-34,-4}})));

          Interstitium.OtherTissueAcidity otherTissue
            annotation (Placement(transformation(extent={{-54,6},{-34,26}})));

          Interstitium.LiverAcidity liver
            annotation (Placement(transformation(extent={{52,52},{72,72}})));

          Interstitium.LeftHeartAcidity leftHeart
            annotation (Placement(transformation(extent={{52,-68},{72,-48}})));

          Interstitium.KidneyAcidity kidney
            annotation (Placement(transformation(extent={{52,-38},{72,-18}})));

          Interstitium.GITractAcidity GITract
            annotation (Placement(transformation(extent={{52,-8},{72,12}})));

          Physiolibrary.Types.BusConnector busConnector annotation (Placement(
                transformation(extent={{-108,72},{-68,112}})));
          Interstitium.SkinAcidity skin annotation (Placement(transformation(
                  extent={{-54,-84},{-34,-64}})));

          Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
              Placement(transformation(extent={{82,80},{96,92}}),
                iconTransformation(extent={{-110,-6},{-90,14}})));
          Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
              Placement(transformation(extent={{-98,66},{-84,78}}),
                iconTransformation(extent={{90,-10},{110,10}})));

            Physiolibrary.Types.MolarFlowRate cTHfromTissues;//(displayUnit="mEq/min");
          equation
            cTHfromTissues = -( q_out.q + q_in.q);

          connect(bone.BloodFlow, busConnector.bone_BloodFlow)        annotation (
               Line(
                points={{-35,54},{6,54},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.BloodFlow, busConnector.brain_BloodFlow)
              annotation (Line(
                points={{71,40},{98,40},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.BloodFlow, busConnector.fat_BloodFlow)     annotation (
                Line(
                points={{-35,-36},{6,-36},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.BloodFlow, busConnector.GITract_BloodFlow)
              annotation (Line(
                points={{71,10},{98,10},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.BloodFlow, busConnector.kidney_BloodFlow)
              annotation (Line(
                points={{71,-20},{98,-20},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.BloodFlow, busConnector.leftHeart_BloodFlow)
              annotation (Line(
                points={{71,-50},{98,-50},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.BloodFlow, busConnector.Liver_BloodFlow)
              annotation (Line(
                points={{71,70},{98,70},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.BloodFlow, busConnector.otherTissue_BloodFlow)
              annotation (Line(
                points={{-35,24},{6,24},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.BloodFlow, busConnector.respiratoryMuscle_BloodFlow)
              annotation (Line(
                points={{-35,-6},{6,-6},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.BloodFlow, busConnector.rightHeart_BloodFlow)
              annotation (Line(
                points={{71,-80},{98,-80},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.BloodFlow, busConnector.skin_BloodFlow)     annotation (
               Line(
                points={{-35,-66},{6,-66},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.BloodFlow, busConnector.skeletalMuscle_BloodFlow)
              annotation (Line(
                points={{-35,84},{5.5,84},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

            connect(bone.LactateFromMetabolism, busConnector.bone_LactateFromMetabolism)        annotation (
               Line(
                points={{-35,40},{6,40},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.LactateFromMetabolism, busConnector.brain_LactateFromMetabolism)
              annotation (Line(
                points={{71,26},{98,26},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.LactateFromMetabolism, busConnector.fat_LactateFromMetabolism)     annotation (
                Line(
                points={{-35,-50},{6,-50},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.LactateFromMetabolism, busConnector.GITract_LactateFromMetabolism)
              annotation (Line(
                points={{71,-4},{98,-4},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.LactateFromMetabolism, busConnector.kidney_LactateFromMetabolism)
              annotation (Line(
                points={{71,-34},{98,-34},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.LactateFromMetabolism, busConnector.leftHeart_LactateFromMetabolism)
              annotation (Line(
                points={{71,-64},{98,-64},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.LactateFromMetabolism, busConnector.liver_LactateFromMetabolism)
              annotation (Line(
                points={{71,56},{98,56},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.LactateFromMetabolism, busConnector.otherTissue_LactateFromMetabolism)
              annotation (Line(
                points={{-35,10},{6,10},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.LactateFromMetabolism, busConnector.respiratoryMuscle_LactateFromMetabolism)
              annotation (Line(
                points={{-35,-20},{6,-20},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.LactateFromMetabolism, busConnector.rightHeart_LactateFromMetabolism)
              annotation (Line(
                points={{71,-94},{98,-94},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.LactateFromMetabolism, busConnector.skin_LactateFromMetabolism)     annotation (
               Line(
                points={{-35,-80},{6,-80},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.LactateFromMetabolism, busConnector.skeletalMuscle_LactateFromMetabolism)
              annotation (Line(
                points={{-35,70},{5.5,70},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

          connect(bone.InterstitialWater, busConnector.bone_InterstitialWater)        annotation (
               Line(
                points={{-35,50},{6,50},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(brain.InterstitialWater, busConnector.brain_InterstitialWater)
              annotation (Line(
                points={{71,36},{98,36},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(fat.InterstitialWater, busConnector.fat_InterstitialWater)     annotation (
                Line(
                points={{-35,-40},{6,-40},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(GITract.InterstitialWater, busConnector.GITract_InterstitialWater)
              annotation (Line(
                points={{71,6},{98,6},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(kidney.InterstitialWater, busConnector.kidney_InterstitialWater)
              annotation (Line(
                points={{71,-24},{98,-24},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(leftHeart.InterstitialWater, busConnector.leftHeart_InterstitialWater)
              annotation (Line(
                points={{71,-54},{98,-54},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(liver.InterstitialWater, busConnector.liver_InterstitialWater)
              annotation (Line(
                points={{71,66},{98,66},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(otherTissue.InterstitialWater, busConnector.otherTissue_InterstitialWater)
              annotation (Line(
                points={{-35,20},{6,20},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(respiratoryMuscle.InterstitialWater, busConnector.respiratoryMuscle_InterstitialWater)
              annotation (Line(
                points={{-35,-10},{6,-10},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(rightHeart.InterstitialWater, busConnector.rightHeart_InterstitialWater)
              annotation (Line(
                points={{71,-84},{98,-84},{98,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skin.InterstitialWater, busConnector.skin_InterstitialWater)     annotation (
               Line(
                points={{-35,-70},{6,-70},{6,92},{-88,92}},
                color={0,127,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));
            connect(skeletalMuscle.InterstitialWater, busConnector.skeletalMuscle_InterstitialWater)
              annotation (Line(
                points={{-35,80},{5.5,80},{5.5,92},{-88,92}},
                color={127,0,0},
                smooth=Smooth.None), Text(
                string="%second",
                index=1,
                extent={{5,2},{5,2}}));

           connect(bone.cTH, busConnector.bone_cTH_interstitial) annotation (Line(
                points={{-42,34},{6,34},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(brain.cTH, busConnector.brain_cTH_interstitial) annotation (Line(
                points={{64,20},{6,20},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(fat.cTH, busConnector.fat_cTH_interstitial) annotation (Line(
                points={{-42,-56},{6,-56},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
                 connect(GITract.cTH, busConnector.GITract_cTH_interstitial) annotation (Line(
                points={{64,-10},{6,-10},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(kidney.cTH, busConnector.kidney_cTH_interstitial) annotation (Line(
                points={{64,-40},{6,-40},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(leftHeart.cTH, busConnector.leftHeart_cTH_interstitial) annotation (Line(
                points={{64,-70},{6,-70},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
           connect(otherTissue.cTH, busConnector.otherTissue_cTH_interstitial) annotation (Line(
                points={{-42,4},{6,4},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
             connect(rightHeart.cTH, busConnector.rightHeart_cTH_interstitial) annotation (Line(
                points={{64,-100},{6,-100},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(respiratoryMuscle.cTH, busConnector.respiratoryMuscle_cTH_interstitial) annotation (Line(
                points={{-42,-26},{6,-26},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(skin.cTH, busConnector.skin_cTH_interstitial) annotation (Line(
                points={{-42,-86},{6,-86},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(skeletalMuscle.cTH, busConnector.skeletalMuscle_cTH_interstitial) annotation (Line(
                points={{-42,64},{6,64},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));

            connect(skeletalMuscle.q_out, q_out) annotation (Line(
                points={{-34,76},{89,76},{89,86}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, liver.q_out) annotation (Line(
                points={{89,86},{89,62},{72,62}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(bone.q_out, q_out) annotation (Line(
                points={{-34,46},{89,46},{89,86}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, brain.q_out) annotation (Line(
                points={{89,86},{89,32},{72,32}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, GITract.q_out) annotation (Line(
                points={{89,86},{89,2},{72,2}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, otherTissue.q_out) annotation (Line(
                points={{89,86},{89,16},{-34,16}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, kidney.q_out) annotation (Line(
                points={{89,86},{89,-28},{72,-28}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, respiratoryMuscle.q_out) annotation (Line(
                points={{89,86},{89,-14},{-34,-14}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, leftHeart.q_out) annotation (Line(
                points={{89,86},{89,-58},{72,-58}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, fat.q_out) annotation (Line(
                points={{89,86},{89,-44},{-34,-44}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, skin.q_out) annotation (Line(
                points={{89,86},{89,-74},{-34,-74}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_out, rightHeart.q_out) annotation (Line(
                points={{89,86},{89,-88},{72,-88}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));

           connect(skeletalMuscle.q_in, q_in) annotation (Line(
                points={{-54,76},{-91,76},{-91,72}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, liver.q_in) annotation (Line(
                points={{-91,72},{-91,62},{52,62}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(bone.q_in, q_in) annotation (Line(
                points={{-54,46},{-91,46},{-91,72}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, brain.q_in) annotation (Line(
                points={{-91,72},{-91,32},{52,32}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, GITract.q_in) annotation (Line(
                points={{-91,72},{-91,2},{52,2}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, otherTissue.q_in) annotation (Line(
                points={{-91,72},{-91,16},{-54,16}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, kidney.q_in) annotation (Line(
                points={{-91,72},{-91,-28},{52,-28}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, respiratoryMuscle.q_in) annotation (Line(
                points={{-91,72},{-91,-14},{-54,-14}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, leftHeart.q_in) annotation (Line(
                points={{-91,72},{-91,-58},{52,-58}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, fat.q_in) annotation (Line(
                points={{-91,72},{-91,-44},{-54,-44}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, skin.q_in) annotation (Line(
                points={{-91,72},{-91,-74},{-54,-74}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(q_in, rightHeart.q_in) annotation (Line(
                points={{-91,72},{-91,-88},{52,-88}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(liver.cTH, busConnector.liver_cTH_interstitial) annotation (
                Line(
                points={{64,50},{6,50},{6,92},{-88,92}},
                color={0,0,127},
                smooth=Smooth.None));
            annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                      -100},{100,100}}), graphics={Rectangle(extent={{-100,100},{
                        100,-100}}, lineColor={0,0,0}), Text(
                    extent={{-118,-104},{130,-130}},
                    lineColor={0,0,127},
                    textString="%name")}),
              Documentation(info="<html>
<p>cTH_interstitial is base excess in the interstitium of the tissue. The standard value is 0, when strong acid concentration increase, then  value decrease with the same concentration. </p>
<p>Meaning might  interpreted like what amount of hydrogen iont must  added to sollution if the end poit of titration will  pH=7.4 and pCO2=5.3kPa.</p>
<p>For any tissue can  simplified with difference of lactate concentration from its normal value.</p>
</html>",           revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
<tr>
<td></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
          end Tissues_cTH;

          model TissuePh__
            extends Physiomodel.Electrolytes.AcidBase.BloodPhBase;

            Physiolibrary.Types.RealIO.ConcentrationInput ctHox(
                                                 displayUnit="mmol/l")
            "titratable acidity of oxygenated blood"
                                             annotation (Placement(transformation(extent={{-54,62},
                      {-14,102}}),          iconTransformation(extent={{-10,-10},{10,10}},
                  origin={-90,40})));
            Physiolibrary.Types.RealIO.TemperatureInput
                                                 T(
                                             displayUnit="degC") "temperature"
                                             annotation (Placement(transformation(extent={{62,24},
                      {40,2}}),             iconTransformation(extent={{-10,-10},{10,10}},
                  origin={-90,-72})));
          equation

          //base excess
            ctHox = _cTHox;

           // cTH_interstitial = -(1-((ctHb_ery/3)/43))*((cHCO3_interstitial-24.5)+betaX*(pH_interstitial-7.42));

            annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
                    extent={{-100,-100},{100,100}}), graphics={Text(
                    extent={{30,100},{96,46}},
                    lineColor={0,0,0},
                    textString="pH"), Text(
                    extent={{-96,72},{-12,100}},
                    lineColor={0,0,0},
                    textString="Blood")}),
              Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
          end TissuePh__;

          model Tissue_cTH_steady "interstitial titratable acidity"

          model I
            parameter String stateName;
          end I;

          I interstitium;

          Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump1(
              useSoluteFlowInput=true)
            annotation (Placement(transformation(extent={{-76,-28},{-56,-8}})));
          Physiolibrary.Chemical.Sensors.ConcentrationMeasure
            concentrationMeasure(
            q_in(conc(start=0)),
            toAnotherUnitCoef=1000,
            unitsString="mEq/l")
            annotation (Placement(transformation(extent={{-16,-16},{4,4}})));
          Physiolibrary.Chemical.Components.Stream solventFlowPump(
              useSolutionFlowInput=true)
            annotation (Placement(transformation(extent={{48,14},{68,34}})));
          Physiolibrary.Chemical.Components.Stream solventFlowPump1(
              useSolutionFlowInput=true) annotation (Placement(transformation(
                extent={{-10,-10},{10,10}},
                origin={24,24})));
            Modelica.Blocks.Interfaces.RealInput LactateFromMetabolism(
                                                                displayUnit="mEq/min")                                                                                     annotation (Placement(transformation(extent={{-82,-16},
                      {-70,-4}}),                                                                                                   iconTransformation(extent={{-10,-10},{10,10}},         rotation=180,         origin={90,-60})));
          Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
              Placement(transformation(extent={{74,14},{94,34}}),
                iconTransformation(extent={{90,-10},{110,10}})));
            Physiolibrary.Types.RealIO.VolumeInput InterstitialWater(
                                                            displayUnit="ml")                                                                                              annotation (Placement(transformation(extent={{-38,-18},
                      {-26,-6}}),                                                                                                    iconTransformation(extent={{-10,-10},{10,10}},         rotation=180,         origin={90,40})));
            Physiolibrary.Types.RealIO.ConcentrationOutput cTH(
                                               displayUnit="mEq/l")
            "interstitial titratable acidity"                                             annotation (Placement(
                  transformation(extent={{-4,-4},{4,4}}),     iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={20,-120})));
          Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
              Placement(transformation(extent={{-16,16},{0,32}}),
                iconTransformation(extent={{-110,-10},{-90,10}})));
            Physiolibrary.Types.RealIO.VolumeFlowRateInput BloodFlow(
                                                    displayUnit="ml/min")                                                                                                  annotation (Placement(transformation(extent={{4,38},{
                      16,50}}),                                                                                                    iconTransformation(extent={{-10,-10},{10,10}},         rotation=180,         origin={90,80})));
          equation
          connect(inputPump1.soluteFlow, LactateFromMetabolism) annotation (Line(
              points={{-62,-14},{-62,-10},{-76,-10}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(concentrationMeasure.concentration, cTH) annotation (Line(
              points={{-6,-2},{-6,0},{0,0}},
              color={0,0,127},
              smooth=Smooth.None));
            connect(solventFlowPump.q_out, q_out) annotation (Line(
                points={{68,24},{84,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
          connect(solventFlowPump.solutionFlow, BloodFlow) annotation (Line(
              points={{58,28},{58,44},{10,44}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(BloodFlow, solventFlowPump1.solutionFlow) annotation (Line(
              points={{10,44},{24,44},{24,28}},
              color={0,0,127},
              smooth=Smooth.None));
            connect(q_in, solventFlowPump1.q_in) annotation (Line(
                points={{-8,24},{14,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(solventFlowPump1.q_out, solventFlowPump.q_in) annotation (Line(
                points={{34,24},{48,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(inputPump1.q_out, solventFlowPump.q_in) annotation (Line(
                points={{-56,-18},{42,-18},{42,24},{48,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(inputPump1.q_out, concentrationMeasure.q_in) annotation (Line(
                points={{-56,-18},{-14,-18},{-14,-6},{-6,-6}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                      -100},{100,100}}), graphics={Rectangle(extent={{-100,100},{
                        100,-100}}, lineColor={0,0,0}), Text(
                    extent={{2,98},{88,48}},
                    lineColor={0,0,0},
                    textString="cTH")}),              Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
<tr>
<td></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
          end Tissue_cTH_steady;

          model Tissue_cTH "interstitial titratable acidity"

          Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump1(
              useSoluteFlowInput=true)
            annotation (Placement(transformation(extent={{-76,-28},{-56,-8}})));
            Physiolibrary.Chemical.Components.Substance                interstitium(
                useNormalizedVolume=false)
              annotation (Placement(transformation(extent={{-20,-28},{0,-8}})));
          Physiolibrary.Chemical.Sensors.ConcentrationMeasure
            concentrationMeasure(toAnotherUnitCoef=1, unitsString="mEq/l")
            annotation (Placement(transformation(extent={{-16,-18},{4,2}})));
          Physiolibrary.Chemical.Components.Stream solventFlowPump(
              useSolutionFlowInput=true)
            annotation (Placement(transformation(extent={{48,14},{68,34}})));
          Physiolibrary.Chemical.Components.Stream solventFlowPump1(
              useSolutionFlowInput=true) annotation (Placement(transformation(
                extent={{-10,-10},{10,10}},
                origin={24,24})));
            Physiolibrary.Types.RealIO.MolarFlowRateInput LactateFromMetabolism                 annotation (Placement(transformation(extent={{-82,-16},
                      {-70,-4}}),                                                                                                   iconTransformation(extent={{-10,-10},{10,10}},         rotation=180,         origin={90,-60})));
                                                                               //(displayUnit="mEq/min")
          Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
              Placement(transformation(extent={{74,14},{94,34}}),
                iconTransformation(extent={{90,-10},{110,10}})));
            Physiolibrary.Types.RealIO.VolumeInput InterstitialWater(
                                                            displayUnit="ml")                                                                                              annotation (Placement(transformation(extent={{-38,-18},
                      {-26,-6}}),                                                                                                    iconTransformation(extent={{-10,-10},{10,10}},         rotation=180,         origin={90,40})));
            Physiolibrary.Types.RealIO.ConcentrationOutput cTH
            "interstitial titratable acidity"                                             annotation (Placement(
                  transformation(extent={{-4,-4},{4,4}}),     iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={20,-120})));                        //(displayUnit="mEq/l")
          Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
              Placement(transformation(extent={{-16,16},{0,32}}),
                iconTransformation(extent={{-110,-10},{-90,10}})));
            Physiolibrary.Types.RealIO.VolumeFlowRateInput BloodFlow(
                                                    displayUnit="ml/min")                                                                                                  annotation (Placement(transformation(extent={{4,38},{
                      16,50}}),                                                                                                    iconTransformation(extent={{-10,-10},{10,10}},         rotation=180,         origin={90,80})));
          equation
          connect(inputPump1.soluteFlow, LactateFromMetabolism) annotation (Line(
              points={{-62,-14},{-62,-10},{-76,-10}},
              color={0,0,127},
              smooth=Smooth.None));
            connect(inputPump1.q_out,interstitium. q_out) annotation (Line(
                points={{-56,-18},{-10,-18}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(concentrationMeasure.q_in,interstitium. q_out) annotation (Line(
                points={{-6,-10},{-10,-10},{-10,-18}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
          connect(concentrationMeasure.concentration, cTH) annotation (Line(
              points={{-6,-4},{-6,0},{0,0}},
              color={0,0,127},
              smooth=Smooth.None));
            connect(solventFlowPump.q_out, q_out) annotation (Line(
                points={{68,24},{84,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
          connect(solventFlowPump.solutionFlow, BloodFlow) annotation (Line(
              points={{58,28},{58,44},{10,44}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(BloodFlow, solventFlowPump1.solutionFlow) annotation (Line(
              points={{10,44},{24,44},{24,28}},
              color={0,0,127},
              smooth=Smooth.None));
            connect(q_in, solventFlowPump1.q_in) annotation (Line(
                points={{-8,24},{14,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(solventFlowPump1.q_out, solventFlowPump.q_in) annotation (Line(
                points={{34,24},{48,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
            connect(interstitium.q_out, solventFlowPump.q_in) annotation (Line(
                points={{-10,-18},{42,-18},{42,24},{48,24}},
                color={200,0,0},
                thickness=1,
                smooth=Smooth.None));
          connect(InterstitialWater, interstitium.solutionVolume) annotation (
              Line(
              points={{-32,-12},{-24,-12},{-24,-14},{-14,-14}},
              color={0,0,127},
              smooth=Smooth.None));
            annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                      -100},{100,100}}), graphics={Rectangle(extent={{-100,100},{
                        100,-100}}, lineColor={0,0,0}), Text(
                    extent={{2,98},{88,48}},
                    lineColor={0,0,0},
                    textString="cTH")}),              Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
<tr>
<td></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
          end Tissue_cTH;

          model TissuePh_intracellular_
           parameter Real CellSID_OtherCations(final displayUnit="mEq/l") = 12;
           parameter Real CellSID_StrongAnions(final displayUnit="mEq/l") = 117;
            Physiolibrary.Types.RealIO.ConcentrationInput KCell(
                                                final displayUnit="mEq/l")
            "tissue interstitial titratable acidity"
                                             annotation (Placement(transformation(extent={{-94,4},
                      {-54,44}}),           iconTransformation(extent={{-10,-10},{10,10}},
                  origin={-90,0})));
            Physiolibrary.Types.RealIO.ConcentrationInput cLactate(
                                                   final displayUnit="mEq/l")
            "tissue lactate concentration"   annotation (Placement(transformation(extent={{-78,-86},
                      {-62,-70}}),          iconTransformation(extent={{-10,-10},{10,10}},
                  origin={-90,-40})));
            Physiolibrary.Types.RealIO.pHOutput pH "tissue intracellular pH"            annotation (Placement(
                  transformation(extent={{66,-42},{86,-22}}), iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={60,-120})));
            Physiolibrary.Types.RealIO.PressureInput pCO2(
                                               final displayUnit="mmHg")
            "tissue partial CO2 pressure"    annotation (Placement(transformation(extent={{-28,-38},
                      {-10,-20}}),         iconTransformation(
                  extent={{-10,-10},{10,10}},
                  origin={-90,80})));
            Modelica.Blocks.Math.Add cations                                                                                                 annotation (Placement(transformation(extent={{-28,8},
                      {-8,28}})));
            Modelica.Blocks.Math.Add anions                                                                                                   annotation (Placement(transformation(extent={{-32,-82},
                      {-12,-62}})));
            Modelica.Blocks.Math.Feedback SID "intracellular"                                                                                          annotation (Placement(transformation(extent={{-4,8},{
                      16,28}})));
          Physiolibrary.Types.Constants.ConcentrationConst
            electrolytesConcentrationConstant_per_l1(k=(CellSID_OtherCations))
            annotation (Placement(transformation(extent={{-76,-12},{-56,8}})));
          Physiolibrary.Types.Constants.ConcentrationConst
            electrolytesConcentrationConstant_per_l2(k=(CellSID_StrongAnions))
            annotation (Placement(transformation(extent={{-76,-60},{-56,-40}})));
            Modelica.Blocks.Math.Division division
              annotation (Placement(transformation(extent={{32,2},{52,22}})));
            Modelica.Blocks.Math.Log10 log10_1
              annotation (Placement(transformation(extent={{66,2},{86,22}})));
            Modelica.Blocks.Math.Add add1
              annotation (Placement(transformation(extent={{46,-42},{66,-22}})));
          Physiolibrary.Types.Constants.pHConst                   const(k=7.15)
            annotation (Placement(transformation(extent={{14,-48},{34,-28}})));
            Modelica.Blocks.Math.Max max
              annotation (Placement(transformation(extent={{16,-18},{24,-10}})));
          Physiolibrary.Types.Constants.DeprecatedUntypedConstant PCO2_min_value(
              k=0.001)
            annotation (Placement(transformation(extent={{-10,-12},{-2,-4}})));
          Physiolibrary.Types.Constants.DeprecatedUntypedConstant PCO2_min_value1(
             k=10^(-7.15))
            annotation (Placement(transformation(extent={{28,52},{36,60}})));
            Modelica.Blocks.Math.Max max1
              annotation (Placement(transformation(extent={{54,46},{62,54}})));
          equation

            connect(anions.y, SID.u2)                                                                                                   annotation (Line(       points={{-11,-72},
                    {6,-72},{6,10}},                                                                                                    color={0,0,127},       smooth=Smooth.None));
            connect(cations.y, SID.u1)                                                                                                 annotation (Line(       points={{-7,18},
                    {-2,18}},                                                                                                   color={0,0,127},       smooth=Smooth.None));
            connect(electrolytesConcentrationConstant_per_l1.y, cations.u2)                                                                                                 annotation (Line(       points={{-53.5,
                  -2},{-36,-2},{-36,12},{-30,12}},                                                                                                  color={0,0,127},       smooth=Smooth.None));
            connect(electrolytesConcentrationConstant_per_l2.y, anions.u1)                                                                                                   annotation (Line(       points={{-53.5,
                  -50},{-42,-50},{-42,-66},{-34,-66}},                                                                                                 color={0,0,127},       smooth=Smooth.None));
            connect(KCell, cations.u1)
                                   annotation (Line(
                points={{-74,24},{-30,24}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(cLactate, anions.u2)
                                       annotation (Line(
                points={{-70,-78},{-34,-78}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(log10_1.y, add1.u1) annotation (Line(
                points={{87,12},{92,12},{92,-6},{40,-6},{40,-26},{44,-26}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(add1.y, pH) annotation (Line(
                points={{67,-32},{76,-32}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(const.y, add1.u2) annotation (Line(
                points={{36.5,-38},{44,-38}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(SID.y, division.u1) annotation (Line(
                points={{15,18},{30,18}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(max.y, division.u2) annotation (Line(
                points={{24.4,-14},{26,-14},{26,6},{30,6}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(pCO2, max.u2) annotation (Line(
                points={{-19,-29},{-3.5,-29},{-3.5,-16.4},{15.2,-16.4}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(PCO2_min_value.y, max.u1) annotation (Line(
                points={{-1,-8},{8.2,-8},{8.2,-11.6},{15.2,-11.6}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(PCO2_min_value1.y, max1.u1) annotation (Line(
                points={{37,56},{46,56},{46,52.4},{53.2,52.4}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(max1.u2, division.y) annotation (Line(
                points={{53.2,47.6},{53.2,29.8},{53,29.8},{53,12}},
                color={0,0,127},
                smooth=Smooth.None));
            connect(max1.y, log10_1.u) annotation (Line(
                points={{62.4,50},{64,50},{64,12}},
                color={0,0,127},
                smooth=Smooth.None));
            annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
                    extent={{-100,-100},{100,100}}), graphics={
                  Text(
                    extent={{34,102},{100,48}},
                    lineColor={0,0,0},
                    textString="pH"),
                  Text(
                    extent={{-84,72},{-20,100}},
                    lineColor={0,0,0},
                    textString="ICF"),
                  Rectangle(extent={{-100,100},{100,-100}}, lineColor={0,0,0})}),
              Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
          end TissuePh_intracellular_;
        end old;
      end Tissues;

      package Buffers
        partial model BufferInterface

          Physiolibrary.Types.RealIO.pHInput pH
            annotation (Placement(transformation(extent={{-120,40},{-80,80}})));
          Physiolibrary.Types.RealIO.VolumeDensityOfChargeOutput
                                              y(displayUnit="mEq/l")
          "charge of buffer"                                                        annotation (Placement(
                transformation(extent={{80,-100},{120,-60}}), iconTransformation(extent=
                   {{80,-100},{120,-60}})));
          annotation ( Icon(graphics={Rectangle(extent={{-100,
                      100},{100,-100}}, lineColor={0,0,255})}));
        end BufferInterface;

        model Bicarbonate
          extends BufferInterface;
          Physiolibrary.Types.RealIO.PressureInput
                                             pCO2(displayUnit="mmHg") annotation (Placement(transformation(extent=
                   {{-120,-20},{-80,20}}), iconTransformation(extent={{-120,-20},{-80,20}})));
          Physiolibrary.Types.RealIO.TemperatureInput
                                             T(displayUnit="degC") annotation (Placement(transformation(extent={{-120,
                    -20},{-80,20}}), iconTransformation(extent={{-120,-60},{-80,-20}})));

            Real pK;
          Real aCO2;
          Physiolibrary.Types.Concentration cdCO2;

          Physiolibrary.Types.VolumeDensityOfCharge y2;
        equation

          //Henderson-Hasselbalch equation:
          pK = 6.1 + (-0.0026)*(T-310.15);
          aCO2 = 0.00023 * 10^(-0.0092*(T-310.15)); //solubility depends on temperature
          cdCO2 = aCO2*pCO2;
          y = -cdCO2*10^(pH-pK)* Modelica.Constants.F;  //bicarbonate

          y2 = -cdCO2*10^(pH-6.35)* Modelica.Constants.F;  //bicarbonate

          annotation (Icon(graphics={Text(
                  extent={{-79,-27},{79,27}},
                  lineColor={0,0,255},
                  origin={75,19},
                  rotation=90,
                  textString="HCO3")}));
        end Bicarbonate;

        model Albumin
            extends BufferInterface;
          Physiolibrary.Types.RealIO.ConcentrationInput
                                             tAlb(displayUnit="mmol/l")
            annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));

          Physiolibrary.Types.MassConcentration tAlb_mass;
          parameter Physiolibrary.Types.MolarMass Alb_MolarMass(displayUnit="g/mol") = 66.463;
        equation
          tAlb_mass=tAlb*Alb_MolarMass;  //kg/m3 = g/l
          y = - tAlb_mass * ( 0.123 * pH - 0.631) * Modelica.Constants.F;

        //where [ Albx- ] is in mEq / L and [ Albumin ] is in g / dL. Therefore, at pH 7.40, the charge contributed by 4.40 g / dL of albumin is approximately -12.3 mEq / L.

          annotation (Documentation(info="<html>
<p>http://www.figge-fencl.org/titrationcurve.html</p>
<p>:</p>
<p><br/>A least-squares linear regression fit to the Figge-Fencl quantitative physicochemical model (version 3.0) over the pH range of 6.90 to 7.90 yields the following equation for the charge displayed by albumin:</p>
<p><br/> [ Albx- ] = -10 x [ Albumin ] x ( 0.123 x pH - 0.631 );</p>
<p><br/> where [ Albx- ] is in mEq / L and [ Albumin ] is in g / dL. Therefore, at pH 7.40, the charge contributed by 4.40 g / dL of albumin is approximately -12.3 mEq / L.</p>
</html>"), Icon(graphics={Text(
                  extent={{-79,-27},{79,27}},
                  lineColor={0,0,255},
                  origin={73,19},
                  rotation=90,
                  textString="Alb")}));
        end Albumin;

        model Globulins
            extends BufferInterface;
          Physiolibrary.Types.RealIO.MassConcentrationInput
                                             ctGlb
            annotation (Placement(transformation(extent={{-120,-40},{-80,0}})));
        equation
        //  y=-ctGlb*(0.075/0.81)*(pH-3.6);  //sklon -0.075/0.81 so siggaarda, pri 7.4 chcem -10 aby to pokrilo nastavene SID u Colemana
            y=-ctGlb*((0.075/0.77)*(pH-7.4) + 2.5/28)* Modelica.Constants.F; //chcem naboj -2.5 mEq/l pre normalnu koncentraciu 28 mg/l a pH=7.4
        //  y=-ctGlb*((0.075/0.77)*(pH-7.4) + 15.6/28)* Modelica.Constants.F; //chcem naboj -15.6 mEq/l pre normalnu koncentraciu 28 mg/l a pH=7.4
          annotation (Icon(graphics={Text(
                  extent={{-79,-27},{79,27}},
                  lineColor={0,0,255},
                  origin={73,19},
                  rotation=90,
                  textString="Glb")}));
        end Globulins;

        model Phosphates
          extends BufferInterface;
          Physiolibrary.Types.RealIO.ConcentrationInput
                                             tPO4
            annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));

            parameter Real pKa1=2.1;
          parameter Real pKa2=6.8;
          parameter Real pKa3=12.7;

        equation
           y = - tPO4*(10^(pKa2-pH)+2+3*10^(pH-pKa3))/(10^(pKa1+pKa2-2*pH)+10^(pKa2-pH)+1+10^(pH-pKa3))* Modelica.Constants.F;

          annotation ( Documentation(info="<html>
<p><b><font style=\"font-size: 12pt; \"><a name=\"internal-source-marker_0.47659245471196454\">C</a>harge for phosphates:</b></p>
<p><br/>pKa1=2.1, pKa2=6.8, pKa3=12.7 &nbsp;&nbsp;(wiki: &nbsp;2.12, 7.21, 12.67 at 25&deg;C)</p>
<p><br/>tPO4 = [H3PO4] + [H2PO4] + [HPO4] + [PO4]</p>
<p><br/>charge(tPO4,pH) = [H2PO4] + 2[HPO4] + 3[PO4]</p>
<p><br/>[H2PO4] / [H3PO4] = 10^(pH-pKa1) </p>
<p><br/>[HPO4] / [H2PO4] = 10^(pH-pKa2) </p>
<p><br/>[PO4] / [HPO4] = 10^(pH-pKa3) </p>
</html>"),  Icon(graphics={Text(
                  extent={{-79,-27},{79,27}},
                  lineColor={0,0,255},
                  origin={73,19},
                  rotation=90,
                  textString="PO4")}));
        end Phosphates;

        model Haemoglobin
          extends BufferInterface;
         Physiolibrary.Types.RealIO.ConcentrationInput
                                             tHb_E
          "total concentration of haemoglobin in erythrocytes"
            annotation (Placement(transformation(extent={{-120,0},{-80,40}})));
          Physiolibrary.Types.RealIO.FractionInput
                                             sO2
          "saturation of haemoglobin by O2"
            annotation (Placement(transformation(extent={{-120,-40},{-80,0}})));
          Physiolibrary.Types.RealIO.PressureInput
                                             pCO2 "partial pressure of CO2"
            annotation (Placement(transformation(extent={{-120,-80},{-80,-40}})));
          parameter Real betaOxyHb = 3.1
          "buffer value for oxygenated Hb without CO2";
          parameter Real betaDeoxyHb = 3.3
          "buffer value for Hb without O2 and CO2";
          parameter Real pIo=7.13
          "isoelectric pH for oxygenated Hb without CO2";
          parameter Real pIr=7.32 "isoelectric pH for Hb without O2 and CO2";

          parameter Real pKzO=8.08
          "pKa for NH3+ end of oxygenated haemoglobin chain";
          parameter Real pKzR=7.14
          "pKa for NH3+ end of deoxygenated haemoglobin chain";
          parameter Real pKcO=4.62
          "10^(pH-pKcO) is the dissociation constatnt for O2HbNH2 + CO2 <-> O2HbNHCOO- + H+ ";
          parameter Real pKcR=4.62
          "10^(pH-pKcR) is the dissociation constatnt for HbNH2 + CO2 <-> HbNHCOO- + H+ ";

          parameter Real KcR=10^(-pKcR);
          parameter Real KzR=10^(-pKzR);
          parameter Real KcO=10^(-pKcO);
          parameter Real KzO=10^(-pKzO);

          Real carbaminohaemoglobin;
          Real sCO2;
          Real zOxyHb;
          Real zDeoxyHb;
          Real zOxyCarbaminoHb;
          Real zDeoxyCarbaminoHb;
          Real H=10^(-pH);
          Real aCO2;
          Real cdCO2;
          Physiolibrary.Types.RealIO.TemperatureInput
                                             T
            annotation (Placement(transformation(extent={{-120,-120},{-80,-80}})));
        equation
        aCO2 = 0.23 * 10^(-0.0092*(T-37)); //solubility depends on temperature
        cdCO2 = aCO2*pCO2*0.001; //from mmol to mol

        carbaminohaemoglobin = tHb_E*cdCO2*( ( H*H*((1-sO2)/(KzO*KcO)+sO2/(KzR*KcR)) + H*((1-sO2)/KcO + sO2/KcR) + cdCO2) / ((H*H/(KzR*KcR) + H/KcR + cdCO2)*(H*H/(KzO*KcO) + H/KcO + cdCO2))); //, where cdCO2=free disolved CO2 concentration in erythrocytes in mol/l
        sCO2 = carbaminohaemoglobin/ tHb_E;

        y = -tHb_E*(sO2*(1-sCO2)*zOxyHb + (1-sO2)*(1-sCO2)*zDeoxyHb + sO2*sCO2*zOxyCarbaminoHb + (1-sO2)*sCO2*zDeoxyCarbaminoHb)* Modelica.Constants.F;

        zOxyHb = betaOxyHb * (pH-pIo);
        zDeoxyHb = betaDeoxyHb * (pH-pIr);
        zOxyCarbaminoHb = zOxyHb + (1+2*10^(pKzO-pH))/(1+10^(pKzO-pH)); //= zOxyHb + -[O2HbNH2]/([O2HbNH2]+[O2HbNH3+]) + -2[O2HbNH3+]/([O2HbNH2]+[O2HbNH3+]), where pKZO=8.08
        zDeoxyCarbaminoHb = zDeoxyHb + (1+2*10^(pKzR-pH))/(1+10^(pKzR-pH)); //betaOxyHb(pH) * (pH-pIO) + -[HbNH2]/([HbNH2]+[HbNH3+]) + -2[HbNH3+]/([HbNH2]+[HbNH3+]), where pKZR=7.14
          annotation (Icon(graphics={Text(
                  extent={{-79,-27},{79,27}},
                  lineColor={0,0,255},
                  origin={73,19},
                  rotation=90,
                  textString="Hb")}));
        end Haemoglobin;

        model OtherRBCBuffers
          extends BufferInterface;

          parameter Physiolibrary.Types.Concentration NCharge=9
          "charge at pH=7.4";

        equation
           y = - NCharge * Modelica.Constants.F;

          annotation ( Documentation(info="<html>
<p><b><font style=\"font-size: 12pt; \"><a name=\"internal-source-marker_0.47659245471196454\">C</a>harge for phosphates:</b></p>
<p><br/>pKa1=2.1, pKa2=6.8, pKa3=12.7 &nbsp;&nbsp;(wiki: &nbsp;2.12, 7.21, 12.67 at 25&deg;C)</p>
<p><br/>tPO4 = [H3PO4] + [H2PO4] + [HPO4] + [PO4]</p>
<p><br/>charge(tPO4,pH) = [H2PO4] + 2[HPO4] + 3[PO4]</p>
<p><br/>[H2PO4] / [H3PO4] = 10^(pH-pKa1) </p>
<p><br/>[HPO4] / [H2PO4] = 10^(pH-pKa2) </p>
<p><br/>[PO4] / [HPO4] = 10^(pH-pKa3) </p>
</html>"),  Icon(graphics={Text(
                  extent={{-79,-27},{79,27}},
                  lineColor={0,0,255},
                  origin={73,19},
                  rotation=90,
                  textString="Others")}));
        end OtherRBCBuffers;
      end Buffers;

      model AcidBase
        extends Physiolibrary.Icons.AcidBase;
      BloodPhMeassure artysPH(_BEox(start=-0.177))
        annotation (Placement(transformation(extent={{86,28},{58,56}})));
      BloodPhMeassure veinsPH(_cTHox(start=0), pH(start=7.37))
        annotation (Placement(transformation(extent={{-56,28},{-84,56}})));

      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-44,72},{-4,112}}), iconTransformation(
              extent={{-20,-18},{20,22}})));

      //initial equation
      //  ArtysPh.pH=7.4;

      BloodPhMeassure lungsPH
        annotation (Placement(transformation(extent={{28,28},{0,56}})));
      Tissues.Bloods tissues_blood_acidity
        annotation (Placement(transformation(extent={{-6,-96},{14,-76}})));
      Tissues.Cells tissues_intracellular
        annotation (Placement(transformation(extent={{46,-96},{66,-76}})));
      Tissues.Interstitia tissues_interstitial_acidity
        annotation (Placement(transformation(extent={{20,-96},{40,-76}})));
        Physiomodel.Electrolytes.AcidBase.NormalSID normalSID
        annotation (Placement(transformation(extent={{-38,-38},{-66,2}})));
        Modelica.Blocks.Math.Feedback BEox(y(unit="C/m3", displayUnit="mEq/l"))
          annotation (Placement(transformation(extent={{-2,-12},{18,8}})));
      Urine pHUCalculation2_1
        annotation (Placement(transformation(extent={{26,-72},{80,-18}})));
        Buffers.Albumin albumin
          annotation (Placement(transformation(extent={{-86,-68},{-66,-48}})));
        Buffers.Globulins globulins
          annotation (Placement(transformation(extent={{-86,-90},{-66,-70}})));
      Modelica.Blocks.Math.Add add(k1=-1, k2=-1)
        annotation (Placement(transformation(extent={{-60,-92},{-50,-82}})));
      equation
        connect(busConnector.O2Artys_sO2,artysPH. sO2)        annotation (Line(
            points={{-24,92},{-24,74},{44,74},{44,60},{64,60},{64,57.4},{63.6,
              57.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,6},{-6,6}}));
        connect(busConnector.O2Veins_sO2, veinsPH.sO2)         annotation (Line(
            points={{-24,92},{-24,74},{-100,74},{-100,60},{-78,60},{-78,57.4},{
              -78.4,57.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,6},{-6,6}}));
        connect(busConnector.ctAlb,artysPH. ctAlb)    annotation (Line(
            points={{-24,92},{-24,74},{44,74},{44,42},{59.4,42}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CO2Artys_cHCO3,artysPH. cHCO3)    annotation (Line(
            points={{-24,92},{-24,74},{44,74},{44,53.2},{59.4,53.2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctAlb, veinsPH.ctAlb)    annotation (Line(
            points={{-24,92},{-24,74},{-100,74},{-100,42},{-82.6,42}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CO2Veins_cHCO3, veinsPH.cHCO3)    annotation (Line(
            points={{-24,92},{-24,74},{-100,74},{-100,53.2},{-82.6,53.2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(artysPH.pH, busConnector.Artys_pH)    annotation (Line(
            points={{74.8,25.2},{74.8,16},{98,16},{98,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,-8},{6,-8}}));
        connect(artysPH.pH_ery, busConnector.Artys_pH_ery)    annotation (Line(
            points={{69.2,25.2},{69.2,10},{98,10},{98,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,-13},{6,-13}}));
        connect(veinsPH.pH, busConnector.Veins_pH)    annotation (Line(
            points={{-67.2,25.2},{-67.2,16},{-24,16},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,-8},{6,-8}}));
        connect(veinsPH.pH_ery, busConnector.Veins_pH_ery)    annotation (Line(
            points={{-72.8,25.2},{-72.8,10},{-24,10},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,-13},{6,-13}}));
        connect(busConnector.ctGlb,artysPH. ctGlb) annotation (Line(
            points={{-24,92},{-24,74},{44,74},{44,36.4},{59.4,36.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctPO4,artysPH. ctPO4) annotation (Line(
            points={{-24,92},{-24,74},{44,74},{44,30.8},{59.4,30.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctGlb, veinsPH.ctGlb) annotation (Line(
            points={{-24,92},{-24,74},{-100,74},{-100,36.4},{-82.6,36.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctPO4, veinsPH.ctPO4) annotation (Line(
            points={{-24,92},{-24,74},{-100,74},{-100,30.8},{-82.6,30.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(artysPH.pH, busConnector.BloodPh_ArtysPh) annotation (Line(
            points={{74.8,25.2},{74.8,16},{98,16},{98,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.ctAlb,lungsPH. ctAlb)    annotation (Line(
            points={{-24,92},{-14,92},{-14,42},{1.4,42}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(lungsPH.pH, busConnector.Lung_pH)     annotation (Line(
            points={{16.8,25.2},{16.8,14},{34,14},{34,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,-8},{6,-8}}));
        connect(lungsPH.pH_ery, busConnector.Lung_pH_ery)     annotation (Line(
            points={{11.2,25.2},{11.2,8},{34,8},{34,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,-13},{6,-13}}));
        connect(busConnector.ctGlb,lungsPH. ctGlb) annotation (Line(
            points={{-24,92},{-14,92},{-14,36.4},{1.4,36.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctPO4,lungsPH. ctPO4) annotation (Line(
            points={{-24,92},{-14,92},{-14,30.8},{1.4,30.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.O2Lung_sO2,lungsPH. sO2)              annotation (Line(
            points={{-24,92},{-14,92},{-14,57.4},{5.6,57.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CO2Lung_cHCO3,lungsPH. cHCO3)              annotation (
            Line(
            points={{-24,92},{-14,92},{-14,53.2},{1.4,53.2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector,tissues_blood_acidity. busConnector)
                                                      annotation (Line(
            points={{-24,92},{-24,-80},{-4.8,-80},{-4.8,-79.8333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(tissues_intracellular.busConnector, busConnector) annotation (
            Line(
            points={{47.2,-76.8},{-24,-76.8},{-24,92}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(busConnector, tissues_interstitial_acidity.busConnector)
          annotation (Line(
            points={{-24,92},{-24,-76.8},{21.2,-76.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(lungsPH.pH, busConnector.lungs_pH_plasma) annotation (Line(
            points={{16.8,25.2},{16.8,14},{34,14},{34,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(lungsPH.pH_ery, busConnector.lungs_pH_ery) annotation (Line(
            points={{11.2,25.2},{11.2,8},{34,8},{34,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None));

        connect(busConnector.ctHb, veinsPH.ctHb) annotation (Line(
            points={{-24,92},{-24,74},{-100,74},{-100,47.6},{-82.6,47.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctHb, lungsPH.ctHb) annotation (Line(
            points={{-24,92},{-14,92},{-14,47.6},{1.4,47.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctHb, artysPH.ctHb) annotation (Line(
            points={{-24,92},{-24,74},{44,74},{44,47.6},{59.4,47.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));

         connect(busConnector.BloodVol_Hct,normalSID. Hct)        annotation (
            Line(
            points={{-24,92},{-100,92},{-100,-32},{-64.6,-32}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.HeatCore_Temp,normalSID. T)        annotation (
            Line(
            points={{-24,92},{-100,92},{-100,-26},{-64.6,-26}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctHb_ery,normalSID. tHb_E)        annotation (Line(
            points={{-24,92},{-100,92},{-100,-20},{-64.6,-20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctAlb,normalSID. ctAlb)        annotation (Line(
            points={{-24,92},{-100,92},{-100,-2},{-64.6,-2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctGlb,normalSID. ctGlb)        annotation (Line(
            points={{-24,92},{-100,92},{-100,-8},{-64.6,-8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.ctPO4,normalSID. ctPO4_P)        annotation (Line(
            points={{-24,92},{-100,92},{-100,-14},{-64.6,-14}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(normalSID.NSID,BEox. u2)        annotation (Line(
            points={{-35.2,-30},{-28,-30},{-28,-14},{8,-14},{8,-10}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(BEox.y, busConnector.Blood_BEox) annotation (Line(
            points={{17,-2},{88,-2},{88,92},{-24,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

      connect(BEox.y, veinsPH.BEox) annotation (Line(
          points={{17,-2},{88,-2},{88,64},{-58.8,64},{-58.8,56}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BEox.y, lungsPH.BEox) annotation (Line(
          points={{17,-2},{88,-2},{88,64},{25.2,64},{25.2,56}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BEox.y, artysPH.BEox) annotation (Line(
          points={{17,-2},{88,-2},{88,64},{83.2,64},{83.2,56}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.CD_Na_Outflow, pHUCalculation2_1.qNa) annotation (
          Line(
          points={{-24,92},{-24,-20.4545},{28.7,-20.4545}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_K_Outflow, pHUCalculation2_1.qK) annotation (Line(
          points={{-24,92},{-24,-26},{28.7,-26},{28.7,-25.3636}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_NH4_Outflow, pHUCalculation2_1.qNH4) annotation (
          Line(
          points={{-24,92},{-24,-30},{28.7,-30},{28.7,-30.2727}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_Cl_Outflow, pHUCalculation2_1.qCl) annotation (
          Line(
          points={{-24,92},{-24,-46},{28.7,-46},{28.7,-45}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_SO4_Outflow, pHUCalculation2_1.qSO4) annotation (
          Line(
          points={{-24,92},{-24,-49.9091},{28.7,-49.9091}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_PO4_Outflow, pHUCalculation2_1.qPO4) annotation (
          Line(
          points={{-24,92},{-24,-54},{28.7,-54},{28.7,-54.8182}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_KA_Outflow, pHUCalculation2_1.qKA) annotation (
          Line(
          points={{-24,92},{-24,-59.7273},{28.7,-59.7273}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CO2Artys_pCO2, pHUCalculation2_1.pCO2) annotation (
          Line(
          points={{-24,92},{-24,-64},{28.7,-64},{28.7,-64.6364}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_H2O_Outflow, pHUCalculation2_1.qH2O) annotation (
          Line(
          points={{-24,92},{-24,-70},{28.7,-70},{28.7,-69.5455}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(pHUCalculation2_1.PHU, busConnector.Urine_pH) annotation (Line(
          points={{80.54,-42.5455},{98,-42.5455},{98,92},{-24,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.CD_Mg_Outflow, pHUCalculation2_1.qMg) annotation (
          Line(
          points={{-24,92},{-24,-35.1818},{28.7,-35.1818}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_Ca_Outflow, pHUCalculation2_1.qCa) annotation (
          Line(
          points={{-24,92},{-24,-40.0909},{28.7,-40.0909}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(artysPH.pH, albumin.pH) annotation (Line(
          points={{74.8,25.2},{74.8,-98},{-100,-98},{-100,-52},{-86,-52}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(artysPH.pH, globulins.pH) annotation (Line(
          points={{74.8,25.2},{74.8,-98},{-100,-98},{-100,-74},{-86,-74}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ctAlb, albumin.tAlb) annotation (Line(
          points={{-24,92},{-100,92},{-100,-58},{-86,-58}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.ctGlb, globulins.ctGlb) annotation (Line(
          points={{-24,92},{-100,92},{-100,-82},{-86,-82}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(globulins.y, add.u2) annotation (Line(
          points={{-66,-88},{-64,-88},{-64,-90},{-61,-90}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(albumin.y, add.u1) annotation (Line(
          points={{-66,-66},{-60,-66},{-60,-84},{-61,-84}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(add.y, busConnector.BloodIons_ProteinAnions) annotation (Line(
          points={{-49.5,-87},{-36,-87},{-36,-88},{-24,-88},{-24,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.Blood_SID, BEox.u1) annotation (Line(
          points={{-24,92},{-22,92},{-22,-2},{0,-2}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={                 Text(
                extent={{-118,-84},{124,-118}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2009</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr>
<tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
<tr>
<td></td>
<td><p>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</p></td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end AcidBase;

      model AcidBase_variables
        extends Physiolibrary.Icons.AcidBase;
        package T = Physiolibrary.Types.RealTypes;

      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{52,-28},{66,-14}}), iconTransformation(
              extent={{-40,-20},{0,20}})));
      T.pH BloodPh_ArtysPh(varName="BloodPh.ArtysPh")
        "Acidity (pH) of arterial blood."
      annotation (Placement(transformation(extent={{-110,-194},{-104,-188}})));
      T.pH Artys_pH1(                         varName="BloodPh.ArtysPh")
      annotation (Placement(transformation(extent={{-108,-58},{-102,-52}})));
      T.pH Artys_pH_ery(varName="Artys_pH_ery")
      annotation (Placement(transformation(extent={{-108,-48},{-102,-42}})));
      T.pH bone_pH_ery(varName="bone_pH_ery")
      annotation (Placement(transformation(extent={{-108,12},{-102,18}})));
      T.pH bone_pH_interstitial(varName="bone_pH_interstitial")
      annotation (Placement(transformation(extent={{-108,22},{-102,28}})));
      T.pH bone_pH_plasma(varName="bone_pH_plasma")
      annotation (Placement(transformation(extent={{-108,32},{-102,38}})));
      T.pH brain_pH_ery(varName="brain_pH_ery")
      annotation (Placement(transformation(extent={{-108,82},{-102,88}})));
      T.pH brain_pH_interstitial(varName="brain_pH_interstitial")
      annotation (Placement(transformation(extent={{-108,92},{-102,98}})));
      T.pH brain_pH_plasma(varName="brain_pH_plasma")
      annotation (Placement(transformation(extent={{-108,102},{-102,108}})));
      T.pH fat_pH_ery(varName="fat_pH_ery")
      annotation (Placement(transformation(extent={{-100,-30},{-94,-24}})));
      T.pH fat_pH_interstitial(varName="fat_pH_interstitial")
      annotation (Placement(transformation(extent={{-100,-20},{-94,-14}})));
      T.pH fat_pH_plasma(varName="fat_pH_plasma")
      annotation (Placement(transformation(extent={{-100,-10},{-94,-4}})));
      T.pH GITract_pH_ery(varName="GITract_pH_ery")
      annotation (Placement(transformation(extent={{146,-338},{152,-332}})));
      T.pH GITract_pH_interstitial(varName="GITract_pH_interstitial")
      annotation (Placement(transformation(extent={{146,-328},{152,-322}})));
      T.pH GITract_pH_plasma(varName="GITract_pH_plasma")
      annotation (Placement(transformation(extent={{146,-318},{152,-312}})));
      T.pH kidney_pH_ery(varName="kidney_pH_ery")
      annotation (Placement(transformation(extent={{146,-258},{152,-252}})));
      T.pH kidney_pH_interstitial(varName="kidney_pH_interstitial")
      annotation (Placement(transformation(extent={{146,-248},{152,-242}})));
      T.pH kidney_pH_plasma(varName="kidney_pH_plasma")
      annotation (Placement(transformation(extent={{146,-238},{152,-232}})));
      T.pH leftHeart_pH_ery(varName="leftHeart_pH_ery")
      annotation (Placement(transformation(extent={{146,-188},{152,-182}})));
      T.pH leftHeart_pH_interstitial(varName="leftHeart_pH_interstitial")
      annotation (Placement(transformation(extent={{146,-178},{152,-172}})));
      T.pH leftHeart_pH_plasma(varName="leftHeart_pH_plasma")
      annotation (Placement(transformation(extent={{146,-168},{152,-162}})));
      T.pH liver_pH_ery(varName="liver_pH_ery")
      annotation (Placement(transformation(extent={{146,-128},{152,-122}})));
      T.pH liver_pH_interstitial(varName="liver_pH_interstitial")
      annotation (Placement(transformation(extent={{146,-118},{152,-112}})));
      T.pH liver_pH_plasma(varName="liver_pH_plasma")
      annotation (Placement(transformation(extent={{146,-108},{152,-102}})));
      T.pH otherTissue_pH_ery(varName="otherTissue_pH_ery")
      annotation (Placement(transformation(extent={{146,-28},{152,-22}})));
      T.pH otherTissue_pH_interstitial(varName="otherTissue_pH_interstitial")
      annotation (Placement(transformation(extent={{146,-18},{152,-12}})));
      T.pH otherTissue_pH_plasma(varName="otherTissue_pH_plasma")
      annotation (Placement(transformation(extent={{146,-8},{152,-2}})));
      T.pH respiratoryMuscle_pH_ery(varName="respiratoryMuscle_pH_ery")
      annotation (Placement(transformation(extent={{146,62},{152,68}})));
      T.pH respiratoryMuscle_pH_interstitial(varName="respiratoryMuscle_pH_interstitial")
      annotation (Placement(transformation(extent={{146,72},{152,78}})));
      T.pH respiratoryMuscle_pH_plasma(varName="respiratoryMuscle_pH_plasma")
      annotation (Placement(transformation(extent={{146,82},{152,88}})));
      T.pH rightHeart_pH_ery(varName="rightHeart_pH_ery")
      annotation (Placement(transformation(extent={{146,142},{152,148}})));
      T.pH rightHeart_pH_interstitial(varName="rightHeart_pH_interstitial")
      annotation (Placement(transformation(extent={{146,152},{152,158}})));
      T.pH rightHeart_pH_plasma(varName="rightHeart_pH_plasma")
      annotation (Placement(transformation(extent={{146,162},{152,168}})));
      T.pH skeletalMuscle_pH_ery(varName="skeletalMuscle_pH_ery")
      annotation (Placement(transformation(extent={{92,-78},{98,-72}})));
      T.pH skeletalMuscle_pH_interstitial(varName="skeletalMuscle_pH_interstitial")
      annotation (Placement(transformation(extent={{92,-68},{98,-62}})));
      T.pH skeletalMuscle_pH_plasma(varName="skeletalMuscle_pH_plasma")
      annotation (Placement(transformation(extent={{92,-58},{98,-52}})));
      T.pH skin_pH_ery(varName="skin_pH_ery")
      annotation (Placement(transformation(extent={{146,282},{152,288}})));
      T.pH skin_pH_interstitial(varName="skin_pH_interstitial")
      annotation (Placement(transformation(extent={{146,292},{152,298}})));
      T.pH skin_pH_plasma(varName="skin_pH_plasma")
      annotation (Placement(transformation(extent={{146,302},{152,308}})));
      T.pH Veins_pH(varName="BloodPh.VeinsPh")
      annotation (Placement(transformation(extent={{146,342},{152,348}})));
      T.pH Veins_pH_ery(varName="Veins_pH_ery")
      annotation (Placement(transformation(extent={{-108,-86},{-102,-80}})));
      T.pH lungs_pH_ery(varName="lungs_pH_ery")
      annotation (Placement(transformation(extent={{-116,56},{-110,62}})));
      T.pH lungs_pH_plasma(varName="lungs_pH_plasma")
      annotation (Placement(transformation(extent={{-116,64},{-110,70}})));
      T.pH GITract_pH_intracellular(varName="GITract-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,10},{-30,16}})));
      T.pH bone_pH_intracellular(varName="Bone-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,20},{-30,26}})));
      T.pH brain_pH_intracellular(varName="Brain-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,30},{-30,36}})));
      T.pH fat_pH_intracellular(varName="Fat-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,40},{-30,46}})));
      T.pH kidney_pH_intracellular(varName="Kidney-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,50},{-30,56}})));
      T.pH leftHeart_pH_intracellular(varName="LeftHeart-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,60},{-30,66}})));
      T.pH liver_pH_intracellular(varName="Liver-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,70},{-30,76}})));
      T.pH otherTissue_pH_intracellular(varName="OtherTissue-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,80},{-30,86}})));
      T.pH respiratoryMuscle_pH_intracellular(varName="RespiratoryMuscle-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,90},{-30,96}})));
      T.pH rightHeart_pH_intracellular(varName="RightHeart-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,100},{-30,106}})));
      T.pH skeletalMuscle_pH_intracellular(varName="SkeletalMuscle-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,110},{-30,116}})));
      T.pH skin_pH_intracellular(varName="Skin-Ph.Ph")
      annotation (Placement(transformation(extent={{-36,120},{-30,126}})));
      /*
T.pH CD_NH4_Outflow(varName="CD_NH4.Outflow")
    "Collecting duct amonia ions outflow to urine."
annotation (Placement(transformation(extent={{-110,-130},{-104,-124}})));
T.pH Urine_pH(varName="Urine_pH") "Acidity (pH) of urine."
annotation (Placement(transformation(extent={{-108,-106},{-102,-100}})));
*/
      T.VolumeDensityOfCharge BloodIons_ProteinAnions(
                        varName="BloodIons.Protein")
      annotation (Placement(transformation(extent={{-92,-72},{-86,-66}})));
      equation
      connect(BloodPh_ArtysPh.y, busConnector.BloodPh_ArtysPh) annotation (Line(
       points={{-103.7,-191},{59,-191},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Artys_pH1.y, busConnector.Artys_pH)
                                                 annotation (Line(
       points={{-101.7,-55},{59,-55},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Veins_pH.y, busConnector.Veins_pH) annotation (Line(
       points={{152.3,345},{59,345},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GITract_pH_plasma.y, busConnector.GITract_pH_plasma) annotation (Line(
       points={{152.3,-315},{59,-315},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(bone_pH_plasma.y, busConnector.bone_pH_plasma) annotation (Line(
       points={{-101.7,35},{59,35},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(brain_pH_plasma.y, busConnector.brain_pH_plasma) annotation (Line(
       points={{-101.7,105},{59,105},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(fat_pH_plasma.y, busConnector.fat_pH_plasma) annotation (Line(
       points={{-93.7,-7},{59,-7},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(kidney_pH_plasma.y, busConnector.kidney_pH_plasma) annotation (Line(
       points={{152.3,-235},{59,-235},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(leftHeart_pH_plasma.y, busConnector.leftHeart_pH_plasma) annotation (Line(
       points={{152.3,-165},{59,-165},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(liver_pH_plasma.y, busConnector.liver_pH_plasma) annotation (Line(
       points={{152.3,-105},{59,-105},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(otherTissue_pH_plasma.y, busConnector.otherTissue_pH_plasma) annotation (Line(
       points={{152.3,-5},{59,-5},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(respiratoryMuscle_pH_plasma.y, busConnector.respiratoryMuscle_pH_plasma) annotation (Line(
       points={{152.3,85},{59,85},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(rightHeart_pH_plasma.y, busConnector.rightHeart_pH_plasma) annotation (Line(
       points={{152.3,165},{59,165},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_pH_plasma.y, busConnector.skeletalMuscle_pH_plasma) annotation (Line(
       points={{98.3,-55},{59,-55},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skin_pH_plasma.y, busConnector.skin_pH_plasma) annotation (Line(
       points={{152.3,305},{59,305},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GITract_pH_ery.y, busConnector.GITract_pH_ery) annotation (Line(
       points={{152.3,-335},{59,-335},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Veins_pH_ery.y, busConnector.Veins_pH_ery) annotation (Line(
       points={{-101.7,-83},{-62.35,-83},{-62.35,-21},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(bone_pH_ery.y, busConnector.bone_pH_ery) annotation (Line(
       points={{-101.7,15},{59,15},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(brain_pH_ery.y, busConnector.brain_pH_ery) annotation (Line(
       points={{-101.7,85},{59,85},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(fat_pH_ery.y, busConnector.fat_pH_ery) annotation (Line(
       points={{-93.7,-27},{59,-27},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(kidney_pH_ery.y, busConnector.kidney_pH_ery) annotation (Line(
       points={{152.3,-255},{59,-255},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(leftHeart_pH_ery.y, busConnector.leftHeart_pH_ery) annotation (Line(
       points={{152.3,-185},{59,-185},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(liver_pH_ery.y, busConnector.liver_pH_ery) annotation (Line(
       points={{152.3,-125},{59,-125},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(otherTissue_pH_ery.y, busConnector.otherTissue_pH_ery) annotation (Line(
       points={{152.3,-25},{59,-25},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(respiratoryMuscle_pH_ery.y, busConnector.respiratoryMuscle_pH_ery) annotation (Line(
       points={{152.3,65},{59,65},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(rightHeart_pH_ery.y, busConnector.rightHeart_pH_ery) annotation (Line(
       points={{152.3,145},{59,145},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_pH_ery.y, busConnector.skeletalMuscle_pH_ery) annotation (Line(
       points={{98.3,-75},{59,-75},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skin_pH_ery.y, busConnector.skin_pH_ery) annotation (Line(
       points={{152.3,285},{59,285},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Artys_pH_ery.y, busConnector.Artys_pH_ery) annotation (Line(
       points={{-101.7,-45},{59,-45},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(bone_pH_interstitial.y, busConnector.bone_pH_interstitial) annotation (Line(
       points={{-101.7,25},{59,25},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(brain_pH_interstitial.y, busConnector.brain_pH_interstitial) annotation (Line(
       points={{-101.7,95},{59,95},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(fat_pH_interstitial.y, busConnector.fat_pH_interstitial) annotation (Line(
       points={{-93.7,-17},{59,-17},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GITract_pH_interstitial.y, busConnector.GITract_pH_interstitial) annotation (Line(
       points={{152.3,-325},{59,-325},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(kidney_pH_interstitial.y, busConnector.kidney_pH_interstitial) annotation (Line(
       points={{152.3,-245},{59,-245},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(leftHeart_pH_interstitial.y, busConnector.leftHeart_pH_interstitial) annotation (Line(
       points={{152.3,-175},{59,-175},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(liver_pH_interstitial.y, busConnector.liver_pH_interstitial) annotation (Line(
       points={{152.3,-115},{152.3,-82},{152.3,-21},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(otherTissue_pH_interstitial.y, busConnector.otherTissue_pH_interstitial) annotation (Line(
       points={{152.3,-15},{126.65,-15},{126.65,-21},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(respiratoryMuscle_pH_interstitial.y, busConnector.respiratoryMuscle_pH_interstitial) annotation (Line(
       points={{152.3,75},{59,75},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(rightHeart_pH_interstitial.y, busConnector.rightHeart_pH_interstitial) annotation (Line(
       points={{152.3,155},{59,155},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_pH_interstitial.y, busConnector.skeletalMuscle_pH_interstitial) annotation (Line(
       points={{98.3,-65},{59,-65},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skin_pH_interstitial.y, busConnector.skin_pH_interstitial) annotation (Line(
       points={{152.3,295},{59,295},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(lungs_pH_ery.y, busConnector.lungs_pH_ery)      annotation (Line(
              points={{-109.7,59},{59,59},{59,-21}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        connect(lungs_pH_plasma.y, busConnector.lungs_pH_plasma)   annotation (Line(
              points={{-109.7,67},{59,67},{59,-21}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        connect(GITract_pH_intracellular.y, busConnector.GITract_pH_intracellular) annotation (Line(
       points={{-29.7,13},{59,13},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(bone_pH_intracellular.y, busConnector.bone_pH_intracellular) annotation (Line(
       points={{-29.7,23},{59,23},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(brain_pH_intracellular.y, busConnector.brain_pH_intracellular) annotation (Line(
       points={{-29.7,33},{59,33},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(fat_pH_intracellular.y, busConnector.fat_pH_intracellular) annotation (Line(
       points={{-29.7,43},{59,43},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(kidney_pH_intracellular.y, busConnector.kidney_pH_intracellular) annotation (Line(
       points={{-29.7,53},{59,53},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(leftHeart_pH_intracellular.y, busConnector.leftHeart_pH_intracellular) annotation (Line(
       points={{-29.7,63},{59,63},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(liver_pH_intracellular.y, busConnector.liver_pH_intracellular) annotation (Line(
       points={{-29.7,73},{59,73},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(otherTissue_pH_intracellular.y, busConnector.otherTissue_pH_intracellular) annotation (Line(
       points={{-29.7,83},{59,83},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(respiratoryMuscle_pH_intracellular.y, busConnector.respiratoryMuscle_pH_intracellular) annotation (Line(
       points={{-29.7,93},{59,93},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(rightHeart_pH_intracellular.y, busConnector.rightHeart_pH_intracellular) annotation (Line(
       points={{-29.7,103},{59,103},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_pH_intracellular.y, busConnector.skeletalMuscle_pH_intracellular) annotation (Line(
       points={{-29.7,113},{59,113},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skin_pH_intracellular.y, busConnector.skin_pH_intracellular) annotation (Line(
       points={{-29.7,123},{59,123},{59,-21}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

      connect(BloodIons_ProteinAnions.y, busConnector.BloodIons_ProteinAnions)
        annotation (Line(
          points={{-85.7,-69},{-10,-69},{-10,-21},{59,-21}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={
              Text(
                extent={{18,138},{100,100}},
                lineColor={0,0,0},
                textString="vars"),
              Text(
                extent={{-122,-106},{120,-140}},
                lineColor={0,0,255},
                textString="%name")}));
      end AcidBase_variables;
      annotation (Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Siggaard Andersen: OSA (2005), University of Copenhagen</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
    end AcidBase;

    package Sodium "Body Sodium Distribution"

      model GlomerulusCationFiltration

      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (extent=
           [-10,-110; 10,-90], Placement(transformation(extent={{90,-10},{110,
                10}})));

      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
          Placement(transformation(extent={{-120,-20},{-80,20}}),
            iconTransformation(extent={{-110,-10},{-90,10}})));

        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput otherCations annotation (Placement(
              transformation(extent={{-78,30},{-38,70}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-60,50})));
        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput ProteinAnions annotation (Placement(
              transformation(extent={{-40,30},{0,70}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-20,50})));
        Physiolibrary.Types.Fraction KAdjustment;
        Physiolibrary.Types.VolumeDensityOfCharge Cations;
        Physiolibrary.Types.VolumeDensityOfCharge Anions;
      equation
        q_in.q + q_out.q = 0;
        Cations = q_in.conc*Modelica.Constants.F+otherCations;
        Anions = Cations;
        KAdjustment = (Cations-(Anions-ProteinAnions))/(Cations+(Anions-ProteinAnions));
        q_out.conc = (1-KAdjustment)*q_in.conc;

       annotation (
          Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,-100},{
                  100,100}}), graphics={
              Rectangle(
                extent={{-100,-50},{100,50}},
                lineColor={0,0,127},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid),
              Text(
                extent={{-150,-100},{150,-60}},
                textString="%name",
                lineColor={0,0,255}),
              Line(
                points={{0,42},{0,26}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,20},{0,4}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,-4},{0,-20}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,-26},{0,-42}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5)}));
      end GlomerulusCationFiltration;

      package test
        model T_
        import QHP = Physiomodel;
          Physiomodel.Electrolytes.Sodium.Sodium sodium2_1
            annotation (Placement(transformation(extent={{-32,30},{-12,50}})));
        QHP.Electrolytes.old.setup.ElectrolytesConstInputs2FromFile
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{14,48},{34,68}})));
          QHP.Electrolytes.Sodium.setup.ConstInputsFromOtherElectrolytes
            constInputsFromOtherElectrolytes
            annotation (Placement(transformation(extent={{14,12},{34,32}})));
        equation
          connect(sodium2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-14,48},{4.05,48},{4.05,58},{22,58}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(sodium2_1.busConnector, constInputsFromOtherElectrolytes.busConnector)
            annotation (Line(
              points={{-14,48},{5.05,48},{5.05,22},{22,22}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T_;

        model T
        import QHP = Physiomodel;
          Sodium2 sodium2_1
            annotation (Placement(transformation(extent={{-32,30},{-12,50}})));
        QHP.Electrolytes.old.setup.ElectrolytesConstInputs
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{14,48},{34,68}})));
          QHP.Electrolytes.Sodium.setup.ConstInputsFromOtherElectrolytes
            constInputsFromOtherElectrolytes
            annotation (Placement(transformation(extent={{14,12},{34,32}})));
        equation
          connect(sodium2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-14,48},{4.05,48},{4.05,58},{22,58}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(sodium2_1.busConnector, constInputsFromOtherElectrolytes.busConnector)
            annotation (Line(
              points={{-14,48},{5.05,48},{5.05,22},{22,22}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T;

        model Sodium
        Physiolibrary.Chemical.Components.Substance NaPool(useNormalizedVolume=
              false, solute_start=(2170.0)/1000)
          annotation (Placement(transformation(extent={{-82,14},{-62,34}})));
          Modelica.Blocks.Interfaces.RealInput ECFV_Vol(final quantity="Volume",
              final displayUnit="ml") "Extracellular fluid volume"
            annotation (Placement(transformation(extent={{-98,28},{-90,36}}),
                iconTransformation(extent={{-100,70},{-88,82}})));
        Physiolibrary.Chemical.Components.Substance GILumen(useNormalizedVolume=
             false, solute_start=(80.0)/1000)
          annotation (Placement(transformation(extent={{-82,-36},{-62,-16}})));
          Modelica.Blocks.Interfaces.RealInput GILumenVolume_Mass(final
              quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{-98,-22},{-90,-14}}),
                iconTransformation(extent={{-100,58},{-88,70}})));
        Physiolibrary.Chemical.Components.SolutePump Absorbtion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,-20},{-46,-32}})));
          Modelica.Blocks.Math.Gain Perm(k=0.0015)
            annotation (Placement(transformation(extent={{-62,-46},{-56,-40}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,64},{-38,84}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,50},{-38,70}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut SweatDuct(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,78},{-38,98}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-78,70},{-58,90}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-78,56},{-58,76}})));
        Physiolibrary.Chemical.Components.Stream glomerulusSudiumRate(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{-16,14},{4,34}})));
          Modelica.Blocks.Interfaces.RealInput GlomerulusFiltrate_GFR(final
              quantity="VolumeFlowRate", final displayUnit="ml/min")
            annotation (Placement(transformation(extent={{-16,30},{-8,38}}),
                iconTransformation(extent={{-100,-16},{-88,-4}})));
          Physiomodel.Electrolytes.Sodium.GlomerulusCationFiltration glomerulus
            annotation (Placement(transformation(extent={{-40,14},{-20,34}})));
          Modelica.Blocks.Interfaces.RealInput KPool(final quantity=
                "Concentration", final displayUnit="mEq/l")
            annotation (Placement(transformation(extent={{-48,32},{-40,40}}),
                iconTransformation(extent={{-100,94},{-88,106}})));
          Modelica.Blocks.Interfaces.RealInput BloodIons_ProteinAnions(final
              quantity="Concentration", final displayUnit="mEq/l")
            annotation (Placement(transformation(extent={{-48,40},{-40,48}}),
                iconTransformation(extent={{-100,82},{-88,94}})));
        Physiolibrary.Chemical.Components.Reabsorption PT(
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{8,14},{28,34}})));
        Physiolibrary.Types.Constants.FractionConst const1(k=0.58)
          annotation (Placement(transformation(extent={{2,30},{8,36}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 IFPEffect( data=
               {{1.0,1.4,0},{4.0,1.0,-0.2},{7.0,0.3,0}})
            annotation (Placement(transformation(extent={{14,32},{34,52}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 ANPEffect( data=
               {{0.0,1.2,0},{1.3,1.0,-0.2},{2.7,0.6,0}})
            annotation (Placement(transformation(extent={{14,40},{34,60}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 SympsEffect(
              data={{0.6,0.6,0},{1.0,1.0,0.5},{4.0,1.5,0}})
            annotation (Placement(transformation(extent={{14,48},{34,68}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 A2Effect( data=
                {{0.7,0.8,0},{1.3,1.0,0.8},{1.6,1.2,0}})
            annotation (Placement(transformation(extent={{14,56},{34,76}})));
          Modelica.Blocks.Interfaces.RealInput NephronIFP_Pressure(final
              quantity=
               "Pressure", final displayUnit="mmHg")
            annotation (Placement(transformation(extent={{-4,38},{4,46}}),
                iconTransformation(extent={{-100,-28},{-88,-16}})));
          Modelica.Blocks.Interfaces.RealInput NephronANP_Log10Conc(final displayUnit=
                "log10(pMol/L)")
            annotation (Placement(transformation(extent={{-4,46},{4,54}}),
                iconTransformation(extent={{-100,-64},{-88,-52}})));
          Modelica.Blocks.Interfaces.RealInput KidneyAlpha_PT_NA(final displayUnit="Hz")
            annotation (Placement(transformation(extent={{-4,54},{4,62}}),
                iconTransformation(extent={{-100,-40},{-88,-28}})));
          Modelica.Blocks.Interfaces.RealInput A2Pool_Log10Con(final displayUnit=
                "log10(pG/mL)")
            annotation (Placement(transformation(extent={{-4,62},{4,70}}),
                iconTransformation(extent={{-100,-52},{-88,-40}})));
          Modelica.Blocks.Interfaces.RealInput KidneyFunctionEffect(final displayUnit=
                "1")
            annotation (Placement(transformation(extent={{12,80},{20,88}}),
                iconTransformation(extent={{-100,8},{-88,20}})));
        Physiolibrary.Chemical.Components.Reabsorption LH(
          MaxReab=7,
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{68,14},{88,34}})));
        Physiolibrary.Types.Constants.FractionConst const2(k=0.75)
          annotation (Placement(transformation(extent={{64,30},{70,36}})));
        Physiolibrary.Chemical.Components.Reabsorption DT(
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{80,-74},{60,-54}})));
        Physiolibrary.Chemical.Components.Reabsorption CD(
          MaxReab=0.7,
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{30,-74},{10,-54}})));
        Physiolibrary.Types.Constants.FractionConst const3(k=0.75)
          annotation (Placement(transformation(extent={{18,-58},{24,-52}})));
        Physiolibrary.Types.Constants.FractionConst const4(k=0.75)
          annotation (Placement(transformation(extent={{68,-58},{74,-52}})));
        Physiolibrary.Chemical.Components.Substance Bladder(useNormalizedVolume=
             false, solute_start=(0)/1000)
          annotation (Placement(transformation(extent={{-28,-34},{-8,-14}})));
          Modelica.Blocks.Interfaces.RealInput BladderVolume_Mass(final
              quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{-12,-10},{-20,-2}}),
                iconTransformation(extent={{-100,46},{-88,58}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue2 Furosemide(
              data={{0.0,1.0,-1},{0.1,0.0,0}})
            annotation (Placement(transformation(extent={{64,62},{84,82}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue2 AldoEffect(
              data={{0.0,0.7,0},{10.0,1.0,0}})
            annotation (Placement(transformation(extent={{76,40},{96,60}})));
          Modelica.Blocks.Interfaces.RealInput
            KidneyNephronCount_Filtering_xNormal(final displayUnit="1")
            annotation (Placement(transformation(extent={{50,60},{58,68}}),
                iconTransformation(extent={{-100,-4},{-88,8}})));
          Modelica.Blocks.Interfaces.RealInput FurosemidePool_Furosemide_conc(
              final quantity="Concentration", final displayUnit="ug/ml")
            annotation (Placement(transformation(extent={{50,68},{58,76}}),
                iconTransformation(extent={{-100,-88},{-88,-76}})));
          Modelica.Blocks.Interfaces.RealInput NephronAldo_conc_in_nG_per_dL(
              final quantity="Concentration", final displayUnit="ng/dl")
            annotation (Placement(transformation(extent={{56,46},{64,54}}),
                iconTransformation(extent={{-100,-76},{-88,-64}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 LoadEffect(
              data={{0.0,3.0,0},{7.2,1.0,-0.2},{20.0,0.5,0}})
            annotation (Placement(transformation(extent={{76,32},{96,52}})));
        Physiolibrary.Blocks.Factors.Normalization FurosemideEffect
          annotation (Placement(transformation(extent={{76,48},{96,68}})));
        Physiolibrary.Blocks.Factors.Normalization Filtering_xNormal
          annotation (Placement(transformation(extent={{64,54},{84,74}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
          annotation (Placement(transformation(extent={{50,14},{70,34}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure1
          annotation (Placement(transformation(extent={{98,-74},{78,-54}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue2 LoadEffect1(
              data={{0.0,2.0,0},{1.6,1.0,0}})
            annotation (Placement(transformation(extent={{72,-56},{52,-36}})));
           Physiolibrary.Factors.NonlinearSystemPatch.SplineValue2
            ThiazideEffect(data={{0.0,1.0,-2.0},{0.6,0.2,0.0}})
            annotation (Placement(transformation(extent={{72,-40},{52,-20}})));
          Modelica.Blocks.Interfaces.RealInput ThiazidePool_Thiazide_conc(final
              quantity="Concentration", final displayUnit="ug/ml")
            annotation (Placement(transformation(extent={{92,-34},{84,-26}}),
                iconTransformation(extent={{-100,-100},{-88,-88}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure2
          annotation (Placement(transformation(extent={{58,-74},{38,-54}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue2 LoadEffect2(
              data={{0.0,2.0,0},{0.4,1.0,0}})
            annotation (Placement(transformation(extent={{22,-58},{2,-38}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 ANPEffect2(
              data={{0.0,1.2,0},{1.3,1.0,-0.4},{2.7,0.2,0}})
            annotation (Placement(transformation(extent={{22,-50},{2,-30}})));
          Modelica.Blocks.Interfaces.RealInput IVDrip_NaRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-82,82},{-74,90}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-40,98})));
          Modelica.Blocks.Interfaces.RealInput Transfusion_NaRate(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-82,66},{-74,74}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-28,98})));
          Modelica.Blocks.Interfaces.RealInput SweatDuct_NaRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-36,90},{-42,96}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-16,98})));
          Modelica.Blocks.Interfaces.RealInput Hemorrhage_NaRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-36,76},{-42,82}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-4,98})));
        Physiolibrary.Blocks.Factors.Normalization AldoEffect2 annotation (
            Placement(transformation(
              extent={{10,-10},{-10,10}},
              rotation=270,
              origin={84,-78})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant const5(k=2)
          annotation (Placement(transformation(extent={{94,-80},{90,-76}})));
          Modelica.Blocks.Interfaces.RealInput DialyzerActivity_Na_Flux(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-36,62},{-42,68}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={8,98})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-100,-42},{-80,-22}})));
          Modelica.Blocks.Interfaces.RealInput DietIntakeElectrolytes_Na(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-100,-30},{-92,-22}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={20,98})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
            useSoluteFlowInput=true) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={-90,-44})));
          Modelica.Blocks.Interfaces.RealInput GILumenDiarrhea_NaLoss(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{3,-3},{-3,3}},
                rotation=180,
                origin={-93,-51}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={32,98})));
          Modelica.Blocks.Interfaces.RealOutput PT_FractReab
                                          annotation (Placement(transformation(extent={{28,16},
                    {36,24}}),         iconTransformation(extent={{100,60},{120,
                    80}})));
          Modelica.Blocks.Interfaces.RealOutput LH_FractReab
                                          annotation (Placement(transformation(extent={{88,6},{
                    96,14}}),          iconTransformation(extent={{100,40},{120,
                    60}})));
          Modelica.Blocks.Interfaces.RealOutput DT_Outflow
                                          annotation (Placement(transformation(extent={{-4,-4},
                    {4,4}},
                rotation=180,
                origin={46,-54}),      iconTransformation(extent={{100,20},{120,
                    40}})));
          Modelica.Blocks.Interfaces.RealOutput CD_Outflow
                                          annotation (Placement(transformation(extent={{-4,-4},
                    {4,4}},
                rotation=180,
                origin={-4,-72}),      iconTransformation(extent={{100,0},{120,20}})));
          Modelica.Blocks.Interfaces.RealOutput Medulla_Conc
                                          annotation (Placement(transformation(extent={{54,-96},
                    {62,-88}}),        iconTransformation(extent={{100,-20},{120,
                    0}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure3
          annotation (Placement(transformation(extent={{10,-54},{-10,-74}})));
        Physiolibrary.Chemical.Components.Substance Medulla(useNormalizedVolume=
             false, solute_start=(13)/1000)
          annotation (Placement(transformation(extent={{28,-102},{48,-82}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={46,-92})));
        Physiolibrary.Chemical.Components.Stream VasaRectaOutflow(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{-4,-100},{-20,-84}})));
          Modelica.Blocks.Interfaces.RealInput VasaRecta_Outflow(final quantity="VolumeFlowRate", final displayUnit="ml/min")
            annotation (Placement(transformation(extent={{-46,-88},{-38,-80}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                origin={-94,26})));
          Modelica.Blocks.Math.Gain gain(k=0.03)
            annotation (Placement(transformation(extent={{-28,-88},{-20,-80}})));
          Modelica.Blocks.Interfaces.RealInput Medulla_Volume(final quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{8,-88},{16,-80}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                origin={-94,40})));
          Modelica.Blocks.Interfaces.RealOutput NaPool_mass
                                          annotation (Placement(transformation(extent={{-68,2},
                    {-60,10}}),        iconTransformation(extent={{100,100},{120,
                    120}})));
          Modelica.Blocks.Interfaces.RealOutput NaPool_conc_per_liter
                                          annotation (Placement(transformation(extent={{-64,-8},
                    {-56,0}}),         iconTransformation(extent={{100,80},{120,
                    100}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure1 annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={-80,-4})));
          Modelica.Blocks.Math.Gain gain1(k=1000)
            annotation (Placement(transformation(extent={{-70,-6},{-66,-2}})));
        Physiolibrary.Chemical.Components.Clearance bladderVoid(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{12,-22},{24,-10}})));
          Modelica.Blocks.Interfaces.RealInput BladderVoidFlow(final quantity="VolumeFlowRate", final displayUnit="ml/min")
            annotation (Placement(transformation(extent={{4,-10},{12,-2}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                origin={-94,-106})));
          Modelica.Blocks.Interfaces.RealOutput GILumenSodium_Mass
                                          annotation (Placement(transformation(extent={{-64,-60},
                    {-56,-52}}),       iconTransformation(extent={{100,-40},{120,
                    -20}})));
        Physiolibrary.Blocks.Factors.Normalization AldosteroneEffect
          annotation (Placement(transformation(extent={{72,-48},{52,-28}})));
        Physiolibrary.Blocks.Interpolation.NonlinearSystemPatch.Curve3
          DT_AldoEffect(
          x={0,12,50},
          y={0.5,1,3},
          slope={0,0.08,0})
          annotation (Placement(transformation(extent={{60,-22},{80,-2}})));
          Modelica.Blocks.Interfaces.RealOutput DT_AldosteroneEffect
                                          annotation (Placement(transformation(
                  extent={{90,-16},{98,-8}}), iconTransformation(extent={{100,-60},
                    {120,-40}})));
          Modelica.Blocks.Interfaces.RealOutput DT_Na_Reab
                                          annotation (Placement(transformation(
                  extent={{60,-86},{68,-78}}), iconTransformation(extent={{100,-80},
                    {120,-60}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure4
          annotation (Placement(transformation(extent={{64,-68},{44,-88}})));
          Modelica.Blocks.Interfaces.RealOutput LH_Na_Reab
                                          annotation (Placement(transformation(
                  extent={{76,-2},{84,6}}), iconTransformation(extent={{100,-100},
                    {120,-80}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure5
          annotation (Placement(transformation(extent={{80,16},{60,-4}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure6
          annotation (Placement(transformation(
              extent={{10,10},{-10,-10}},
              rotation=90,
              origin={18,12})));
          Modelica.Blocks.Interfaces.RealOutput PT_Na_Reab
                                          annotation (Placement(transformation(
                  extent={{24,8},{32,16}}), iconTransformation(extent={{100,-120},
                    {120,-100}})));
        equation
        connect(NaPool.solutionVolume, ECFV_Vol) annotation (Line(
            points={{-80,30},{-87,30},{-87,32},{-94,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GILumen.solutionVolume, GILumenVolume_Mass) annotation (Line(
            points={{-80,-20},{-87,-20},{-87,-18},{-94,-18}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
              points={{-72,-26},{-65,-26},{-65,-26},{-58,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Absorbtion.q_out, NaPool.q_out) annotation (Line(
              points={{-46,-26},{-44,-26},{-44,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Hemorrhage.q_in, NaPool.q_out) annotation (Line(
              points={{-54,74},{-58,74},{-58,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, NaPool.q_out) annotation (Line(
              points={{-54,60},{-58,60},{-58,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(NaPool.q_out, SweatDuct.q_in) annotation (Line(
              points={{-72,24},{-58,24},{-58,88},{-54,88}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, NaPool.q_out) annotation (Line(
              points={{-62,66},{-58,66},{-58,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, NaPool.q_out) annotation (Line(
              points={{-62,80},{-58,80},{-58,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(glomerulusSudiumRate.solutionFlow, GlomerulusFiltrate_GFR)
          annotation (Line(
            points={{-6,30},{-6,34},{-12,34}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(glomerulus.q_in, NaPool.q_out) annotation (Line(
              points={{-40,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(glomerulus.q_out, glomerulusSudiumRate.q_in) annotation (Line(
              points={{-20,24},{-16,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(glomerulusSudiumRate.q_out, PT.Inflow) annotation (Line(
              points={{4,24},{8,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(const1.y, PT.baseReabsorption) annotation (Line(
            points={{8.3,33},{12,33},{12,28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(A2Effect.yBase, KidneyFunctionEffect) annotation (Line(
              points={{24,68},{24,84},{16,84}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(A2Effect.y, SympsEffect.yBase) annotation (Line(
              points={{24,64},{24,60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(SympsEffect.y, ANPEffect.yBase) annotation (Line(
              points={{24,56},{24,52}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ANPEffect.y, IFPEffect.yBase) annotation (Line(
              points={{24,48},{24,44}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(IFPEffect.y, PT.Effect) annotation (Line(
            points={{24,40},{24,28},{26,28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(A2Pool_Log10Con, A2Effect.u) annotation (Line(
              points={{0,66},{14.2,66}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(SympsEffect.u, KidneyAlpha_PT_NA) annotation (Line(
              points={{14.2,58},{0,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(NephronANP_Log10Conc, ANPEffect.u) annotation (Line(
              points={{0,50},{14.2,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(NephronIFP_Pressure, IFPEffect.u) annotation (Line(
              points={{0,42},{14.2,42}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(const2.y, LH.baseReabsorption) annotation (Line(
            points={{70.3,33},{72,33},{72,28}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(const3.y, CD.baseReabsorption) annotation (Line(
            points={{24.3,-55},{26,-55},{26,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(const4.y, DT.baseReabsorption) annotation (Line(
            points={{74.3,-55},{76,-55},{76,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Bladder.solutionVolume, BladderVolume_Mass) annotation (Line(
            points={{-26,-18},{-36,-18},{-36,-6},{-16,-6}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(NephronAldo_conc_in_nG_per_dL, AldoEffect.u)
                                               annotation (Line(
              points={{60,50},{76.2,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Furosemide.u, FurosemidePool_Furosemide_conc)
                                                    annotation (Line(
              points={{64.2,72},{54,72}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AldoEffect.y, LoadEffect.yBase) annotation (Line(
              points={{86,48},{86,44}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(LoadEffect.y, LH.Effect) annotation (Line(
            points={{86,40},{86,28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(FurosemideEffect.y, AldoEffect.yBase) annotation (Line(
              points={{86,56},{86,52}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Filtering_xNormal.u, KidneyNephronCount_Filtering_xNormal)
            annotation (Line(
              points={{64.2,64},{54,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Filtering_xNormal.y, FurosemideEffect.u) annotation (Line(
              points={{74,62},{74,58},{76.2,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Furosemide.y, Filtering_xNormal.yBase) annotation (Line(
              points={{74,70},{74,66}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunctionEffect, Furosemide.yBase) annotation (Line(
              points={{16,84},{74,84},{74,74}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(FurosemideEffect.yBase, KidneyFunctionEffect) annotation (Line(
              points={{86,60},{86,84},{16,84}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(PT.Outflow, flowMeasure.q_in) annotation (Line(
              points={{28,24},{56,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure.q_out, LH.Inflow) annotation (Line(
              points={{64,24},{68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(flowMeasure.molarFlowRate, LoadEffect.u) annotation (Line(
            points={{60,29},{60,42},{76.2,42}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(DT.Inflow, flowMeasure1.q_out) annotation (Line(
              points={{80,-64},{84,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure1.q_in, LH.Outflow) annotation (Line(
              points={{92,-64},{100,-64},{100,24},{88,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(LoadEffect1.y, DT.Effect) annotation (Line(
            points={{62,-48},{62,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(LoadEffect1.u, flowMeasure1.molarFlowRate) annotation (Line(
            points={{71.8,-46},{88,-46},{88,-59}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(DT_AldoEffect.u, NephronAldo_conc_in_nG_per_dL)
                                                                annotation (Line(
              points={{60,-12},{50,-12},{50,48},{66,48},{66,50},{60,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.yBase, KidneyFunctionEffect) annotation (Line(
              points={{62,-28},{62,-26},{46,-26},{46,84},{16,84}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.u, ThiazidePool_Thiazide_conc) annotation (Line(
              points={{71.8,-30},{88,-30}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(CD.Inflow, flowMeasure2.q_out) annotation (Line(
              points={{30,-64},{44,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure2.q_in, DT.Outflow) annotation (Line(
              points={{52,-64},{60,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(LoadEffect2.y, CD.Effect) annotation (Line(
            points={{12,-50},{12,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(LoadEffect2.u, flowMeasure2.molarFlowRate) annotation (Line(
            points={{21.8,-48},{48,-48},{48,-59}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(ANPEffect2.y, LoadEffect2.yBase) annotation (Line(
              points={{12,-42},{12,-46}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ANPEffect2.yBase, KidneyFunctionEffect) annotation (Line(
              points={{12,-38},{12,-26},{46,-26},{46,84},{16,84}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ANPEffect2.u, NephronANP_Log10Conc) annotation (Line(
              points={{21.8,-40},{40,-40},{40,38},{6,38},{6,50},{0,50}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(IVDrip.soluteFlow, IVDrip_NaRate) annotation (Line(
            points={{-68,84},{-68,86},{-78,86}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Transfusion.soluteFlow, Transfusion_NaRate) annotation (Line(
            points={{-68,70},{-78,70}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SweatDuct.soluteFlow, SweatDuct_NaRate) annotation (Line(
            points={{-48,92},{-48,93},{-39,93}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(const5.y, AldoEffect2.yBase) annotation (Line(
              points={{89.8,-78},{86,-78}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AldoEffect2.y, DT.MaxReab) annotation (Line(
              points={{82,-78},{76,-78},{76,-68.2}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Hemorrhage_NaRate, Hemorrhage.soluteFlow) annotation (Line(
            points={{-39,79},{-47.5,79},{-47.5,78},{-48,78}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(DialyzerActivity.soluteFlow, DialyzerActivity_Na_Flux)
          annotation (Line(
            points={{-48,64},{-48,65},{-39,65}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(glomerulus.otherCations, KPool) annotation (Line(
              points={{-36,29},{-36,36},{-44,36}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(glomerulus.ProteinAnions, BloodIons_ProteinAnions) annotation (
              Line(
              points={{-32,29},{-32,44},{-44,44}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Diet.soluteFlow, DietIntakeElectrolytes_Na) annotation (Line(
            points={{-90,-28},{-94,-28},{-94,-26},{-96,-26}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Diet.q_out, GILumen.q_out) annotation (Line(
              points={{-84,-32},{-80,-32},{-80,-26},{-72,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Diarrhea.soluteFlow, GILumenDiarrhea_NaLoss) annotation (Line(
            points={{-90,-48},{-90,-51},{-93,-51}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
              points={{-72,-26},{-80,-26},{-80,-44},{-84,-44}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(GILumen.solute, Perm.u) annotation (Line(
            points={{-72,-33.8},{-72,-43},{-62.6,-43}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
              points={{-55.7,-43},{-52,-43},{-52,-29.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(PT.ReabFract, PT_FractReab) annotation (Line(
              points={{28,20},{32,20}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(LH.ReabFract, LH_FractReab) annotation (Line(
              points={{88,20},{92,20},{92,10},{92,10}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(flowMeasure2.molarFlowRate, DT_Outflow) annotation (Line(
            points={{48,-59},{48,-54},{46,-54}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(CD.Outflow, flowMeasure3.q_in) annotation (Line(
              points={{10,-64},{4,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure3.q_out, Bladder.q_out) annotation (Line(
              points={{-4,-64},{-6,-64},{-6,-24},{-18,-24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(flowMeasure3.molarFlowRate, CD_Outflow) annotation (Line(
            points={{0,-69},{0,-72},{-4,-72}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(CD.Reabsorption, Medulla.q_out) annotation (Line(
              points={{20,-68},{20,-92},{38,-92}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Medulla.q_out, concentrationMeasure.q_in) annotation (Line(
              points={{38,-92},{46,-92}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(concentrationMeasure.concentration, Medulla_Conc) annotation (
            Line(
            points={{50,-92},{58,-92}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Medulla.q_out, VasaRectaOutflow.q_in) annotation (Line(
              points={{38,-92},{-4,-92}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(VasaRectaOutflow.q_out, NaPool.q_out) annotation (Line(
              points={{-20,-92},{-44,-92},{-44,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(gain.y, VasaRectaOutflow.solutionFlow) annotation (Line(
            points={{-19.6,-84},{-12,-84},{-12,-87.2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(VasaRecta_Outflow, gain.u) annotation (Line(
              points={{-42,-84},{-28.8,-84}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Medulla.solutionVolume, Medulla_Volume) annotation (Line(
            points={{30,-86},{21,-86},{21,-84},{12,-84}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(NaPool.solute, NaPool_mass) annotation (Line(
            points={{-72,16.2},{-72,6},{-64,6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure1.concentration, gain1.u) annotation (Line(
            points={{-76,-4},{-73.2,-4},{-73.2,-4},{-70.4,-4}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(gain1.y, NaPool_conc_per_liter) annotation (Line(
              points={{-65.8,-4},{-60,-4}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(concentrationMeasure1.q_in, NaPool.q_out) annotation (Line(
              points={{-80,-4},{-80,24},{-72,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
              points={{-18,-24},{-4,-24},{-4,-16},{12,-16}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(bladderVoid.solutionFlow, BladderVoidFlow) annotation (Line(
            points={{18,-12.4},{18,-6},{8,-6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GILumen.solute, GILumenSodium_Mass) annotation (Line(
            points={{-72,-33.8},{-72,-56},{-60,-56}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(AldosteroneEffect.y, LoadEffect1.yBase) annotation (Line(
              points={{62,-40},{62,-44}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.y, AldosteroneEffect.yBase) annotation (Line(
              points={{62,-32},{62,-36}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AldosteroneEffect.u, DT_AldoEffect.val) annotation (Line(
              points={{71.8,-38},{96,-38},{96,-12},{80.2,-12}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(DT_AldoEffect.val, AldoEffect2.u) annotation (Line(
              points={{80.2,-12},{96,-12},{96,-94},{84,-94},{84,-87.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(DT_AldoEffect.val, DT_AldosteroneEffect) annotation (Line(
              points={{80.2,-12},{94,-12}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(flowMeasure4.molarFlowRate, DT_Na_Reab) annotation (Line(
            points={{54,-83},{60,-83},{60,-82},{64,-82}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(DT.Reabsorption, flowMeasure4.q_in) annotation (Line(
              points={{70,-68},{70,-78},{58,-78}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure4.q_out, NaPool.q_out) annotation (Line(
              points={{50,-78},{-44,-78},{-44,24},{-72,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure5.molarFlowRate, LH_Na_Reab) annotation (Line(
            points={{70,1},{76,1},{76,2},{80,2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(LH.Reabsorption, flowMeasure5.q_in) annotation (Line(
              points={{78,20},{78,6},{74,6}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure5.q_out, NaPool.q_out) annotation (Line(
              points={{66,6},{-44,6},{-44,24},{-72,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure6.molarFlowRate, PT_Na_Reab) annotation (Line(
            points={{23,12},{28,12}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(PT.Reabsorption, flowMeasure6.q_in) annotation (Line(
              points={{18,20},{18,16}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure6.q_out, NaPool.q_out) annotation (Line(
              points={{18,8},{18,6},{-44,6},{-44,24},{-72,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={Bitmap(extent={{-100,100},{100,-100}}, fileName=
                      "../Physiolibrary/icons/Na.jpg")}));
        end Sodium;

        model Sodium2
        Physiolibrary.Chemical.Components.Substance NaPool(
          stateName="NaPool.Mass",
          useNormalizedVolume=false,
          solute_start=(2058.45)/1000)
          annotation (Placement(transformation(extent={{-86,14},{-66,34}})));
        Physiolibrary.Chemical.Components.Substance GILumen(
          stateName="GILumenSodium.Mass",
          useNormalizedVolume=false,
          solute_start=(80)/1000)
          annotation (Placement(transformation(extent={{-60,-46},{-40,-26}})));
        Physiolibrary.Chemical.Components.SolutePump Absorbtion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-44,-10},{-56,-22}})));
          Modelica.Blocks.Math.Gain Perm(k=0.0015)
            annotation (Placement(transformation(extent={{-40,-56},{-34,-50}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,64},{-38,84}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,50},{-38,70}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-78,70},{-58,90}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-78,56},{-58,76}})));
          Physiolibrary.Molar.SolventFlowPump_InitialPatch
            glomerulusSudiumRate
            annotation (Placement(transformation(extent={{-16,14},{4,34}})));
          Physiomodel.Electrolytes.Sodium.GlomerulusCationFiltration glomerulus
            annotation (Placement(transformation(extent={{-40,14},{-20,34}})));
        Physiolibrary.Chemical.Components.Reabsorption PT(
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{8,14},{28,34}})));
        Physiolibrary.Types.Constants.FractionConst const1(k=0.58)
          annotation (Placement(transformation(extent={{2,34},{8,40}})));
        Physiolibrary.Blocks.Factors.Spline IFPEffect(data={{1.0,1.4,0},{4.0,
              1.0,-0.2},{7.0,0.3,0}})
          annotation (Placement(transformation(extent={{14,32},{34,52}})));
        Physiolibrary.Blocks.Factors.Spline ANPEffect(data={{0.0,1.2,0},{1.3,
              1.0,-0.2},{2.7,0.6,0}})
          annotation (Placement(transformation(extent={{14,40},{34,60}})));
        Physiolibrary.Blocks.Factors.Spline SympsEffect(data={{0.6,0.6,0},{1.0,
              1.0,0.5},{4.0,1.5,0}})
          annotation (Placement(transformation(extent={{14,48},{34,68}})));
        Physiolibrary.Blocks.Factors.Spline A2Effect(data={{0.7,0.8,0},{1.3,1.0,
              0.8},{1.6,1.2,0}})
          annotation (Placement(transformation(extent={{14,56},{34,76}})));
        Physiolibrary.Chemical.Components.Reabsorption LH(
          MaxReab=7,
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{68,14},{88,34}})));
        Physiolibrary.Types.Constants.FractionConst const2(k=0.75)
          annotation (Placement(transformation(extent={{64,30},{70,36}})));
        Physiolibrary.Chemical.Components.Reabsorption DT(
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{80,-74},{60,-54}})));
        Physiolibrary.Chemical.Components.Reabsorption CD(
          MaxReab=0.7,
          useBaseReabsorption=true,
          useEffect=true,
          useMaxReabInput=true)
          annotation (Placement(transformation(extent={{30,-74},{10,-54}})));
        Physiolibrary.Types.Constants.FractionConst const3(k=0.75)
          annotation (Placement(transformation(extent={{18,-58},{24,-52}})));
        Physiolibrary.Types.Constants.FractionConst const4(k=0.75)
          annotation (Placement(transformation(extent={{68,-58},{74,-52}})));
        Physiolibrary.Chemical.Components.Substance Bladder(
          stateName="BladderSodium.Mass",
          STEADY=false,
          useNormalizedVolume=false,
          solute_start=(0)/1000)
          annotation (Placement(transformation(extent={{-28,-26},{-8,-6}})));
        Physiolibrary.Blocks.Factors.Spline Furosemide(data={{0.0,1.0,-1},{0.1,
              0.0,0}})
          annotation (Placement(transformation(extent={{64,62},{84,82}})));
        Physiolibrary.Blocks.Factors.Spline AldoEffect(data={{0.0,0.7,0},{10.0,
              1.0,0}})
          annotation (Placement(transformation(extent={{76,40},{96,60}})));
        Physiolibrary.Blocks.Factors.Spline LoadEffect(data={{0.0,3.0,0},{7.2,
              1.0,-0.2},{20.0,0.5,0}})
          annotation (Placement(transformation(extent={{76,32},{96,52}})));
        Physiolibrary.Blocks.Factors.Normalization FurosemideEffect
          annotation (Placement(transformation(extent={{76,48},{96,68}})));
        Physiolibrary.Blocks.Factors.Normalization Filtering_xNormal
          annotation (Placement(transformation(extent={{64,54},{84,74}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
          annotation (Placement(transformation(extent={{50,14},{70,34}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure1
          annotation (Placement(transformation(extent={{98,-74},{78,-54}})));
        Physiolibrary.Blocks.Factors.Spline LoadEffect1(data={{0.0,2.0,0},{1.6,
              1.0,0}})
          annotation (Placement(transformation(extent={{72,-56},{52,-36}})));
        Physiolibrary.Blocks.Factors.Spline ThiazideEffect(data={{0.0,1.0,-2.0},
              {0.6,0.2,0.0}})
          annotation (Placement(transformation(extent={{72,-48},{52,-28}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure2
          annotation (Placement(transformation(extent={{58,-74},{38,-54}})));
        Physiolibrary.Blocks.Factors.Spline LoadEffect2(data={{0.0,2.0,0},{0.4,
              1.0,0}})
          annotation (Placement(transformation(extent={{22,-58},{2,-38}})));
        Physiolibrary.Blocks.Factors.Spline ANPEffect2(data={{0.0,1.2,0},{1.3,
              1.0,-0.4},{2.7,0.2,0}})
          annotation (Placement(transformation(extent={{22,-50},{2,-30}})));
        Physiolibrary.Blocks.Factors.Normalization AldoEffect2 annotation (
            Placement(transformation(
              extent={{10,-10},{-10,10}},
              rotation=270,
              origin={84,-78})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant const5(k=2)
          annotation (Placement(transformation(extent={{94,-80},{90,-76}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-90,-60},{-70,-40}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
            useSoluteFlowInput=true) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={-80,-64})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure3
          annotation (Placement(transformation(extent={{10,-54},{-10,-74}})));
        Physiolibrary.Chemical.Components.Substance Medulla(
          stateName="MedullaNa.Mass",
          useNormalizedVolume=false,
          solute_start=(13)/1000)
          annotation (Placement(transformation(extent={{28,-102},{48,-82}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-9,-9},{9,9}},
              rotation=270,
              origin={57,-97})));
        Physiolibrary.Chemical.Components.Stream VasaRectaOutflow(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{-4,-100},{-20,-84}})));
          Modelica.Blocks.Math.Gain gain(k=0.03)
            annotation (Placement(transformation(extent={{-28,-88},{-20,-80}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure1(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-92,36})));
        Physiolibrary.Chemical.Components.Clearance bladderVoid(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{12,-22},{24,-10}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure4
          annotation (Placement(transformation(extent={{64,-68},{44,-88}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure5
          annotation (Placement(transformation(extent={{80,16},{60,-4}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure6
          annotation (Placement(transformation(
              extent={{10,10},{-10,-10}},
              rotation=90,
              origin={18,12})));
        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{-98,86},{-86,98}}), iconTransformation(
                extent={{60,60},{100,100}})));
          Modelica.Blocks.Math.Gain Osm(k=2)
            annotation (Placement(transformation(extent={{68,-100},{74,-94}})));
        Physiolibrary.Blocks.Factors.Spline AldoEffect1(data={{0.0,0.5,0},{12.0,
              1.0,0.08},{50.0,3.0,0}})
          annotation (Placement(transformation(extent={{52,-40},{72,-20}})));
          Modelica.Blocks.Math.Division division
            annotation (Placement(transformation(extent={{80,-16},{86,-10}})));
          Modelica.Blocks.Math.Gain ml2l(k=1000)
            annotation (Placement(transformation(extent={{90,-16},{96,-10}})));
        Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,
              1.0,-0.04},{50,0.0,0}})
          annotation (Placement(transformation(extent={{-90,-50},{-70,-30}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant7(k=180
              /1440)
          annotation (Placement(transformation(extent={{-90,-36},{-82,-28}})));
        Real ECF_conc;
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure2(toAnotherUnitCoef=1, unitsString="mEq/ml")
          annotation (Placement(transformation(
              extent={{-9,-9},{9,9}},
              rotation=270,
              origin={57,-93})));
          SweatGlandSalt sweatGlandSalt
            annotation (Placement(transformation(extent={{4,74},{20,90}})));
        equation
          ECF_conc =concentrationMeasure1.concentration;

        connect(NaPool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
            points={{-84,30},{-97,30},{-97,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumen.solutionVolume, busConnector.GILumenVolume_Mass)
          annotation (Line(
            points={{-58,-30},{-97,-30},{-97,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
              points={{-50,-36},{-38,-36},{-38,-16},{-44,-16}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Absorbtion.q_out, NaPool.q_out) annotation (Line(
              points={{-56,-16},{-100,-16},{-100,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Hemorrhage.q_in, NaPool.q_out) annotation (Line(
              points={{-54,74},{-58,74},{-58,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, NaPool.q_out) annotation (Line(
              points={{-54,60},{-58,60},{-58,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, NaPool.q_out) annotation (Line(
              points={{-62,66},{-58,66},{-58,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, NaPool.q_out) annotation (Line(
              points={{-62,80},{-58,80},{-58,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(glomerulusSudiumRate.solventFlow, busConnector. GlomerulusFiltrate_GFR)
            annotation (Line(
              points={{-6,30},{-6,38},{-32,38},{-32,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(glomerulus.q_in, NaPool.q_out) annotation (Line(
              points={{-40,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(glomerulus.q_out, glomerulusSudiumRate.q_in) annotation (Line(
              points={{-20,24},{-16,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(glomerulusSudiumRate.q_out, PT.Inflow) annotation (Line(
              points={{4,24},{8,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(const1.y, PT.baseReabsorption) annotation (Line(
            points={{8.3,37},{12,37},{12,28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(A2Effect.yBase, busConnector. KidneyFunctionEffect) annotation (Line(
              points={{24,68},{24,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(A2Effect.y, SympsEffect.yBase) annotation (Line(
              points={{24,64},{24,60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(SympsEffect.y, ANPEffect.yBase) annotation (Line(
              points={{24,56},{24,52}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ANPEffect.y, IFPEffect.yBase) annotation (Line(
              points={{24,48},{24,44}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(IFPEffect.y, PT.Effect) annotation (Line(
            points={{24,40},{24,28},{26,28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(busConnector.A2Pool_Log10Conc, A2Effect.u) annotation (Line(
              points={{-92,92},{-18.9,92},{-18.9,66},{14.2,66}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-6,3},{-6,3}}));
          connect(SympsEffect.u, busConnector. KidneyAlpha_PT_NA) annotation (Line(
              points={{14.2,58},{-18.9,58},{-18.9,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(busConnector.NephronANP_Log10Conc, ANPEffect.u) annotation (Line(
              points={{-92,92},{-18.9,92},{-18.9,50},{14.2,50}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-6,3},{-6,3}}));
          connect(busConnector.NephronIFP_Pressure, IFPEffect.u) annotation (Line(
              points={{-92,92},{-18.9,92},{-18.9,42},{14.2,42}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-6,3},{-6,3}}));
        connect(const2.y, LH.baseReabsorption) annotation (Line(
            points={{70.3,33},{72,33},{72,28}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(const3.y, CD.baseReabsorption) annotation (Line(
            points={{24.3,-55},{26,-55},{26,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(const4.y, DT.baseReabsorption) annotation (Line(
            points={{74.3,-55},{76,-55},{76,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Bladder.solutionVolume, busConnector.BladderVolume_Mass)
          annotation (Line(
            points={{-26,-10},{-98,-10},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(Furosemide.u, busConnector. FurosemidePool_Furosemide_conc)
                                                    annotation (Line(
              points={{64.2,72},{48,72},{48,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(AldoEffect.y, LoadEffect.yBase) annotation (Line(
              points={{86,48},{86,44}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(LoadEffect.y, LH.Effect) annotation (Line(
            points={{86,40},{86,28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(FurosemideEffect.y, AldoEffect.yBase) annotation (Line(
              points={{86,56},{86,52}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Filtering_xNormal.u, busConnector. Kidney_NephronCount_Filtering_xNormal)
            annotation (Line(
              points={{64.2,64},{48,64},{48,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(Filtering_xNormal.y, FurosemideEffect.u) annotation (Line(
              points={{74,62},{74,58},{76.2,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Furosemide.y, Filtering_xNormal.yBase) annotation (Line(
              points={{74,70},{74,66}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(busConnector.KidneyFunctionEffect, Furosemide.yBase) annotation (Line(
              points={{-92,92},{74,92},{74,74}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-6,3},{-6,3}}));
          connect(FurosemideEffect.yBase, busConnector. KidneyFunctionEffect) annotation (Line(
              points={{86,60},{86,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(PT.Outflow, flowMeasure.q_in) annotation (Line(
              points={{28,24},{56,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure.q_out, LH.Inflow) annotation (Line(
              points={{64,24},{68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(flowMeasure.molarFlowRate, LoadEffect.u) annotation (Line(
            points={{60,29},{60,42},{76.2,42}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(DT.Inflow, flowMeasure1.q_out) annotation (Line(
              points={{80,-64},{84,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure1.q_in, LH.Outflow) annotation (Line(
              points={{92,-64},{98,-64},{98,24},{88,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(LoadEffect1.y, DT.Effect) annotation (Line(
            points={{62,-48},{62,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(LoadEffect1.u, flowMeasure1.molarFlowRate) annotation (Line(
            points={{71.8,-46},{88,-46},{88,-59}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(ThiazideEffect.u, busConnector. ThiazidePool_Thiazide_conc) annotation (Line(
              points={{71.8,-38},{99.9,-38},{99.9,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(CD.Inflow, flowMeasure2.q_out) annotation (Line(
              points={{30,-64},{44,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure2.q_in, DT.Outflow) annotation (Line(
              points={{52,-64},{60,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(LoadEffect2.y, CD.Effect) annotation (Line(
            points={{12,-50},{12,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(LoadEffect2.u, flowMeasure2.molarFlowRate) annotation (Line(
            points={{21.8,-48},{48,-48},{48,-59}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(ANPEffect2.y, LoadEffect2.yBase) annotation (Line(
              points={{12,-42},{12,-46}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ANPEffect2.yBase, busConnector. KidneyFunctionEffect) annotation (Line(
              points={{12,-38},{12,-36},{48,-36},{48,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(ANPEffect2.u, busConnector. NephronANP_Log10Conc) annotation (Line(
              points={{21.8,-40},{48,-40},{48,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
        connect(IVDrip.soluteFlow, busConnector.IVDrip_NaRate) annotation (Line(
            points={{-68,84},{-68,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Transfusion.soluteFlow, busConnector.Transfusion_NaRate)
          annotation (Line(
            points={{-68,70},{-60,70},{-60,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(const5.y, AldoEffect2.yBase) annotation (Line(
              points={{89.8,-78},{86,-78}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AldoEffect2.y, DT.MaxReab) annotation (Line(
              points={{82,-78},{76,-78},{76,-68.2}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(busConnector.Hemorrhage_NaRate, Hemorrhage.soluteFlow)
          annotation (Line(
            points={{-92,92},{-47.5,92},{-47.5,78},{-48,78}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_Na_Flux)
          annotation (Line(
            points={{-48,64},{-48,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(glomerulus.otherCations, busConnector. KPool) annotation (Line(
              points={{-36,29},{-36,38},{-32,38},{-32,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(glomerulus.ProteinAnions, busConnector. BloodIons_ProteinAnions) annotation (
              Line(
              points={{-32,29},{-32,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(Diet.q_out, GILumen.q_out) annotation (Line(
              points={{-74,-50},{-58,-50},{-58,-36},{-50,-36}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Diarrhea.soluteFlow, busConnector.GILumenDiarrhea_NaLoss)
          annotation (Line(
            points={{-80,-68},{-80,-70},{-98,-70},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
              points={{-50,-36},{-58,-36},{-58,-64},{-74,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(GILumen.solute, Perm.u) annotation (Line(
            points={{-50,-43.8},{-50,-53},{-40.6,-53}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
              points={{-33.7,-53},{-32,-54},{-32,-24},{-50,-24},{-50,-19.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(CD.Outflow, flowMeasure3.q_in) annotation (Line(
              points={{10,-64},{4,-64}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(flowMeasure3.q_out, Bladder.q_out) annotation (Line(
              points={{-4,-64},{-6,-64},{-6,-16},{-18,-16}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(CD.Reabsorption, Medulla.q_out) annotation (Line(
              points={{20,-68},{20,-92},{38,-92}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Medulla.q_out, concentrationMeasure.q_in) annotation (Line(
              points={{38,-92},{42,-92},{42,-97},{57,-97}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Medulla.q_out, VasaRectaOutflow.q_in) annotation (Line(
              points={{38,-92},{-4,-92}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(VasaRectaOutflow.q_out, NaPool.q_out) annotation (Line(
              points={{-20,-92},{-100,-92},{-100,24},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(gain.y, VasaRectaOutflow.solutionFlow) annotation (Line(
            points={{-19.6,-84},{-12,-84},{-12,-87.2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(busConnector.VasaRecta_Outflow, gain.u) annotation (Line(
              points={{-92,92},{-98.4,92},{-98.4,-84},{-28.8,-84}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-6,3},{-6,3}}));
        connect(Medulla.solutionVolume, busConnector.Medulla_Volume)
          annotation (Line(
            points={{30,-86},{26,-86},{26,-78},{-98,-78},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(NaPool.solute, busConnector.NaPool_mass) annotation (Line(
            points={{-76,16.2},{-76,14},{-98,14},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(concentrationMeasure1.q_in, NaPool.q_out) annotation (Line(
              points={{-92,36},{-76,36},{-76,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
              points={{-18,-16},{12,-16}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(bladderVoid.solutionFlow, busConnector.BladderVoidFlow)
          annotation (Line(
            points={{18,-12.4},{18,-6},{-98,-6},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumen.solute, busConnector.GILumenSodium_Mass) annotation (
            Line(
            points={{-50,-43.8},{-50,-60},{-76,-60},{-76,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(AldoEffect1.y, busConnector. DT_AldosteroneEffect) annotation (Line(
              points={{62,-32},{62,-34},{100,-34},{100,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(DT.Reabsorption, flowMeasure4.q_in) annotation (Line(
              points={{70,-68},{70,-78},{58,-78}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure4.q_out, NaPool.q_out) annotation (Line(
              points={{50,-78},{-100,-78},{-100,24},{-76,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure5.molarFlowRate, busConnector.LH_Na_Reab)
          annotation (Line(
            points={{70,1},{100,1},{100,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(LH.Reabsorption, flowMeasure5.q_in) annotation (Line(
              points={{78,20},{78,6},{74,6}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure5.q_out, NaPool.q_out) annotation (Line(
              points={{66,6},{-100,6},{-100,24},{-76,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure6.molarFlowRate, busConnector.PT_Na_Reab)
          annotation (Line(
            points={{23,12},{47.5,12},{47.5,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(PT.Reabsorption, flowMeasure6.q_in) annotation (Line(
              points={{18,20},{18,16}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure6.q_out, NaPool.q_out) annotation (Line(
              points={{18,8},{18,6},{-100,6},{-100,24},{-76,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));

        connect(concentrationMeasure1.concentration, busConnector.NaPool_conc_per_liter)
          annotation (Line(
            points={{-92,40},{-92,46},{-98,46},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(concentrationMeasure.concentration, Osm.u) annotation (Line(
            points={{60.6,-97},{67.4,-97}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Osm.y, busConnector.MedullaNa_Osmolarity) annotation (Line(
              points={{74.3,-97},{100,-97},{100,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(busConnector.KidneyFunctionEffect, AldoEffect1.yBase) annotation (
              Line(
              points={{-92,92},{48,92},{48,-28},{62,-28}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(AldoEffect1.y, ThiazideEffect.yBase) annotation (Line(
              points={{62,-32},{62,-36}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.y, LoadEffect1.yBase) annotation (Line(
              points={{62,-40},{62,-44}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AldoEffect1.y, AldoEffect2.u) annotation (Line(
              points={{62,-32},{62,-34},{96,-34},{96,-90},{84,-90},{84,-87.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(LH.ReabFract, busConnector. LH_Na_FractReab) annotation (Line(
              points={{88,20},{100,20},{100,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
          connect(PT.ReabFract, busConnector. PT_Na_FractReab) annotation (Line(
              points={{28,20},{48,20},{48,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{6,3},{6,3}}));
        connect(flowMeasure2.molarFlowRate, busConnector.DT_Na_Outflow)
          annotation (Line(
            points={{48,-59},{48,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(flowMeasure3.molarFlowRate, busConnector.CD_Na_Outflow)
          annotation (Line(
            points={{0,-69},{0,-74},{-98,-74},{-98,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(flowMeasure4.molarFlowRate, busConnector.DT_Na_Reab)
          annotation (Line(
            points={{54,-83},{54,-90},{100,-90},{100,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(flowMeasure1.molarFlowRate, division.u1) annotation (Line(
            points={{88,-59},{88,-24},{74,-24},{74,-11.2},{79.4,-11.2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(busConnector.LH_H2O_Outflow, division.u2) annotation (Line(
              points={{-92,92},{-98,92},{-98,-6},{56,-6},{56,-14.8},{79.4,-14.8}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));

          connect(ml2l.u, division.y) annotation (Line(
              points={{89.4,-13},{89.4,-12.5},{86.3,-12.5},{86.3,-13}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ml2l.y, busConnector.MD_Na) annotation (Line(
              points={{96.3,-13},{100,-14},{100,92},{-92,92}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(busConnector.NephronAldo_conc_in_nG_per_dl, AldoEffect.u)
            annotation (Line(
              points={{-92,92},{48,92},{48,50},{76.2,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.NephronAldo_conc_in_nG_per_dl, AldoEffect1.u)
            annotation (Line(
              points={{-92,92},{48,92},{48,-30},{52.2,-30}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
              points={{-81.6,-32},{-80,-32},{-80,-38}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
            points={{-80,-42},{-80,-46}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
              points={{-92,92},{-98,92},{-98,-40},{-89.8,-40}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(Medulla.q_out, concentrationMeasure2.q_in) annotation (Line(
              points={{38,-92},{52,-92},{52,-93},{57,-93}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, busConnector.MedullaNa_conc)
          annotation (Line(
            points={{60.6,-93},{100,-93},{100,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(NaPool.q_out, sweatGlandSalt.salt) annotation (Line(
              points={{-76,24},{-58,24},{-58,80},{4,80},{4,77.2}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(busConnector.Aldo_conc_in_nG_per_dl, sweatGlandSalt.Aldo)
            annotation (Line(
              points={{-92,92},{-50,92},{-50,86.8},{4,86.8}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.SweatGland_H2ORate, sweatGlandSalt.H2OIntflow)
            annotation (Line(
              points={{-92,92},{-50,92},{-50,83.6},{4,83.6}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={Bitmap(extent={{-100,100},{100,-100}}, fileName=
                      "../Physiolibrary/icons/Na.jpg"), Text(
                  extent={{-110,-104},{110,-130}},
                  lineColor={0,0,255},
                  textString="%name")}),
            Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end Sodium2;
      end test;

      package setup
        model ConstInputsFromOtherElectrolytes

        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{44,58},{64,78}}), iconTransformation(
                extent={{-40,-20},{0,20}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BloodIons_ProteinAnions(k=12.9427208016075)
          annotation (Placement(transformation(extent={{-20,42},{-14,48}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant KPool(k=
              4.30150131804415)
          annotation (Placement(transformation(extent={{-20,48},{-14,54}})));
        equation

        connect(BloodIons_ProteinAnions.y, busConnector.BloodIons_ProteinAnions) annotation (Line(
         points={{-13.7,45},{54,45},{54,68}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(KPool.y, busConnector.KPool)                                                       annotation (Line(
         points={{-13.7,51},{54,51},{54,68}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end ConstInputsFromOtherElectrolytes;
      end setup;

      package expandableConnectorPatch
        record InsideBusConnector
          extends Physiomodel.Interfaces.SignalBusBlue;

        Modelica.Blocks.Interfaces.RealOutput BladderVoidFlow annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput A2Pool_Log10Conc annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput AldoPool_Aldo annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput BladderVolume_Mass annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput Artys_pH annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput CD_KA_Outflow annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput CO2Veins_cHCO3 annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput CellH2O_Vol annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput ECFV_Vol annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput GILumenPotassium_Mass annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput GILumenSodium_Mass annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput GILumenVolume_Mass annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput GlomerulusFiltrate_GFR annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput KAPool_Osmoles annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput KAPool_conc annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput KidneyAlpha_PT_NA annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput KidneyFunction_Effect annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput Kidney_NephronCount_Total_xNormal annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput LacPool_Mass_mEq annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput LacPool_Lac_mEq_per_litre annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput Medulla_Volume annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput NephronANP_Log10Conc annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput NephronAldo_conc_in_nG_per_dl annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput NephroneIFP_Pressure annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput VasaRecta_Outflow annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput liver_GlucoseToCellStorageFlow annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput
            skeletalMuscle_GlucoseToCellStorageFlow                                   annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));

        Modelica.Blocks.Interfaces.RealOutput KPool annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));
        Modelica.Blocks.Interfaces.RealOutput ProteinAnions annotation (Placement(transformation(
                  extent={{80,2},{100,22}}), iconTransformation(extent={{80,0},{120,40}})));

        end InsideBusConnector;

        record OutsideBusConnector
          extends Physiomodel.Interfaces.SignalBusBlue;

        Modelica.Blocks.Interfaces.RealInput BladderVoidFlow annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput A2Pool_Log10Conc annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput AldoPool_Aldo annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput BladderVolume_Mass annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput Artys_pH annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput CD_KA_Outflow annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput CO2Veins_cHCO3 annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput CellH2O_Vol annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput ECFV_Vol annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput GILumenPotassium_Mass annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput GILumenSodium_Mass annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput GILumenVolume_Mass annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput GlomerulusFiltrate_GFR annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput KAPool_Osmoles annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput KAPool_conc annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput KidneyAlpha_PT_NA annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput KidneyFunction_Effect annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput Kidney_NephronCount_Total_xNormal annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput LacPool_Mass_mEq annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput LacPool_Lac_mEq_per_litre annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput Medulla_Volume annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput NephronANP_Log10Conc annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput NephronAldo_conc_in_nG_per_dl annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput NephroneIFP_Pressure annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput VasaRecta_Outflow annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput liver_GlucoseToCellStorageFlow annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput
            skeletalMuscle_GlucoseToCellStorageFlow                                  annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));

        Modelica.Blocks.Interfaces.RealInput KPool annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));
        Modelica.Blocks.Interfaces.RealInput ProteinAnions annotation (Placement(transformation(
                  extent={{-120,0},{-80,40}}), iconTransformation(extent={{-120,0},{-80,
                    40}})));

        end OutsideBusConnector;

      model ElectrolytesConstInputs

      OutsideBusConnector busConnector
          annotation (Placement(transformation(extent={{38,-12},{52,2}}),
               iconTransformation(extent={{-40,-20},{0,20}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant BladderVoidFlow(
            k=0)
          annotation (Placement(transformation(extent={{-30,-98},{-24,-92}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          A2Pool_Log10Conc(k=1.30698460203345)
          annotation (Placement(transformation(extent={{-30,-88},{-24,-82}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant AldoPool_Aldo(k=
             0.290854848569316)
          annotation (Placement(transformation(extent={{-30,-78},{-24,-72}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass(k=629.260404013417)
          annotation (Placement(transformation(extent={{-30,-68},{-24,-62}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Artys_pH(k=
              7.38644600458198)
          annotation (Placement(transformation(extent={{-30,-58},{-24,-52}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant CD_KA_Outflow(k=
             6.08968322729714e-005)
          annotation (Placement(transformation(extent={{-30,-48},{-24,-42}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant CO2Veins_cHCO3(
            k=2.57071728935027e-002)
          annotation (Placement(transformation(extent={{-30,-38},{-24,-32}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant CellH2O_Vol(k=
              27335.8967957385)
          annotation (Placement(transformation(extent={{-30,-28},{-24,-22}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant ECFV_Vol(k=
              15491.3023234116)
          annotation (Placement(transformation(extent={{-30,-18},{-24,-12}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          GILumenVolume_Mass(k=959.290660950713)
          annotation (Placement(transformation(extent={{-30,-8},{-24,-2}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          GlomerulusFiltrate_GFR(k=127.333064117169)
          annotation (Placement(transformation(extent={{-30,2},{-24,8}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant KAPool_Osmoles(
            k=2.10110505683432)
          annotation (Placement(transformation(extent={{-30,8},{-24,14}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant KAPool_conc(k=
              1.3839925831359e-002)
          annotation (Placement(transformation(extent={{-30,14},{-24,20}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          KidneyAlpha_PT_NA(k=1.)
          annotation (Placement(transformation(extent={{-30,20},{-24,26}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          KidneyFunction_Effect(k=0.995580586980285)
          annotation (Placement(transformation(extent={{-30,26},{-24,32}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          Kidney_NephronCount_Total_xNormal(k=1.)
          annotation (Placement(transformation(extent={{-30,32},{-24,38}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          LacPool_Mass_mEq(k=18.2596543652006)
          annotation (Placement(transformation(extent={{78,-2},{72,4}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          LacPool_Lac_mEq_per_litre(k=1.17870363536868)
          annotation (Placement(transformation(extent={{78,8},{72,14}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Medulla_Volume(
            k=31.)
          annotation (Placement(transformation(extent={{78,18},{72,24}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          NephronANP_Log10Conc(k=1.25866025557014)
          annotation (Placement(transformation(extent={{78,28},{72,34}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          NephronAldo_conc_in_nG_per_dl(k=9.9383249094754)
          annotation (Placement(transformation(extent={{78,38},{72,44}})));
        Physiolibrary.Types.Constants.PressureConst NephroneIFP_Pressure(k=
              522.7446867783631)
          annotation (Placement(transformation(extent={{78,48},{72,54}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          VasaRecta_Outflow(k=21.7865579572364)
          annotation (Placement(transformation(extent={{78,58},{72,64}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          liver_GlucoseToCellStorageFlow(k=0)
          annotation (Placement(transformation(extent={{78,68},{72,74}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          skeletalMuscle_GlucoseToCellStorageFlow(k=0)
          annotation (Placement(transformation(extent={{78,78},{72,84}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          skeletalMuscle_GlucoseToCellStorageFlow1(k=0)
          annotation (Placement(transformation(extent={{78,88},{72,94}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant14(k=0)
          annotation (Placement(transformation(extent={{-86,42},{-78,50}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant15(k=0)
          annotation (Placement(transformation(extent={{-86,50},{-78,58}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant16(k=0)
          annotation (Placement(transformation(extent={{-86,58},{-78,66}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant17(k=0)
          annotation (Placement(transformation(extent={{-86,66},{-78,74}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant18(k=0)
          annotation (Placement(transformation(extent={{-86,74},{-78,82}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant19(k=
              0.12)
          annotation (Placement(transformation(extent={{-86,82},{-78,90}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant20(k=0)
          annotation (Placement(transformation(extent={{-86,90},{-78,98}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=0)
          annotation (Placement(transformation(extent={{-94,-10},{-86,-2}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant2(k=0)
          annotation (Placement(transformation(extent={{-94,-24},{-86,-16}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          Kidney_NephronCount_Filtering_xNormal(k=1.)
          annotation (Placement(transformation(extent={{-30,38},{-24,44}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant21(k=0)
          annotation (Placement(transformation(extent={{-92,-92},{-84,-84}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant22(k=0)
          annotation (Placement(transformation(extent={{-92,-84},{-84,-76}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant23(k=0)
          annotation (Placement(transformation(extent={{-92,-76},{-84,-68}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant24(k=0)
          annotation (Placement(transformation(extent={{-92,-68},{-84,-60}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant25(k=0)
          annotation (Placement(transformation(extent={{-92,-60},{-84,-52}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant26(k=
              5.2e-002)
          annotation (Placement(transformation(extent={{-92,-52},{-84,-44}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant27(k=0)
          annotation (Placement(transformation(extent={{-92,-44},{-84,-36}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant28(k=0)
          annotation (Placement(transformation(extent={{80,-70},{72,-62}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant29(k=0)
          annotation (Placement(transformation(extent={{80,-62},{72,-54}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant30(k=0)
          annotation (Placement(transformation(extent={{80,-54},{72,-46}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant31(k=0)
          annotation (Placement(transformation(extent={{80,-46},{72,-38}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant32(k=0)
          annotation (Placement(transformation(extent={{80,-38},{72,-30}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant33(k=
              0.149511)
          annotation (Placement(transformation(extent={{80,-30},{72,-22}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant34(k=0)
          annotation (Placement(transformation(extent={{80,-22},{72,-14}})));
      equation

      connect(BladderVoidFlow.y, busConnector.BladderVoidFlow) annotation (Line(
       points={{-23.7,-95},{38,-95},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(A2Pool_Log10Conc.y, busConnector.A2Pool_Log10Conc) annotation (Line(
       points={{-23.7,-85},{38,-85},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(AldoPool_Aldo.y, busConnector.AldoPool_Aldo) annotation (Line(
       points={{-23.7,-75},{38,-75},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(BladderVolume_Mass.y, busConnector.BladderVolume_Mass) annotation (Line(
       points={{-23.7,-65},{38,-65},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Artys_pH.y, busConnector.Artys_pH) annotation (Line(
       points={{-23.7,-55},{38,-55},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(CD_KA_Outflow.y, busConnector.CD_KA_Outflow) annotation (Line(
       points={{-23.7,-45},{38,-45},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(CO2Veins_cHCO3.y, busConnector.CO2Veins_cHCO3) annotation (Line(
       points={{-23.7,-35},{38,-35},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(CellH2O_Vol.y, busConnector.CellH2O_Vol) annotation (Line(
       points={{-23.7,-25},{38,-25},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(ECFV_Vol.y, busConnector.ECFV_Vol) annotation (Line(
       points={{-23.7,-15},{38,-15},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GILumenVolume_Mass.y, busConnector.GILumenVolume_Mass) annotation (Line(
       points={{-23.7,-5},{38,-5},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GlomerulusFiltrate_GFR.y, busConnector.GlomerulusFiltrate_GFR) annotation (Line(
       points={{-23.7,5},{38,5},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KAPool_Osmoles.y, busConnector.KAPool_Osmoles) annotation (Line(
       points={{-23.7,11},{38,11},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KAPool_conc.y, busConnector.KAPool_conc_per_liter) annotation (Line(
       points={{-23.7,17},{29,17},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KidneyAlpha_PT_NA.y, busConnector.KidneyAlpha_PT_NA) annotation (Line(
       points={{-23.7,23},{38,23},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KidneyFunction_Effect.y, busConnector.KidneyFunctionEffect) annotation (Line(
       points={{-23.7,29},{29,29},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Total_xNormal.y, busConnector.Kidney_NephronCount_Total_xNormal) annotation (Line(
       points={{-23.7,35},{38,35},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LacPool_Mass_mEq.y, busConnector.LacPool_Mass_mEq) annotation (Line(
       points={{71.7,1},{52.35,1},{52.35,-3.6},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LacPool_Lac_mEq_per_litre.y, busConnector.LacPool_Lac_mEq_per_litre) annotation (Line(
       points={{71.7,11},{38,11},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Medulla_Volume.y, busConnector.Medulla_Volume) annotation (Line(
       points={{71.7,21},{38,21},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(NephronANP_Log10Conc.y, busConnector.NephronANP_Log10Conc) annotation (Line(
       points={{71.7,31},{38,31},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(NephronAldo_conc_in_nG_per_dl.y, busConnector.NephronAldo_conc_in_nG_per_dl) annotation (Line(
       points={{71.7,41},{38,41},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(NephroneIFP_Pressure.y, busConnector.NephronIFP_Pressure) annotation (Line(
       points={{71.7,51},{28,48},{28,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(VasaRecta_Outflow.y, busConnector.VasaRecta_Outflow) annotation (Line(
       points={{71.7,61},{38,61},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(liver_GlucoseToCellStorageFlow.y, busConnector.liver_GlucoseToCellStorageFlow) annotation (Line(
       points={{71.7,71},{38,71},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_GlucoseToCellStorageFlow.y, busConnector.skeletalMuscle_GlucoseToCellStorageFlow) annotation (Line(
       points={{71.7,81},{38,81},{38,-3.6}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

        connect(skeletalMuscle_GlucoseToCellStorageFlow1.y, busConnector.respiratoryMuscle_GlucoseToCellStorageFlow)
          annotation (Line(
            points={{71.7,91},{29,91},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Constant14.y,busConnector.IVDrip_NaRate) annotation (Line(
            points={{-77.6,46},{29,46},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant15.y,busConnector. Transfusion_NaRate) annotation (Line(
            points={{-77.6,54},{29,54},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant16.y,busConnector. SweatDuct_NaRate) annotation (Line(
            points={{-77.6,62},{29,62},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant17.y,busConnector. Hemorrhage_NaRate) annotation (Line(
            points={{-77.6,70},{29,70},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant18.y,busConnector. DialyzerActivity_Na_Flux) annotation (
            Line(
            points={{-77.6,78},{29,78},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant19.y,busConnector. DietIntakeElectrolytes_Na) annotation (
            Line(
            points={{-77.6,86},{29,86},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant20.y,busConnector. GILumenDiarrhea_NaLoss) annotation (Line(
            points={{-77.6,94},{29,94},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant1.y,busConnector. FurosemidePool_Furosemide_conc)
          annotation (Line(
            points={{-85.6,-6},{-66,-6},{-66,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant2.y,busConnector. ThiazidePool_Thiazide_conc) annotation (
            Line(
            points={{-85.6,-20},{-66,-20},{-66,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Kidney_NephronCount_Filtering_xNormal.y, busConnector.Kidney_NephronCount_Filtering_xNormal)
                                                                                                   annotation (Line(
       points={{-23.7,41},{29,41},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Constant21.y,busConnector. IVDrip_KRate) annotation (Line(
            points={{-83.6,-88},{-62,-88},{-62,-44},{30,-44},{30,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant22.y,busConnector. Transfusion_KRate) annotation (Line(
            points={{-83.6,-80},{-62,-80},{-62,-44},{30,-44},{30,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant23.y,busConnector. SweatDuct_KRate) annotation (Line(
            points={{-83.6,-72},{-62,-72},{-62,-44},{30,-44},{30,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant24.y,busConnector. Hemorrhage_KRate) annotation (Line(
            points={{-83.6,-64},{-62,-64},{-62,-44},{30,-44},{30,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant25.y,busConnector. DialyzerActivity_K_Flux) annotation (
            Line(
            points={{-83.6,-56},{-62,-56},{-62,-44},{30,-44},{30,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant26.y,busConnector. DietIntakeElectrolytes_K) annotation (
            Line(
            points={{-83.6,-48},{-62,-48},{-62,-44},{30,-44},{30,-3},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant27.y,busConnector. GILumenDiarrhea_KLoss) annotation (Line(
            points={{-83.6,-40},{29,-40},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant28.y,busConnector. IVDrip_ClRate) annotation (Line(
            points={{71.6,-66},{29,-66},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant29.y,busConnector. Transfusion_ClRate) annotation (Line(
            points={{71.6,-58},{29,-58},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant30.y,busConnector. SweatDuct_ClRate) annotation (Line(
            points={{71.6,-50},{29,-50},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant31.y,busConnector. Hemorrhage_ClRate) annotation (Line(
            points={{71.6,-42},{29,-42},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant32.y,busConnector. DialyzerActivity_Cl_Flux) annotation (
            Line(
            points={{71.6,-34},{29,-34},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant33.y,busConnector. DietIntakeElectrolytes_Cl) annotation (
            Line(
            points={{71.6,-26},{29,-26},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant34.y,busConnector.GILumenVomitus_ClLoss) annotation (Line(
            points={{71.6,-18},{29,-18},{29,-3}},
            color={0,0,127},
            smooth=Smooth.None));
      end ElectrolytesConstInputs;
      end expandableConnectorPatch;

      model Sodium
      import Physiomodel;
        extends Physiolibrary.Icons.Sodium;

        Physiolibrary.Chemical.Components.Substance                NaPool(
                                       stateName="NaPool.Mass",
        useNormalizedVolume=false,
        solute_start=2.05845)
          annotation (Placement(transformation(extent={{-10,6},{10,26}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-42,-70},{-22,-50}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-42,-100},{-22,-80}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-64,-46},{-44,-26}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-62,-88},{-42,-68}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure1
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-60,26})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-74,84},{-62,96}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Types.Concentration ECF_conc;
        SweatGlandSalt sweatGlandSalt
          annotation (Placement(transformation(extent={{52,50},{68,66}})));
        GILumen gILumen
          annotation (Placement(transformation(extent={{-20,54},{0,74}})));
        Physiomodel.Electrolytes.Bladder bladder(stateVarName="BladderSodium.Mass")
          annotation (Placement(transformation(extent={{60,-50},{80,-30}})));
        Physiomodel.Electrolytes.Sodium.KidneyNa kidneyNa
          annotation (Placement(transformation(extent={{52,-8},{72,12}})));
      equation
        ECF_conc =concentrationMeasure1.concentration;

        connect(Hemorrhage.q_in, NaPool.q_out) annotation (Line(
            points={{-42,-60},{-42,16},{0,16}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(DialyzerActivity.q_in, NaPool.q_out) annotation (Line(
            points={{-42,-90},{-42,16},{0,16}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Transfusion.q_out, NaPool.q_out) annotation (Line(
            points={{-42,-78},{-42,16},{0,16}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(IVDrip.q_out, NaPool.q_out) annotation (Line(
            points={{-44,-36},{-42,-36},{-42,16},{0,16}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(IVDrip.soluteFlow, busConnector.IVDrip_NaRate) annotation (Line(
          points={{-50,-32},{-74,-32},{-74,90},{-68,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion.soluteFlow, busConnector.Transfusion_NaRate)
        annotation (Line(
          points={{-48,-74},{-74,-74},{-74,90},{-68,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.Hemorrhage_NaRate, Hemorrhage.soluteFlow)
        annotation (Line(
          points={{-68,90},{-74,90},{-74,-56},{-28,-56}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_Na_Flux)
        annotation (Line(
          points={{-28,-86},{-74,-86},{-74,90},{-68,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(concentrationMeasure1.q_in, NaPool.q_out) annotation (Line(
            points={{-60,26},{-42,26},{-42,16},{0,16}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));

      connect(concentrationMeasure1.concentration, busConnector.NaPool_conc_per_liter)
        annotation (Line(
          points={{-60,18},{-60,90},{-68,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

        connect(NaPool.q_out, sweatGlandSalt.salt) annotation (Line(
            points={{0,16},{52,16},{52,53.2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(gILumen.busConnector, busConnector) annotation (Line(
            points={{-2,72},{-2,90},{-68,90}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gILumen.q_out, NaPool.q_out) annotation (Line(
            points={{-10,64},{0,64},{0,16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(bladder.busConnector, busConnector) annotation (Line(
            points={{78,-32},{78,90},{-68,90}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(busConnector, sweatGlandSalt.busConnector) annotation (Line(
            points={{-68,90},{78,90},{78,64},{66.4,64},{66.4,64.4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(kidneyNa.q_out, bladder.q_in) annotation (Line(
            points={{64,-6},{70,-6},{70,-32}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(kidneyNa.q_in, NaPool.q_out) annotation (Line(
            points={{64,2},{64,16},{0,16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(kidneyNa.busConnector, busConnector) annotation (Line(
            points={{70,10},{78,10},{78,90},{-68,90}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      connect(busConnector.ECFV_Vol, NaPool.solutionVolume) annotation (Line(
          points={{-68,90},{-24,90},{-24,20},{-4,20}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(NaPool.solute, busConnector.NaPool_mass) annotation (Line(
          points={{6,6},{6,-4},{-74,-4},{-74,90},{-68,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(concentrationMeasure1.concentration, busConnector.NaPool)
        annotation (Line(
          points={{-60,18},{-66,18},{-66,90},{-68,90}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={             Text(
                extent={{-110,-104},{110,-130}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end Sodium;

      model GILumen
        extends Physiolibrary.Icons.GILumen;
        Physiolibrary.Chemical.Components.Substance                GILumen(
                                  stateName="GILumenSodium.Mass",
        useNormalizedVolume=false,
        solute_start=0.08)
          annotation (Placement(transformation(extent={{-6,-54},{14,-34}})));
      Physiolibrary.Chemical.Components.SolutePump Absorbtion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{10,-18},{-2,-30}})));
        Modelica.Blocks.Math.Gain Perm(k=0.0015/60)
          annotation (Placement(transformation(extent={{14,-64},{20,-58}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-36,-68},{-16,-48}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
          useSoluteFlowInput=true) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={-26,-72})));
      Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,1.0,
            -0.04},{50,0.0,0}}, Xscale=1e-6/Substances.Leptin.mw)
        annotation (Placement(transformation(extent={{-36,-58},{-16,-38}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst        Constant7(k=
            2.0833333333333e-06)
        annotation (Placement(transformation(extent={{-36,-40},{-28,-32}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-62,-72},{-50,-60}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
          Placement(transformation(extent={{-10,-10},{10,10}}),
            iconTransformation(extent={{-10,-10},{10,10}})));
      equation
        connect(GILumen.q_out,Absorbtion. q_in) annotation (Line(
            points={{4,-44},{16,-44},{16,-24},{10,-24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Diet.q_out,GILumen. q_out) annotation (Line(
            points={{-16,-58},{-4,-58},{-4,-44},{4,-44}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(Diarrhea.soluteFlow, busConnector.GILumenDiarrhea_NaLoss)
        annotation (Line(
          points={{-30,-76},{-30,-78},{-44,-78},{-44,-66},{-56,-66}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(GILumen.q_out,Diarrhea. q_in) annotation (Line(
            points={{4,-44},{-4,-44},{-4,-72},{-16,-72}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Perm.y,Absorbtion. soluteFlow) annotation (Line(
            points={{20.3,-61},{46,-61},{46,-32},{1.6,-32},{1.6,-26.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
            points={{-27,-36},{-26,-36},{-26,-46}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
          points={{-26,-52},{-26,-54},{-22,-54}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.Leptin,LeptinEffect2. u) annotation (Line(
            points={{-56,-66},{-44,-66},{-44,-48},{-34,-48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Absorbtion.q_out, q_out) annotation (Line(
            points={{-2,-24},{-8,-24},{-8,0},{0,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(GILumen.solute, busConnector.GILumenSodium_Mass) annotation (Line(
          points={{10,-54},{10,-66},{-56,-66}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumen.solute, Perm.u) annotation (Line(
          points={{10,-54},{10,-61},{13.4,-61}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.GILumenVolume_Mass, GILumen.solutionVolume)
        annotation (Line(
          points={{-56,-66},{-56,-30},{0,-30},{0,-40}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      end GILumen;

      model KidneyNa
      import Physiomodel;
        extends Physiolibrary.Icons.Kidney;
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-64,-4},{-46,14}}),
            iconTransformation(extent={{10,-10},{30,10}})));
      Physiolibrary.Chemical.Components.Stream glomerulusSudiumRate(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-16,14},{4,34}})));
      Physiolibrary.Chemical.Components.Reabsorption PT(
        useBaseReabsorption=true,
        useEffect=true,
        useMaxReabInput=true)
        annotation (Placement(transformation(extent={{8,14},{28,34}})));
      Physiolibrary.Types.Constants.FractionConst const1(k=0.58)
        annotation (Placement(transformation(extent={{2,34},{8,40}})));
      Physiolibrary.Blocks.Factors.Spline IFPEffect(data={{1.0,1.4,0},{4.0,1.0,
            -0.2},{7.0,0.3,0}}, Xscale=101325/760)
        annotation (Placement(transformation(extent={{14,32},{34,52}})));
      Physiolibrary.Blocks.Factors.LagSpline
                                          ANPEffect(data={{0.0,1.2,0},{1.3,1.0,
            -0.2},{2.7,0.6,0}},
          Xscale=1e-9,
          UsePositiveLog10=true,
        HalfTime=Modelica.Math.log(2)*20*60,
        initialValue=20)
        "1 pmol/l = 1e-9 mmol/l, NephronAnp.Tau = 20 min, initial: 20 pmol/l"
        annotation (Placement(transformation(extent={{14,40},{34,60}})));
      Physiolibrary.Blocks.Factors.Spline SympsEffect(data={{0.6,0.6,0},{1.0,
            1.0,0.5},{4.0,1.5,0}})
        annotation (Placement(transformation(extent={{14,48},{34,68}})));
      Physiolibrary.Blocks.Factors.Spline A2Effect(
        data={{0.7,0.8,0},{1.3,1.0,0.8},{1.6,1.2,0}},
        UsePositiveLog10=true,
        Xscale=1e-9/Physiomodel.Substances.AngiotensinII.mw)
        "1 pg/ml =  0.956 pmol/l = 0.956e-9 mmol/l"
        annotation (Placement(transformation(extent={{14,56},{34,76}})));
      Physiolibrary.Chemical.Components.Reabsorption LH(
        useBaseReabsorption=true,
        useEffect=true,
        useMaxReabInput=true)
        annotation (Placement(transformation(extent={{68,14},{88,34}})));
      Physiolibrary.Types.Constants.FractionConst const2(k=0.75)
        annotation (Placement(transformation(extent={{64,30},{70,36}})));
      Physiolibrary.Chemical.Components.Reabsorption DT(
        useBaseReabsorption=true,
        useEffect=true,
        useMaxReabInput=true)
        annotation (Placement(transformation(extent={{80,-74},{60,-54}})));
      Physiolibrary.Chemical.Components.Reabsorption CD(
        useBaseReabsorption=true,
        useEffect=true,
        useMaxReabInput=true)
        annotation (Placement(transformation(extent={{30,-74},{10,-54}})));
      Physiolibrary.Types.Constants.FractionConst const3(k=0.75)
        annotation (Placement(transformation(extent={{38,-56},{32,-50}})));
      Physiolibrary.Types.Constants.FractionConst const4(k=0.75)
        annotation (Placement(transformation(extent={{82,-54},{76,-48}})));
      Physiolibrary.Blocks.Factors.Spline Furosemide(data={{0.0,1.0,-1},{0.1,
            0.0,0}}, Xscale=1e-3/Physiomodel.Substances.Furosemide.mw)
        annotation (Placement(transformation(extent={{64,62},{84,82}})));
      Physiolibrary.Blocks.Factors.LagSpline
                                          AldoEffect(data={{0.0,0.7,0},{10.0,
            1.0,0}},
        HalfTime=Modelica.Math.log(2)*3*60*60,
        Xscale=1e-8/Physiomodel.Substances.Aldosterone.mw,
        initialValue=12)
        "1 ng/dl = 1e-8 kg/m3, 0.036 ng/dl = 1 pmol/l, NephronAldo.Tau = 3 h, initial: 11 ng/dl"
        annotation (Placement(transformation(extent={{76,40},{96,60}})));
      Physiolibrary.Blocks.Factors.Spline LoadEffect(data={{0.0,3.0,0},{7.2,1.0,
            -0.2},{20.0,0.5,0}}, Xscale=1e-3/60)
        annotation (Placement(transformation(extent={{76,32},{96,52}})));
      Physiolibrary.Blocks.Factors.Normalization FurosemideEffect
        annotation (Placement(transformation(extent={{76,48},{96,68}})));
      Physiolibrary.Blocks.Factors.Normalization Filtering_xNormal
        annotation (Placement(transformation(extent={{64,54},{84,74}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
        annotation (Placement(transformation(extent={{38,18},{58,38}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure1
        annotation (Placement(transformation(extent={{98,-74},{78,-54}})));
      Physiolibrary.Blocks.Factors.Spline LoadEffect1(data={{0.0,2.0,0},{1.6,
            1.0,0}}, Xscale=1e-3/60)
        annotation (Placement(transformation(extent={{72,-56},{52,-36}})));
      Physiolibrary.Blocks.Factors.Spline ThiazideEffect(data={{0.0,1.0,-2.0},{
            0.6,0.2,0.0}})
        annotation (Placement(transformation(extent={{72,-48},{52,-28}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure2
        annotation (Placement(transformation(extent={{58,-74},{38,-54}})));
      Physiolibrary.Blocks.Factors.Spline LoadEffect2(data={{0.0,2.0,0},{0.4,
            1.0,0}}, Xscale=1e-3/60)
        annotation (Placement(transformation(extent={{22,-58},{2,-38}})));
      Physiolibrary.Blocks.Factors.LagSpline
                                          ANPEffect2(data={{0.0,1.2,0},{1.3,1.0,
            -0.4},{2.7,0.2,0}},
          Xscale=1e-9,
          UsePositiveLog10=true,
        HalfTime=Modelica.Math.log(2)*20*60,
        initialValue=20)
        annotation (Placement(transformation(extent={{22,-50},{2,-30}})));
      Physiolibrary.Blocks.Factors.Normalization AldoEffect2 annotation (
          Placement(transformation(
            extent={{10,-10},{-10,10}},
            rotation=270,
            origin={84,-78})));
      Physiolibrary.Types.Constants.FractionConst             const5(k=2)
        annotation (Placement(transformation(extent={{94,-80},{90,-76}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure3
        annotation (Placement(transformation(extent={{10,-54},{-10,-74}})));
      Physiolibrary.Chemical.Components.Substance Medulla(
        stateName="MedullaNa.Mass",
        useNormalizedVolume=false,
        solute_start=(13)/1000)
        annotation (Placement(transformation(extent={{28,-102},{48,-82}})));
      Physiolibrary.Chemical.Components.Stream VasaRectaOutflow(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-4,-100},{-20,-84}})));
        Modelica.Blocks.Math.Gain gain(k=0.03)
          annotation (Placement(transformation(extent={{-28,-88},{-20,-80}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure4
        annotation (Placement(transformation(extent={{64,-68},{44,-88}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure5
        annotation (Placement(transformation(extent={{68,8},{48,-12}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure6 annotation (
          Placement(transformation(
            extent={{10,10},{-10,-10}},
            rotation=90,
            origin={18,-4})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-98,86},{-86,98}}), iconTransformation(
              extent={{60,60},{100,100}})));
        Modelica.Blocks.Math.Gain Osm(k=2)
          annotation (Placement(transformation(extent={{68,-104},{74,-98}})));
      Physiolibrary.Blocks.Factors.LagSpline
                                          AldoEffect1(data={{0.0,0.5,0},{12.0,
            1.0,0.08},{50.0,3.0,0}},
        HalfTime=Modelica.Math.log(2)*3*60*60,
        Xscale=1e-8/Physiomodel.Substances.Aldosterone.mw,
        initialValue=12) "12 ng/dl = 12e-8 kg/m3"
        annotation (Placement(transformation(extent={{54,-38},{74,-18}})));
        Modelica.Blocks.Math.Division division(y(unit="mol/m3"))
          annotation (Placement(transformation(extent={{80,-16},{86,-10}})));

        Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure2 annotation (Placement(
              transformation(
              extent={{-9,-9},{9,9}},
              rotation=270,
              origin={57,-95})));
        GlomerulusCationFiltration glomerulus
          annotation (Placement(transformation(extent={{-40,14},{-20,34}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out
        "sodium mass outflow to urine from collecting ducts" annotation (
          Placement(transformation(extent={{-24,-70},{-8,-56}}),
            iconTransformation(extent={{10,-90},{30,-70}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst const6(k=14)
        annotation (Placement(transformation(extent={{4,10},{8,6}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst const7(k=7)
        annotation (Placement(transformation(extent={{60,12},{66,18}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst const8(k=0.7)
        annotation (Placement(transformation(
            extent={{-3,-3},{3,3}},
            rotation=180,
            origin={35,-73})));
      Modelica.Blocks.Math.Gain gain1(k=Modelica.Constants.F)
        annotation (Placement(transformation(extent={{-62,48},{-52,58}})));
      equation

      connect(glomerulusSudiumRate.solutionFlow, busConnector.GlomerulusFiltrate_GFR)
        annotation (Line(
          points={{-6,31},{-6,38},{-32,38},{-32,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(glomerulusSudiumRate.q_out, PT.Inflow) annotation (Line(
            points={{4,24},{6,24},{6,28},{8,28}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(const1.y, PT.baseReabsorption) annotation (Line(
          points={{8.75,37},{22,37},{22,34}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(A2Effect.yBase, busConnector. KidneyFunctionEffect) annotation (Line(
            points={{24,68},{24,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(A2Effect.y, SympsEffect.yBase) annotation (Line(
            points={{24,62},{24,60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SympsEffect.y, ANPEffect.yBase) annotation (Line(
            points={{24,54},{24,52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ANPEffect.y, IFPEffect.yBase) annotation (Line(
            points={{24,46},{24,44}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(IFPEffect.y, PT.Effect) annotation (Line(
            points={{24,38},{24,34},{18,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SympsEffect.u, busConnector. KidneyAlpha_PT_NA) annotation (Line(
            points={{16,58},{-22.9,58},{-22.9,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(busConnector.NephronIFP_Pressure, IFPEffect.u) annotation (Line(
            points={{-92,92},{-22.9,92},{-22.9,42},{16,42}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%first",
       index=-1,
       extent={{-6,3},{-6,3}}));
      connect(const2.y, LH.baseReabsorption) annotation (Line(
          points={{70.75,33},{82,33},{82,34}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(const3.y, CD.baseReabsorption) annotation (Line(
          points={{31.25,-53},{16,-53},{16,-54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(const4.y, DT.baseReabsorption) annotation (Line(
          points={{75.25,-51},{66,-51},{66,-54}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(Furosemide.u, busConnector. FurosemidePool_Furosemide_conc)
                                                  annotation (Line(
            points={{66,72},{48,72},{48,92},{-92,92}},
            color={255,0,0},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(AldoEffect.y, LoadEffect.yBase) annotation (Line(
            points={{86,46},{86,44}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(LoadEffect.y, LH.Effect) annotation (Line(
            points={{86,38},{86,34},{78,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FurosemideEffect.y, AldoEffect.yBase) annotation (Line(
            points={{86,54},{86,52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Filtering_xNormal.u, busConnector. Kidney_NephronCount_Filtering_xNormal)
          annotation (Line(
            points={{66,64},{48,64},{48,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(Filtering_xNormal.y, FurosemideEffect.u) annotation (Line(
            points={{74,60},{74,58},{78,58}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Furosemide.y, Filtering_xNormal.yBase) annotation (Line(
            points={{74,68},{74,66}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.KidneyFunctionEffect, Furosemide.yBase) annotation (Line(
            points={{-92,92},{74,92},{74,74}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%first",
       index=-1,
       extent={{-6,3},{-6,3}}));
        connect(FurosemideEffect.yBase, busConnector. KidneyFunctionEffect) annotation (Line(
            points={{86,60},{86,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(PT.Outflow, flowMeasure.q_in) annotation (Line(
            points={{28,28},{38,28}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(flowMeasure.q_out, LH.Inflow) annotation (Line(
            points={{58,28},{68,28}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(flowMeasure.molarFlowRate, LoadEffect.u) annotation (Line(
          points={{48,20},{48,42},{78,42}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(DT.Inflow, flowMeasure1.q_out) annotation (Line(
            points={{80,-60},{80,-64},{80,-64},{78,-64}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(flowMeasure1.q_in, LH.Outflow) annotation (Line(
            points={{98,-64},{98,28},{88,28}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(LoadEffect1.y, DT.Effect) annotation (Line(
            points={{62,-50},{62,-54},{70,-54}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LoadEffect1.u, flowMeasure1.molarFlowRate) annotation (Line(
          points={{70,-46},{88,-46},{88,-72}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(ThiazideEffect.u, busConnector. ThiazidePool_Thiazide_conc) annotation (Line(
            points={{70,-38},{99.9,-38},{99.9,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(CD.Inflow, flowMeasure2.q_out) annotation (Line(
            points={{30,-60},{34,-60},{34,-64},{38,-64}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(flowMeasure2.q_in, DT.Outflow) annotation (Line(
            points={{58,-64},{60,-64},{60,-60},{60,-60}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(LoadEffect2.y, CD.Effect) annotation (Line(
            points={{12,-52},{12,-54},{20,-54}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ANPEffect2.y, LoadEffect2.yBase) annotation (Line(
            points={{12,-44},{12,-46}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ANPEffect2.yBase, busConnector. KidneyFunctionEffect) annotation (Line(
            points={{12,-38},{12,-36},{48,-36},{48,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(const5.y, AldoEffect2.yBase) annotation (Line(
            points={{89.5,-78},{86,-78}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(AldoEffect2.y, DT.MaxReab) annotation (Line(
            points={{80,-78},{78,-78},{78,-70}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CD.Outflow, flowMeasure3.q_in) annotation (Line(
            points={{10,-60},{10,-64}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(CD.Reabsorption, Medulla.q_out) annotation (Line(
            points={{20,-74},{20,-92},{38,-92}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Medulla.q_out, VasaRectaOutflow.q_in) annotation (Line(
            points={{38,-92},{-4,-92}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(gain.y, VasaRectaOutflow.solutionFlow) annotation (Line(
          points={{-19.6,-84},{-12,-84},{-12,-86.4}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.VasaRecta_Outflow, gain.u) annotation (Line(
            points={{-92,92},{-98.4,92},{-98.4,-84},{-28.8,-84}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%first",
       index=-1,
       extent={{-6,3},{-6,3}}));
      connect(Medulla.solutionVolume, busConnector.Medulla_Volume) annotation (
          Line(
          points={{34,-88},{26,-88},{26,-78},{-98,-78},{-98,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(AldoEffect1.y, busConnector. DT_AldosteroneEffect) annotation (Line(
            points={{64,-32},{102,-32},{102,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(DT.Reabsorption, flowMeasure4.q_in) annotation (Line(
            points={{70,-74},{70,-78},{64,-78}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(flowMeasure5.molarFlowRate, busConnector.LH_Na_Reab) annotation (
          Line(
          points={{58,6},{100,6},{100,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(LH.Reabsorption, flowMeasure5.q_in) annotation (Line(
            points={{78,14},{78,-2},{68,-2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(flowMeasure6.molarFlowRate, busConnector.PT_Na_Reab) annotation (
          Line(
          points={{10,-4},{47.5,-4},{47.5,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(PT.Reabsorption, flowMeasure6.q_in) annotation (Line(
            points={{18,14},{18,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));

        connect(Osm.y, busConnector.MedullaNa_Osmolarity) annotation (Line(
            points={{74.3,-101},{100,-101},{100,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(busConnector.KidneyFunctionEffect, AldoEffect1.yBase) annotation (
            Line(
            points={{-92,92},{48,92},{48,-26},{64,-26}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(AldoEffect1.y, ThiazideEffect.yBase) annotation (Line(
            points={{64,-32},{64,-34},{62,-34},{62,-36}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ThiazideEffect.y, LoadEffect1.yBase) annotation (Line(
            points={{62,-42},{62,-44}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(AldoEffect1.y, AldoEffect2.u) annotation (Line(
            points={{64,-32},{96,-32},{96,-90},{84,-90},{84,-86}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(LH.ReabFract, busConnector. LH_Na_FractReab) annotation (Line(
            points={{88,16},{100,16},{100,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(PT.ReabFract, busConnector. PT_Na_FractReab) annotation (Line(
            points={{28,16},{48,16},{48,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
      connect(flowMeasure2.molarFlowRate, busConnector.DT_Na_Outflow)
        annotation (Line(
          points={{48,-72},{48,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(flowMeasure3.molarFlowRate, busConnector.CD_Na_Outflow)
        annotation (Line(
          points={{0,-56},{0,-54},{-98,-54},{-98,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(flowMeasure4.molarFlowRate, busConnector.DT_Na_Reab) annotation (
          Line(
          points={{54,-70},{54,-90},{100,-90},{100,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(flowMeasure1.molarFlowRate, division.u1) annotation (Line(
          points={{88,-72},{88,-24},{74,-24},{74,-11.2},{79.4,-11.2}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.LH_H2O_Outflow, division.u2) annotation (Line(
            points={{-92,92},{-98,92},{-98,-6},{56,-6},{56,-14.8},{79.4,-14.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));

        connect(Medulla.q_out, concentrationMeasure2.q_in) annotation (Line(
            points={{38,-92},{52,-92},{52,-95},{57,-95}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure2.concentration, busConnector.MedullaNa_conc)
        annotation (Line(
          points={{49.8,-95},{100,-95},{100,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(glomerulus.ProteinAnions, busConnector. BloodIons_ProteinAnions) annotation (
            Line(
            points={{-32,29},{-32,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{6,3},{6,3}}));
        connect(glomerulusSudiumRate.q_in, glomerulus.q_out) annotation (Line(
            points={{-16,24},{-20,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(glomerulus.q_in, q_in) annotation (Line(
            points={{-40,24},{-54,24},{-54,5},{-55,5}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure6.q_out, q_in) annotation (Line(
            points={{18,-14},{18,-18},{-8,-18},{-54,-18},{-54,2},{-54,6},{-54,5},{-55,
                5}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure5.q_out, q_in) annotation (Line(
            points={{48,-2},{40,-2},{40,-18},{-54,-18},{-54,5},{-55,5}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure4.q_out, q_in) annotation (Line(
            points={{44,-78},{-55,-78},{-55,5}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(VasaRectaOutflow.q_out, q_in) annotation (Line(
            points={{-20,-92},{-55,-92},{-55,5}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure3.q_out, q_out) annotation (Line(
            points={{-10,-64},{-16,-64},{-16,-63}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(const6.y, PT.MaxReab) annotation (Line(
            points={{8.5,8},{8.5,9.5},{10,9.5},{10,18}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(const7.y, LH.MaxReab) annotation (Line(
            points={{66.75,15},{70,15},{70,18}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CD.MaxReab, const8.y) annotation (Line(
            points={{28,-70},{28,-73},{31.25,-73}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(division.y, busConnector.MD_Na) annotation (Line(
            points={{86.3,-13},{100,-13},{100,92},{-92,92}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(concentrationMeasure2.concentration, Osm.u) annotation (Line(
          points={{49.8,-95},{64.3,-95},{64.3,-101},{67.4,-101}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(flowMeasure2.molarFlowRate, LoadEffect2.u) annotation (Line(
          points={{48,-72},{48,-48},{20,-48}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain1.y, glomerulus.otherCations) annotation (Line(
          points={{-51.5,53},{-36,52},{-36,29}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.KPool, gain1.u) annotation (Line(
          points={{-92,92},{-94,92},{-94,53},{-63,53}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.Angiotensin2, A2Effect.u) annotation (Line(
          points={{-92,92},{-22,92},{-22,66},{16,66}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.ANP, ANPEffect.u) annotation (Line(
          points={{-92,92},{-22,92},{-22,50},{16,50}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.Aldosterone, AldoEffect.u) annotation (Line(
          points={{-92,92},{48,92},{48,50},{78,50}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(ANPEffect2.u, busConnector.ANP) annotation (Line(
          points={{20,-40},{48,-40},{48,92},{-92,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.Aldosterone, AldoEffect1.u) annotation (Line(
          points={{-92,92},{48,92},{48,-28},{56,-28}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-110,-104},{110,-130}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end KidneyNa;
    end Sodium;

    package Potassium "Body Potassium Distribution"

      model IkedaPotasiumIntoICFFactor

        Physiolibrary.Types.RealIO.MolarFlowRateInput yBase
                         annotation (Placement(transformation(extent={{-20,-20},{
                  20,20}},
              rotation=270,
              origin={6,100}),
              iconTransformation(extent={{-10,-10},{10,10}},rotation=270,
              origin={0,50})));
        Physiolibrary.Types.RealIO.MolarFlowRateOutput y
                      annotation (Placement(transformation(extent={{-20,-20},{20,
                  20}},
              rotation=270,
              origin={0,-80}),
              iconTransformation(extent={{-10,-10},{10,10}},  rotation=270,
              origin={0,-52})));

        Physiolibrary.Types.RealIO.pHInput Artys_pH
                                               annotation (Placement(transformation(
                extent={{-118,10},{-78,50}}), iconTransformation(extent={{-120,10},{-80,
                  50}})));
        Physiolibrary.Types.RealIO.ConcentrationInput PotasiumECF_conc
                                                       annotation (Placement(
              transformation(extent={{-118,-28},{-78,12}}),iconTransformation(extent={
                  {-120,-50},{-80,-10}})));

        Real effect;
      equation
        effect = 1+0.5*log(PotasiumECF_conc/(56.744-7.06*Artys_pH));
        y = yBase*effect;
       annotation (
          Icon(coordinateSystem(
              preserveAspectRatio=true,
              extent={{-100,-100},{100,100}},
              grid={2,2}), graphics={Rectangle(
                extent={{-100,50},{100,-50}},
                lineColor={127,0,127},
                fillColor={255,255,255},
                fillPattern=FillPattern.Sphere), Text(
                extent={{-86,-36},{100,40}},
                textString="%name",
                lineColor={0,0,0},
                fillPattern=FillPattern.Sphere)}));
      end IkedaPotasiumIntoICFFactor;

      package test
        model T
        import QHP = Physiomodel;
          Physiomodel.Electrolytes.Potassium.Potassium potassium2_1
            annotation (Placement(transformation(extent={{-40,22},{-20,42}})));
        QHP.Electrolytes.old.setup.ElectrolytesConstInputs2FromFile
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{2,30},{22,50}})));
          QHP.Electrolytes.Potassium.setup.ConstInputsFromOtherElectrolytes
            constInputsFromOtherElectrolytes
            annotation (Placement(transformation(extent={{4,4},{24,24}})));
        equation
          connect(potassium2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-22,40},{10,40}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(potassium2_1.busConnector, constInputsFromOtherElectrolytes.busConnector)
            annotation (Line(
              points={{-22,40},{-6,40},{-6,14},{12,14}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T;

        model T_old
        import QHP = Physiomodel;
          Potassium2 potassium2_1
            annotation (Placement(transformation(extent={{-40,22},{-20,42}})));
        QHP.Electrolytes.old.setup.ElectrolytesConstInputs
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{2,30},{22,50}})));
          QHP.Electrolytes.Potassium.setup.ConstInputsFromOtherElectrolytes
            constInputsFromOtherElectrolytes
            annotation (Placement(transformation(extent={{4,4},{24,24}})));
        equation
          connect(potassium2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-22,40},{10,40}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(potassium2_1.busConnector, constInputsFromOtherElectrolytes.busConnector)
            annotation (Line(
              points={{-22,40},{-6,40},{-6,14},{12,14}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T_old;

        model Potassium
        Physiolibrary.Chemical.Components.Substance KPool(useNormalizedVolume=
              false, solute_start=(66.0)/1000)
          annotation (Placement(transformation(extent={{-34,14},{-14,34}})));
          Modelica.Blocks.Interfaces.RealInput ECFV_Vol(final quantity="Volume",
              final displayUnit="ml")
            annotation (Placement(transformation(extent={{-46,28},{-38,36}}),
                iconTransformation(extent={{-100,52},{-88,64}})));
        Physiolibrary.Chemical.Components.Substance GILumen(useNormalizedVolume=
             false, solute_start=(25)/1000)
          annotation (Placement(transformation(extent={{-18,-36},{2,-16}})));
          Modelica.Blocks.Interfaces.RealInput GILumenVolume_Mass(final
              quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{-34,-22},{-26,-14}}),
                iconTransformation(extent={{-100,40},{-88,52}})));
        Physiolibrary.Chemical.Components.SolutePump Absorbtion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{6,-20},{18,-32}})));
          Modelica.Blocks.Math.Gain Perm(k=0.002)
            annotation (Placement(transformation(extent={{0,-48},{6,-42}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-86},{40,-66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-100},{40,-80}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut SweatDuct(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-72},{40,-52}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{0,-80},{20,-60}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{0,-94},{20,-74}})));
        Physiolibrary.Chemical.Components.Substance Bladder(useNormalizedVolume=
             false, solute_start=(0)/1000)
          annotation (Placement(transformation(extent={{78,14},{98,34}})));
          Modelica.Blocks.Interfaces.RealInput BladderVolume_Mass(final
              quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{64,28},{72,36}}),
                iconTransformation(extent={{-100,28},{-88,40}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 NaEffect( data=
                {{0.0,0.3,0},{0.4,1.0,1.5},{4.0,3.0,0}})
            annotation (Placement(transformation(extent={{44,30},{24,50}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 AldoEffect1(
              data={{0.0,0.5,0},{12.0,1.0,0.08},{50.0,3.0,0}})
            annotation (Placement(transformation(extent={{44,38},{24,58}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue2
            ThiazideEffect(
              data={{0.0,1.0,2.0},{0.6,2.0,0}})
            annotation (Placement(transformation(extent={{44,46},{24,66}})));
          Modelica.Blocks.Interfaces.RealInput ThiazidePool_Thiazide_conc(final
              quantity="Concentration", final displayUnit="ug/ml")
            annotation (Placement(transformation(extent={{64,52},{56,60}}),
                iconTransformation(extent={{-100,-20},{-88,-8}})));
          Modelica.Blocks.Interfaces.RealInput IVDrip_KRate(final quantity="VolumeFlowRate",
              final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-4,-68},{4,-60}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-40,98})));
          Modelica.Blocks.Interfaces.RealInput Transfusion_KRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-4,-84},{4,-76}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-28,98})));
          Modelica.Blocks.Interfaces.RealInput SweatDuct_KRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{42,-60},{36,-54}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-16,98})));
          Modelica.Blocks.Interfaces.RealInput Hemorrhage_KRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{42,-74},{36,-68}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-4,98})));
          Modelica.Blocks.Interfaces.RealInput DialyzerActivity_K_Flux(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{42,-88},{36,-82}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={8,98})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-36,-42},{-16,-22}})));
          Modelica.Blocks.Interfaces.RealInput DietIntakeElectrolytes_K(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-36,-30},{-28,-22}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={20,98})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
            useSoluteFlowInput=true) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={-26,-44})));
          Modelica.Blocks.Interfaces.RealInput GILumenDiarrhea_KLoss(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{3,-3},{-3,3}},
                rotation=180,
                origin={-29,-51}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={32,98})));
        Physiolibrary.Chemical.Components.Substance KCell(useNormalizedVolume=
              false, solute_start=(3980)/1000)
          annotation (Placement(transformation(extent={{-30,70},{-10,90}})));
          Modelica.Blocks.Interfaces.RealInput CellH2O_Vol(final quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{-50,82},{-42,90}}),
                iconTransformation(extent={{-100,64},{-88,76}})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToCell(
            useSoluteFlowInput=true)                             annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=90,
              origin={-30,58})));
          Modelica.Blocks.Math.Gain Perm1(k=0.002)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                rotation=90,
                origin={-55,53})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToPool(
            useSoluteFlowInput=true)                             annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=270,
              origin={-12,48})));
          Modelica.Blocks.Interfaces.RealInput AldoPool_Aldo(final quantity=
                "Concentration", final displayUnit="pmol/l")
            annotation (Placement(transformation(extent={{-60,68},{-52,76}}),
                iconTransformation(extent={{-100,16},{-88,28}})));
          Modelica.Blocks.Math.Feedback feedback
            annotation (Placement(transformation(extent={{-10,62},{-2,54}})));
        Physiolibrary.Types.Constants.ElectricChargeConst KCell_CaptiveMass(k=
              210338.040982)
          annotation (Placement(transformation(extent={{10,78},{-2,66}})));
          Modelica.Blocks.Math.Gain Perm2(k=7.4e-5)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                rotation=270,
                origin={3,53})));
          Modelica.Blocks.Interfaces.RealInput NephronAldo_conc_in_nG_per_dL(
                                                                            final
              quantity =                                                                  "Concentration", final unit = "ng/dl")
            annotation (Placement(transformation(extent={{-4,-4},{4,4}},
                rotation=180,
                origin={60,48}),
                iconTransformation(extent={{-100,-8},{-88,4}})));
          Modelica.Blocks.Interfaces.RealInput DT_Na_Outflow(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{62,36},{56,42}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                origin={-94,10})));
        Physiolibrary.Types.Constants.ElectricCurrentConst
          electrolytesFlowConstant(k=0.08040444991666501)
          annotation (Placement(transformation(extent={{18,76},{30,88}})));
        Physiolibrary.Chemical.Components.SolutePump DT_K(useSoluteFlowInput=
              true)                                       annotation (Placement(
              transformation(
              extent={{-6,-6},{6,6}},
              origin={34,22})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 KEffect( data={
                {0.0,0.0,0},{4.4,1.0,0.5},{5.5,3.0,0}})
            annotation (Placement(transformation(extent={{24,22},{44,42}})));
          Modelica.Blocks.Math.Gain mEq_per_L(k=1000)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                origin={15,31})));
          Modelica.Blocks.Math.Division division
            annotation (Placement(transformation(extent={{-18,6},{-14,10}})));
        Physiolibrary.Blocks.Factors.Normalization KidneyFunction
          annotation (Placement(transformation(extent={{44,54},{24,74}})));
          Modelica.Blocks.Interfaces.RealInput KidneyFunctionEffect(final
              quantity="Effect", final displayUnit="1")
            annotation (Placement(transformation(extent={{64,60},{56,68}}),
                iconTransformation(extent={{-100,76},{-88,88}})));
          Modelica.Blocks.Interfaces.RealOutput CD_Outflow
                                          annotation (Placement(transformation(extent={{-4,-4},
                    {4,4}},
                origin={62,26}),       iconTransformation(extent={{100,0},{120,20}})));
          Modelica.Blocks.Interfaces.RealOutput KCell_Mass
                                          annotation (Placement(transformation(extent={{-4,-4},
                    {4,4}},
                origin={-18,68}),      iconTransformation(extent={{100,20},{120,
                    40}})));
          Modelica.Blocks.Interfaces.RealOutput KPool_mass
                                          annotation (Placement(transformation(extent={{-16,-6},
                    {-8,2}}),          iconTransformation(extent={{100,80},{120,
                    100}})));
          Modelica.Blocks.Interfaces.RealOutput KPool_conc_per_liter
                                          annotation (Placement(transformation(extent={{46,2},{
                    54,10}}),          iconTransformation(extent={{100,60},{120,
                    80}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={30,6})));
          Modelica.Blocks.Math.Gain gain(k=1000)
            annotation (Placement(transformation(extent={{40,4},{44,8}})));
          Physiolibrary.Factors.NonlinearSystemPatch.Spline3DelayByDay
            splineDelayByDay(Tau=120/1440, data={{0,0.9,0.0},{300,1.0,0.00025},{
                1500,1.1,0.0}})                               annotation (
              Placement(transformation(
                extent={{10,-10},{-10,10}},
                rotation=90,
                origin={-48,58})));
        Physiolibrary.Chemical.Components.Clearance bladderVoid(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{82,-20},{94,-8}})));
          Modelica.Blocks.Interfaces.RealInput BladderVoidFlow(
                                                        final quantity="VolumeFlowRate",
              final displayUnit="ml/min")
            annotation (Placement(transformation(extent={{74,-8},{82,0}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                origin={-94,-106})));
          Modelica.Blocks.Interfaces.RealOutput GILumenPotasium_Mass
                                          annotation (Placement(transformation(extent={{4,-60},
                    {12,-52}}),        iconTransformation(extent={{100,-40},{120,
                    -20}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure1(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-8,80})));
          Modelica.Blocks.Interfaces.RealOutput KCell_conc
                                          annotation (Placement(transformation(extent={{-8,84},
                    {0,92}}),          iconTransformation(extent={{100,40},{120,
                    60}})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure annotation (
           Placement(transformation(
              extent={{-8,8},{8,-8}},
              rotation=90,
              origin={-24,34})));
          Modelica.Blocks.Interfaces.RealOutput PotassiumToCells(
                                                          displayUnit="mEq/min")
                                          annotation (Placement(transformation(
                  extent={{-20,30},{-12,38}}), iconTransformation(extent={{100,
                    -80},{120,-60}})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToCellWithGlucose(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=90,
              origin={-70,50})));
          Modelica.Blocks.Math.Gain CGL3(k=0.03)
          "glucose flow into cells to potassium flow into cells"
            annotation (Placement(transformation(extent={{-4,-4},{4,4}},
                origin={-82,50})));
          Modelica.Blocks.Interfaces.RealInput GlucoseToCellsFlow(final
              quantity="VolumeFlowRate", final displayUnit="mmol/min")
            annotation (Placement(transformation(extent={{-102,46},{-94,54}}),
                iconTransformation(extent={{-100,88},{-88,100}})));
          IkedaPotasiumIntoICFFactor IkedaIntoICF annotation (Placement(
                transformation(
                extent={{-10,-10},{10,10}},
                rotation=90,
                origin={-40,58})));
          Modelica.Blocks.Interfaces.RealInput Artys_pH
            annotation (Placement(transformation(extent={{-56,38},{-48,46}}),
                iconTransformation(extent={{-100,-32},{-88,-20}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure2(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-48,24})));
          Modelica.Blocks.Interfaces.RealOutput KPool_per_liter(
                                                         displayUnit="mEq/l")
                                          annotation (Placement(transformation(extent={{-70,26},
                    {-78,34}}),        iconTransformation(extent={{100,-60},{120,
                    -40}})));
        equation
        connect(KPool.solutionVolume, ECFV_Vol) annotation (Line(
            points={{-32,30},{-37,30},{-37,32},{-42,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GILumen.solutionVolume, GILumenVolume_Mass) annotation (Line(
            points={{-16,-20},{-23,-20},{-23,-18},{-30,-18}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
              points={{-8,-26},{-1,-26},{-1,-26},{6,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Absorbtion.q_out, KPool.q_out)  annotation (Line(
              points={{18,-26},{22,-26},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Hemorrhage.q_in, KPool.q_out)  annotation (Line(
              points={{24,-76},{22,-76},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, KPool.q_out)  annotation (Line(
              points={{24,-90},{22,-90},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KPool.q_out, SweatDuct.q_in)  annotation (Line(
              points={{-24,24},{22,24},{22,-62},{24,-62}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, KPool.q_out)  annotation (Line(
              points={{16,-84},{22,-84},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, KPool.q_out)  annotation (Line(
              points={{16,-70},{22,-70},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Bladder.solutionVolume, BladderVolume_Mass) annotation (Line(
            points={{80,30},{74,30},{74,32},{68,32}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(AldoEffect1.y, NaEffect.yBase)    annotation (Line(
              points={{34,46},{34,42}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.y, AldoEffect1.yBase) annotation (Line(
              points={{34,54},{34,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.u, ThiazidePool_Thiazide_conc) annotation (Line(
              points={{43.8,56},{60,56}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(IVDrip.soluteFlow, IVDrip_KRate) annotation (Line(
            points={{10,-66},{10,-64},{0,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Transfusion.soluteFlow, Transfusion_KRate) annotation (Line(
            points={{10,-80},{0,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SweatDuct.soluteFlow, SweatDuct_KRate) annotation (Line(
            points={{30,-58},{30,-57},{39,-57}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Hemorrhage_KRate, Hemorrhage.soluteFlow) annotation (Line(
            points={{39,-71},{30.5,-71},{30.5,-72},{30,-72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(DialyzerActivity.soluteFlow, DialyzerActivity_K_Flux)
          annotation (Line(
            points={{30,-86},{30,-85},{39,-85}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Diet.soluteFlow, DietIntakeElectrolytes_K) annotation (Line(
            points={{-26,-28},{-26,-26},{-32,-26}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Diet.q_out, GILumen.q_out) annotation (Line(
              points={{-20,-32},{-16,-32},{-16,-26},{-8,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Diarrhea.soluteFlow, GILumenDiarrhea_KLoss) annotation (Line(
            points={{-26,-48},{-26,-51},{-29,-51}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
              points={{-8,-26},{-16,-26},{-16,-44},{-20,-44}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(KCell.solutionVolume, CellH2O_Vol) annotation (Line(
            points={{-28,86},{-46,86}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
              points={{6.3,-45},{12,-45},{12,-29.6}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Perm.u, GILumen.solute) annotation (Line(
            points={{-0.6,-45},{-8,-45},{-8,-33.8}},
            color={0,0,127},
            smooth=Smooth.None));

          connect(KFluxToCell.q_out, KCell.q_out) annotation (Line(
              points={{-30,64},{-30,80},{-20,80}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KCell.q_out, KFluxToPool.q_in) annotation (Line(
              points={{-20,80},{-12,80},{-12,54}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(KPool.solute, Perm1.u) annotation (Line(
            points={{-24,16.2},{-24,10},{-55,10},{-55,49.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KCell.solute, feedback.u1) annotation (Line(
            points={{-20,72.2},{-20,58},{-9.2,58}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(KCell_CaptiveMass.y, feedback.u2) annotation (Line(
              points={{-2.6,72},{-6,72},{-6,61.2}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(feedback.y, Perm2.u) annotation (Line(
              points={{-2.4,58},{3.3,58},{3.3,56.6},{3,56.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KFluxToPool.soluteFlow, Perm2.y) annotation (Line(
              points={{-8.4,48},{3,48},{3,49.7}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AldoEffect1.u, NephronAldo_conc_in_nG_per_dL) annotation (Line(
              points={{43.8,48},{60,48}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(NaEffect.u, DT_Na_Outflow) annotation (Line(
              points={{43.8,40},{51.4,40},{51.4,39},{59,39}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KPool.q_out, DT_K.q_in) annotation (Line(
              points={{-24,24},{22,24},{22,22},{28,22}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(NaEffect.y, KEffect.yBase) annotation (Line(
              points={{34,38},{34,34}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KEffect.y, DT_K.soluteFlow) annotation (Line(
              points={{34,30},{34,25.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(mEq_per_L.y, KEffect.u) annotation (Line(
              points={{18.3,31},{21.15,31},{21.15,32},{24.2,32}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(division.u1, KPool.solute) annotation (Line(
            points={{-18.4,9.2},{-24,9.2},{-24,16.2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(ECFV_Vol, division.u2) annotation (Line(
              points={{-42,32},{-38,32},{-38,6.8},{-18.4,6.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(division.y, mEq_per_L.u) annotation (Line(
              points={{-13.8,8},{-8,8},{-8,31},{11.4,31}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(electrolytesFlowConstant.y, KidneyFunction.yBase) annotation (
              Line(
              points={{30.6,82},{34,82},{34,66}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunction.y, ThiazideEffect.yBase) annotation (Line(
              points={{34,62},{34,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunction.u, KidneyFunctionEffect) annotation (Line(
              points={{43.8,64},{60,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(DT_K.q_out, Bladder.q_out) annotation (Line(
              points={{40,22},{64,22},{64,24},{88,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KEffect.y, CD_Outflow) annotation (Line(
              points={{34,30},{34,26},{62,26}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(KCell_Mass, KCell.solute) annotation (Line(
            points={{-18,68},{-20,68},{-20,72.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KPool.solute, KPool_mass) annotation (Line(
            points={{-24,16.2},{-24,-2},{-12,-2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(concentrationMeasure.q_in, KPool.q_out) annotation (Line(
              points={{30,6},{22,6},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(concentrationMeasure.concentration, gain.u) annotation (Line(
            points={{34,6},{36.8,6},{36.8,6},{39.6,6}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(gain.y, KPool_conc_per_liter) annotation (Line(
              points={{44.2,6},{50,6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Perm1.y, splineDelayByDay.yBase) annotation (Line(
              points={{-55,56.3},{-55,58},{-50,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(splineDelayByDay.u, AldoPool_Aldo) annotation (Line(
              points={{-48,67.8},{-48,72},{-56,72}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
              points={{88,24},{66,24},{66,-14},{82,-14}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(bladderVoid.solutionFlow, BladderVoidFlow) annotation (Line(
            points={{88,-10.4},{88,-4},{78,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GILumen.solute, GILumenPotasium_Mass) annotation (Line(
            points={{-8,-33.8},{-8,-56},{8,-56}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(KCell.q_out, concentrationMeasure1.q_in) annotation (Line(
              points={{-20,80},{-8,80}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure1.concentration, KCell_conc) annotation (
            Line(
            points={{-8,84},{-8,88},{-4,88}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(KPool.q_out, flowMeasure.q_in) annotation (Line(
              points={{-24,24},{-24,30.8}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToPool.q_out) annotation (Line(
              points={{-24,37.2},{-24,38},{-12,38},{-12,42}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToCell.q_in) annotation (Line(
              points={{-24,37.2},{-24,38},{-30,38},{-30,52}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure.molarFlowRate, PotassiumToCells) annotation (Line(
            points={{-20,34},{-16,34}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToCellWithGlucose.q_in) annotation (
              Line(
              points={{-24,37.2},{-24,38},{-70,38},{-70,44}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(KFluxToCellWithGlucose.q_out, KCell.q_out) annotation (Line(
              points={{-70,56},{-70,80},{-20,80}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(CGL3.y, KFluxToCellWithGlucose.soluteFlow) annotation (Line(
              points={{-77.6,50},{-73.6,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(GlucoseToCellsFlow, CGL3.u) annotation (Line(
              points={{-98,50},{-86.8,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(IkedaIntoICF.y, KFluxToCell.soluteFlow) annotation (Line(
              points={{-34.8,58},{-33.6,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(splineDelayByDay.y, IkedaIntoICF.yBase) annotation (Line(
              points={{-46,58},{-45,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(IkedaIntoICF.Artys_pH, Artys_pH) annotation (Line(
              points={{-43,48},{-43,42},{-52,42}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(concentrationMeasure2.q_in, KPool.q_out) annotation (Line(
              points={{-48,24},{-24,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, IkedaIntoICF.PotasiumECF_conc)
          annotation (Line(
            points={{-48,28},{-48,40},{-37,40},{-37,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, KPool_per_liter)
          annotation (Line(
            points={{-48,28},{-48,30},{-74,30}},
            color={0,0,127},
            smooth=Smooth.None));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={Bitmap(extent={{-100,100},{100,-100}}, fileName=
                      "../Physiolibrary/icons/K.jpg")}));
        end Potassium;

        model Potassium2
        Physiolibrary.Chemical.Components.Substance KPool(
          stateName="KPool.Mass",
          useNormalizedVolume=false,
          solute_start=(62.897)/1000)
          annotation (Placement(transformation(extent={{-34,14},{-14,34}})));
        Physiolibrary.Chemical.Components.Substance GILumen(
          stateName="GILumenPotassium.Mass",
          useNormalizedVolume=false,
          solute_start=(25)/1000)
          annotation (Placement(transformation(extent={{-18,-36},{2,-16}})));
        Physiolibrary.Chemical.Components.SolutePump Absorbtion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{6,-20},{18,-32}})));
          Modelica.Blocks.Math.Gain Perm(k=0.002)
            annotation (Placement(transformation(extent={{0,-48},{6,-42}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-86},{40,-66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-100},{40,-80}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut SweatDuct(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-72},{40,-52}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{0,-80},{20,-60}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{0,-94},{20,-74}})));
        Physiolibrary.Chemical.Components.Substance Bladder(
          STEADY=false,
          stateName="BladderPotassium.Mass",
          useNormalizedVolume=false,
          solute_start=(0)/1000)
          annotation (Placement(transformation(extent={{94,12},{74,32}})));
        Physiolibrary.Blocks.Factors.Spline NaEffect(data={{0.0,0.3,0},{0.4,1.0,
              1.5},{4.0,3.0,0}})
          annotation (Placement(transformation(extent={{44,30},{24,50}})));
        Physiolibrary.Blocks.Factors.Spline AldoEffect(data={{0.0,0.3,0},{12.0,
              1.0,0.06},{50.0,3.0,0}})
          annotation (Placement(transformation(extent={{44,38},{24,58}})));
        Physiolibrary.Blocks.Factors.Spline ThiazideEffect(data={{0.0,1.0,2.0},
              {0.6,2.0,0}})
          annotation (Placement(transformation(extent={{44,46},{24,66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-66,-42},{-46,-22}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
            useSoluteFlowInput=true) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={-56,-44})));
        Physiolibrary.Chemical.Components.Substance KCell(
          stateName="KCell.Mass",
          useNormalizedVolume=false,
          solute_start=(3769.74)/1000)
          annotation (Placement(transformation(extent={{-30,70},{-10,90}})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToCell(
            useSoluteFlowInput=true)                             annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=90,
              origin={-30,58})));
          Modelica.Blocks.Math.Gain Perm1(k=0.002)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                rotation=90,
                origin={-55,53})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToPool(
            useSoluteFlowInput=true)                             annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=270,
              origin={-12,48})));
          Modelica.Blocks.Math.Feedback feedback
            annotation (Placement(transformation(extent={{-10,62},{-2,54}})));
        Physiolibrary.Types.Constants.ElectricChargeConst KCell_CaptiveMass(k=
              210338.040982)
          annotation (Placement(transformation(extent={{8,76},{-2,66}})));
          Modelica.Blocks.Math.Gain Perm2(k=7.4e-5)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                rotation=270,
                origin={3,53})));
        Physiolibrary.Types.Constants.ElectricCurrentConst
          electrolytesFlowConstant(k=0.08040444991666501)
          annotation (Placement(transformation(extent={{18,76},{30,88}})));
        Physiolibrary.Chemical.Components.SolutePump DT_K(useSoluteFlowInput=
              true)                                       annotation (Placement(
              transformation(
              extent={{-6,-6},{6,6}},
              origin={34,22})));
        Physiolibrary.Blocks.Factors.Spline KEffect(data={{0.0,0.0,0},{4.4,1.0,
              0.5},{5.5,3.0,0}})
          annotation (Placement(transformation(extent={{24,22},{44,42}})));
          Modelica.Blocks.Math.Gain mEq_per_L(k=1000)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                origin={15,31})));
          Modelica.Blocks.Math.Division division
            annotation (Placement(transformation(extent={{-18,6},{-14,10}})));
        Physiolibrary.Blocks.Factors.Normalization KidneyFunction
          annotation (Placement(transformation(extent={{44,54},{24,74}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={30,6})));
          Modelica.Blocks.Math.Gain gain(k=1000)
            annotation (Placement(transformation(extent={{40,4},{44,8}})));
        Physiomodel.Metabolism.deprecated.Input2EffectDelayed splineDelayByDay(data={{
              0,0.9,0.0},{300,1.0,0.00025},{1500,1.1,0.0}}, Tau=120*1440) annotation (
            Placement(transformation(
              extent={{10,-10},{-10,10}},
              rotation=90,
              origin={-48,58})));
        Physiolibrary.Chemical.Components.Clearance bladderVoid(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{82,-20},{94,-8}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure1(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-8,80})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure annotation (
           Placement(transformation(
              extent={{-8,8},{8,-8}},
              rotation=90,
              origin={-24,34})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToCellWithGlucose(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=90,
              origin={-68,60})));
          Modelica.Blocks.Math.Gain CGL3(k=0.03)
          "glucose flow into cells to potassium flow into cells"
            annotation (Placement(transformation(extent={{-2,-2},{2,2}},
                origin={-78,60})));
          IkedaPotasiumIntoICFFactor IkedaIntoICF annotation (Placement(
                transformation(
                extent={{-10,-10},{10,10}},
                rotation=90,
                origin={-40,58})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure2(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-48,24})));
        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{-94,88},{-82,100}}), iconTransformation(
                extent={{60,60},{100,100}})));
          Modelica.Blocks.Math.Add3 YGLS "Ikeda glucose to cells flow"
            annotation (Placement(transformation(extent={{-84,66},{-74,76}})));
        Physiolibrary.Types.Constants.ElectricCurrentConst
          electrolytesFlowConstant1(k=0)
          annotation (Placement(transformation(extent={{-90,46},{-80,56}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant7(k=70/
              1440)
          annotation (Placement(transformation(extent={{-66,-16},{-58,-8}})));
        Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,
              1.0,-0.04},{50,0.0,0}})
          annotation (Placement(transformation(extent={{-66,-30},{-46,-10}})));

        Real ECF_conc;
        equation
          ECF_conc=concentrationMeasure2.concentration;
        connect(GILumen.solutionVolume, busConnector.GILumenVolume_Mass)
          annotation (Line(
            points={{-16,-20},{-24,-20},{-24,-4},{-96,-4},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
              points={{-8,-26},{6,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Absorbtion.q_out, KPool.q_out)  annotation (Line(
              points={{18,-26},{22,-26},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Hemorrhage.q_in, KPool.q_out)  annotation (Line(
              points={{24,-76},{22,-76},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, KPool.q_out)  annotation (Line(
              points={{24,-90},{22,-90},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KPool.q_out, SweatDuct.q_in)  annotation (Line(
              points={{-24,24},{22,24},{22,-62},{24,-62}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, KPool.q_out)  annotation (Line(
              points={{16,-84},{22,-84},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, KPool.q_out)  annotation (Line(
              points={{16,-70},{22,-70},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Bladder.solutionVolume, busConnector.BladderVolume_Mass)
          annotation (Line(
            points={{92,28},{98,28},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(AldoEffect.y, NaEffect.yBase)     annotation (Line(
              points={{34,46},{34,42}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.y, AldoEffect.yBase)  annotation (Line(
              points={{34,54},{34,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.u, busConnector. ThiazidePool_Thiazide_conc) annotation (Line(
              points={{43.8,56},{98,56},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
        connect(IVDrip.soluteFlow, busConnector.IVDrip_KRate) annotation (Line(
            points={{10,-66},{10,-64},{-96,-64},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(Transfusion.soluteFlow, busConnector.Transfusion_KRate)
          annotation (Line(
            points={{10,-80},{-96,-80},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(SweatDuct.soluteFlow, busConnector.SweatDuct_KRate) annotation (
           Line(
            points={{30,-58},{30,-54},{98,-54},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(busConnector.Hemorrhage_KRate, Hemorrhage.soluteFlow)
          annotation (Line(
            points={{-88,94},{98,94},{98,-72},{30,-72}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-3,1},{-3,1}}));
        connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_K_Flux)
          annotation (Line(
            points={{30,-86},{98,-86},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(Diet.q_out, GILumen.q_out) annotation (Line(
              points={{-50,-32},{-16,-32},{-16,-26},{-8,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Diarrhea.soluteFlow, busConnector.GILumenDiarrhea_KLoss)
          annotation (Line(
            points={{-56,-48},{-96,-48},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
              points={{-8,-26},{-16,-26},{-16,-44},{-50,-44}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(KCell.solutionVolume, busConnector.CellH2O_Vol) annotation (
            Line(
            points={{-28,86},{-95,86},{-95,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
              points={{6.3,-45},{12,-45},{12,-29.6}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Perm.u, GILumen.solute) annotation (Line(
            points={{-0.6,-45},{-8,-45},{-8,-33.8}},
            color={0,0,127},
            smooth=Smooth.None));

          connect(KFluxToCell.q_out, KCell.q_out) annotation (Line(
              points={{-30,64},{-30,80},{-20,80}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KCell.q_out, KFluxToPool.q_in) annotation (Line(
              points={{-20,80},{-12,80},{-12,54}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(KPool.solute, Perm1.u) annotation (Line(
            points={{-24,16.2},{-24,10},{-55,10},{-55,49.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KCell.solute, feedback.u1) annotation (Line(
            points={{-20,72.2},{-20,58},{-9.2,58}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(KCell_CaptiveMass.y, feedback.u2) annotation (Line(
              points={{-2.5,71},{-6,71},{-6,61.2}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(feedback.y, Perm2.u) annotation (Line(
              points={{-2.4,58},{3.3,58},{3.3,56.6},{3,56.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KFluxToPool.soluteFlow, Perm2.y) annotation (Line(
              points={{-8.4,48},{3,48},{3,49.7}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(NaEffect.u, busConnector. DT_Na_Outflow) annotation (Line(
              points={{43.8,40},{98,40},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(KPool.q_out, DT_K.q_in) annotation (Line(
              points={{-24,24},{22,24},{22,22},{28,22}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(NaEffect.y, KEffect.yBase) annotation (Line(
              points={{34,38},{34,34}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KEffect.y, DT_K.soluteFlow) annotation (Line(
              points={{34,30},{34,25.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(mEq_per_L.y, KEffect.u) annotation (Line(
              points={{18.3,31},{21.15,31},{21.15,32},{24.2,32}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(division.u1, KPool.solute) annotation (Line(
            points={{-18.4,9.2},{-24,9.2},{-24,16.2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(busConnector.ECFV_Vol, division.u2) annotation (Line(
              points={{-88,94},{-96,94},{-96,6.8},{-18.4,6.8}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-3,1},{-3,1}}));
          connect(division.y, mEq_per_L.u) annotation (Line(
              points={{-13.8,8},{-8,8},{-8,31},{11.4,31}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(electrolytesFlowConstant.y, KidneyFunction.yBase) annotation (
              Line(
              points={{30.6,82},{34,82},{34,66}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunction.y, ThiazideEffect.yBase) annotation (Line(
              points={{34,62},{34,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunction.u, busConnector. KidneyFunctionEffect) annotation (Line(
              points={{43.8,64},{98,64},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(DT_K.q_out, Bladder.q_out) annotation (Line(
              points={{40,22},{84,22}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(busConnector.KCell_Mass, KCell.solute) annotation (Line(
            points={{-88,94},{-4,94},{-4,72},{-20,72},{-20,72.2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-3,1},{-3,1}}));
        connect(KPool.solute, busConnector.KPool_mass) annotation (Line(
            points={{-24,16.2},{-24,10},{-96,10},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(concentrationMeasure.q_in, KPool.q_out) annotation (Line(
              points={{30,6},{22,6},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(concentrationMeasure.concentration, gain.u) annotation (Line(
            points={{34,6},{36.8,6},{36.8,6},{39.6,6}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(gain.y, busConnector. KPool_conc_per_liter) annotation (Line(
              points={{44.2,6},{98,6},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(Perm1.y, splineDelayByDay.yBase) annotation (Line(
              points={{-55,56.3},{-55,58},{-50,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(splineDelayByDay.u, busConnector. AldoPool_Aldo) annotation (Line(
              points={{-48,67.8},{-48,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
              points={{84,22},{66,22},{66,-14},{82,-14}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(bladderVoid.solutionFlow, busConnector.BladderVoidFlow)
          annotation (Line(
            points={{88,-10.4},{88,-6},{98,-6},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(GILumen.solute, busConnector.GILumenPotasium_Mass) annotation (
            Line(
            points={{-8,-33.8},{-8,-54},{-96,-54},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(KCell.q_out, concentrationMeasure1.q_in) annotation (Line(
              points={{-20,80},{-8,80}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure1.concentration, busConnector.KCell_conc)
          annotation (Line(
            points={{-8,84},{-8,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(KPool.q_out, flowMeasure.q_in) annotation (Line(
              points={{-24,24},{-24,30.8}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToPool.q_out) annotation (Line(
              points={{-24,37.2},{-24,38},{-12,38},{-12,42}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToCell.q_in) annotation (Line(
              points={{-24,37.2},{-24,38},{-30,38},{-30,52}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure.molarFlowRate, busConnector.PotassiumToCells)
          annotation (Line(
            points={{-20,34},{-95,34},{-95,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(flowMeasure.q_out, KFluxToCellWithGlucose.q_in) annotation (
              Line(
              points={{-24,37.2},{-24,38},{-68,38},{-68,54}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(KFluxToCellWithGlucose.q_out, KCell.q_out) annotation (Line(
              points={{-68,66},{-68,80},{-20,80}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(IkedaIntoICF.y, KFluxToCell.soluteFlow) annotation (Line(
              points={{-34.8,58},{-33.6,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(splineDelayByDay.y, IkedaIntoICF.yBase) annotation (Line(
              points={{-46,58},{-45,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(IkedaIntoICF.Artys_pH, busConnector. Artys_pH) annotation (Line(
              points={{-43,48},{-44,46},{-44,42},{-96,42},{-96,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(concentrationMeasure2.q_in, KPool.q_out) annotation (Line(
              points={{-48,24},{-24,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, IkedaIntoICF.PotasiumECF_conc)
          annotation (Line(
            points={{-48,28},{-48,40},{-37,40},{-37,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, busConnector.KPool_per_liter)
          annotation (Line(
            points={{-48,28},{-48,30},{-96,30},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));

          connect(busConnector.skeletalMuscle_GlucoseToCellStorageFlow,YGLS. u2)
                     annotation (Line(
              points={{-88,94},{-96,94},{-96,71},{-85,71}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.liver_GlucoseToCellStorageFlow,YGLS. u1)
            annotation (Line(
              points={{-88,94},{-96,94},{-96,75},{-85,75}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.respiratoryMuscle_GlucoseToCellStorageFlow,YGLS. u3)
            annotation (Line(
              points={{-88,94},{-96,94},{-96,67},{-85,67}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(YGLS.y, CGL3.u) annotation (Line(
              points={{-73.5,71},{-72,71},{-72,64},{-82,64},{-82,60},{-80.4,60}},
              color={0,0,127},
              smooth=Smooth.None));

          connect(KEffect.y, busConnector. CD_K_Outflow) annotation (Line(
              points={{34,30},{98,30},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
        connect(concentrationMeasure2.concentration, busConnector.KPool)
          annotation (Line(
            points={{-48,28},{-96,28},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumen.solute, busConnector.GILumenPotassium_Mass) annotation (
           Line(
            points={{-8,-33.8},{-8,-54},{-96,-54},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(electrolytesFlowConstant1.y, KFluxToCellWithGlucose.soluteFlow)
            annotation (Line(
              points={{-79.5,51},{-74,51},{-74,60},{-71.6,60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
              points={{-88,94},{-96,94},{-96,-20},{-65.8,-20}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
              points={{-57.6,-12},{-56,-12},{-56,-18}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
            points={{-56,-22},{-56,-28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(AldoEffect.u, busConnector.NephronAldo_conc_in_nG_per_dl) annotation (
             Line(
              points={{43.8,48},{98,48},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        connect(busConnector.ECFV_Vol, KPool.solutionVolume) annotation (Line(
            points={{-88,94},{-96,94},{-96,16},{-38,16},{-38,30},{-32,30}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={Bitmap(extent={{-100,100},{100,-100}}, fileName=
                      "../Physiolibrary/icons/K.jpg"), Text(
                  extent={{-112,-102},{108,-128}},
                  lineColor={0,0,255},
                  textString="%name")}),
            Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>",   info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
        end Potassium2;

        model Potassium2_corrected
        Physiolibrary.Chemical.Components.Substance KPool(useNormalizedVolume=
              false, solute_start=(62.897)/1000)
          annotation (Placement(transformation(extent={{-34,14},{-14,34}})));
        Physiolibrary.Chemical.Components.Substance GILumen(useNormalizedVolume=
             false, solute_start=(25)/1000)
          annotation (Placement(transformation(extent={{-18,-36},{2,-16}})));
        Physiolibrary.Chemical.Components.SolutePump Absorbtion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{6,-20},{18,-32}})));
          Modelica.Blocks.Math.Gain Perm(k=0.002)
            annotation (Placement(transformation(extent={{0,-48},{6,-42}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-86},{40,-66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-100},{40,-80}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut SweatDuct(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{20,-72},{40,-52}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{0,-80},{20,-60}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{0,-94},{20,-74}})));
        Physiolibrary.Chemical.Components.Substance Bladder(useNormalizedVolume=
             false, solute_start=(0)/1000)
          annotation (Placement(transformation(extent={{94,12},{74,32}})));
        Physiolibrary.Blocks.Factors.Spline NaEffect(data={{0.0,0.3,0},{0.4,1.0,
              1.5},{4.0,3.0,0}})
          annotation (Placement(transformation(extent={{44,30},{24,50}})));
        Physiolibrary.Blocks.Factors.Spline AldoEffect(data={{0.0,0.3,0},{12.0,
              1.0,0.06},{50.0,3.0,0}})
          annotation (Placement(transformation(extent={{44,38},{24,58}})));
        Physiolibrary.Blocks.Factors.Spline ThiazideEffect(data={{0.0,1.0,2.0},
              {0.6,2.0,0}})
          annotation (Placement(transformation(extent={{44,46},{24,66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-66,-42},{-46,-22}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
            useSoluteFlowInput=true) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={-56,-44})));
        Physiolibrary.Chemical.Components.Substance KCell(useNormalizedVolume=
              false, solute_start=(3769.74)/1000)
          annotation (Placement(transformation(extent={{-30,70},{-10,90}})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToCell(
            useSoluteFlowInput=true)                             annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=90,
              origin={-30,58})));
          Modelica.Blocks.Math.Gain Perm1(k=0.002)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                rotation=90,
                origin={-55,53})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToPool(
            useSoluteFlowInput=true)                             annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=270,
              origin={-12,48})));
          Modelica.Blocks.Math.Feedback feedback
            annotation (Placement(transformation(extent={{-10,62},{-2,54}})));
        Physiolibrary.Types.Constants.ElectricChargeConst KCell_CaptiveMass(k=
              210338.040982)
          annotation (Placement(transformation(extent={{8,76},{-2,66}})));
          Modelica.Blocks.Math.Gain Perm2(k=7.4e-5)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                rotation=270,
                origin={3,53})));
        Physiolibrary.Types.Constants.ElectricCurrentConst
          electrolytesFlowConstant(k=0.08040444991666501)
          annotation (Placement(transformation(extent={{18,76},{30,88}})));
        Physiolibrary.Chemical.Components.SolutePump DT_K(useSoluteFlowInput=
              true)                                       annotation (Placement(
              transformation(
              extent={{-6,-6},{6,6}},
              origin={34,22})));
        Physiolibrary.Blocks.Factors.Spline KEffect(data={{0.0,0.0,0},{4.4,1.0,
              0.5},{5.5,3.0,0}})
          annotation (Placement(transformation(extent={{24,22},{44,42}})));
          Modelica.Blocks.Math.Gain mEq_per_L(k=1000)
            annotation (Placement(transformation(extent={{-3,-3},{3,3}},
                origin={15,31})));
          Modelica.Blocks.Math.Division division
            annotation (Placement(transformation(extent={{-18,6},{-14,10}})));
        Physiolibrary.Blocks.Factors.Normalization KidneyFunction
          annotation (Placement(transformation(extent={{44,54},{24,74}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={30,6})));
          Modelica.Blocks.Math.Gain gain(k=1000)
            annotation (Placement(transformation(extent={{40,4},{44,8}})));
        Physiomodel.Metabolism.deprecated.Input2EffectDelayed splineDelayByDay(data={{
              0,0.9,0.0},{300,1.0,0.00025},{1500,1.1,0.0}}, Tau=120*1440) annotation (
            Placement(transformation(
              extent={{10,-10},{-10,10}},
              rotation=90,
              origin={-48,58})));
        Physiolibrary.Chemical.Components.Clearance bladderVoid(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{82,-20},{94,-8}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure1(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-8,80})));
        Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure annotation (
           Placement(transformation(
              extent={{-8,8},{8,-8}},
              rotation=90,
              origin={-24,34})));
        Physiolibrary.Chemical.Components.SolutePump KFluxToCellWithGlucose(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(
              extent={{-6,-6},{6,6}},
              rotation=90,
              origin={-68,60})));
          Modelica.Blocks.Math.Gain CGL3(k=0.03)
          "glucose flow into cells to potassium flow into cells"
            annotation (Placement(transformation(extent={{-2,-2},{2,2}},
                origin={-78,60})));
          IkedaPotasiumIntoICFFactor IkedaIntoICF annotation (Placement(
                transformation(
                extent={{-10,-10},{10,10}},
                rotation=90,
                origin={-40,58})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure2(toAnotherUnitCoef=1000, unitsString="mEq/l")
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-48,24})));
        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{-94,88},{-82,100}}), iconTransformation(
                extent={{60,60},{100,100}})));
          Modelica.Blocks.Math.Add3 YGLS "Ikeda glucose to cells flow"
            annotation (Placement(transformation(extent={{-84,66},{-74,76}})));
        Physiolibrary.Types.Constants.ElectricCurrentConst
          electrolytesFlowConstant1(k=0)
          annotation (Placement(transformation(extent={{-90,46},{-80,56}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant7(k=70/
              1440)
          annotation (Placement(transformation(extent={{-66,-16},{-58,-8}})));
        Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,
              1.0,-0.04},{50,0.0,0}})
          annotation (Placement(transformation(extent={{-66,-30},{-46,-10}})));
        equation

        connect(KPool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
            points={{-32,30},{-95,30},{-95,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(GILumen.solutionVolume, busConnector.GILumenVolume_Mass)
          annotation (Line(
            points={{-16,-20},{-24,-20},{-24,-4},{-96,-4},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
              points={{-8,-26},{6,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Absorbtion.q_out, KPool.q_out)  annotation (Line(
              points={{18,-26},{22,-26},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Hemorrhage.q_in, KPool.q_out)  annotation (Line(
              points={{24,-76},{22,-76},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, KPool.q_out)  annotation (Line(
              points={{24,-90},{22,-90},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KPool.q_out, SweatDuct.q_in)  annotation (Line(
              points={{-24,24},{22,24},{22,-62},{24,-62}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, KPool.q_out)  annotation (Line(
              points={{16,-84},{22,-84},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, KPool.q_out)  annotation (Line(
              points={{16,-70},{22,-70},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Bladder.solutionVolume, busConnector.BladderVolume_Mass)
          annotation (Line(
            points={{92,28},{98,28},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(AldoEffect.y, NaEffect.yBase)     annotation (Line(
              points={{34,46},{34,42}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.y, AldoEffect.yBase)  annotation (Line(
              points={{34,54},{34,50}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ThiazideEffect.u, busConnector. ThiazidePool_Thiazide_conc) annotation (Line(
              points={{43.8,56},{98,56},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
        connect(IVDrip.soluteFlow, busConnector.IVDrip_KRate) annotation (Line(
            points={{10,-66},{10,-64},{-96,-64},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(Transfusion.soluteFlow, busConnector.Transfusion_KRate)
          annotation (Line(
            points={{10,-80},{-96,-80},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(SweatDuct.soluteFlow, busConnector.SweatDuct_KRate) annotation (
           Line(
            points={{30,-58},{30,-54},{98,-54},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(busConnector.Hemorrhage_KRate, Hemorrhage.soluteFlow)
          annotation (Line(
            points={{-88,94},{98,94},{98,-72},{30,-72}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-3,1},{-3,1}}));
        connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_K_Flux)
          annotation (Line(
            points={{30,-86},{98,-86},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(Diet.q_out, GILumen.q_out) annotation (Line(
              points={{-50,-32},{-16,-32},{-16,-26},{-8,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Diarrhea.soluteFlow, busConnector.GILumenDiarrhea_KLoss)
          annotation (Line(
            points={{-56,-48},{-96,-48},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
              points={{-8,-26},{-16,-26},{-16,-44},{-50,-44}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(KCell.solutionVolume, busConnector.CellH2O_Vol) annotation (
            Line(
            points={{-28,86},{-95,86},{-95,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
              points={{6.3,-45},{12,-45},{12,-29.6}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Perm.u, GILumen.solute) annotation (Line(
            points={{-0.6,-45},{-8,-45},{-8,-33.8}},
            color={0,0,127},
            smooth=Smooth.None));

          connect(KFluxToCell.q_out, KCell.q_out) annotation (Line(
              points={{-30,64},{-30,80},{-20,80}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(KCell.q_out, KFluxToPool.q_in) annotation (Line(
              points={{-20,80},{-12,80},{-12,54}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(KPool.solute, Perm1.u) annotation (Line(
            points={{-24,16.2},{-24,10},{-55,10},{-55,49.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KCell.solute, feedback.u1) annotation (Line(
            points={{-20,72.2},{-20,58},{-9.2,58}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(KCell_CaptiveMass.y, feedback.u2) annotation (Line(
              points={{-2.5,71},{-6,71},{-6,61.2}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(feedback.y, Perm2.u) annotation (Line(
              points={{-2.4,58},{3.3,58},{3.3,56.6},{3,56.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KFluxToPool.soluteFlow, Perm2.y) annotation (Line(
              points={{-8.4,48},{3,48},{3,49.7}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(NaEffect.u, busConnector. DT_Na_Outflow) annotation (Line(
              points={{43.8,40},{98,40},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(KPool.q_out, DT_K.q_in) annotation (Line(
              points={{-24,24},{22,24},{22,22},{28,22}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(NaEffect.y, KEffect.yBase) annotation (Line(
              points={{34,38},{34,34}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KEffect.y, DT_K.soluteFlow) annotation (Line(
              points={{34,30},{34,25.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(mEq_per_L.y, KEffect.u) annotation (Line(
              points={{18.3,31},{21.15,31},{21.15,32},{24.2,32}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(division.u1, KPool.solute) annotation (Line(
            points={{-18.4,9.2},{-24,9.2},{-24,16.2}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(busConnector.ECFV_Vol, division.u2) annotation (Line(
              points={{-88,94},{-96,94},{-96,6.8},{-18.4,6.8}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%first",
         index=-1,
         extent={{-3,1},{-3,1}}));
          connect(division.y, mEq_per_L.u) annotation (Line(
              points={{-13.8,8},{-8,8},{-8,31},{11.4,31}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(electrolytesFlowConstant.y, KidneyFunction.yBase) annotation (
              Line(
              points={{30.6,82},{34,82},{34,66}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunction.y, ThiazideEffect.yBase) annotation (Line(
              points={{34,62},{34,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(KidneyFunction.u, busConnector. KidneyFunctionEffect) annotation (Line(
              points={{43.8,64},{98,64},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(DT_K.q_out, Bladder.q_out) annotation (Line(
              points={{40,22},{84,22}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(busConnector.KCell_Mass, KCell.solute) annotation (Line(
            points={{-88,94},{-4,94},{-4,72},{-20,72},{-20,72.2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-3,1},{-3,1}}));
        connect(KPool.solute, busConnector.KPool_mass) annotation (Line(
            points={{-24,16.2},{-24,10},{-96,10},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(concentrationMeasure.q_in, KPool.q_out) annotation (Line(
              points={{30,6},{22,6},{22,24},{-24,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(concentrationMeasure.concentration, gain.u) annotation (Line(
            points={{34,6},{36.8,6},{36.8,6},{39.6,6}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(gain.y, busConnector. KPool_conc_per_liter) annotation (Line(
              points={{44.2,6},{98,6},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(Perm1.y, splineDelayByDay.yBase) annotation (Line(
              points={{-55,56.3},{-55,58},{-50,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(splineDelayByDay.u, busConnector. AldoPool_Aldo) annotation (Line(
              points={{-48,67.8},{-48,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
              points={{84,22},{66,22},{66,-14},{82,-14}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(bladderVoid.solutionFlow, busConnector.BladderVoidFlow)
          annotation (Line(
            points={{88,-10.4},{88,-6},{98,-6},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(GILumen.solute, busConnector.GILumenPotasium_Mass) annotation (
            Line(
            points={{-8,-33.8},{-8,-54},{-96,-54},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(KCell.q_out, concentrationMeasure1.q_in) annotation (Line(
              points={{-20,80},{-8,80}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure1.concentration, busConnector.KCell_conc)
          annotation (Line(
            points={{-8,84},{-8,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(KPool.q_out, flowMeasure.q_in) annotation (Line(
              points={{-24,24},{-24,30.8}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToPool.q_out) annotation (Line(
              points={{-24,37.2},{-24,38},{-12,38},{-12,42}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(flowMeasure.q_out, KFluxToCell.q_in) annotation (Line(
              points={{-24,37.2},{-24,38},{-30,38},{-30,52}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(flowMeasure.molarFlowRate, busConnector.PotassiumToCells)
          annotation (Line(
            points={{-20,34},{-95,34},{-95,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
          connect(flowMeasure.q_out, KFluxToCellWithGlucose.q_in) annotation (
              Line(
              points={{-24,37.2},{-24,38},{-68,38},{-68,54}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(KFluxToCellWithGlucose.q_out, KCell.q_out) annotation (Line(
              points={{-68,66},{-68,80},{-20,80}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(IkedaIntoICF.y, KFluxToCell.soluteFlow) annotation (Line(
              points={{-34.8,58},{-33.6,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(splineDelayByDay.y, IkedaIntoICF.yBase) annotation (Line(
              points={{-46,58},{-45,58}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(IkedaIntoICF.Artys_pH, busConnector. Artys_pH) annotation (Line(
              points={{-43,48},{-44,46},{-44,42},{-96,42},{-96,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
          connect(concentrationMeasure2.q_in, KPool.q_out) annotation (Line(
              points={{-48,24},{-24,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, IkedaIntoICF.PotasiumECF_conc)
          annotation (Line(
            points={{-48,28},{-48,40},{-37,40},{-37,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure2.concentration, busConnector.KPool_per_liter)
          annotation (Line(
            points={{-48,28},{-48,30},{-96,30},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));

          connect(busConnector.skeletalMuscle_GlucoseToCellStorageFlow,YGLS. u2)
                     annotation (Line(
              points={{-88,94},{-96,94},{-96,71},{-85,71}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.liver_GlucoseToCellStorageFlow,YGLS. u1)
            annotation (Line(
              points={{-88,94},{-96,94},{-96,75},{-85,75}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.respiratoryMuscle_GlucoseToCellStorageFlow,YGLS. u3)
            annotation (Line(
              points={{-88,94},{-96,94},{-96,67},{-85,67}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(YGLS.y, CGL3.u) annotation (Line(
              points={{-73.5,71},{-72,71},{-72,64},{-82,64},{-82,60},{-80.4,60}},
              color={0,0,127},
              smooth=Smooth.None));

          connect(KEffect.y, busConnector. CD_K_Outflow) annotation (Line(
              points={{34,30},{98,30},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
         string="%second",
         index=1,
         extent={{3,1},{3,1}}));
        connect(concentrationMeasure2.concentration, busConnector.KPool)
          annotation (Line(
            points={{-48,28},{-96,28},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumen.solute, busConnector.GILumenPotassium_Mass) annotation (
           Line(
            points={{-8,-33.8},{-8,-54},{-96,-54},{-96,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
          connect(electrolytesFlowConstant1.y, KFluxToCellWithGlucose.soluteFlow)
            annotation (Line(
              points={{-79.5,51},{-74,51},{-74,60},{-71.6,60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
              points={{-88,94},{-96,94},{-96,-20},{-65.8,-20}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
              points={{-57.6,-12},{-56,-12},{-56,-18}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
            points={{-56,-22},{-56,-28}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(AldoEffect.u, busConnector.NephronAldo_conc_in_nG_per_dl)
            annotation (Line(
              points={{43.8,48},{98,48},{98,94},{-88,94}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={Bitmap(extent={{-100,100},{100,-100}}, fileName=
                      "../Physiolibrary/icons/K.jpg"), Text(
                  extent={{-112,-102},{108,-128}},
                  lineColor={0,0,255},
                  textString="%name")}),
            Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>",   info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
        end Potassium2_corrected;

        model TNa_K
        import Physiomodel;
          Physiomodel.Electrolytes.Potassium.Potassium potassium2_1
            annotation (Placement(transformation(extent={{-30,32},{-10,52}})));
        Physiomodel.Electrolytes.old.setup.ElectrolytesConstInputs2FromFile
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{12,40},{32,60}})));
          Physiomodel.Electrolytes.Sodium.Sodium sodium
            annotation (Placement(transformation(extent={{-32,-6},{-12,14}})));
          Physiomodel.Electrolytes.Phosphate.Phosphate2 phosphate2_1
            annotation (Placement(transformation(extent={{-70,46},{-50,66}})));
        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{-70,-32},{-52,-14}}), iconTransformation(
                extent={{-120,20},{-80,60}})));
          Modelica.Blocks.Math.Sum BloodCations(nin=2)
            annotation (Placement(transformation(extent={{-12,-66},{8,-46}})));
          Physiomodel.Electrolytes.Sulphate.Sulphate2 sulphate2_1
            annotation (Placement(transformation(extent={{-98,-8},{-78,12}})));
        Physiomodel.Electrolytes.Chloride.setup.Chloride chloride
          annotation (Placement(transformation(extent={{42,-18},{62,2}})));
          Modelica.Blocks.Math.Sum StrongAnionsLessCl(nin=4)
            annotation (Placement(transformation(extent={{-48,-100},{-28,-80}})));
        equation
          connect(potassium2_1.busConnector,electrolytesConstInputs. busConnector)
            annotation (Line(
              points={{-12,50},{20,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(sodium.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-14,12},{4,12},{4,50},{20,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(phosphate2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-52,64},{20,64},{20,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(busConnector.NaPool_conc_per_liter,BloodCations. u[1]) annotation (Line(
              points={{-61,-23},{-62,-56},{-14,-56},{-14,-57}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(busConnector.KPool_conc_per_liter,BloodCations. u[2]) annotation (Line(
              points={{-61,-23},{-62,-23},{-62,-54},{-14,-54},{-14,-55}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(BloodCations.y,busConnector. BloodIons_Cations)
            annotation (Line(
              points={{9,-56},{44,-56},{44,-24},{-61,-24},{-61,-23}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(BloodCations.y,busConnector. BloodCations) annotation (Line(
              points={{9,-56},{44,-56},{44,-23},{-61,-23}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(busConnector, phosphate2_1.busConnector) annotation (Line(
              points={{-61,-23},{-61,20.5},{-52,20.5},{-52,64}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(sulphate2_1.busConnector, busConnector) annotation (Line(
              points={{-80,10},{-61,10},{-61,-23}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(chloride.busConnector, busConnector) annotation (Line(
              points={{60.1,0.1},{1.05,0.1},{1.05,-23},{-61,-23}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(busConnector.PO4Pool_conc_per_liter, StrongAnionsLessCl.u[2])
            annotation (Line(
              points={{-61,-23},{-62,-23},{-62,-90.5},{-50,-90.5}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(busConnector.SO4Pool_conc_per_liter, StrongAnionsLessCl.u[3])
            annotation (Line(
              points={{-61,-23},{-62,-90},{-50,-89.5}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(busConnector.LacPool_Lac_mEq_per_litre, StrongAnionsLessCl.u[4])
                annotation (Line(
              points={{-61,-23},{-61,-88.5},{-50,-88.5}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(busConnector.KAPool_conc_per_liter, StrongAnionsLessCl.u[1])
            annotation (Line(
              points={{-61,-23},{-61,-91.5},{-50,-91.5}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(StrongAnionsLessCl.y, busConnector.BloodIons_StrongAnionsLessCl)
            annotation (Line(
              points={{-27,-90},{44,-90},{44,-23},{-61,-23}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end TNa_K;
      end test;

      package setup
        model ConstInputsFromOtherElectrolytes

        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{44,58},{64,78}}), iconTransformation(
                extent={{-40,-20},{0,20}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant DT_Na_Outflow(k=
             0.48247099389415)
          annotation (Placement(transformation(extent={{-20,42},{-14,48}})));
        equation

          connect(DT_Na_Outflow.y, busConnector.DT_Na_Outflow) annotation (Line(
         points={{-13.7,45},{54,45},{54,68}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end ConstInputsFromOtherElectrolytes;
      end setup;

      model Potassium
      import Physiomodel;
        extends Physiolibrary.Icons.Potassium;
      Physiolibrary.Chemical.Components.Substance KPool(
        stateName="KPool.Mass",
        useNormalizedVolume=false,
        solute_start=(62.897)/1000)
        annotation (Placement(transformation(extent={{-34,14},{-14,34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{20,-86},{40,-66}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{20,-100},{40,-80}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{0,-80},{20,-60}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{0,-94},{20,-74}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure2 annotation (Placement(
              transformation(
              extent={{-10,-10},{10,10}},
              origin={-80,42})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-94,88},{-82,100}}), iconTransformation(
              extent={{60,60},{100,100}})));
        GILumenK gILumenK
          annotation (Placement(transformation(extent={{-74,-40},{-54,-20}})));
        Physiomodel.Electrolytes.Bladder bladder(stateVarName=
              "BladderPotassium.Mass")
          annotation (Placement(transformation(extent={{56,-52},{76,-32}})));
        Physiomodel.Electrolytes.Potassium.KindeyK kindeyK
          annotation (Placement(transformation(extent={{42,-22},{62,-2}})));
      Physiolibrary.Types.Concentration ECF_conc;
        Physiomodel.Electrolytes.SweatGlandSalt sweatGlandSalt(FractReabBasic=0,
            FractReabK=0)
          annotation (Placement(transformation(extent={{22,42},{42,62}})));
        Physiomodel.Electrolytes.Potassium.CellsK
          intracellularPotassium
          annotation (Placement(transformation(extent={{-32,68},{-12,88}})));
      equation
        ECF_conc=concentrationMeasure2.concentration;

      connect(KPool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
          points={{-28,28},{-95,28},{-95,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(Hemorrhage.q_in, KPool.q_out)  annotation (Line(
            points={{20,-76},{22,-76},{22,24},{-24,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(DialyzerActivity.q_in, KPool.q_out)  annotation (Line(
            points={{20,-90},{22,-90},{22,24},{-24,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Transfusion.q_out, KPool.q_out)  annotation (Line(
            points={{20,-84},{22,-84},{22,24},{-24,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(IVDrip.q_out, KPool.q_out)  annotation (Line(
            points={{20,-70},{22,-70},{22,24},{-24,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(IVDrip.soluteFlow, busConnector.IVDrip_KRate) annotation (Line(
          points={{14,-66},{14,-64},{-96,-64},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
      connect(Transfusion.soluteFlow, busConnector.Transfusion_KRate)
        annotation (Line(
          points={{14,-80},{-96,-80},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
      connect(busConnector.Hemorrhage_KRate, Hemorrhage.soluteFlow) annotation (
         Line(
          points={{-88,94},{98,94},{98,-72},{34,-72}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-3,1},{-3,1}}));
      connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_K_Flux)
        annotation (Line(
          points={{34,-86},{98,-86},{98,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

        connect(concentrationMeasure2.q_in, KPool.q_out) annotation (Line(
            points={{-80,42},{-64,42},{-64,24},{-24,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));

      connect(concentrationMeasure2.concentration, busConnector.KPool)
        annotation (Line(
          points={{-80,34},{-64,34},{-64,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(gILumenK.busConnector, busConnector) annotation (Line(
            points={{-56,-22},{-56,-16},{-96,-16},{-96,94},{-88,94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gILumenK.q_out, KPool.q_out) annotation (Line(
            points={{-64,-30},{-64,24},{-24,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(kindeyK.q_out, bladder.q_in) annotation (Line(
            points={{54,-20},{66,-20},{66,-34}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(kindeyK.q_in, KPool.q_out) annotation (Line(
            points={{54,-12},{54,24},{-24,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(bladder.busConnector, busConnector) annotation (Line(
            points={{74,-34},{82,-34},{82,94},{-88,94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(kindeyK.busConnector, busConnector) annotation (Line(
            points={{60,-4},{82,-4},{82,94},{-88,94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      connect(KPool.solute, busConnector.KPool_mass) annotation (Line(
          points={{-18,14},{-18,6},{-96,6},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(KPool.q_out, sweatGlandSalt.salt) annotation (Line(
            points={{-24,24},{22,24},{22,46}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(sweatGlandSalt.busConnector, busConnector) annotation (Line(
            points={{40,60},{82,60},{82,94},{-88,94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(KPool.q_out, intracellularPotassium.q_in) annotation (Line(
            points={{-24,24},{-24,78},{-22,78}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector, intracellularPotassium.busConnector) annotation (
            Line(
            points={{-88,94},{-14,94},{-14,86}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      connect(concentrationMeasure2.concentration, busConnector.KPool_conc_per_liter)
        annotation (Line(
          points={{-80,34},{-84,34},{-84,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={            Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
      end Potassium;

      model KindeyK
        extends Physiolibrary.Icons.Kidney;

      Physiolibrary.Blocks.Factors.Spline NaEffect(data={{0.0,0.3,0},{0.4,1.0,
            1.5},{4.0,3.0,0}}, Xscale=1e-3/60)
        annotation (Placement(transformation(extent={{44,30},{24,50}})));
      Physiolibrary.Blocks.Factors.LagSpline
                                          AldoEffect(data={{0.0,0.3,0},{12.0,
            1.0,0.06},{50.0,3.0,0}},
        Xscale=1e-8/Substances.Aldosterone.mw,
        HalfTime=Modelica.Math.log(2)*3*60*60,
        initialValue=12)
        annotation (Placement(transformation(extent={{44,38},{24,58}})));
      Physiolibrary.Blocks.Factors.Spline ThiazideEffect(data={{0.0,1.0,2.0},{
            0.6,2.0,0}})
        annotation (Placement(transformation(extent={{44,46},{24,66}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        electrolytesFlowConstant(k=8.3333333333333e-07)
        annotation (Placement(transformation(extent={{18,76},{30,88}})));
      Physiolibrary.Chemical.Components.SolutePump DT_K(useSoluteFlowInput=true)
                                                        annotation (Placement(
            transformation(
            extent={{-6,-6},{6,6}},
            origin={34,22})));
      Physiolibrary.Blocks.Factors.Spline KEffect(data={{0.0,0.0,0},{4.4,1.0,
            0.5},{5.5,3.0,0}})
        annotation (Placement(transformation(extent={{24,22},{44,42}})));
      Physiolibrary.Blocks.Factors.Normalization KidneyFunction
        annotation (Placement(transformation(extent={{44,54},{24,74}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-94,88},{-82,100}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-54,6},{-36,24}}),
            iconTransformation(extent={{10,-10},{30,10}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out
        "sodium mass outflow to urine from collecting ducts" annotation (
          Placement(transformation(extent={{-14,-60},{2,-46}}),
            iconTransformation(extent={{10,-90},{30,-70}})));
      equation

        connect(AldoEffect.y, NaEffect.yBase)     annotation (Line(
            points={{34,44},{34,42}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ThiazideEffect.y, AldoEffect.yBase)  annotation (Line(
            points={{34,52},{34,50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ThiazideEffect.u, busConnector. ThiazidePool_Thiazide_conc) annotation (Line(
            points={{42,56},{98,56},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));

        connect(NaEffect.u, busConnector. DT_Na_Outflow) annotation (Line(
            points={{42,40},{98,40},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
        connect(NaEffect.y, KEffect.yBase) annotation (Line(
            points={{34,36},{34,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KEffect.y, DT_K.soluteFlow) annotation (Line(
            points={{34,28},{34,24.4},{36.4,24.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(electrolytesFlowConstant.y, KidneyFunction.yBase) annotation (
            Line(
            points={{31.5,82},{34,82},{34,66}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KidneyFunction.y, ThiazideEffect.yBase) annotation (Line(
            points={{34,60},{34,58}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KidneyFunction.u, busConnector. KidneyFunctionEffect) annotation (Line(
            points={{42,64},{98,64},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));

        connect(KEffect.y, busConnector. CD_K_Outflow) annotation (Line(
            points={{34,28},{98,28},{98,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
        connect(q_in, DT_K.q_in) annotation (Line(
            points={{-45,15},{-8.5,15},{-8.5,22},{28,22}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(DT_K.q_out, q_out) annotation (Line(
            points={{40,22},{56,22},{56,-44},{-4,-44},{-4,-53},{-6,-53}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.KPool_conc_per_liter, KEffect.u) annotation (Line(
            points={{-88,94},{-88,32},{26,32}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(AldoEffect.u, busConnector.Aldosterone) annotation (Line(
          points={{42,48},{98,48},{98,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
      end KindeyK;

      model GILumenK
        extends Physiolibrary.Icons.GILumen;
      Physiolibrary.Chemical.Components.Substance GILumen(
        stateName="GILumenPotassium.Mass",
        useNormalizedVolume=false,
        solute_start=(25)/1000)
        annotation (Placement(transformation(extent={{-18,-36},{2,-16}})));
      Physiolibrary.Chemical.Components.SolutePump Absorbtion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{6,-20},{18,-32}})));
        Modelica.Blocks.Math.Gain Perm(k(unit="1/s")=0.002/60)
          annotation (Placement(transformation(extent={{0,-48},{6,-42}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-66,-42},{-46,-22}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
          useSoluteFlowInput=true) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={-56,-44})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-94,88},{-82,100}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst        Constant7(k(
            displayUnit="mmol/min") = 8.1018518518518e-07)
        annotation (Placement(transformation(extent={{-66,-16},{-58,-8}})));
      Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,1.0,
            -0.04},{50,0.0,0}}, Xscale=1e-6/Substances.Leptin.mw)
        annotation (Placement(transformation(extent={{-66,-30},{-46,-10}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out
        "sodium mass outflow to urine from collecting ducts" annotation (
          Placement(transformation(extent={{56,-24},{72,-10}}),
            iconTransformation(extent={{-10,-10},{10,10}})));
      equation

      connect(GILumen.solutionVolume, busConnector.GILumenVolume_Mass)
        annotation (Line(
          points={{-12,-22},{-24,-22},{-24,-4},{-96,-4},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
            points={{-8,-26},{6,-26}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Diet.q_out, GILumen.q_out) annotation (Line(
            points={{-46,-32},{-16,-32},{-16,-26},{-8,-26}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(Diarrhea.soluteFlow, busConnector.GILumenDiarrhea_KLoss)
        annotation (Line(
          points={{-60,-48},{-96,-48},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
            points={{-8,-26},{-16,-26},{-16,-44},{-46,-44}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
            points={{6.3,-45},{14.4,-45},{14.4,-28.4}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Perm.u, GILumen.solute) annotation (Line(
          points={{-0.6,-45},{-2,-45},{-2,-36}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(GILumen.solute, busConnector.GILumenPotasium_Mass) annotation (
          Line(
          points={{-2,-36},{-2,-54},{-96,-54},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

      connect(GILumen.solute, busConnector.GILumenPotassium_Mass) annotation (
          Line(
          points={{-2,-36},{-2,-54},{-96,-54},{-96,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
            points={{-88,94},{-96,94},{-96,-20},{-64,-20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
            points={{-57,-12},{-56,-12},{-56,-18}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
          points={{-56,-24},{-56,-28},{-52,-28}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(Absorbtion.q_out, q_out) annotation (Line(
            points={{18,-26},{42,-26},{42,-17},{64,-17}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
      end GILumenK;

      model CellsK
      import Physiomodel;
        extends Physiolibrary.Icons.Cell;
      Physiolibrary.Chemical.Components.Substance KCell(
        stateName="KCell.Mass",
        useNormalizedVolume=false,
        solute_start=(3769.74)/1000)
        annotation (Placement(transformation(extent={{2,46},{22,66}})));
      Physiolibrary.Chemical.Components.SolutePump KFluxToCell(
          useSoluteFlowInput=true)                             annotation (
          Placement(transformation(
            extent={{-6,-6},{6,6}},
            rotation=90,
            origin={6,-10})));
        Modelica.Blocks.Math.Gain Perm1(k=0.002/60)
          annotation (Placement(transformation(extent={{-4,-4},{4,4}},
              rotation=270,
              origin={-68,32})));
      Physiolibrary.Chemical.Components.SolutePump KFluxToPool(
          useSoluteFlowInput=true)                             annotation (
          Placement(transformation(
            extent={{-6,-6},{6,6}},
            rotation=270,
            origin={48,-56})));
        Modelica.Blocks.Math.Feedback feedback
          annotation (Placement(transformation(extent={{54,-18},{62,-26}})));
      Physiolibrary.Types.Constants.AmountOfSubstanceConst
                                                        KCell_CaptiveMass(k=2.18)
        annotation (Placement(transformation(extent={{72,-4},{62,-14}})));
        Modelica.Blocks.Math.Gain Perm2(k=7.4e-5/60)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              rotation=270,
              origin={67,-27})));
        Physiolibrary.Blocks.Factors.SplineLag      splineDelayByDay(        data={{
              0,0.9,0.0},{300,1.0,0.00025},{1500,1.1,0.0}},
          stateName="PotassiumToCell_AldoEffect",
          Xscale=1e-9,
          HalfTime=120*Modelica.Math.log(2)*60) "1 pmol/L = 1e-9 mmol/l"
                                                            annotation (
            Placement(transformation(
              extent={{10,-10},{-10,10}},
              origin={-68,18})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1 annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-24,74})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure annotation (
          Placement(transformation(
            extent={{-8,-8},{8,8}},
            rotation=90,
            origin={6,-76})));
      Physiolibrary.Chemical.Components.SolutePump KFluxToCellWithGlucose(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(
            extent={{-6,-6},{6,6}},
            rotation=90,
            origin={-28,-44})));
        Modelica.Blocks.Math.Gain CGL3(k=0.03/60)
        "glucose flow into cells to potassium flow into cells"
          annotation (Placement(transformation(extent={{-2,-2},{2,2}},
              origin={-38,-44})));
        IkedaPotasiumIntoICFFactor IkedaIntoICF annotation (Placement(
              transformation(
              extent={{-10,-10},{10,10}},
              origin={-68,2})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-94,88},{-82,100}}), iconTransformation(
              extent={{60,60},{100,100}})));
        Modelica.Blocks.Math.Add3 YGLS "Ikeda glucose to cells flow"
          annotation (Placement(transformation(extent={{-44,-38},{-34,-28}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        electrolytesFlowConstant1(k=0)
        annotation (Placement(transformation(extent={{-50,-58},{-40,-48}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-4,-94},{14,-76}}),
            iconTransformation(extent={{-10,-10},{10,10}})));

      equation
      connect(KCell.solutionVolume, busConnector.CellH2O_Vol) annotation (Line(
          points={{8,60},{-1,60},{-1,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

        connect(KFluxToCell.q_out, KCell.q_out) annotation (Line(
            points={{6,-4},{6,56},{12,56}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(KCell.q_out, KFluxToPool.q_in) annotation (Line(
            points={{12,56},{48,56},{48,-50}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(KCell.solute, feedback.u1) annotation (Line(
          points={{18,46},{18,-22},{54.8,-22}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(KCell_CaptiveMass.y, feedback.u2) annotation (Line(
            points={{60.75,-9},{58,-9},{58,-18.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(feedback.y, Perm2.u) annotation (Line(
            points={{61.6,-22},{67.3,-22},{67.3,-23.4},{67,-23.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KFluxToPool.soluteFlow, Perm2.y) annotation (Line(
            points={{50.4,-58.4},{67,-58.4},{67,-30.3}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(busConnector.KCell_Mass, KCell.solute) annotation (Line(
          points={{-88,94},{-4,94},{-4,46},{18,46}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-3,1},{-3,1}}));
        connect(Perm1.y, splineDelayByDay.yBase) annotation (Line(
            points={{-68,27.6},{-68,20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KCell.q_out, concentrationMeasure1.q_in) annotation (Line(
            points={{12,56},{-24,56},{-24,72}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure1.concentration, busConnector.KCell_conc)
        annotation (Line(
          points={{-24,78},{-24,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(flowMeasure.q_out, KFluxToPool.q_out) annotation (Line(
            points={{6,-68},{6,-62},{48,-62}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure.q_out, KFluxToCell.q_in) annotation (Line(
            points={{6,-68},{6,-16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(flowMeasure.molarFlowRate, busConnector.PotassiumToCells)
        annotation (Line(
          points={{10.8,-76},{97,-76},{97,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(flowMeasure.q_out, KFluxToCellWithGlucose.q_in) annotation (
            Line(
            points={{6,-68},{6,-66},{-28,-66},{-28,-50}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(KFluxToCellWithGlucose.q_out, KCell.q_out) annotation (Line(
            points={{-28,-38},{-28,56},{12,56}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(IkedaIntoICF.y, KFluxToCell.soluteFlow) annotation (Line(
            points={{-68,-3.2},{-68,-7.6},{3.6,-7.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(splineDelayByDay.y, IkedaIntoICF.yBase) annotation (Line(
            points={{-68,14},{-68,7}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(IkedaIntoICF.Artys_pH, busConnector. Artys_pH) annotation (Line(
            points={{-78,5},{-86,6},{-100,6},{-100,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));

        connect(busConnector.skeletalMuscle_GlucoseToCellStorageFlow,YGLS. u2)
                   annotation (Line(
            points={{-88,94},{-100,94},{-100,-33},{-45,-33}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.liver_GlucoseToCellStorageFlow,YGLS. u1)
          annotation (Line(
            points={{-88,94},{-100,94},{-100,-29},{-45,-29}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.respiratoryMuscle_GlucoseToCellStorageFlow,YGLS. u3)
          annotation (Line(
            points={{-88,94},{-100,94},{-100,-37},{-45,-37}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(YGLS.y, CGL3.u) annotation (Line(
            points={{-33.5,-33},{-32,-33},{-32,-40},{-42,-40},{-42,-44},{-40.4,-44}},
            color={0,0,127},
            smooth=Smooth.None));

        connect(electrolytesFlowConstant1.y, KFluxToCellWithGlucose.soluteFlow)
          annotation (Line(
            points={{-38.75,-53},{-34,-53},{-34,-41.6},{-30.4,-41.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(flowMeasure.q_in, q_in) annotation (Line(
            points={{6,-84},{5,-84},{5,-85}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.KPool_mass, Perm1.u) annotation (Line(
            points={{-88,94},{-68,94},{-68,36.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));

      connect(splineDelayByDay.u, busConnector.Aldosterone) annotation (Line(
          points={{-60,18},{-36,18},{-36,94},{-88,94}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.KPool, IkedaIntoICF.PotasiumECF_conc) annotation (
          Line(
          points={{-88,94},{-96,94},{-96,-1},{-78,-1}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
      end CellsK;

      model CellsK_Steady
      import Physiomodel;
        extends Physiolibrary.Icons.Cell;
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-94,88},{-82,100}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-18,-86},{0,-68}}),
            iconTransformation(extent={{-10,-10},{10,10}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant KCell_Mass(
          varName="KCell.Mass")
        annotation (Placement(transformation(extent={{-50,-4},{-20,26}})));
      equation

        q_in.q=0
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));

        connect(KCell_Mass.y, busConnector.KCell_Mass) annotation (Line(
            points={{-16.25,11},{-16.25,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      end CellsK_Steady;

      model CellsK_
      import Physiomodel;
        extends Physiolibrary.Icons.Cell;

        parameter String stateName;
        parameter Real initialSoluteMass;
      Physiolibrary.Chemical.Components.Substance KCell(
        stateName=stateName,
        useNormalizedVolume=false,
        solute_start=(initialSoluteMass)/1000)
        annotation (Placement(transformation(extent={{2,46},{22,66}})));
      Physiolibrary.Chemical.Components.SolutePump KFluxToCell(
          useSoluteFlowInput=true)                             annotation (
          Placement(transformation(
            extent={{-6,-6},{6,6}},
            rotation=90,
            origin={6,-10})));
        Modelica.Blocks.Math.Gain Perm1(k=0.002)
          annotation (Placement(transformation(extent={{-4,-4},{4,4}},
              rotation=270,
              origin={-68,32})));
      Physiolibrary.Chemical.Components.SolutePump KFluxToPool(
          useSoluteFlowInput=true)                             annotation (
          Placement(transformation(
            extent={{-6,-6},{6,6}},
            rotation=270,
            origin={48,-56})));
        Modelica.Blocks.Math.Feedback feedback
          annotation (Placement(transformation(extent={{54,-18},{62,-26}})));
      Physiolibrary.Types.Constants.ElectricChargeConst KCell_CaptiveMass(k=
            210338.040982)
        annotation (Placement(transformation(extent={{72,-4},{62,-14}})));
        Modelica.Blocks.Math.Gain Perm2(k=7.4e-5)
          annotation (Placement(transformation(extent={{-3,-3},{3,3}},
              rotation=270,
              origin={67,-27})));
      Physiomodel.Metabolism.deprecated.Input2EffectDelayed splineDelayByDay(
        data={{0,0.9,0.0},{300,1.0,0.00025},{1500,1.1,0.0}},
        Tau=120*1440,
        stateName="PotassiumToCell_AldoEffect") annotation (Placement(transformation(
            extent={{10,-10},{-10,10}},
            origin={-68,18})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1(
         toAnotherUnitCoef=1000, unitsString="mEq/l") annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-24,74})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure annotation (
          Placement(transformation(
            extent={{-8,8},{8,-8}},
            rotation=90,
            origin={6,-76})));
      Physiolibrary.Chemical.Components.SolutePump KFluxToCellWithGlucose(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(
            extent={{-6,-6},{6,6}},
            rotation=90,
            origin={-28,-44})));
        IkedaPotasiumIntoICFFactor IkedaIntoICF annotation (Placement(
              transformation(
              extent={{-10,-10},{10,10}},
              origin={-68,2})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-94,88},{-82,100}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-4,-94},{14,-76}}),
            iconTransformation(extent={{-10,-10},{10,10}})));

        Modelica.Blocks.Interfaces.RealInput
                                           additionalInflow annotation (
            Placement(transformation(extent={{-122,-74},{-82,-34}}),
              iconTransformation(extent={{-100,-74},{-60,-34}})));
        Modelica.Blocks.Interfaces.RealInput
                                           CellH2O_Vol annotation (Placement(
              transformation(extent={{-70,42},{-30,82}}), iconTransformation(
                extent={{-100,18},{-60,58}})));
        Modelica.Blocks.Interfaces.RealOutput KCell_Mass
          annotation (Placement(transformation(extent={{70,18},{90,38}})));
        Modelica.Blocks.Interfaces.RealOutput KCell_conc
          annotation (Placement(transformation(extent={{44,72},{64,92}})));
      equation

        connect(KFluxToCell.q_out, KCell.q_out) annotation (Line(
            points={{6,-4},{6,56},{12,56}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(KCell.q_out, KFluxToPool.q_in) annotation (Line(
            points={{12,56},{48,56},{48,-50}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(KCell.solute, feedback.u1) annotation (Line(
          points={{12,46},{12,-22},{54.8,-22}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(KCell_CaptiveMass.y, feedback.u2) annotation (Line(
            points={{60.75,-9},{58,-9},{58,-18.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(feedback.y, Perm2.u) annotation (Line(
            points={{61.6,-22},{67.3,-22},{67.3,-23.4},{67,-23.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KFluxToPool.soluteFlow, Perm2.y) annotation (Line(
            points={{50.4,-58.4},{67,-58.4},{67,-30.3}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Perm1.y, splineDelayByDay.yBase) annotation (Line(
            points={{-68,27.6},{-68,20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(splineDelayByDay.u, busConnector. AldoPool_Aldo) annotation (Line(
            points={{-58.2,18},{-58.2,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
        connect(KCell.q_out, concentrationMeasure1.q_in) annotation (Line(
            points={{12,56},{-24,56},{-24,72}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure.q_out, KFluxToPool.q_out) annotation (Line(
            points={{6,-68},{6,-62},{48,-62}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure.q_out, KFluxToCell.q_in) annotation (Line(
            points={{6,-68},{6,-16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure.q_out, KFluxToCellWithGlucose.q_in) annotation (
            Line(
            points={{6,-68},{6,-66},{-28,-66},{-28,-50}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(KFluxToCellWithGlucose.q_out, KCell.q_out) annotation (Line(
            points={{-28,-38},{-28,56},{12,56}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(IkedaIntoICF.y, KFluxToCell.soluteFlow) annotation (Line(
            points={{-68,-3.2},{-68,-7.6},{3.6,-7.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(splineDelayByDay.y, IkedaIntoICF.yBase) annotation (Line(
            points={{-68,16},{-68,7}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(IkedaIntoICF.Artys_pH, busConnector. Artys_pH) annotation (Line(
            points={{-78,5},{-86,6},{-100,6},{-100,94},{-88,94}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));

        connect(busConnector.KPool_per_liter, IkedaIntoICF.PotasiumECF_conc)
          annotation (Line(
            points={{-88,94},{-100,94},{-100,0},{-78,0},{-78,-1}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(flowMeasure.q_in, q_in) annotation (Line(
            points={{6,-84},{5,-84},{5,-85}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.KPool_mass, Perm1.u) annotation (Line(
            points={{-88,94},{-68,94},{-68,36.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));

        connect(KFluxToCellWithGlucose.soluteFlow, additionalInflow)
          annotation (Line(
            points={{-30.4,-41.6},{-60,-41.6},{-60,-54},{-102,-54}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(KCell.solutionVolume, CellH2O_Vol) annotation (Line(
          points={{8,60},{-22,60},{-22,62},{-50,62}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(KCell.solute, KCell_Mass) annotation (Line(
          points={{12,46},{12,28},{80,28}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(concentrationMeasure1.concentration, KCell_conc) annotation (Line(
          points={{-24,78},{-24,82},{54,82}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name"), Rectangle(
                extent={{-100,100},{100,-100}},
                lineColor={0,0,255},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid)}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Ikeda - Potassium glucose flow from ECF to ICF with insulin affects potassium flow to cells.</p>
</html>"));
      end CellsK_;

      model IntracellularPotassium
        extends Physiolibrary.Icons.Cell;

      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-86,58},{-74,70}}), iconTransformation(
              extent={{60,60},{100,100}})));
        CellsK_ liverCells(stateName="liver_CellK_Mass", initialSoluteMass=
              3769.74*0.0285)
          annotation (Placement(transformation(extent={{-40,40},{-20,60}})));
        CellsK_ skeletalMuscleCells(initialSoluteMass=3769.74*0.664, stateName=
              "muscle_CellK_Mass")
          annotation (Placement(transformation(extent={{62,26},{82,46}})));
        CellsK_ otherCells(initialSoluteMass=3769.74*0.3075, stateName=
              "other_CellK_Mass")
          annotation (Placement(transformation(extent={{78,-16},{98,4}})));
      Physiolibrary.Types.Constants.ElectricCurrentConst
        electrolytesFlowConstant1(k=0)
        annotation (Placement(transformation(extent={{50,-30},{60,-20}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure annotation (
          Placement(transformation(
            extent={{-8,8},{8,-8}},
            rotation=90,
            origin={-52,-78})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-62,-96},{-44,-78}}),
            iconTransformation(extent={{-10,-10},{10,10}})));
        Modelica.Blocks.Math.Add add
          annotation (Placement(transformation(extent={{4,-28},{24,-8}})));
        Modelica.Blocks.Math.Add add1
          annotation (Placement(transformation(extent={{-38,2},{-18,22}})));
        Modelica.Blocks.Math.Feedback feedback
          annotation (Placement(transformation(extent={{48,-12},{68,8}})));
        Modelica.Blocks.Math.Add add2
          annotation (Placement(transformation(extent={{22,18},{42,38}})));
        Modelica.Blocks.Math.Add3 KCell_MASS
          annotation (Placement(transformation(extent={{-4,-74},{16,-54}})));
        Modelica.Blocks.Math.Division mean_KCell_conc
          annotation (Placement(transformation(extent={{56,-66},{76,-46}})));
      Modelica.Blocks.Math.Gain gain(k=1000, y(displayUnit="mEq/l"))
        annotation (Placement(transformation(extent={{86,-68},{96,-58}})));
      equation
        connect(busConnector.liver_GlucoseToCellStorageFlow, liverCells.additionalInflow)
          annotation (Line(
            points={{-80,64},{-80,44.6},{-38,44.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector, liverCells.busConnector) annotation (Line(
            points={{-80,64},{90,64},{90,58},{-22,58}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(busConnector.liver_CellH2OVol, liverCells.CellH2O_Vol)
          annotation (Line(
            points={{-80,64},{-80,53.8},{-38,53.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector, skeletalMuscleCells.busConnector) annotation (
            Line(
            points={{-80,64},{90,64},{90,44},{80,44}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(busConnector, otherCells.busConnector) annotation (Line(
            points={{-80,64},{90,64},{90,2},{96,2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytesFlowConstant1.y, otherCells.additionalInflow)
          annotation (Line(
            points={{61.25,-25},{72.25,-25},{72.25,-11.4},{80,-11.4}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(flowMeasure.molarFlowRate, busConnector.PotassiumToCells)
        annotation (Line(
          points={{-56.8,-78},{99,-78},{99,64},{-80,64}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(flowMeasure.q_in,q_in)  annotation (Line(
            points={{-52,-86},{-53,-86},{-53,-87}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure.q_out, liverCells.q_in) annotation (Line(
            points={{-52,-70},{-52,24},{-30,24},{-30,50}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flowMeasure.q_out, skeletalMuscleCells.q_in) annotation (Line(
            points={{-52,-70},{-52,24},{72,24},{72,36}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(otherCells.q_in, flowMeasure.q_out) annotation (Line(
            points={{88,-6},{-52,-6},{-52,-70}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(add1.y, skeletalMuscleCells.CellH2O_Vol) annotation (Line(
            points={{-17,12},{-12,12},{-12,39.8},{64,39.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.skeletalMuscle_CellH2OVol, add1.u1) annotation (Line(
            points={{-80,64},{-80,18},{-40,18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.respiratoryMuscle_CellH2OVol, add1.u2) annotation (Line(
            points={{-80,64},{-80,6},{-40,6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.liver_CellH2OVol, add.u1) annotation (Line(
            points={{-80,64},{-80,-2},{2,-2},{2,-12}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(add1.y, add.u2) annotation (Line(
            points={{-17,12},{-10,12},{-10,-24},{2,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(add.y, feedback.u2) annotation (Line(
            points={{25,-18},{26,-18},{26,-12},{58,-12},{58,-10}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.CellH2O_Vol, feedback.u1) annotation (Line(
            points={{-80,64},{-80,-2},{50,-2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(feedback.y, otherCells.CellH2O_Vol) annotation (Line(
            points={{67,-2},{75.5,-2},{75.5,-2.2},{80,-2.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(add2.y, skeletalMuscleCells.additionalInflow) annotation (Line(
            points={{43,28},{54,28},{54,30.6},{64,30.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.skeletalMuscle_GlucoseToCellStorageFlow, add2.u1)
          annotation (Line(
            points={{-80,64},{-6,64},{-6,34},{20,34}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.respiratoryMuscle_GlucoseToCellStorageFlow, add2.u2)
          annotation (Line(
            points={{-80,64},{-6,64},{-6,22},{20,22}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(liverCells.KCell_Mass, KCell_MASS.u1) annotation (Line(
            points={{-22,52.8},{-14,52.8},{-14,-56},{-6,-56}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(skeletalMuscleCells.KCell_Mass, KCell_MASS.u2) annotation (Line(
            points={{80,38.8},{-48,38.8},{-48,-64},{-6,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(otherCells.KCell_Mass, KCell_MASS.u3) annotation (Line(
            points={{96,-3.2},{46,-3.2},{46,-72},{-6,-72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(KCell_MASS.y, busConnector.KCell_Mass) annotation (Line(
            points={{17,-64},{30,-64},{30,78},{-80,78},{-80,64}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(KCell_MASS.y, mean_KCell_conc.u1) annotation (Line(
            points={{17,-64},{36,-64},{36,-50},{54,-50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.CellH2O_Vol, mean_KCell_conc.u2) annotation (Line(
            points={{-80,64},{-78,64},{-78,-70},{54,-70},{54,-62}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(mean_KCell_conc.y, gain.u) annotation (Line(
          points={{77,-56},{82,-56},{82,-63},{85,-63}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain.y, busConnector.KCell_conc_per_liter) annotation (Line(
          points={{96.5,-63},{106,-63},{106,64},{-80,64}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      end IntracellularPotassium;

      model IntracellularPotassium_const
        extends Physiolibrary.Icons.Cell;

      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-86,58},{-74,70}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        electrolytesFlowConstant1(k=0)
        annotation (Placement(transformation(extent={{-66,-46},{-56,-36}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-62,-96},{-44,-78}}),
            iconTransformation(extent={{-10,-10},{10,10}})));
      Physiolibrary.Types.Constants.ConcentrationConst
        electrolytesFlowConstant2(k=(142))
        annotation (Placement(transformation(extent={{10,-78},{28,-60}})));
      Physiolibrary.Types.Constants.AmountOfSubstanceConst
        electrolytesFlowConstant3(k(displayUnit="mol") = 4)
        annotation (Placement(transformation(extent={{-68,-22},{-50,-4}})));
        Modelica.Blocks.Math.Division division
          annotation (Placement(transformation(extent={{10,-54},{30,-34}})));
      equation
        q_in.q=0;
        connect(electrolytesFlowConstant1.y, busConnector.PotassiumToCells)
          annotation (Line(
            points={{-54.75,-41},{-22,-41},{-22,64},{-80,64}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(electrolytesFlowConstant3.y, busConnector.KCell_Mass) annotation (
            Line(
            points={{-47.75,-13},{32,-13},{32,64},{-80,64}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(busConnector.ICFV_Vol, division.u2) annotation (Line(
            points={{-80,64},{-36,64},{-36,-50},{8,-50}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(electrolytesFlowConstant3.y, division.u1) annotation (Line(
            points={{-47.75,-13},{-47.75,-14.5},{8,-14.5},{8,-38}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(division.y, busConnector.KCell_conc) annotation (Line(
          points={{31,-44},{92,-44},{92,64},{-80,64}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      end IntracellularPotassium_const;
    end Potassium;

    package Chloride "Body Chloride Distribution"

      package test
        model T_
        import QHP = Physiomodel;
        QHP.Electrolytes.Chloride.setup.Chloride chloride2_1
          annotation (Placement(transformation(extent={{-58,8},{-38,28}})));
        QHP.Electrolytes.old.setup.ElectrolytesConstInputs2FromFile
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{-10,12},{10,32}})));
          QHP.Electrolytes.Chloride.setup.ConstInputsFromOtherElectrolytes
            constInputsFromOtherElectrolytes
            annotation (Placement(transformation(extent={{-12,-10},{8,10}})));
        equation
          connect(chloride2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-39.9,26.1},{-20.95,26.1},{-20.95,22},{-2,22}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(chloride2_1.busConnector, constInputsFromOtherElectrolytes.busConnector)
            annotation (Line(
              points={{-39.9,26.1},{-20,26.1},{-20,0},{-4,0}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T_;

        model T
        import QHP = Physiomodel;
        Physiomodel.Electrolytes.Chloride.setup.Chloride chloride2_1
          annotation (Placement(transformation(extent={{-58,8},{-38,28}})));
        QHP.Electrolytes.old.setup.ElectrolytesConstInputs
          electrolytesConstInputs
          annotation (Placement(transformation(extent={{-10,12},{10,32}})));
          QHP.Electrolytes.Chloride.setup.ConstInputsFromOtherElectrolytes
            constInputsFromOtherElectrolytes
            annotation (Placement(transformation(extent={{-12,-10},{8,10}})));
        equation
          connect(chloride2_1.busConnector, electrolytesConstInputs.busConnector)
            annotation (Line(
              points={{-39.9,26.1},{-20.95,26.1},{-20.95,22},{-2,22}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(chloride2_1.busConnector, constInputsFromOtherElectrolytes.busConnector)
            annotation (Line(
              points={{-39.9,26.1},{-20,26.1},{-20,0},{-4,0}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T;

        model Chloride
        Physiolibrary.Chemical.Components.Substance ClPool(useNormalizedVolume=
              false, solute_start=(1610)/1000)
          annotation (Placement(transformation(extent={{-78,14},{-58,34}})));
          Modelica.Blocks.Interfaces.RealInput ECFV_Vol(final quantity="Volume",
              final displayUnit="ml")
            annotation (Placement(transformation(extent={{-90,28},{-82,36}}),
                iconTransformation(extent={{-100,64},{-88,76}})));
        Physiolibrary.Chemical.Components.Substance GILumen(useNormalizedVolume=
             false, solute_start=(90)/1000)
          annotation (Placement(transformation(extent={{-82,-36},{-62,-16}})));
          Modelica.Blocks.Interfaces.RealInput GILumenVolume_Mass(final
              quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{-98,-22},{-90,-14}}),
                iconTransformation(extent={{-100,52},{-88,64}})));
        Physiolibrary.Chemical.Components.SolutePump Absorbtion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-58,-20},{-46,-32}})));
          Modelica.Blocks.Math.Gain Perm(k=0.0015)
            annotation (Placement(transformation(extent={{-64,-48},{-58,-42}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-44,-86},{-24,-66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-44,-100},{-24,-80}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut SweatDuct(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-44,-72},{-24,-52}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-64,-80},{-44,-60}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-64,-94},{-44,-74}})));
        Physiolibrary.Chemical.Components.Substance Bladder(
          STEADY=false,
          useNormalizedVolume=false,
          solute_start=(0)/1000)
          annotation (Placement(transformation(extent={{50,14},{70,34}})));
          Modelica.Blocks.Interfaces.RealInput BladderVolume_Mass(final
              quantity=
                "Volume", final displayUnit="ml")
            annotation (Placement(transformation(extent={{36,28},{44,36}}),
                iconTransformation(extent={{-100,40},{-88,52}})));
          Modelica.Blocks.Interfaces.RealInput IVDrip_ClRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-68,-68},{-60,-60}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-40,98})));
          Modelica.Blocks.Interfaces.RealInput Transfusion_ClRate(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-68,-84},{-60,-76}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-28,98})));
          Modelica.Blocks.Interfaces.RealInput SweatDuct_ClRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-22,-60},{-28,-54}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-16,98})));
          Modelica.Blocks.Interfaces.RealInput Hemorrhage_ClRate(final quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-22,-74},{-28,-68}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={-4,98})));
          Modelica.Blocks.Interfaces.RealInput DialyzerActivity_Cl_Flux(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-22,-88},{-28,-82}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={8,98})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-100,-42},{-80,-22}})));
          Modelica.Blocks.Interfaces.RealInput DietIntakeElectrolytes_Cl(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{-100,-30},{-92,-22}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={20,98})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
            useSoluteFlowInput=true) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={-90,-44})));
          Modelica.Blocks.Interfaces.RealInput GILumenVomitus_ClLoss(final
              quantity="VolumeFlowRate", final displayUnit="mEq/min")
            annotation (Placement(transformation(extent={{3,-3},{-3,3}},
                rotation=180,
                origin={-93,-51}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                rotation=270,
                origin={32,98})));
        Physiolibrary.Chemical.Components.SolutePump CD_Cl(useSoluteFlowInput=
              true)                                        annotation (
            Placement(transformation(
              extent={{-6,-6},{6,6}},
              origin={26,24})));
          Modelica.Blocks.Interfaces.RealInput CollectingDuct_NetSumCats(final
              quantity="Mass", final displayUnit="mEq")
            annotation (Placement(transformation(extent={{16,52},{24,60}}),
                iconTransformation(extent={{-100,28},{-88,40}})));
          Modelica.Blocks.Interfaces.RealInput BloodPh_ArtysPh
            annotation (Placement(transformation(extent={{2,42},{10,50}}),
                iconTransformation(extent={{-100,88},{-88,100}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 KEffect1( data=
                {{7.00,1.00,0},{7.45,0.93,-0.5},{7.80,0.00,0}})
            annotation (Placement(transformation(extent={{16,36},{36,56}})));
          Modelica.Blocks.Interfaces.RealOutput ClPool_mass
                                          annotation (Placement(transformation(extent={{-60,4},
                    {-52,12}}),        iconTransformation(extent={{100,80},{120,
                    100}})));
          Modelica.Blocks.Interfaces.RealOutput ClPool_conc_per_liter
                                          annotation (Placement(transformation(extent={{-40,36},
                    {-32,44}}),        iconTransformation(extent={{100,60},{120,
                    80}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure
          concentrationMeasure annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={-56,40})));
          Modelica.Blocks.Math.Gain gain(k=1000)
            annotation (Placement(transformation(extent={{-46,38},{-42,42}})));
        Physiolibrary.Chemical.Components.Clearance bladderVoid(
            useSolutionFlowInput=true)
          annotation (Placement(transformation(extent={{58,-14},{70,-2}})));
          Modelica.Blocks.Interfaces.RealInput BladderVoidFlow(
                                                        final quantity="VolumeFlowRate",
              final displayUnit="ml/min")
            annotation (Placement(transformation(extent={{50,-2},{58,6}}),
                iconTransformation(
                extent={{-6,-6},{6,6}},
                origin={-94,-106})));
        equation
        connect(ClPool.solutionVolume, ECFV_Vol) annotation (Line(
            points={{-76,30},{-81,30},{-81,32},{-86,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GILumen.solutionVolume, GILumenVolume_Mass) annotation (Line(
            points={{-80,-20},{-87,-20},{-87,-18},{-94,-18}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
              points={{-72,-26},{-65,-26},{-65,-26},{-58,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Absorbtion.q_out, ClPool.q_out) annotation (Line(
              points={{-46,-26},{-44,-26},{-44,24},{-68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Hemorrhage.q_in, ClPool.q_out) annotation (Line(
              points={{-40,-76},{-44,-76},{-44,24},{-68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, ClPool.q_out) annotation (Line(
              points={{-40,-90},{-44,-90},{-44,24},{-68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(ClPool.q_out, SweatDuct.q_in) annotation (Line(
              points={{-68,24},{-44,24},{-44,-62},{-40,-62}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, ClPool.q_out) annotation (Line(
              points={{-48,-84},{-44,-84},{-44,24},{-68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, ClPool.q_out) annotation (Line(
              points={{-48,-70},{-44,-70},{-44,24},{-68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Bladder.solutionVolume, BladderVolume_Mass) annotation (Line(
            points={{52,30},{46,30},{46,32},{40,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(IVDrip.soluteFlow, IVDrip_ClRate) annotation (Line(
            points={{-54,-66},{-54,-64},{-64,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Transfusion.soluteFlow, Transfusion_ClRate) annotation (Line(
            points={{-54,-80},{-64,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SweatDuct.soluteFlow, SweatDuct_ClRate) annotation (Line(
            points={{-34,-58},{-34,-57},{-25,-57}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Hemorrhage_ClRate, Hemorrhage.soluteFlow) annotation (Line(
            points={{-25,-71},{-33.5,-71},{-33.5,-72},{-34,-72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(DialyzerActivity.soluteFlow, DialyzerActivity_Cl_Flux)
          annotation (Line(
            points={{-34,-86},{-34,-85},{-25,-85}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Diet.soluteFlow, DietIntakeElectrolytes_Cl) annotation (Line(
            points={{-90,-28},{-90,-26},{-96,-26}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(Diet.q_out, GILumen.q_out) annotation (Line(
              points={{-84,-32},{-80,-32},{-80,-26},{-72,-26}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(Diarrhea.soluteFlow, GILumenVomitus_ClLoss) annotation (Line(
            points={{-90,-48},{-90,-51},{-93,-51}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
              points={{-72,-26},{-80,-26},{-80,-44},{-84,-44}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
              points={{-57.7,-45},{-52,-45},{-52,-29.6}},
              color={0,0,127},
              smooth=Smooth.None));
        connect(Perm.u, GILumen.solute) annotation (Line(
            points={{-64.6,-45},{-72,-45},{-72,-33.8}},
            color={0,0,127},
            smooth=Smooth.None));

          connect(KEffect1.u, BloodPh_ArtysPh) annotation (Line(
              points={{16.2,46},{6,46}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(CollectingDuct_NetSumCats, KEffect1.yBase) annotation (Line(
              points={{20,56},{26,56},{26,48}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(CD_Cl.soluteFlow, KEffect1.y) annotation (Line(
              points={{26,27.6},{26,44}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(CD_Cl.q_out, Bladder.q_out) annotation (Line(
              points={{32,24},{60,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(CD_Cl.q_in, ClPool.q_out) annotation (Line(
              points={{20,24},{-24,24},{-24,24},{-68,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(ClPool.solute, ClPool_mass) annotation (Line(
            points={{-68,16.2},{-68,8},{-56,8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure.concentration, gain.u) annotation (Line(
            points={{-52,40},{-46.4,40}},
            color={0,0,127},
            smooth=Smooth.None));
          connect(gain.y, ClPool_conc_per_liter) annotation (Line(
              points={{-41.8,40},{-36,40}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ClPool.q_out, concentrationMeasure.q_in) annotation (Line(
              points={{-68,24},{-62,24},{-62,40},{-56,40}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
              points={{60,24},{42,24},{42,-8},{58,-8}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
        connect(bladderVoid.solutionFlow, BladderVoidFlow) annotation (Line(
            points={{64,-4.4},{64,2},{54,2}},
            color={0,0,127},
            smooth=Smooth.None));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={Bitmap(extent={{-100,100},{100,-100}}, fileName=
                      "../Physiolibrary/icons/Cl.jpg")}));
        end Chloride;
      end test;

      package setup
        model ConstInputsFromOtherElectrolytes

        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{44,58},{64,78}}), iconTransformation(
                extent={{-40,-20},{0,20}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          CollectingDuct_NetSumCats(k=0.138798773009742)
          annotation (Placement(transformation(extent={{-20,42},{-14,48}})));
        equation

          connect(CollectingDuct_NetSumCats.y, busConnector.CollectingDuct_NetSumCats) annotation (Line(
         points={{-13.7,45},{54,45},{54,68}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end ConstInputsFromOtherElectrolytes;

        model Chloride
        import Physiomodel;
          extends Physiolibrary.Icons.Chloride;
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-6,-86},{14,-66}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-6,-100},{14,-80}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-26,-80},{-6,-60}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
            useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{-26,-94},{-6,-74}})));
        Physiolibrary.Types.BusConnector busConnector annotation (Placement(
              transformation(extent={{-92,-4},{-80,8}}), iconTransformation(
                extent={{62,62},{100,100}})));

        Real ECF_conc;
          SweatGlandSalt sweatGlandSalt
            annotation (Placement(transformation(extent={{-34,76},{-18,92}})));
          GILumenCl gILumenCl
            annotation (Placement(transformation(extent={{-58,-38},{-38,-18}})));
          Physiomodel.Electrolytes.Bladder bladder(stateVarName="BladderChloride.Mass")
            annotation (Placement(transformation(extent={{54,-20},{74,0}})));
          Physiomodel.Electrolytes.Chloride.KidneyCl kidneyCl
            annotation (Placement(transformation(extent={{22,6},{42,26}})));
        Physiomodel.Electrolytes.Chloride.setup.ChloridePool ClPool(
            ClPool_conc_per_liter(start=1515.2456531712))
          annotation (Placement(transformation(extent={{-68,14},{-48,34}})));
        equation
           ECF_conc = ClPool.ClPool_conc_per_liter;
          connect(Hemorrhage.q_in, ClPool.q_out) annotation (Line(
              points={{-6,-76},{-6,-76},{-6,24},{-58,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(DialyzerActivity.q_in, ClPool.q_out) annotation (Line(
              points={{-6,-90},{-6,-90},{-6,24},{-58,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(Transfusion.q_out, ClPool.q_out) annotation (Line(
              points={{-6,-84},{-6,-84},{-6,24},{-58,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
          connect(IVDrip.q_out, ClPool.q_out) annotation (Line(
              points={{-6,-70},{-6,-70},{-6,24},{-58,24}},
              color={200,0,0},
              smooth=Smooth.None,
              thickness=1));
        connect(IVDrip.soluteFlow, busConnector.IVDrip_ClRate) annotation (Line(
            points={{-12,-66},{-12,2},{-86,2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(Transfusion.soluteFlow, busConnector.Transfusion_ClRate)
          annotation (Line(
            points={{-12,-80},{-38,-80},{-38,2},{-86,2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));
        connect(busConnector.Hemorrhage_ClRate, Hemorrhage.soluteFlow)
          annotation (Line(
            points={{-86,2},{4.5,2},{4.5,-72},{8,-72}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-3,1},{-3,1}}));
        connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_Cl_Flux)
          annotation (Line(
            points={{8,-86},{8,2},{-86,2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{3,1},{3,1}}));

          connect(ClPool.q_out, sweatGlandSalt.salt) annotation (Line(
              points={{-58,24},{-62,24},{-62,79.2},{-34,79.2}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(busConnector, gILumenCl.busConnector) annotation (Line(
              points={{-86,2},{-40,2},{-40,-19.9},{-39.9,-19.9}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(gILumenCl.q_out, ClPool.q_out) annotation (Line(
              points={{-48,-28},{-48,24},{-58,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(bladder.busConnector, busConnector) annotation (Line(
              points={{72,-2},{72,2},{-86,2}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(sweatGlandSalt.busConnector, busConnector) annotation (Line(
              points={{-19.6,90.4},{-94,90.4},{-94,2},{-86,2}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(kidneyCl.busConnector, busConnector) annotation (Line(
              points={{40.1,24.1},{40.1,2},{-86,2}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(bladder.q_in, kidneyCl.q_out) annotation (Line(
              points={{64,-2},{64,8},{34,8}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(kidneyCl.q_in, ClPool.q_out) annotation (Line(
              points={{34,16},{34,24},{-58,24}},
              color={200,0,0},
              thickness=1,
              smooth=Smooth.None));
          connect(busConnector.ECFV_Vol, ClPool.EFCV_Vol) annotation (Line(
              points={{-86,2},{-86,32},{-66,32}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.BloodIons_StrongAnionsLessCl, ClPool.StrongAnionsLessCl)
            annotation (Line(
              points={{-86,2},{-86,28},{-66,28}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.BloodIons_Cations, ClPool.Cations) annotation (Line(
              points={{-86,2},{-86,24},{-66,24}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.BloodIons_ProteinAnions, ClPool.NBB) annotation (Line(
              points={{-86,2},{-86,20},{-66,20}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.CO2Veins_cHCO3, ClPool.HCO3) annotation (Line(
              points={{-86,2},{-86,16},{-66,16}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(ClPool.ClPool_conc_per_liter, busConnector.ClPool_conc_per_liter)
            annotation (Line(
              points={{-50,32},{-42,32},{-42,2},{-86,2}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(ClPool.ClPool_mass, busConnector.ClPool_mass) annotation (Line(
              points={{-50,28},{-42,28},{-42,2},{-86,2}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={             Text(
                  extent={{-112,-102},{108,-128}},
                  lineColor={0,0,255},
                  textString="%name")}),
            Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end Chloride;

        model ChloridePool
        import Physiomodel;
         extends Physiolibrary.Icons.Chloride;

        Real ECF_conc(displayUnit="mEq/l");
          Modelica.Blocks.Interfaces.RealInput EFCV_Vol(displayUnit="ml")
            annotation (Placement(transformation(extent={{-100,60},{-60,100}})));
          Modelica.Blocks.Interfaces.RealOutput ClPool_conc_per_liter(displayUnit="mEq/l")
            annotation (Placement(transformation(extent={{60,60},{100,100}})));
          Modelica.Blocks.Interfaces.RealOutput ClPool_mass(displayUnit="mEq")
            annotation (Placement(transformation(extent={{60,20},{100,60}})));
          Modelica.Blocks.Interfaces.RealInput NBB(displayUnit="mEq/l")
          "non-bicarbonate bases concentration"
            annotation (Placement(transformation(extent={{-100,-60},{-60,-20}})));
          Modelica.Blocks.Interfaces.RealInput StrongAnionsLessCl(displayUnit="mEq/l")
          "all extracellular strong ions concentration"
            annotation (Placement(transformation(extent={{-100,20},{-60,60}})));
          Modelica.Blocks.Interfaces.RealInput Cations(displayUnit="mEq/l")
          "all extracellular cations concentration"
            annotation (Placement(transformation(extent={{-100,-20},{-60,20}})));
        Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_out annotation (
            Placement(transformation(extent={{-34,26},{-16,44}}),
              iconTransformation(extent={{-10,-10},{10,10}})));
          Modelica.Blocks.Interfaces.RealInput HCO3(displayUnit="mEq/l")
          "bicarbonate concentration"
            annotation (Placement(transformation(extent={{-100,-100},{-60,-60}})));
        equation

          ClPool_conc_per_liter = Cations - (NBB+HCO3+StrongAnionsLessCl);

          ECF_conc = ClPool_conc_per_liter;
          q_out.conc =  ECF_conc/1000.;

          ClPool_mass=ClPool_conc_per_liter*EFCV_Vol/1000.;
          annotation ( Icon(coordinateSystem(
                  preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
                graphics={             Text(
                  extent={{-112,-102},{108,-128}},
                  lineColor={0,0,255},
                  textString="%name")}),
            Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
        end ChloridePool;
      end setup;

      model GILumenCl
       extends Physiolibrary.Icons.GILumen;
      Physiolibrary.Chemical.Components.Substance GILumen(
        stateName="GILumenChloride.Mass",
        useNormalizedVolume=false,
        solute_start=(90)/1000)
        annotation (Placement(transformation(extent={{-44,-36},{-24,-16}})));
      Physiolibrary.Chemical.Components.SolutePump Absorbtion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-20,-20},{-8,-32}})));
        Modelica.Blocks.Math.Gain Perm(k=0.0015/60)
          annotation (Placement(transformation(extent={{-26,-48},{-20,-42}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-82,-46},{-62,-26}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Diarrhea(
          useSoluteFlowInput=true) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={-52,-44})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-92,-4},{-80,8}}), iconTransformation(
              extent={{62,62},{100,100}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst        Constant7(k(
            displayUnit="mmol/day") = 2.3148148148148e-06)
        annotation (Placement(transformation(extent={{-82,-22},{-74,-14}})));
      Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,1.0,
            -0.04},{50,0.0,0}}, Xscale=1e-6/Substances.Leptin.mw)
        annotation (Placement(transformation(extent={{-82,-38},{-62,-18}})));

      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out
        "sodium mass outflow to urine from collecting ducts" annotation (
          Placement(transformation(extent={{14,-28},{30,-14}}),
            iconTransformation(extent={{-10,-10},{10,10}})));
      equation

      connect(GILumen.solutionVolume, busConnector.GILumenVolume_Mass)
        annotation (Line(
          points={{-38,-22},{-49,-22},{-49,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(GILumen.q_out, Absorbtion.q_in) annotation (Line(
            points={{-34,-26},{-20,-26}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Diet.q_out, GILumen.q_out) annotation (Line(
            points={{-62,-36},{-42,-36},{-42,-26},{-34,-26}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(Diarrhea.soluteFlow, busConnector.GILumenVomitus_ClLoss)
        annotation (Line(
          points={{-56,-48},{-56,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(GILumen.q_out, Diarrhea.q_in) annotation (Line(
            points={{-34,-26},{-42,-26},{-42,-44},{-42,-44}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Perm.y, Absorbtion.soluteFlow) annotation (Line(
            points={{-19.7,-45},{-11.6,-45},{-11.6,-28.4}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(Perm.u, GILumen.solute) annotation (Line(
          points={{-26.6,-45},{-28,-45},{-28,-36}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
            points={{-86,2},{-90,2},{-90,-28},{-80,-28}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
            points={{-73,-18},{-72,-18},{-72,-26}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
          points={{-72,-32},{-68,-32}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(Absorbtion.q_out, q_out) annotation (Line(
            points={{-8,-26},{8,-26},{8,-21},{22,-21}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end GILumenCl;

      model KidneyCl
      import Physiomodel;
       extends Physiolibrary.Icons.Kidney;
      Physiolibrary.Blocks.Factors.Spline PhEffect(data={{7.00,1.00,0},{7.42,
            0.93,-0.5},{7.80,0.00,0}})
        "marek: normal pH corrected from 7.45 to 7.42"
        annotation (Placement(transformation(extent={{16,42},{36,62}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-92,-4},{-80,8}}), iconTransformation(
              extent={{62,62},{100,100}})));
      Physiolibrary.Chemical.Components.SolutePump CD_Outflow(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{10,22},{22,10}})));
        Modelica.Blocks.Math.Sum CD_Cations_Outflow(nin=3)
          annotation (Placement(transformation(extent={{42,-38},{52,-28}})));
        Modelica.Blocks.Math.Sum CD_AnionsLessCl_Outflow(nin=3)
          annotation (Placement(transformation(extent={{42,-52},{52,-42}})));
        Modelica.Blocks.Math.Feedback CD_Cl_Outflow
          annotation (Placement(transformation(extent={{60,-42},{78,-24}})));

      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-44,8},{-26,26}}),
            iconTransformation(extent={{10,-10},{30,10}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out
        "sodium mass outflow to urine from collecting ducts" annotation (
          Placement(transformation(extent={{50,10},{66,24}}),
            iconTransformation(extent={{10,-90},{30,-70}})));
        Modelica.Blocks.Math.Sum CD_AnionsLessCl_Outflow1(
                                                         nin=3)
          annotation (Placement(transformation(extent={{42,-74},{52,-64}})));
      Modelica.Blocks.Math.Gain gain(k=1/Modelica.Constants.F)
        annotation (Placement(transformation(extent={{-40,66},{-20,86}})));
      Physiolibrary.Blocks.Factors.Spline ChloridePoolEffect(data={{0.00,0.0,0},
            {50,1.0,0.0}})
        "electroneutrality does not allow to extract cation without anion"
        annotation (Placement(transformation(extent={{16,30},{36,50}})));
      equation

        connect(busConnector.Artys_pH,PhEffect. u) annotation (Line(
            points={{-86,2},{-90,2},{-90,52},{18,52}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CD_Na_Outflow, CD_Cations_Outflow.u[1]) annotation (Line(
            points={{-86,2},{10,2},{10,-32},{40,-32},{40,-33.6667},{41,-33.6667}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CD_NH4_Outflow, CD_Cations_Outflow.u[2]) annotation (
            Line(
            points={{-86,2},{10,2},{10,-38},{41,-38},{41,-33}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,0},{-6,0}}));
        connect(busConnector.CD_K_Outflow, CD_Cations_Outflow.u[3]) annotation (Line(
            points={{-86,2},{10,2},{10,-34},{40,-34},{40,-32.3333},{41,-32.3333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,-3},{-6,-3}}));
        connect(busConnector.CD_PO4_mEq_Outflow, CD_AnionsLessCl_Outflow.u[1])
          annotation (Line(
            points={{-86,2},{10,2},{10,-46},{40,-46},{40,-47.6667},{41,-47.6667}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CD_SO4_Outflow, CD_AnionsLessCl_Outflow.u[2])
          annotation (Line(
            points={{-86,2},{10,2},{10,-48},{40,-48},{41,-47}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,0},{-6,0}}));
        connect(busConnector.CD_KA_Outflow, CD_AnionsLessCl_Outflow.u[3]) annotation (
           Line(
            points={{-86,2},{10,2},{10,-52},{40,-52},{40,-46.3333},{41,-46.3333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,-3},{-6,-3}}));
        connect(CD_Cations_Outflow.y, CD_Cl_Outflow.u1) annotation (Line(
            points={{52.5,-33},{52,-34},{52,-33},{61.8,-33}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(q_in, CD_Outflow.q_in) annotation (Line(
            points={{-35,17},{-12.5,17},{-12.5,16},{10,16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(CD_Outflow.q_out, q_out) annotation (Line(
            points={{22,16},{40,16},{50,18},{58,17}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.CD_SO4_Outflow, CD_AnionsLessCl_Outflow1.u[2])
          annotation (Line(
            points={{-86,2},{10,2},{10,-70},{40,-70},{41,-69}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,0},{-6,0}}));
        connect(busConnector.CD_KA_Outflow, CD_AnionsLessCl_Outflow1.u[3])
                                                                          annotation (
           Line(
            points={{-86,2},{10,2},{10,-74},{40,-74},{40,-68.3333},{41,-68.3333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,-3},{-6,-3}}));
        connect(busConnector.CD_PO4_Outflow, CD_AnionsLessCl_Outflow1.u[1])
          annotation (Line(
            points={{-86,2},{10,2},{10,-66},{41,-66},{41,-69.6667}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(CD_AnionsLessCl_Outflow.y, CD_Cl_Outflow.u2) annotation (Line(
            points={{52.5,-47},{69,-40.2}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(busConnector.CollectingDuct_NetSumCats, gain.u) annotation (Line(
          points={{-86,2},{-84,2},{-84,76},{-42,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(gain.y, PhEffect.yBase) annotation (Line(
          points={{-19,76},{26,76},{26,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ClPool, ChloridePoolEffect.u) annotation (Line(
          points={{-86,2},{-86,40},{18,40}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(PhEffect.y, ChloridePoolEffect.yBase) annotation (Line(
          points={{26,48},{26,42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.CD_Cl_Outflow, ChloridePoolEffect.y) annotation (
          Line(
          points={{-86,2},{-86,32},{26,32},{26,36}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(CD_Outflow.soluteFlow, ChloridePoolEffect.y) annotation (Line(
          points={{18.4,13.6},{18.4,6},{26,6},{26,36}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Chloride extracellular body concentration should play a role in chloride excretion by kidney?</p>
<p>In this implementation is chloride outflow driven only by electroneutrality.</p>
<p>That means - there is hard to calculate steady state for chloride concentration !!</p>
<p>Chloride concentration sholud be calculate also from internal electroneutrality, better than integrated value from inflow and outflow.</p>
</html>"));
      end KidneyCl;

      model Chloride2
      import Physiomodel;
       extends Physiolibrary.Icons.Chloride;
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut Hemorrhage(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-6,-86},{14,-66}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut DialyzerActivity(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-6,-100},{14,-80}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump IVDrip(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-26,-80},{-6,-60}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Transfusion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-26,-94},{-6,-74}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-92,-4},{-80,8}}), iconTransformation(
              extent={{62,62},{100,100}})));

      Physiolibrary.Types.Concentration ECF_conc;
        SweatGlandSalt sweatGlandSalt
          annotation (Placement(transformation(extent={{-34,76},{-18,92}})));
        GILumenCl gILumenCl
          annotation (Placement(transformation(extent={{-58,-38},{-38,-18}})));
        Physiomodel.Electrolytes.Bladder bladder(stateVarName="BladderChloride.Mass")
          annotation (Placement(transformation(extent={{54,-20},{74,0}})));
        Physiomodel.Electrolytes.Chloride.KidneyCl kidneyCl
          annotation (Placement(transformation(extent={{22,6},{42,26}})));
      Physiolibrary.Chemical.Components.Substance ClPool(
        stateName="ClPool.Mass",
        useNormalizedVolume=false,
        solute_start=(1515.2456531712)/1000)
        annotation (Placement(transformation(extent={{8,46},{28,66}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1 annotation (Placement(
              transformation(
              extent={{-10,-10},{10,10}},
              origin={10,72})));
      equation
         ECF_conc =concentrationMeasure1.concentration;
        connect(Hemorrhage.q_in, ClPool.q_out) annotation (Line(
            points={{-6,-76},{-6,-76},{-6,56},{18,56}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(DialyzerActivity.q_in, ClPool.q_out) annotation (Line(
            points={{-6,-90},{-6,-90},{-6,56},{18,56}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(Transfusion.q_out, ClPool.q_out) annotation (Line(
            points={{-6,-84},{-6,-84},{-6,56},{18,56}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(IVDrip.q_out, ClPool.q_out) annotation (Line(
            points={{-6,-70},{-6,-70},{-6,56},{18,56}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(IVDrip.soluteFlow, busConnector.IVDrip_ClRate) annotation (Line(
          points={{-12,-66},{-12,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
      connect(Transfusion.soluteFlow, busConnector.Transfusion_ClRate)
        annotation (Line(
          points={{-12,-80},{-38,-80},{-38,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
      connect(busConnector.Hemorrhage_ClRate, Hemorrhage.soluteFlow)
        annotation (Line(
          points={{-86,2},{4.5,2},{4.5,-72},{8,-72}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-3,1},{-3,1}}));
      connect(DialyzerActivity.soluteFlow, busConnector.DialyzerActivity_Cl_Flux)
        annotation (Line(
          points={{8,-86},{8,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

        connect(ClPool.q_out, sweatGlandSalt.salt) annotation (Line(
            points={{18,56},{-62,56},{-62,79.2},{-34,79.2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector, gILumenCl.busConnector) annotation (Line(
            points={{-86,2},{-40,2},{-40,-19.9},{-39.9,-19.9}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gILumenCl.q_out, ClPool.q_out) annotation (Line(
            points={{-48,-28},{-48,56},{18,56}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(bladder.busConnector, busConnector) annotation (Line(
            points={{72,-2},{72,2},{-86,2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(sweatGlandSalt.busConnector, busConnector) annotation (Line(
            points={{-19.6,90.4},{-94,90.4},{-94,2},{-86,2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(kidneyCl.busConnector, busConnector) annotation (Line(
            points={{40.1,24.1},{40.1,2},{-86,2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(bladder.q_in, kidneyCl.q_out) annotation (Line(
            points={{64,-2},{64,8},{34,8}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(kidneyCl.q_in, ClPool.q_out) annotation (Line(
            points={{34,16},{34,56},{18,56}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure1.concentration, busConnector.ClPool_conc_per_liter)
        annotation (Line(
          points={{10,76},{-16,76},{-16,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(ClPool.solute, busConnector.ClPool_mass) annotation (Line(
          points={{24,46},{-30,46},{-30,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.ECFV_Vol, ClPool.solutionVolume) annotation (Line(
          points={{-86,2},{-86,60},{14,60}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
        connect(ClPool.q_out, concentrationMeasure1.q_in) annotation (Line(
            points={{18,56},{16,56},{16,70},{10,70}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure1.concentration, busConnector.ClPool)
        annotation (Line(
          points={{10,76},{-16,76},{-16,2},{-86,2},{-86,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={             Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end Chloride2;

      model KidneyCl_old
      import Physiomodel;
       extends Physiolibrary.Icons.Kidney;
      Physiolibrary.Blocks.Factors.Spline PhEffect(data={{7.00,1.00,0},{7.45,
            0.93,-0.5},{7.80,0.00,0}})
        annotation (Placement(transformation(extent={{16,42},{36,62}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-92,-4},{-80,8}}), iconTransformation(
              extent={{62,62},{100,100}})));
      Physiolibrary.Chemical.Components.SolutePump CD_Outflow(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{10,22},{22,10}})));
        Modelica.Blocks.Math.Sum CD_Cations_Outflow(nin=3)
          annotation (Placement(transformation(extent={{42,-38},{52,-28}})));
        Modelica.Blocks.Math.Sum CD_AnionsLessCl_Outflow(nin=3)
          annotation (Placement(transformation(extent={{42,-52},{52,-42}})));
        Modelica.Blocks.Math.Feedback CD_Cl_Outflow
          annotation (Placement(transformation(extent={{60,-42},{78,-24}})));

      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in
        "sodium concentration in blood incomming to glomerulus capillaries; sodium mass flow is filtration - reabsorbtion"
        annotation (Placement(transformation(extent={{-44,8},{-26,26}}),
            iconTransformation(extent={{10,-10},{30,10}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out
        "sodium mass outflow to urine from collecting ducts" annotation (
          Placement(transformation(extent={{50,10},{66,24}}),
            iconTransformation(extent={{10,-90},{30,-70}})));
        Modelica.Blocks.Math.Sum CD_AnionsLessCl_Outflow1(
                                                         nin=3)
          annotation (Placement(transformation(extent={{42,-74},{52,-64}})));
      Modelica.Blocks.Math.Gain gain(k=1/Modelica.Constants.F)
        annotation (Placement(transformation(extent={{-40,66},{-20,86}})));
      Physiolibrary.Blocks.Factors.Spline ChloridePoolEffect(data={{0.00,0.0,0},
            {50,1.0,0.0}})
        "electroneutrality does not allow to extract cation without anion"
        annotation (Placement(transformation(extent={{16,30},{36,50}})));
      equation

        connect(busConnector.Artys_pH,PhEffect. u) annotation (Line(
            points={{-86,2},{-90,2},{-90,52},{18,52}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CD_Na_Outflow, CD_Cations_Outflow.u[1]) annotation (Line(
            points={{-86,2},{10,2},{10,-32},{40,-32},{40,-33.6667},{41,-33.6667}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CD_NH4_Outflow, CD_Cations_Outflow.u[2]) annotation (
            Line(
            points={{-86,2},{10,2},{10,-38},{41,-38},{41,-33}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,0},{-6,0}}));
        connect(busConnector.CD_K_Outflow, CD_Cations_Outflow.u[3]) annotation (Line(
            points={{-86,2},{10,2},{10,-34},{40,-34},{40,-32.3333},{41,-32.3333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,-3},{-6,-3}}));
        connect(busConnector.CD_PO4_mEq_Outflow, CD_AnionsLessCl_Outflow.u[1])
          annotation (Line(
            points={{-86,2},{10,2},{10,-46},{40,-46},{40,-47.6667},{41,-47.6667}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.CD_SO4_Outflow, CD_AnionsLessCl_Outflow.u[2])
          annotation (Line(
            points={{-86,2},{10,2},{10,-48},{40,-48},{41,-47}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,0},{-6,0}}));
        connect(busConnector.CD_KA_Outflow, CD_AnionsLessCl_Outflow.u[3]) annotation (
           Line(
            points={{-86,2},{10,2},{10,-52},{40,-52},{40,-46.3333},{41,-46.3333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,-3},{-6,-3}}));
        connect(CD_Cations_Outflow.y, CD_Cl_Outflow.u1) annotation (Line(
            points={{52.5,-33},{52,-34},{52,-33},{61.8,-33}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(q_in, CD_Outflow.q_in) annotation (Line(
            points={{-35,17},{-12.5,17},{-12.5,16},{10,16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(CD_Outflow.q_out, q_out) annotation (Line(
            points={{22,16},{40,16},{50,18},{58,17}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.CD_SO4_Outflow, CD_AnionsLessCl_Outflow1.u[2])
          annotation (Line(
            points={{-86,2},{10,2},{10,-70},{40,-70},{41,-69}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,0},{-6,0}}));
        connect(busConnector.CD_KA_Outflow, CD_AnionsLessCl_Outflow1.u[3])
                                                                          annotation (
           Line(
            points={{-86,2},{10,2},{10,-74},{40,-74},{40,-68.3333},{41,-68.3333}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,-3},{-6,-3}}));
        connect(busConnector.CD_PO4_Outflow, CD_AnionsLessCl_Outflow1.u[1])
          annotation (Line(
            points={{-86,2},{10,2},{10,-66},{41,-66},{41,-69.6667}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(CD_AnionsLessCl_Outflow.y, CD_Cl_Outflow.u2) annotation (Line(
            points={{52.5,-47},{69,-40.2}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(busConnector.CollectingDuct_NetSumCats, gain.u) annotation (Line(
          points={{-86,2},{-84,2},{-84,76},{-42,76}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(gain.y, PhEffect.yBase) annotation (Line(
          points={{-19,76},{26,76},{26,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ClPool, ChloridePoolEffect.u) annotation (Line(
          points={{-86,2},{-86,40},{18,40}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(PhEffect.y, ChloridePoolEffect.yBase) annotation (Line(
          points={{26,48},{26,42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.CD_Cl_Outflow, ChloridePoolEffect.y) annotation (
          Line(
          points={{-86,2},{-86,32},{26,32},{26,36}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(CD_Outflow.soluteFlow, ChloridePoolEffect.y) annotation (Line(
          points={{18.4,13.6},{18.4,6},{26,6},{26,36}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>", info="<html>
<p>TODO: Chloride extracellular body concentration should play a role in chloride excretion by kidney?</p>
<p>In this implementation is chloride outflow driven only by electroneutrality.</p>
<p>That means - there is hard to calculate steady state for chloride concentration !!</p>
<p>Chloride concentration sholud be calculate also from internal electroneutrality, better than integrated value from inflow and outflow.</p>
</html>"));
      end KidneyCl_old;
    end Chloride;

    package Phosphate "Body Phosphate Distribution"

      model Phosphate
      Physiolibrary.Chemical.Components.Substance PO4Pool(
        stateName="PO4Pool.Mass",
        useNormalizedVolume=false,
        solute_start=(2.23728)/1000)
        annotation (Placement(transformation(extent={{-64,14},{-44,34}})));
        Modelica.Blocks.Interfaces.RealInput ECFV_Vol(final quantity="Volume",
            final displayUnit="ml")
          annotation (Placement(transformation(extent={{-76,28},{-68,36}}),
              iconTransformation(extent={{-100,64},{-88,76}})));
      Physiolibrary.Chemical.Components.Substance Bladder(
        stateName="BladderPhosphate.Mass",
        useNormalizedVolume=false,
        solute_start=(0)/1000)
        annotation (Placement(transformation(extent={{50,14},{70,34}})));
        Modelica.Blocks.Interfaces.RealInput BladderVolume_Mass(final quantity=
              "Volume", final displayUnit="ml")
          annotation (Placement(transformation(extent={{36,28},{44,36}}),
              iconTransformation(extent={{-100,40},{-88,52}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-84,-4},{-64,16}})));
        Modelica.Blocks.Interfaces.RealInput DietIntakeElectrolytes_PO4(final
            quantity="VolumeFlowRate", final displayUnit="mEq/min")
          annotation (Placement(transformation(extent={{-84,8},{-76,16}}),
              iconTransformation(
              extent={{-6,-6},{6,6}},
              rotation=270,
              origin={20,98})));
      Physiolibrary.Chemical.Components.Stream glomerulusPhosphateRate(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{0,14},{20,34}})));
        Modelica.Blocks.Interfaces.RealInput GlomerulusFiltrate_GFR(
                                                                   final
            quantity =                                                            "Flow", final unit = "ml/min")
          annotation (Placement(transformation(extent={{-4,30},{4,38}}),
              iconTransformation(extent={{-100,-16},{-88,-4}})));
        Modelica.Blocks.Interfaces.RealInput BloodIons_Cations(
                                                        final quantity=
              "Concentration", final displayUnit="mEq/l")
          annotation (Placement(transformation(extent={{-34,32},{-26,40}}),
              iconTransformation(extent={{-100,88},{-88,100}})));
        GlomerulusStrongAnionFiltration glomerulus
          annotation (Placement(transformation(extent={{-28,14},{-8,34}})));
        Modelica.Blocks.Interfaces.RealInput BloodIons_StrongAnionsLessPO4(
                                                                    final
            quantity="Concentration", final displayUnit="mEq/l")
          annotation (Placement(transformation(extent={{-34,40},{-26,48}}),
              iconTransformation(extent={{-100,76},{-88,88}})));
        Modelica.Blocks.Interfaces.RealInput CO2Veins_HCO3(
                                                    final quantity="Concentration",
            final displayUnit="mEq/l")
          annotation (Placement(transformation(extent={{-34,48},{-26,56}}),
              iconTransformation(extent={{-100,28},{-88,40}})));
        Modelica.Blocks.Interfaces.RealOutput PO4Pool_Osmoles(
                                                       final displayUnit="mOsm")
                                        annotation (Placement(transformation(extent={{-38,-16},
                  {-30,-8}}),        iconTransformation(extent={{100,80},{120,
                  100}})));
        Modelica.Blocks.Interfaces.RealOutput PO4Pool_conc_per_liter(
                                                              final displayUnit="mEq/l")
                                        annotation (Placement(transformation(extent={{-2,-2},
                  {6,6}}),           iconTransformation(extent={{100,60},{120,
                  80}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={-28,2})));
        Modelica.Blocks.Math.Gain gain(k=1000)
          annotation (Placement(transformation(extent={{-18,0},{-14,4}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
        annotation (Placement(transformation(extent={{20,34},{40,14}})));
        Modelica.Blocks.Interfaces.RealOutput CD_PO4_Outflow(
                                                      final displayUnit="mEq/min")
        "renal phosphate excretion rate"
                                        annotation (Placement(transformation(extent={{34,10},
                  {42,18}}),         iconTransformation(extent={{100,40},{120,
                  60}})));
        Modelica.Blocks.Math.Gain gain1(k=0.5)
          annotation (Placement(transformation(extent={{-50,-14},{-46,-10}})));
      Physiolibrary.Chemical.Components.Clearance bladderVoid(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{66,-20},{78,-8}})));
        Modelica.Blocks.Interfaces.RealInput BladderVoidFlow(
                                                      final quantity="VolumeFlowRate",
            final displayUnit="ml/min")
          annotation (Placement(transformation(extent={{58,-8},{66,0}}),
              iconTransformation(
              extent={{-6,-6},{6,6}},
              origin={-94,-106})));
        Modelica.Blocks.Interfaces.RealOutput ctPO4(
                                             final displayUnit="mmol/l")
                                        annotation (Placement(transformation(extent={{-60,64},
                  {-52,72}}),        iconTransformation(extent={{100,80},{120,
                  100}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1(
         toAnotherUnitCoef=1000, unitsString="mmol/l") annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-60,60})));
      equation
      connect(PO4Pool.solutionVolume, ECFV_Vol) annotation (Line(
          points={{-58,28},{-67,28},{-67,32},{-72,32}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Bladder.solutionVolume, BladderVolume_Mass) annotation (Line(
          points={{56,28},{46,28},{46,32},{40,32}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Diet.soluteFlow, DietIntakeElectrolytes_PO4) annotation (Line(
          points={{-70,10},{-70,12},{-80,12}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(Diet.q_out, PO4Pool.q_out) annotation (Line(
            points={{-64,6},{-60,6},{-60,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(glomerulusPhosphateRate.solutionFlow, GlomerulusFiltrate_GFR)
        annotation (Line(
          points={{10,28},{10,34},{0,34}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(glomerulus.q_out, glomerulusPhosphateRate.q_in)
                                                             annotation (Line(
            points={{-8,24},{0,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(PO4Pool.q_out, glomerulus.q_in) annotation (Line(
            points={{-54,24},{-28,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(glomerulus.HCO3, CO2Veins_HCO3)  annotation (Line(
            points={{-16,29},{-16,52},{-30,52}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, gain.u) annotation (Line(
          points={{-24,2},{-21.2,2},{-21.2,2},{-18.4,2}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(gain.y, PO4Pool_conc_per_liter) annotation (Line(
            points={{-13.8,2},{2,2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, PO4Pool.q_out) annotation (Line(
            points={{-30,2},{-34,2},{-34,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(flowMeasure.molarFlowRate, CD_PO4_Outflow) annotation (Line(
          points={{30,30},{30,14},{38,14}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(flowMeasure.q_out, Bladder.q_out) annotation (Line(
            points={{40,24},{60,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(glomerulusPhosphateRate.q_out, flowMeasure.q_in) annotation (
            Line(
            points={{20,24},{20,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(BloodIons_StrongAnionsLessPO4, glomerulus.otherStrongAnions)
          annotation (Line(
            points={{-30,44},{-20,44},{-20,29}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(BloodIons_Cations, glomerulus.Cations) annotation (Line(
            points={{-30,36},{-24,36},{-24,29}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(PO4Pool.solute, gain1.u) annotation (Line(
          points={{-54,14},{-54,-12},{-50.4,-12}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(gain1.y, PO4Pool_Osmoles) annotation (Line(
            points={{-45.8,-12},{-34,-12}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
            points={{60,24},{50,24},{50,-14},{66,-14}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(bladderVoid.solutionFlow, BladderVoidFlow) annotation (Line(
          points={{72,-11.6},{72,-4},{62,-4}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(concentrationMeasure1.concentration, ctPO4) annotation (Line(
          points={{-60,64},{-60,68},{-56,68}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(concentrationMeasure1.q_in, PO4Pool.q_out) annotation (Line(
            points={{-60,58},{-54,58},{-54,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      end Phosphate;

      model GlomerulusStrongAnionFiltration

      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (extent=
           [-10,-110; 10,-90], Placement(transformation(extent={{90,-10},{110,
                10}})));

      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
          Placement(transformation(extent={{-120,-20},{-80,20}}),
            iconTransformation(extent={{-110,-10},{-90,10}})));

        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput Cations
                                                annotation (Placement(
              transformation(extent={{-80,30},{-40,70}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-60,50})));
        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput ProteinAnions
           annotation (Placement(
              transformation(extent={{-40,30},{0,70}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-20,50})));
        Physiolibrary.Types.Fraction KAdjustment;
        //Real Cations( final quantity="Concentration", final unit = "mEq/l");
        Physiolibrary.Types.VolumeDensityOfCharge Anions;
      //  Real ProteinAnions( final quantity="Concentration", final unit = "mEq/l");
      /*  Library.Interfaces.RealInput_ HCO3(final quantity="Concentration",
      final displayUnit="mEq/l")                                                                               annotation (Placement(
        transformation(extent={{0,30},{40,70}}),  iconTransformation(
        extent={{-20,-20},{20,20}},
        rotation=270,
        origin={20,50})));
*/
      equation
        q_in.q + q_out.q = 0;
        //Cations = q_in.conc*1000+otherCations;
        Anions = Cations;
      //  ProteinAnions = Anions - otherStrongAnions - q_in.conc*1000 - HCO3;
        KAdjustment = (Cations-(Anions-ProteinAnions))/(Cations+(Anions-ProteinAnions));
        q_out.conc = (1+KAdjustment)*q_in.conc;

       annotation (
          Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,-100},{
                  100,100}}), graphics={
              Rectangle(
                extent={{-100,-50},{100,50}},
                lineColor={0,0,127},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid),
              Text(
                extent={{-150,-100},{150,-60}},
                textString="%name",
                lineColor={0,0,255}),
              Line(
                points={{0,42},{0,26}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,20},{0,4}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,-4},{0,-20}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,-26},{0,-42}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5)}));
      end GlomerulusStrongAnionFiltration;

      model Phosphate2
      import Physiomodel;
        extends Physiolibrary.Icons.Phosphate;
      Physiolibrary.Chemical.Components.Substance PO4Pool(
        stateName="PO4Pool.Mass",
        useNormalizedVolume=false,
        solute_start=(2.43011)/1000)
        annotation (Placement(transformation(extent={{-64,14},{-44,34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-84,-4},{-64,16}})));
      Physiolibrary.Chemical.Components.Stream glomerulusPhosphateRate(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{0,14},{20,34}})));
        Physiomodel.Electrolytes.Sulphate.GlomerulusStrongAnionFiltration glomerulus
          annotation (Placement(transformation(extent={{-28,14},{-8,34}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={-28,2})));
        Modelica.Blocks.Math.Gain gain(k=1000)
          annotation (Placement(transformation(extent={{-18,0},{-14,4}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
        annotation (Placement(transformation(extent={{20,34},{40,14}})));
        Modelica.Blocks.Math.Gain gain1(k=0.5)
          annotation (Placement(transformation(extent={{-50,-14},{-46,-10}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1(
         toAnotherUnitCoef=1000, unitsString="mmol/l") annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-60,60})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-90,76},{-78,88}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant7(k=30/
            1440)
        annotation (Placement(transformation(extent={{-84,24},{-76,32}})));
      Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,1.0,
            -0.04},{50,0.0,0}}, Xscale=1e-6/Substances.Leptin.mw)
        annotation (Placement(transformation(extent={{-84,10},{-64,30}})));
        AcidDissociation acidDissociation
          annotation (Placement(transformation(extent={{30,-50},{50,-30}})));
      Real ECF_conc;
        Physiomodel.Electrolytes.Bladder bladder(stateVarName=
              "BladderPhosphate.Mass")
          annotation (Placement(transformation(extent={{66,6},{86,26}})));
      equation
        ECF_conc =concentrationMeasure1.concentration;
      connect(PO4Pool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
          points={{-58,28},{-67,28},{-67,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

        connect(Diet.q_out, PO4Pool.q_out) annotation (Line(
            points={{-64,6},{-60,6},{-60,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(glomerulusPhosphateRate.solutionFlow, busConnector.GlomerulusFiltrate_GFR)
        annotation (Line(
          points={{10,28},{10,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(glomerulus.q_out, glomerulusPhosphateRate.q_in)
                                                             annotation (Line(
            points={{-8,24},{0,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(PO4Pool.q_out, glomerulus.q_in) annotation (Line(
            points={{-54,24},{-28,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(concentrationMeasure.concentration, gain.u) annotation (Line(
          points={{-24,2},{-21.2,2},{-21.2,2},{-18.4,2}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(gain.y, busConnector. PO4Pool_conc_per_liter) annotation (Line(
            points={{-13.8,2},{-48.9,2},{-48.9,82},{-84,82}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
        connect(concentrationMeasure.q_in, PO4Pool.q_out) annotation (Line(
            points={{-30,2},{-34,2},{-34,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(flowMeasure.molarFlowRate, busConnector.CD_PO4_Outflow)
        annotation (Line(
          points={{30,30},{30,-22},{98,-22},{98,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(glomerulusPhosphateRate.q_out, flowMeasure.q_in) annotation (
            Line(
            points={{20,24},{20,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(busConnector.BloodIons_Cations, glomerulus.Cations) annotation (Line(
            points={{-84,82},{-24,82},{-24,29}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%first",
       index=-1,
       extent={{-3,1},{-3,1}}));
      connect(PO4Pool.solute, gain1.u) annotation (Line(
          points={{-54,14},{-54,-12},{-50.4,-12}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(gain1.y, busConnector. PO4Pool_Osmoles) annotation (Line(
            points={{-45.8,-12},{-64.9,-12},{-64.9,82},{-84,82}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
      connect(concentrationMeasure1.concentration, busConnector.ctPO4)
        annotation (Line(
          points={{-60,64},{-60,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(concentrationMeasure1.q_in, PO4Pool.q_out) annotation (Line(
            points={{-60,58},{-54,58},{-54,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));

        connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
            points={{-84,82},{-92,82},{-92,20},{-82,20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
            points={{-75,28},{-74,28},{-74,22}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
          points={{-74,16},{-74,10},{-70,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(flowMeasure.molarFlowRate, acidDissociation.CD_tPO4) annotation (
          Line(
          points={{30,30},{30,-22},{18,-22},{18,-32},{30,-32}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.Urine_pH, acidDissociation.PHU) annotation (Line(
            points={{-84,82},{-92,82},{-92,-38},{30,-38},{30,-38}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(acidDissociation.CD_PO4_mEq, busConnector.CD_PO4_mEq_Outflow)
          annotation (Line(
            points={{50,-46},{98,-46},{98,82},{-84,82}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(busConnector.BloodIons_ProteinAnions, glomerulus.ProteinAnions)
          annotation (Line(
            points={{-84,82},{-20,82},{-20,29}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(bladder.busConnector, busConnector) annotation (Line(
            points={{84,24},{84,82},{-84,82}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(bladder.q_in, flowMeasure.q_out) annotation (Line(
            points={{76,24},{40,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={                 Text(
                extent={{-108,-98},{112,-124}},
                lineColor={0,0,255},
                textString="%name")}));
      end Phosphate2;

      model AcidDissociation

        Modelica.Blocks.Interfaces.RealInput
                                           CD_tPO4(
                                             displayUnit="mmol/min")
        "total PO4 in mmol/min"
          annotation (Placement(transformation(extent={{-120,60},{-80,100}}),
              iconTransformation(extent={{-120,60},{-80,100}})));
        Modelica.Blocks.Interfaces.RealInput
                                           PHU "pH of urine in collecting duct"
                                                                          annotation (
           Placement(transformation(extent={{-120,60},{-80,100}}), iconTransformation(
                extent={{-120,0},{-80,40}})));
        Modelica.Blocks.Interfaces.RealOutput
                                            CD_PO4_mEq(
                                                 displayUnit="mEq/min") annotation (
            Placement(transformation(extent={{80,-80},{120,-40}}), iconTransformation(
                extent={{80,-80},{120,-40}})));

        Real H2PO4;
        Real HPO4;
      equation
        HPO4/H2PO4 = 10^(PHU-6.8);
        CD_tPO4 = HPO4 + H2PO4;
        CD_PO4_mEq = 2*HPO4 + H2PO4;
      end AcidDissociation;

      model Phosphate3
      import Physiomodel;
        extends Physiolibrary.Icons.Phosphate;
      Physiolibrary.Chemical.Components.Substance PO4Pool(
        stateName="PO4Pool.Mass",
        useNormalizedVolume=false,
        solute_start=(2.43011)/1000)
        annotation (Placement(transformation(extent={{-64,14},{-44,34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-84,-4},{-64,16}})));
      Physiolibrary.Chemical.Components.Stream glomerulusPhosphateRate(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{0,14},{20,34}})));
        Physiomodel.Electrolytes.Sulphate.GlomerulusStrongAnionFiltration glomerulus
          annotation (Placement(transformation(extent={{-28,14},{-8,34}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={-28,2})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
        annotation (Placement(transformation(extent={{40,34},{60,14}})));
        Modelica.Blocks.Math.Gain gain1(k=0.5)
          annotation (Placement(transformation(extent={{-50,-14},{-46,-10}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure1 annotation (Placement(
              transformation(
              extent={{-10,-10},{10,10}},
              origin={-60,60})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-90,76},{-78,88}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst        Constant7(k(displayUnit=
               "mmol/min") = 3.4722222222222e-07)
        annotation (Placement(transformation(extent={{-84,24},{-76,32}})));
      Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,1.0,
            -0.04},{50,0.0,0}}, Xscale=1e-6/Substances.Leptin.mw)
        annotation (Placement(transformation(extent={{-84,10},{-64,30}})));
      Physiolibrary.Types.Concentration ECF_conc;
        Physiomodel.Electrolytes.Bladder bladder(stateVarName=
              "BladderPhosphate.Mass")
          annotation (Placement(transformation(extent={{66,6},{86,26}})));
      equation
        ECF_conc =concentrationMeasure1.concentration;
      connect(PO4Pool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
          points={{-58,28},{-67,28},{-67,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

        connect(Diet.q_out, PO4Pool.q_out) annotation (Line(
            points={{-64,6},{-60,6},{-60,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(glomerulusPhosphateRate.solutionFlow, busConnector.GlomerulusFiltrate_GFR)
        annotation (Line(
          points={{10,31},{10,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(glomerulus.q_out, glomerulusPhosphateRate.q_in)
                                                             annotation (Line(
            points={{-8,24},{0,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(PO4Pool.q_out, glomerulus.q_in) annotation (Line(
            points={{-54,24},{-28,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(concentrationMeasure.q_in, PO4Pool.q_out) annotation (Line(
            points={{-30,2},{-34,2},{-34,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(flowMeasure.molarFlowRate, busConnector.CD_PO4_Outflow)
        annotation (Line(
          points={{50,30},{50,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(glomerulusPhosphateRate.q_out, flowMeasure.q_in) annotation (
            Line(
            points={{20,24},{40,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(busConnector.BloodIons_Cations, glomerulus.Cations) annotation (Line(
            points={{-84,82},{-24,82},{-24,29}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%first",
       index=-1,
       extent={{-3,1},{-3,1}}));
      connect(PO4Pool.solute, gain1.u) annotation (Line(
          points={{-48,14},{-48,-12},{-50.4,-12}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(gain1.y, busConnector. PO4Pool_Osmoles) annotation (Line(
            points={{-45.8,-12},{97.1,-12},{97.1,82},{-84,82}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
      connect(concentrationMeasure1.concentration, busConnector.ctPO4)
        annotation (Line(
          points={{-60,64},{-60,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(concentrationMeasure1.q_in, PO4Pool.q_out) annotation (Line(
            points={{-60,58},{-54,58},{-54,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));

        connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
            points={{-84,82},{-92,82},{-92,20},{-82,20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
            points={{-75,28},{-74,28},{-74,22}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
          points={{-74,16},{-74,10},{-70,10}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.BloodIons_ProteinAnions, glomerulus.ProteinAnions)
          annotation (Line(
            points={{-84,82},{-20,82},{-20,29}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(bladder.busConnector, busConnector) annotation (Line(
            points={{84,24},{84,82},{-84,82}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(bladder.q_in, flowMeasure.q_out) annotation (Line(
            points={{76,24},{60,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(flowMeasure.molarFlowRate, busConnector.CD_PO4_mEq_Outflow)
        annotation (Line(
          points={{50,30},{50,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(concentrationMeasure.concentration, busConnector.PO4Pool_conc_per_liter)
        annotation (Line(
          points={{-24,2},{98,2},{98,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(concentrationMeasure1.concentration, busConnector.PO4Pool)
        annotation (Line(
          points={{-60,64},{-60,82},{-84,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={                 Text(
                extent={{-108,-98},{112,-124}},
                lineColor={0,0,255},
                textString="%name")}));
      end Phosphate3;
    end Phosphate;

    package Sulphate "Body Sulphate Distribution"

      model Sulphate

        Modelica.Blocks.Interfaces.RealInput ECFV_Vol(final quantity="Volume",
            final displayUnit="ml")
          annotation (Placement(transformation(extent={{-76,28},{-68,36}}),
              iconTransformation(extent={{-100,64},{-88,76}})));
        Modelica.Blocks.Interfaces.RealInput BladderVolume_Mass(final quantity=
              "Volume", final displayUnit="ml")
          annotation (Placement(transformation(extent={{36,28},{44,36}}),
              iconTransformation(extent={{-100,40},{-88,52}})));
        Modelica.Blocks.Interfaces.RealInput DietIntakeElectrolytes_SO4(final
            quantity="VolumeFlowRate", final displayUnit="mEq/min")
          annotation (Placement(transformation(extent={{-84,8},{-76,16}}),
              iconTransformation(
              extent={{-6,-6},{6,6}},
              rotation=270,
              origin={20,98})));
        Modelica.Blocks.Interfaces.RealInput GlomerulusFiltrate_GFR(
                                                                   final
            quantity =                                                            "Flow", final unit = "ml/min")
          annotation (Placement(transformation(extent={{-4,30},{4,38}}),
              iconTransformation(extent={{-100,-16},{-88,-4}})));
        Modelica.Blocks.Interfaces.RealInput BloodIons_Cations(
                                                        final quantity=
              "Concentration", final displayUnit="mEq/l")
          annotation (Placement(transformation(extent={{-36,32},{-28,40}}),
              iconTransformation(extent={{-100,88},{-88,100}})));
        Modelica.Blocks.Interfaces.RealInput BloodIons_StrongAnionsLessSO4(
                                                                    final
            quantity="Concentration", final displayUnit="mEq/l")
          annotation (Placement(transformation(extent={{-36,40},{-28,48}}),
              iconTransformation(extent={{-100,76},{-88,88}})));
        Modelica.Blocks.Interfaces.RealInput CO2Veins_HCO3(
                                                    final quantity="Concentration",
            final displayUnit="mEq/l")
          annotation (Placement(transformation(extent={{-36,48},{-28,56}}),
              iconTransformation(extent={{-100,28},{-88,40}})));
        Modelica.Blocks.Interfaces.RealOutput SO4Pool_Osmoles(
                                                       final displayUnit="mOsm")
                                        annotation (Placement(transformation(extent={{-42,-8},
                  {-34,0}}),         iconTransformation(extent={{100,80},{120,100}})));
        Modelica.Blocks.Interfaces.RealOutput SO4Pool_conc_per_liter(
                                                              final displayUnit="mEq/l")
                                        annotation (Placement(transformation(extent={{-2,0},{
                  6,8}}),            iconTransformation(extent={{100,60},{120,80}})));
        Modelica.Blocks.Interfaces.RealOutput CD_SO4_Outflow(
                                                      final displayUnit="mEq/min")
                                        annotation (Placement(transformation(extent={{32,10},
                  {40,18}}),         iconTransformation(extent={{100,40},{120,60}})));
        Modelica.Blocks.Interfaces.RealInput BladderVoidFlow(
                                                      final quantity="VolumeFlowRate",
            final displayUnit="ml/min")
          annotation (Placement(transformation(extent={{58,-6},{66,2}}),
              iconTransformation(
              extent={{-6,-6},{6,6}},
              origin={-94,-106})));

      Physiolibrary.Chemical.Components.Substance SO4Pool(
        stateName="SO4Pool.Mass",
        useNormalizedVolume=false,
        solute_start=(3.72875)/1000)
        annotation (Placement(transformation(extent={{-64,14},{-44,34}})));
      Physiolibrary.Chemical.Components.Substance Bladder(
        stateName="BladderSulphate.Mass",
        useNormalizedVolume=false,
        solute_start=(0)/1000)
        annotation (Placement(transformation(extent={{50,14},{70,34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-84,-4},{-64,16}})));
      Physiolibrary.Chemical.Components.Stream glomerulusPhosphateRate(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-2,14},{18,34}})));
        GlomerulusStrongAnionFiltration glomerulus
          annotation (Placement(transformation(extent={{-28,14},{-8,34}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={-18,4})));
        Modelica.Blocks.Math.Gain gain(k=1000)
          annotation (Placement(transformation(extent={{-8,2},{-4,6}})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
        annotation (Placement(transformation(extent={{18,34},{38,14}})));
        Modelica.Blocks.Math.Gain gain1(k=0.5)
          annotation (Placement(transformation(extent={{-52,-6},{-48,-2}})));
      Physiolibrary.Chemical.Components.Clearance bladderVoid(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{66,-18},{78,-6}})));
      equation
      connect(SO4Pool.solutionVolume, ECFV_Vol) annotation (Line(
          points={{-58,28},{-67,28},{-67,32},{-72,32}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Bladder.solutionVolume, BladderVolume_Mass) annotation (Line(
          points={{56,28},{46,28},{46,32},{40,32}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Diet.soluteFlow, DietIntakeElectrolytes_SO4) annotation (Line(
          points={{-70,10},{-70,12},{-80,12}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(Diet.q_out,SO4Pool. q_out) annotation (Line(
            points={{-64,6},{-60,6},{-60,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(glomerulusPhosphateRate.solutionFlow, GlomerulusFiltrate_GFR)
        annotation (Line(
          points={{8,28},{8,34},{0,34}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(glomerulus.q_out, glomerulusPhosphateRate.q_in)
                                                             annotation (Line(
            points={{-8,24},{-2,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(SO4Pool.q_out, glomerulus.q_in) annotation (Line(
            points={{-54,24},{-28,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(glomerulus.HCO3, CO2Veins_HCO3)  annotation (Line(
            points={{-16,29},{-16,52},{-32,52}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, gain.u) annotation (Line(
          points={{-14,4},{-11.2,4},{-11.2,4},{-8.4,4}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(gain.y, SO4Pool_conc_per_liter) annotation (Line(
            points={{-3.8,4},{2,4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(concentrationMeasure.q_in, SO4Pool.q_out) annotation (Line(
            points={{-20,4},{-36,4},{-36,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(flowMeasure.molarFlowRate, CD_SO4_Outflow) annotation (Line(
          points={{28,30},{28,14},{36,14}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(flowMeasure.q_out, Bladder.q_out) annotation (Line(
            points={{38,24},{60,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(glomerulusPhosphateRate.q_out, flowMeasure.q_in) annotation (
            Line(
            points={{18,24},{18,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(BloodIons_StrongAnionsLessSO4, glomerulus.otherStrongAnions)
          annotation (Line(
            points={{-32,44},{-20,44},{-20,29}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(BloodIons_Cations, glomerulus.Cations) annotation (Line(
            points={{-32,36},{-24,36},{-24,29}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(gain1.y, SO4Pool_Osmoles) annotation (Line(
            points={{-47.8,-4},{-38,-4}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(gain1.u, SO4Pool.solute) annotation (Line(
          points={{-52.4,-4},{-54,-4},{-54,14}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(Bladder.q_out, bladderVoid.q_in) annotation (Line(
            points={{60,24},{50,24},{50,-12},{66,-12}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(bladderVoid.solutionFlow, BladderVoidFlow) annotation (Line(
          points={{72,-9.6},{72,-2},{62,-2}},
          color={0,0,127},
          smooth=Smooth.None));

      end Sulphate;

      model GlomerulusStrongAnionFiltration

      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (extent=
           [-10,-110; 10,-90], Placement(transformation(extent={{90,-10},{110,
                10}})));

      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
          Placement(transformation(extent={{-120,-20},{-80,20}}),
            iconTransformation(extent={{-110,-10},{-90,10}})));

        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput Cations annotation (Placement(
              transformation(extent={{-80,30},{-40,70}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-60,50})));
        Physiolibrary.Types.RealIO.VolumeDensityOfChargeInput ProteinAnions annotation (Placement(
              transformation(extent={{-40,30},{0,70}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-20,50})));
        Physiolibrary.Types.Fraction KAdjustment;
        //Real Cations( final quantity="Concentration", final unit = "mEq/l");
        Physiolibrary.Types.VolumeDensityOfCharge Anions;
       // Real ProteinAnions( final quantity="Concentration", final unit = "mEq/l");
      /*  Library.Interfaces.RealInput_ HCO3(final quantity="Concentration",
      final displayUnit="mEq/l")                                                                               annotation (Placement(
        transformation(extent={{0,30},{40,70}}),  iconTransformation(
        extent={{-20,-20},{20,20}},
        rotation=270,
        origin={20,50})));
*/
      equation
        q_in.q + q_out.q = 0;
        //Cations = q_in.conc*1000+otherCations;
        Anions = Cations;
       // ProteinAnions = Anions - otherStrongAnions - q_in.conc*1000 - HCO3;
        KAdjustment = (Cations-(Anions-ProteinAnions))/(Cations+(Anions-ProteinAnions));
        q_out.conc = (1+KAdjustment)*q_in.conc;

       annotation (
          Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,-100},{
                  100,100}}), graphics={
              Rectangle(
                extent={{-100,-50},{100,50}},
                lineColor={0,0,127},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid),
              Text(
                extent={{-150,-100},{150,-60}},
                textString="%name",
                lineColor={0,0,255}),
              Line(
                points={{0,42},{0,26}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,20},{0,4}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,-4},{0,-20}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5),
              Line(
                points={{0,-26},{0,-42}},
                color={0,0,255},
                smooth=Smooth.None,
                thickness=0.5)}));
      end GlomerulusStrongAnionFiltration;

      model Sulphate2
      import Physiomodel;
         extends Physiolibrary.Icons.Sulphate;
      Physiolibrary.Chemical.Components.Substance SO4Pool(
        stateName="SO4Pool.Mass",
        useNormalizedVolume=false,
        solute_start=(4.00254)/1000)
        annotation (Placement(transformation(extent={{-64,14},{-44,34}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump Diet(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-88,-4},{-68,16}})));
      Physiolibrary.Chemical.Components.Stream glomerulusPhosphateRate(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{-2,14},{18,34}})));
        GlomerulusStrongAnionFiltration glomerulus
          annotation (Placement(transformation(extent={{-28,14},{-8,34}})));
        Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=270,
              origin={-18,4})));
      Physiolibrary.Chemical.Sensors.MolarFlowMeasure flowMeasure
        annotation (Placement(transformation(extent={{18,34},{38,14}})));
        Modelica.Blocks.Math.Gain gain1(k=0.5)
          annotation (Placement(transformation(extent={{-52,-6},{-48,-2}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-96,76},{-84,88}}), iconTransformation(
              extent={{60,60},{100,100}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst        Constant7(k(displayUnit=
               "mol/s") = 2.8935185185185185185185185185185e-7)
        annotation (Placement(transformation(extent={{-88,20},{-80,28}})));
      Physiolibrary.Blocks.Factors.Spline LeptinEffect2(data={{0,3.0,0},{8,1.0,
            -0.04},{50,0.0,0}}, Xscale=1e-6/Substances.Leptin.mw)
        annotation (Placement(transformation(extent={{-88,6},{-68,26}})));
      Physiolibrary.Types.Concentration ECF_conc;
        Physiomodel.Electrolytes.Bladder bladder(stateVarName="BladderSulphate.Mass")
          annotation (Placement(transformation(extent={{64,6},{84,26}})));
      Modelica.Blocks.Math.Gain eq2mol(k=0.5) annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            rotation=90,
            origin={32,56})));
      equation
        ECF_conc =concentrationMeasure.concentration;
      connect(SO4Pool.solutionVolume, busConnector.ECFV_Vol) annotation (Line(
          points={{-58,28},{-67,28},{-67,82},{-90,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));

        connect(Diet.q_out,SO4Pool. q_out) annotation (Line(
            points={{-68,6},{-60,6},{-60,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
      connect(glomerulusPhosphateRate.solutionFlow, busConnector.GlomerulusFiltrate_GFR)
        annotation (Line(
          points={{8,31},{8,82},{-90,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{3,1},{3,1}}));
        connect(glomerulus.q_out, glomerulusPhosphateRate.q_in)
                                                             annotation (Line(
            points={{-8,24},{-2,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(SO4Pool.q_out, glomerulus.q_in) annotation (Line(
            points={{-54,24},{-28,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(concentrationMeasure.q_in, SO4Pool.q_out) annotation (Line(
            points={{-20,4},{-36,4},{-36,24},{-54,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(glomerulusPhosphateRate.q_out, flowMeasure.q_in) annotation (
            Line(
            points={{18,24},{18,24}},
            color={200,0,0},
            smooth=Smooth.None,
            thickness=1));
        connect(busConnector.BloodIons_Cations, glomerulus.Cations) annotation (Line(
            points={{-90,82},{-24,82},{-24,29}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%first",
       index=-1,
       extent={{-3,1},{-3,1}}));
        connect(gain1.y, busConnector. SO4Pool_Osmoles) annotation (Line(
            points={{-47.8,-4},{98,-4},{98,82},{-90,82}},
            color={0,0,127},
            smooth=Smooth.None), Text(
       string="%second",
       index=1,
       extent={{3,1},{3,1}}));
      connect(gain1.u, SO4Pool.solute) annotation (Line(
          points={{-52.4,-4},{-48,-4},{-48,14}},
          color={0,0,127},
          smooth=Smooth.None));

        connect(busConnector.Leptin, LeptinEffect2.u) annotation (Line(
            points={{-90,82},{-96,82},{-96,16},{-86,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Constant7.y,LeptinEffect2. yBase) annotation (Line(
            points={{-79,24},{-78,24},{-78,18}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(LeptinEffect2.y, Diet.soluteFlow) annotation (Line(
          points={{-78,12},{-78,10},{-74,10}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.BloodIons_ProteinAnions, glomerulus.ProteinAnions)
          annotation (Line(
            points={{-90,82},{-20,82},{-20,29}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(flowMeasure.q_out, bladder.q_in) annotation (Line(
            points={{38,24},{74,24}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(bladder.busConnector, busConnector) annotation (Line(
            points={{82,24},{82,82},{-90,82}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      connect(eq2mol.u, flowMeasure.molarFlowRate) annotation (Line(
          points={{32,44},{34,44},{34,30},{28,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(eq2mol.y, busConnector.CD_SO4_Outflow) annotation (Line(
          points={{32,67},{32,82},{-90,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(concentrationMeasure.concentration, busConnector.SO4Pool_conc_per_liter)
        annotation (Line(
          points={{-14,4},{98,4},{98,82},{-90,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(concentrationMeasure.concentration, busConnector.SO4Pool)
        annotation (Line(
          points={{-14,4},{100,4},{100,82},{-90,82}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-110,-104},{110,-130}},
                lineColor={0,0,255},
                textString="%name")}));
      end Sulphate2;
    end Sulphate;

    package NH4 "Body Amonium Distribution"

      model Ammonium
         extends Physiolibrary.Icons.Amonium;
      Physiolibrary.Blocks.Factors.Spline PT_NH3_AcuteEffect(data={{7.00,2.0,0},
            {7.42,1.0,-3.0},{7.80,0.0,0}})
        "marek: normal pH corrected from 7.45 to 7.42"
        annotation (Placement(transformation(extent={{-60,52},{-40,72}})));
        Physiolibrary.Blocks.Factors.SplineLag PT_NH3_ChronicEffect(
        HalfTime=3*86400*Modelica.Math.log(2),
        stateName="PT_NH3.ChronicPhEffect",
        data={{7.00,3.0,0},{7.42,1.0,-4.0},{7.80,0.0,0}})
        "marek: normal pH corrected from 7.45 to 7.42"
        annotation (Placement(transformation(extent={{-60,40},{-40,60}})));
      Physiolibrary.Blocks.Factors.Spline CD_NH4_PhOnFlux(data={{7.00,1.0,0},{
            7.42,0.6,-2.0},{7.80,0.0,0}})
        "marek: normal pH corrected from 7.45 to 7.42"
        annotation (Placement(transformation(extent={{-60,24},{-40,44}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        electrolytesFlowConstant(k=6.6666666666667e-07)
        annotation (Placement(transformation(extent={{-68,74},{-56,86}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-98,42},{-86,54}}), iconTransformation(
              extent={{62,62},{100,100}})));
      Physiolibrary.Blocks.Factors.Spline ChloridePoolEffect(data={{0.00,0.0,0},
            {80,1.0,0.0}})
        "electroneutrality does not allow to extract cation without anion"
        annotation (Placement(transformation(extent={{-60,-2},{-40,18}})));
      equation

      connect(PT_NH3_AcuteEffect.y, PT_NH3_ChronicEffect.yBase) annotation (
          Line(
          points={{-50,58},{-50,52}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(PT_NH3_ChronicEffect.y, CD_NH4_PhOnFlux.yBase) annotation (Line(
          points={{-50,46},{-50,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(electrolytesFlowConstant.y, PT_NH3_AcuteEffect.yBase) annotation (
         Line(
          points={{-54.5,80},{-50,80},{-50,64}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.Artys_pH, PT_NH3_AcuteEffect.u) annotation (Line(
          points={{-92,48},{-76,48},{-76,62},{-58,62}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.Artys_pH, PT_NH3_ChronicEffect.u) annotation (Line(
          points={{-92,48},{-76,48},{-76,50},{-58,50}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.Artys_pH, CD_NH4_PhOnFlux.u) annotation (Line(
          points={{-92,48},{-76,48},{-76,34},{-58,34}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(CD_NH4_PhOnFlux.y, ChloridePoolEffect.yBase) annotation (Line(
          points={{-50,30},{-50,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ClPool, ChloridePoolEffect.u) annotation (Line(
          points={{-92,48},{-92,8},{-58,8}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(ChloridePoolEffect.y, busConnector.CD_NH4_Outflow) annotation (
          Line(
          points={{-50,4},{-50,-8},{-92,-8},{-92,48}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={              Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end Ammonium;

      package test
        model T
          Ammonium amonium2_1
            annotation (Placement(transformation(extent={{-32,16},{-12,36}})));
        old.setup.ElectrolytesConstInputs electrolytesConstInputs
          annotation (Placement(transformation(extent={{6,24},{26,44}})));
        equation
          connect(electrolytesConstInputs.busConnector, amonium2_1.busConnector)
            annotation (Line(
              points={{14,34},{-13.9,34.1}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T;

        model NH4
         extends Physiolibrary.Icons.Amonium;
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 AcuteEffect(
              data={{7.00,2.0,0},{7.45,1.0,-3.0},{7.80,0.0,0}})
            annotation (Placement(transformation(extent={{-60,52},{-40,72}})));
          Physiolibrary.Factors.NonlinearSystemPatch.Spline3DelayByDay
            ChronicEffect(Tau=3, data={{7.00,3.0,0},{7.45,1.0,-4.0},{7.80,0.0,0}})
            annotation (Placement(transformation(extent={{-60,42},{-40,62}})));
          Physiolibrary.Factors.NonlinearSystemPatch.SplineValue3 PhOnFlux( data=
                {{7.00,1.0,0},{7.45,0.6,-2.0},{7.80,0.0,0}})
            annotation (Placement(transformation(extent={{-60,26},{-40,46}})));
        Physiolibrary.Types.Constants.ElectricCurrentConst
          electrolytesFlowConstant(k=0.064323559933332)
          annotation (Placement(transformation(extent={{-68,74},{-56,86}})));
          Modelica.Blocks.Interfaces.RealInput BloodPh_ArtysPh
            annotation (Placement(transformation(extent={{-90,58},{-82,66}}),
                iconTransformation(extent={{-100,88},{-88,100}})));
          Modelica.Blocks.Interfaces.RealOutput CD_NH4_Outflow
                                          annotation (Placement(transformation(extent={{-44,10},
                    {-36,18}}),        iconTransformation(extent={{100,80},{120,
                    100}})));
        equation

          connect(AcuteEffect.y, ChronicEffect.yBase) annotation (Line(
              points={{-50,60},{-50,54}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(ChronicEffect.y, PhOnFlux.yBase) annotation (Line(
              points={{-50,50},{-50,38}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(electrolytesFlowConstant.y, AcuteEffect.yBase) annotation (Line(
              points={{-55.4,80},{-50,80},{-50,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(AcuteEffect.u, BloodPh_ArtysPh) annotation (Line(
              points={{-59.8,62},{-86,62}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(BloodPh_ArtysPh, ChronicEffect.u) annotation (Line(
              points={{-86,62},{-74,62},{-74,52},{-59.8,52}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(BloodPh_ArtysPh, PhOnFlux.u) annotation (Line(
              points={{-86,62},{-74,62},{-74,36},{-59.8,36}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(PhOnFlux.y, CD_NH4_Outflow) annotation (Line(
              points={{-50,34},{-50,14},{-40,14}},
              color={0,0,127},
              smooth=Smooth.None));
        end NH4;
      end test;

      model Ammonium_old
         extends Physiolibrary.Icons.Amonium;
      Physiolibrary.Blocks.Factors.Spline PT_NH3_AcuteEffect(data={{7.00,2.0,0},
            {7.45,1.0,-3.0},{7.80,0.0,0}})
        annotation (Placement(transformation(extent={{-60,52},{-40,72}})));
        Physiolibrary.Blocks.Factors.SplineLag PT_NH3_ChronicEffect(
        HalfTime=3*86400*Modelica.Math.log(2),
        data={{7.00,3.0,0},{7.45,1.0,-4.0},{7.80,0.0,0}},
        stateName="PT_NH3.ChronicPhEffect")
        annotation (Placement(transformation(extent={{-60,40},{-40,60}})));
      Physiolibrary.Blocks.Factors.Spline CD_NH4_PhOnFlux(data={{7.00,1.0,0},{
            7.45,0.6,-2.0},{7.80,0.0,0}})
        annotation (Placement(transformation(extent={{-60,24},{-40,44}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        electrolytesFlowConstant(k=6.6666666666667e-07)
        annotation (Placement(transformation(extent={{-68,74},{-56,86}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-98,42},{-86,54}}), iconTransformation(
              extent={{62,62},{100,100}})));
      Physiolibrary.Blocks.Factors.Spline ChloridePoolEffect(data={{0.00,0.0,0},
            {80,1.0,0.0}})
        "electroneutrality does not allow to extract cation without anion"
        annotation (Placement(transformation(extent={{-60,-2},{-40,18}})));
      equation

      connect(PT_NH3_AcuteEffect.y, PT_NH3_ChronicEffect.yBase) annotation (
          Line(
          points={{-50,58},{-50,52}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(PT_NH3_ChronicEffect.y, CD_NH4_PhOnFlux.yBase) annotation (Line(
          points={{-50,46},{-50,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(electrolytesFlowConstant.y, PT_NH3_AcuteEffect.yBase) annotation (
         Line(
          points={{-54.5,80},{-50,80},{-50,64}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.Artys_pH, PT_NH3_AcuteEffect.u) annotation (Line(
          points={{-92,48},{-76,48},{-76,62},{-58,62}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.Artys_pH, PT_NH3_ChronicEffect.u) annotation (Line(
          points={{-92,48},{-76,48},{-76,50},{-58,50}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.Artys_pH, CD_NH4_PhOnFlux.u) annotation (Line(
          points={{-92,48},{-76,48},{-76,34},{-58,34}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(CD_NH4_PhOnFlux.y, ChloridePoolEffect.yBase) annotation (Line(
          points={{-50,30},{-50,10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ClPool, ChloridePoolEffect.u) annotation (Line(
          points={{-92,48},{-92,8},{-58,8}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(ChloridePoolEffect.y, busConnector.CD_NH4_Outflow) annotation (
          Line(
          points={{-50,4},{-50,-8},{-92,-8},{-92,48}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={              Text(
                extent={{-112,-102},{108,-128}},
                lineColor={0,0,255},
                textString="%name")}),
          Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
      end Ammonium_old;
    end NH4;

    package Calcium
      model Calcium
      import Physiomodel;

      Physiolibrary.Molar.ConcentrationCompartment_knownConc          CaPool(
            concentration=2.4)
          annotation (Placement(transformation(extent={{-42,-12},{-22,8}})));
        Physiomodel.Electrolytes.Calcium.CaBone CaBone(initialSoluteMass=100)
          annotation (Placement(transformation(extent={{42,-12},{62,8}})));
      Physiolibrary.Types.BusConnector busConnector
        annotation (Placement(transformation(extent={{-98,68},{-78,88}})));
      Physiomodel.Electrolytes.Calcium.Bladder Bladder(useNormalizedVolume=
            false, solute_start=(0)/1000)
        annotation (Placement(transformation(extent={{80,-98},{100,-78}})));
      Physiolibrary.Chemical.Components.SolutePump J_pu(useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-2,-96},{14,-80}})));
      Physiolibrary.Chemical.Components.SolutePump J_pb(useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{10,-42},{26,-26}})));
        Modelica.Blocks.Math.Gain gain(k=3.3/31.2)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={4,-24})));
      Physiolibrary.Chemical.Components.SolutePump J_bp(useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{26,-16},{10,0}})));
        Factors.Y2 y2_D(affinity=90, Y_Max=0.04)
          annotation (Placement(transformation(extent={{10,54},{30,74}})));
        Factors.Y2 y2_Ca(affinity=2.4, Y_Max=1)
          annotation (Placement(transformation(extent={{28,22},{8,42}})));
        Factors.Y1 y1_PTH(
          positive=true,
          affinity=3.85,
          a=0.85,
          b=0.45,
          d=0.15,
          Y_Max=1)
          annotation (Placement(transformation(extent={{38,40},{58,60}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        hormoneFlowConstant_mmol_per_hour(k=6.666666666666799e-007)
        annotation (Placement(transformation(extent={{8,66},{16,74}})));
        Factors.Y2 y2_D_(affinity=90, Y_Max=1)
          annotation (Placement(transformation(extent={{-6,-62},{14,-42}})));
        Factors.Y2 y2_Ca_(affinity=2.4, Y_Max=1)
          annotation (Placement(transformation(extent={{-6,-70},{14,-50}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        hormoneFlowConstant_mmol_per_hour1(k=1.6666666666667e-005)
        annotation (Placement(transformation(extent={{-8,-48},{0,-40}})));
        Modelica.Blocks.Math.Division CaT
          annotation (Placement(transformation(extent={{-28,-74},{-20,-66}})));
        Physiolibrary.Blocks.soluteMassConstant Ca_thr(
                                                 k=1.95)
          annotation (Placement(transformation(extent={{-84,-78},{-70,-64}})));
        Factors.Y2 y2_PTH_(affinity=3.85, Y_Max=1)
          annotation (Placement(transformation(extent={{-72,-96},{-52,-76}})));
        Physiomodel.Electrolytes.Calcium.CaGILumen CaGILumen
          annotation (Placement(transformation(extent={{-80,-12},{-60,8}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={-50,-2})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        hormoneFlowConstant_mmol_per_hour2(k=8.666666666666841e-006)
        annotation (Placement(transformation(extent={{8,34},{16,42}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        hormoneFlowConstant_mmol_per_hour3(k=1.6666666666667e-005)
        annotation (Placement(transformation(extent={{38,52},{46,60}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        hormoneFlowConstant_mmol_per_hour4(k=9.166666666667399e-007)
        annotation (Placement(transformation(extent={{6,2},{14,10}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst
        hormoneFlowConstant_mmol_per_hour5(k=3.50000000000007e-006)
        annotation (Placement(transformation(extent={{-6,-82},{2,-74}})));
        Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={-42,22})));
        Modelica.Blocks.Math.Gain mlTOlitre1(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={74,-82})));
      equation
        connect(CaPool.q_out, J_pu.q_in) annotation (Line(
            points={{-32,-2},{-12,-2},{-12,-88},{-2,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(J_pu.q_out, Bladder.q_out) annotation (Line(
            points={{14,-88},{90,-88}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(J_pb.q_out, CaBone.q_out)                             annotation (
            Line(
            points={{26,-34},{36,-34},{36,-2},{52,-2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(J_pb.q_in, CaPool.q_out) annotation (Line(
            points={{10,-34},{-12,-34},{-12,-2},{-32,-2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(gain.y, J_pb.soluteFlow) annotation (Line(
            points={{8.4,-24},{21.2,-24},{21.2,-30.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CaPool.soluteMass, gain.u) annotation (Line(
            points={{-32,-9.8},{-32,-24},{-0.8,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CaBone.q_out, J_bp.q_in)                              annotation (
            Line(
            points={{52,-2},{36,-2},{36,-8},{26,-8}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(J_bp.q_out, CaPool.q_out)  annotation (Line(
            points={{10,-8},{-12,-8},{-12,-2},{-32,-2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.Calcitriol, y2_D.u) annotation (Line(
            points={{-88,78},{-8,78},{-8,64},{10.2,64}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(CaBone.soluteMass, y2_Ca.u)                             annotation (
            Line(
            points={{52,-9.4},{52,-16},{64,-16},{64,32},{27.8,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.PTH, y1_PTH.u) annotation (Line(
            points={{-88,78},{-8,78},{-8,50},{38.2,50}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(hormoneFlowConstant_mmol_per_hour.y, y2_D.yBase) annotation (Line(
            points={{17,70},{20,70},{20,66}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.Calcitriol,y2_D_. u) annotation (Line(
            points={{-88,78},{-88,-52},{-5.8,-52}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(y2_D_.y,y2_Ca_. yBase) annotation (Line(
            points={{4,-56},{4,-58}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant_mmol_per_hour1.y,y2_D_. yBase) annotation (Line(
            points={{1,-44},{4,-44},{4,-50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.PTH, y2_PTH_.u)
                                            annotation (Line(
            points={{-88,78},{-88,-86},{-71.8,-86}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Ca_thr.y, y2_PTH_.yBase) annotation (Line(
            points={{-69.3,-71},{-62,-71},{-62,-84}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(y2_PTH_.y, CaT.u1) annotation (Line(
            points={{-62,-90},{-62,-94},{-44,-94},{-44,-67.6},{-28.8,-67.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CaGILumen.q_out, CaPool.q_out) annotation (Line(
            points={{-60,-2},{-32,-2}},
            color={200,0,0},
            pattern=LinePattern.None,
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector,CaGILumen. busConnector) annotation (Line(
            points={{-88,78},{-88,6},{-78.6,6}},
            color={0,0,255},
            pattern=LinePattern.None,
            thickness=0.5,
            smooth=Smooth.None));
        connect(CaPool.q_out, concentrationMeasure.q_in) annotation (Line(
            points={{-32,-2},{-50,-2}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, y2_Ca_.u) annotation (Line(
          points={{-50,-6},{-50,-60},{-5.8,-60}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(concentrationMeasure.concentration, CaT.u2) annotation (Line(
          points={{-50,-6},{-50,-72.4},{-28.8,-72.4}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(hormoneFlowConstant_mmol_per_hour2.y, y2_Ca.yBase) annotation (
            Line(
            points={{17,38},{18,38},{18,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant_mmol_per_hour3.y, y1_PTH.yBase) annotation (
           Line(
            points={{47,56},{48,56},{48,52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant_mmol_per_hour4.y, J_bp.soluteFlow)
          annotation (Line(
            points={{15,6},{14.8,6},{14.8,-4.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(hormoneFlowConstant_mmol_per_hour5.y, J_pu.soluteFlow)
          annotation (Line(
            points={{3,-78},{9.2,-78},{9.2,-84.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(mlTOlitre.y, CaPool.SolventVolume) annotation (Line(
            points={{-42,17.6},{-42,6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.ECFV_Vol, mlTOlitre.u) annotation (Line(
            points={{-88,78},{-42,78},{-42,26.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(mlTOlitre1.y, Bladder.solutionVolume) annotation (Line(
          points={{78.4,-82},{82,-82},{82,-84},{86,-84}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.BladderVolume_Mass, mlTOlitre1.u) annotation (Line(
            points={{-88,78},{69.2,78},{69.2,-82}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        annotation ( uses);
      end Calcium;

      package Factors "Multiplication Effect Types"

        model Y1
         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));
         parameter Real a;
         parameter Real b;
         parameter Real d;
         parameter Real affinity;
         parameter Real Y_Max;
         parameter Boolean positive "+1 or -1";
          Modelica.Blocks.Math.Product product annotation (Placement(transformation(
                extent={{-10,-10},{10,10}},
                rotation=270,
                origin={0,-32})));
          Real effect;
          Modelica.Blocks.Math.Tanh tanh
            annotation (Placement(transformation(extent={{-34,54},{-14,74}})));
          Modelica.Blocks.Math.Add add(k1=+1)  annotation (Placement(transformation(
                extent={{-4,-4},{4,4}},
                rotation=270,
                origin={-4,16})));
          Modelica.Blocks.Math.Feedback feedback
            annotation (Placement(transformation(extent={{-74,54},{-54,74}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=
              affinity)
          annotation (Placement(transformation(extent={{-76,44},{-68,52}})));
          Modelica.Blocks.Math.Gain gain(k=b)
            annotation (Placement(transformation(extent={{-50,60},{-42,68}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=1)
          annotation (Placement(transformation(extent={{-20,20},{-12,28}})));
          Modelica.Blocks.Math.Gain gain1(k=a) annotation (Placement(transformation(
                extent={{-4,-4},{4,4}},
                rotation=270,
                origin={-4,4})));
          Modelica.Blocks.Math.Add add1(k1=+1) annotation (Placement(transformation(
                extent={{-4,-4},{4,4}},
                rotation=270,
                origin={-6,-10})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant2(k=d)
          annotation (Placement(transformation(extent={{-22,-6},{-14,2}})));
          Modelica.Blocks.Math.BooleanToReal booleanToReal(realFalse=-1)
            annotation (Placement(transformation(extent={{-22,36},{-10,48}})));
          Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=positive)
            annotation (Placement(transformation(extent={{-38,38},{-30,46}})));
          Modelica.Blocks.Math.Product product1 annotation (Placement(transformation(
                extent={{-4,-4},{4,4}},
                rotation=270,
                origin={-2,30})));
        equation
          effect = add1.y;
          connect(yBase, product.u1) annotation (Line(
              points={{6,80},{6,30},{6,-20},{6,-20}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(product.y, y) annotation (Line(
              points={{-2.02067e-015,-43},{-2.02067e-015,-55.5},{0,-55.5},{0,
                  -60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Constant.y, feedback.u2) annotation (Line(
              points={{-67.6,48},{-64,48},{-64,56}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(u, feedback.u1) annotation (Line(
              points={{-98,64},{-72,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(feedback.y, gain.u) annotation (Line(
              points={{-55,64},{-50.8,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(gain.y, tanh.u) annotation (Line(
              points={{-41.6,64},{-36,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Constant1.y, add.u2) annotation (Line(
              points={{-11.6,24},{-6.4,24},{-6.4,20.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(add.y, gain1.u) annotation (Line(
              points={{-4,11.6},{-4,10.9},{-4,10.9},{-4,10.2},{-4,8.8},{-4,8.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Constant2.y, add1.u2) annotation (Line(
              points={{-13.6,-2},{-8.4,-2},{-8.4,-5.2}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(gain1.y, add1.u1) annotation (Line(
              points={{-4,-0.4},{-4,-5.2},{-3.6,-5.2}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(booleanConstant.y, booleanToReal.u) annotation (Line(
              points={{-29.6,42},{-23.2,42}},
              color={255,0,255},
              smooth=Smooth.None));
          connect(product1.y, add.u1) annotation (Line(
              points={{-2,25.6},{-2,20.8},{-1.6,20.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(booleanToReal.y, product1.u2) annotation (Line(
              points={{-9.4,42},{-4.4,42},{-4.4,34.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(tanh.y, product1.u1) annotation (Line(
              points={{-13,64},{0.4,64},{0.4,34.8}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(add1.y, product.u2) annotation (Line(
              points={{-6,-14.4},{-6,-15.8},{-6,-15.8},{-6,-17.2},{-6,-20},{-6,
                  -20}},
              color={0,0,127},
              smooth=Smooth.None));
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end Y1;

        model Y2
         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));
         parameter Real affinity;
         parameter Real Y_Max;
          Modelica.Blocks.Math.Product product annotation (Placement(transformation(
                extent={{-10,-10},{10,10}},
                rotation=270,
                origin={0,-32})));
          Real effect;
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=
              affinity)
          annotation (Placement(transformation(extent={{-76,48},{-68,56}})));
          Modelica.Blocks.Math.Add add2(
                                       k1=+1)  annotation (Placement(transformation(
                extent={{-4,-4},{4,4}},
                origin={-58,62})));
          Modelica.Blocks.Math.Division division
            annotation (Placement(transformation(extent={{-36,58},{-16,78}})));
        equation
          effect = division.y;
          connect(yBase, product.u1) annotation (Line(
              points={{6,80},{6,30},{6,-20},{6,-20}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(product.y, y) annotation (Line(
              points={{-2.02067e-015,-43},{-2.02067e-015,-55.5},{0,-55.5},{0,
                  -60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(u, add2.u1) annotation (Line(
              points={{-98,64},{-84,64},{-84,64.4},{-62.8,64.4}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(Constant.y, add2.u2) annotation (Line(
              points={{-67.6,52},{-66,52},{-66,59.6},{-62.8,59.6}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(add2.y, division.u2) annotation (Line(
              points={{-53.6,62},{-38,62}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(u, division.u1) annotation (Line(
              points={{-98,64},{-76,64},{-76,74},{-38,74}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(division.y, product.u2) annotation (Line(
              points={{-15,68},{-6,68},{-6,-20}},
              color={0,0,127},
              smooth=Smooth.None));
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end Y2;

        model Y3
         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));
         parameter Real k;

          Modelica.Blocks.Math.Product product annotation (Placement(transformation(
                extent={{-10,-10},{10,10}},
                rotation=270,
                origin={0,-32})));
          Real effect;
          Modelica.Blocks.Math.Gain gain
            annotation (Placement(transformation(extent={{-54,54},{-34,74}})));
        equation
          effect = add1.y;
          connect(yBase, product.u1) annotation (Line(
              points={{6,80},{6,30},{6,-20},{6,-20}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(product.y, y) annotation (Line(
              points={{-2.02067e-015,-43},{-2.02067e-015,-55.5},{0,-55.5},{0,
                  -60}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(u, gain.u) annotation (Line(
              points={{-98,64},{-56,64}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(gain.y, product.u2) annotation (Line(
              points={{-33,64},{-6,64},{-6,-20}},
              color={0,0,127},
              smooth=Smooth.None));
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end Y3;

        model Y4
         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));

          Modelica.Blocks.Math.Product product annotation (Placement(transformation(
                extent={{-10,-10},{10,10}},
                rotation=270,
                origin={0,-32})));
          Real effect;
        equation
          effect = add1.y;
          connect(yBase, product.u1) annotation (Line(
              points={{6,80},{6,30},{6,-20},{6,-20}},
              color={0,0,127},
              smooth=Smooth.None));
          connect(product.y, y) annotation (Line(
              points={{-2.02067e-015,-43},{-2.02067e-015,-55.5},{0,-55.5},{0,
                  -60}},
              color={0,0,127},
              smooth=Smooth.None));
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end Y4;
      end Factors;

      model CaBone
        extends Physiomodel.Metabolism.deprecated.MolarStorageCompartment;
        extends Physiolibrary.Icons.Bone;
      end CaBone;

      model CaGILumen
        extends Physiolibrary.Icons.GILumen;
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
          Placement(transformation(extent={{90,-10},{110,10}}),
            iconTransformation(extent={{90,-10},{110,10}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-96,70},{-76,90}}), iconTransformation(
              extent={{-96,70},{-76,90}})));
      Physiolibrary.Chemical.Components.Diffusion resistorWithCondParam(
          Conductance=(0.0002)*(1e-6)/60)
        annotation (Placement(transformation(extent={{38,-10},{58,10}})));
        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          GILumen(
            concentration=0.21/0.0002 + 2.4)
          annotation (Placement(transformation(extent={{-24,-10},{-4,10}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-50,30},{-30,50}})));
        CaTransportPool caTransportPool
          annotation (Placement(transformation(extent={{-28,-60},{-8,-40}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={-52,-4})));
      Physiolibrary.Chemical.Components.SolutePump soluteFlowPump(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{40,-18},{60,-38}})));
        Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={-36,8})));
      equation
        connect(resistorWithCondParam.q_out, q_out) annotation (Line(
            points={{58,0},{100,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(GILumen.q_out, resistorWithCondParam.q_in) annotation (Line(
            points={{-14,0},{39.4,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(inputPump.q_out, GILumen.q_out) annotation (Line(
            points={{-34,40},{-14,40},{-14,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(busConnector.Diet_Ca_Intake, inputPump.soluteFlow) annotation (
          Line(
          points={{-86,80},{-36,80},{-36,44}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
        connect(busConnector.Calcitriol, caTransportPool.Calcitriol) annotation (Line(
            points={{-86,80},{-86,-44},{-26,-44}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(GILumen.q_out, concentrationMeasure.q_in) annotation (Line(
            points={{-14,0},{-52,0},{-52,-4}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, caTransportPool.CaIntestinal)
        annotation (Line(
          points={{-52,-8},{-52,-52},{-26,-52}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(GILumen.q_out, soluteFlowPump.q_in) annotation (Line(
            points={{-14,0},{14,0},{14,-28},{40,-28}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(soluteFlowPump.q_out, q_out) annotation (Line(
            points={{60,-28},{80,-28},{80,0},{100,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(caTransportPool.J_ipCa_activeAbsorbtion, soluteFlowPump.soluteFlow)
          annotation (Line(
            points={{-8,-50},{54,-50},{54,-32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(mlTOlitre.y, GILumen.SolventVolume) annotation (Line(
            points={{-31.6,8},{-24,8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.GILumenVolume_Mass, mlTOlitre.u) annotation (Line(
            points={{-86,80},{-86,8},{-40.8,8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{-108,-110},{104,-130}},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid,
                textString="%name",
                lineColor={0,0,127})}));
      end CaGILumen;

      block CaTransportPool

        Modelica.Blocks.Interfaces.RealInput Calcitriol
                                                 annotation (Placement(transformation(
                extent={{-100,40},{-60,80}}), iconTransformation(extent={{-100,40},{-60,
                  80}})));
        Modelica.Blocks.Interfaces.RealInput CaIntestinal
                                                   annotation (Placement(
              transformation(extent={{-104,-26},{-64,14}}), iconTransformation(extent=
                 {{-100,-40},{-60,0}})));
        Modelica.Blocks.Interfaces.RealOutput J_ipCa_activeAbsorbtion
                                                               annotation (Placement(
              transformation(extent={{80,-20},{120,20}}), iconTransformation(extent={{
                  80,-20},{120,20}})));
        parameter Real Q_TCai_initial = 0;
        parameter Real Y2_Cai_Max = 1;

        Real Q_TCai;
        Real change;
        Real k1D;
        Real k2D;
        Factors.Y2 Y2_Cai(affinity=1, Y_Max=Y2_Cai_Max)
          annotation (Placement(transformation(extent={{-34,-16},{-14,4}})));
      initial equation
        Q_TCai = Q_TCai_initial;
      equation
        der( Q_TCai)  = change;
        change = ( 1-Q_TCai)  * k1D - Q_TCai * k2D;
        Y2_Cai.yBase = change*Y2_Cai_Max;
        J_ipCa_activeAbsorbtion = Y2_Cai.y;

        k1D = 0.02;
        k2D = 0.02;

        connect(CaIntestinal, Y2_Cai.u) annotation (Line(
            points={{-84,-6},{-33.8,-6}},
            color={0,0,127},
            smooth=Smooth.None));
      end CaTransportPool;

      model Bladder
        extends Physiolibrary.Chemical.Components.Substance(useNormalizedVolume=
           false);
        extends Physiolibrary.Icons.Bladder(useNormalizedVolume=false);
      equation

      end Bladder;

      package test
        model T
          Calcium calcium
            annotation (Placement(transformation(extent={{10,-14},{30,6}})));
          setup.CaInputs caInputs
            annotation (Placement(transformation(extent={{-54,-12},{-34,8}})));
        equation
          connect(caInputs.busConnector, calcium.busConnector) annotation (Line(
              points={{-51.8,6.8},{-19.9,6.8},{-19.9,3.8},{11.2,3.8}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T;

        model T2
          Calcitriol calcitriol
            annotation (Placement(transformation(extent={{-2,6},{18,26}})));
          setup.CalcitriolInputs calcitriolInputs
            annotation (Placement(transformation(extent={{-60,6},{-40,26}})));
        equation
          connect(calcitriolInputs.busConnector, calcitriol.busConnector)
            annotation (Line(
              points={{-57.8,24.8},{-31.9,24.8},{-31.9,24.4},{-0.8,24.4}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T2;
      end test;

      package setup
        model CaInputs

        Physiolibrary.Types.BusConnector busConnector
          annotation (Placement(transformation(extent={{-88,78},{-68,98}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant ECFV_Vol(units=
              "ml", k=13000)
          annotation (Placement(transformation(extent={{-68,46},{-60,54}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Calcitriol(k=90)
          annotation (Placement(transformation(extent={{-68,70},{-60,78}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant PTH(k=3.85)
          annotation (Placement(transformation(extent={{-68,58},{-60,66}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass(units="ml", k=10)
          annotation (Placement(transformation(extent={{-68,32},{-60,40}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass1(units="ml", k=1000)
          annotation (Placement(transformation(extent={{-68,18},{-60,26}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass2(units="ml", k=0.21)
          annotation (Placement(transformation(extent={{-68,4},{-60,12}})));
        equation
          connect(busConnector.ECFV_Vol, ECFV_Vol.y) annotation (Line(
              points={{-78,88},{2,88},{2,50},{-59.6,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.BladderVolume_Mass, BladderVolume_Mass.y) annotation (
              Line(
              points={{-78,88},{2,88},{2,36},{-59.6,36}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.Calcitriol, Calcitriol.y) annotation (Line(
              points={{-78,88},{2,88},{2,74},{-59.6,74}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.PTH, PTH.y) annotation (Line(
              points={{-78,88},{2,88},{2,62},{-59.6,62}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(BladderVolume_Mass1.y, busConnector.GILumenVolume_Mass)
            annotation (Line(
              points={{-59.6,22},{2,22},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(BladderVolume_Mass2.y, busConnector.Diet_Ca_Intake)
            annotation (Line(
              points={{-59.6,8},{2,8},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end CaInputs;

        model CalcitriolInputs

        Physiolibrary.Types.BusConnector busConnector
          annotation (Placement(transformation(extent={{-88,78},{-68,98}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant ECFV_Vol(units=
              "ml", k=13000)
          annotation (Placement(transformation(extent={{-68,46},{-60,54}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant PTH(k=3.85)
          annotation (Placement(transformation(extent={{-68,58},{-60,66}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass(units="ml", k=10)
          annotation (Placement(transformation(extent={{-68,32},{-60,40}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass1(units="ml", k=1000)
          annotation (Placement(transformation(extent={{-68,18},{-60,26}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass2(units="ml", k=0.21)
          annotation (Placement(transformation(extent={{-68,4},{-60,12}})));
        equation
          connect(busConnector.ECFV_Vol, ECFV_Vol.y) annotation (Line(
              points={{-78,88},{2,88},{2,50},{-59.6,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.BladderVolume_Mass, BladderVolume_Mass.y) annotation (
              Line(
              points={{-78,88},{2,88},{2,36},{-59.6,36}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.PTH, PTH.y) annotation (Line(
              points={{-78,88},{2,88},{2,62},{-59.6,62}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(BladderVolume_Mass1.y, busConnector.GILumenVolume_Mass)
            annotation (Line(
              points={{-59.6,22},{2,22},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(BladderVolume_Mass2.y, busConnector.Diet_Ca_Intake)
            annotation (Line(
              points={{-59.6,8},{2,8},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end CalcitriolInputs;
      end setup;

      model Calcitriol
      Physiolibrary.Types.BusConnector busConnector
        annotation (Placement(transformation(extent={{-98,74},{-78,94}})));
        Physiolibrary.Molar.ConcentrationCompartment_knownConc
          concentrationCompartment(concentration=90)
          annotation (Placement(transformation(extent={{10,-68},{30,-48}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-46,-68},{-26,-48}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut outputPump(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{48,-68},{68,-48}})));
        Modelica.Blocks.Math.Gain gain(k=0.1) annotation (Placement(
              transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={58,-44})));
      Physiolibrary.Chemical.Components.Substance hydroxylase(
          useNormalizedVolume=false, solute_start=(117)/1000)
        annotation (Placement(transformation(extent={{-46,-26},{-26,-6}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump1(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-96,-26},{-76,-6}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut outputPump1(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-10,-26},{10,-6}})));
        Modelica.Blocks.Math.Gain gain1(k=0.05) annotation (Placement(
              transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={0,-2})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=5.85)
        annotation (Placement(transformation(extent={{-100,-8},{-92,0}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(extent={{18,-44},{38,-24}})));
        Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={0,-50})));
        Modelica.Blocks.Math.Gain mlTOlitre1(
                                            k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={-54,-10})));
      equation
        connect(inputPump.q_out, concentrationCompartment.q_out) annotation (
            Line(
            points={{-30,-58},{20,-58}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(concentrationCompartment.q_out, outputPump.q_in) annotation (
            Line(
            points={{20,-58},{52,-58}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(gain.y, outputPump.soluteFlow) annotation (Line(
          points={{58,-48.4},{58,-54}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(concentrationCompartment.soluteMass, gain.u) annotation (Line(
            points={{20,-65.8},{20,-78},{38,-78},{38,-34},{58,-34},{58,-39.2}},
            color={0,0,127},
            smooth=Smooth.None));

      connect(gain1.y, outputPump1.soluteFlow) annotation (Line(
          points={{-8.08267e-016,-6.4},{-8.08267e-016,-10},{0,-10},{0,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hydroxylase.solute, gain1.u) annotation (Line(
          points={{-36,-23.8},{-36,-30},{-12,-30},{-12,8},{8.81746e-016,8},{
              8.81746e-016,2.8}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(hydroxylase.q_out, outputPump1.q_in) annotation (Line(
            points={{-36,-16},{-6,-16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(inputPump1.q_out, hydroxylase.q_out) annotation (Line(
            points={{-80,-16},{-36,-16}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(hydroxylase.solute, inputPump.soluteFlow) annotation (Line(
          points={{-36,-23.8},{-36,-54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, inputPump1.soluteFlow) annotation (Line(
          points={{-91.6,-4},{-86,-4},{-86,-12}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(concentrationCompartment.q_out, concentrationMeasure.q_in)
          annotation (Line(
            points={{20,-58},{28,-58},{28,-34}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, busConnector.Calcitriol)
        annotation (Line(
          points={{28,-30},{28,84},{-88,84}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        connect(mlTOlitre.y, concentrationCompartment.SolventVolume)
          annotation (Line(
            points={{4.4,-50},{10,-50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.ECFV_Vol, mlTOlitre.u) annotation (Line(
            points={{-88,84},{-18,84},{-18,-50},{-4.8,-50}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(mlTOlitre1.y, hydroxylase.solutionVolume) annotation (Line(
          points={{-49.6,-10},{-44,-10}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.ECFV_Vol, mlTOlitre1.u) annotation (Line(
            points={{-88,84},{-68,84},{-68,-10},{-58.8,-10}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      end Calcitriol;
      annotation (Documentation(info="<html>
<p>J.F.Raposo,L.G.Sobrinho,and H.G.Ferreira: A Minimal Mathematical Model of Calcium Homeostasis,JCE&AMP;M,sep2002,87(9)</p>
</html>"));
    end Calcium;

    package Calcium2
      model Calcium

      parameter Real D[:] = {1};
      parameter Real GFR(displayUnit="l/h")=6;

      Real A[11];
      Real v_intake;
      Real v1_4;
      Real v4_u;

      function H
        input Real x;
        input Real alpha;
        input Real delta;
        input Real gamma=1;
        output Real value;
      algorithm
        value:=alpha*x^gamma/(delta^gamma+x^gamma);
      end H;

      function H_minus
        input Real x;
        input Real alpha;
        input Real delta;
        input Real gamma=1;
        input Real ro;
        output Real value;
      algorithm
        value:=alpha-(alpha-ro)*x^gamma/(delta^gamma+x^gamma);
      end H_minus;

      function H_plus
        input Real x;
        input Real alpha;
        input Real delta;
        input Real gamma=1;
        input Real ro;
        output Real value;
      algorithm
        value:=ro+(alpha-ro)*x^gamma/(delta^gamma+x^gamma);
      end H_plus;

      Real H62p;
      Real H62m;
      Real v1_4a;
      Real v1_4p;
      Real T64p;
      Real T64m;
      Real a;
      Real b;
      Real c;

      parameter Real ECFV(displayUnit="l") = 32.9/2.4;
      parameter Real ECFV2(displayUnit="l") = 1260/90;
      parameter Real GILumenVolume(displayUnit="l") = 1.3;

      initial equation
        A[1] = 1.3;  //Ca gut
        A[2] = 0.5;   //Ca transporters
        A[3] = 0.839;
        A[4] = 32.9; //Ca pool
        A[5] = 16.8;
        A[6] = 1260;
        A[7] = 53.9;
        A[8] = 3226;
        A[9] = 126;
        A[10] = 0.5;
        A[11] = 1;
      equation
      //gut
      v_intake = D[1] * H_plus(A[2],0.9,0.75,4,0.25); //alpha was calculated == 0.35
      der( A[1])  = v_intake - v1_4;
      v1_4 = v1_4a + v1_4p;
      v1_4a = (H(A[1]/GILumenVolume,0.9,1,1) * (A[2]/0.5) / (A[1] + 0.75)) * A[1];
      v1_4p = (0.0495) * A[1];

      //transporters
      H62p = H_plus(A[6]/ECFV2,0.037,90,1,0.003);
      H62m = H_minus(A[6]/ECFV2,0.037,90,1,0.003);
      der( A[2])  = H62p*(1-A[2])- H62m*A[2];

      //Ca pool
      der(A[4]) = 0; //v1_4 - v4_u;

      //to urine
      v4_u = (2-H(A[6]/ECFV2,2,90,1)) * (0.3*GFR*A[4] - H(A[4]/ECFV2,(-0.38+59.22)/0.317936,1.573,1)*H(A[7]/ECFV2,1.0615,53.9/ECFV2,1));
      //!!it's used concentration of ecf Ca, not the mass such as in the article!!, H_4-u:alpha was calculated, H7,4-u:delta was assumed as normal ecf PTH concentration
      //a = (2-H(A[6]/ECFV2,2,90,1)) * (0.3*GFR*A[4]);
      //b = (2-H(A[6]/ECFV2,2,90,1)) * (H(A[4]/ECFV2,1,1.573,1)*H(A[7]/ECFV2,1.0615,53.9/ECFV2,1));
      //v4_u = v1_4;

      //calcitriol
      der( A[6])  = A[9] -0.1 *A[6];
      der( A[9])  = 6.3*H(A[7]/ECFV2, 1.90371, 1.549,0.1112)*( if A[5]<=16.8 then 1 else H_minus(A[5]/ECFV2,1.525,1.302,8.252,-1.78249))  -0.05 *A[9]; //H7,9:alpha was calculated,
      //a = 6.3*H(A[7]/ECFV2, 1.90371 ,1.549,0.1112);
      //c =  if A[5]<16.8 then 1 else H_minus(A[5]/ECFV2,1.525,1.302,8.252,1.181);
      //b = 0.05 *A[9];

      //PTH
      der( A[7])  =  H_minus(A[4]/ECFV2,96.25, 3.037, 11.74,6249)*(A[10]/0.5)*A[11] - 7.143*A[7];
      a= H_minus(A[4]/ECFV2,96.25, 3.037, 11.74,6249)*(A[10]/0.5)*A[11];
      b=7.143*A[7];
      c=b/((A[10]/0.5)*A[11]);

      der( A[10])  = (1-A[10])*0.01*(0.85*T64m+0.15) - A[10]*0.01*(0.85*T64p+0.15);
      T64m = 1-(exp(0.03*(A[6]/14 - 90*(32.9/A[4]))) - exp(-0.03*(A[6]/14 - 90*(32.9/A[4])))) / (exp(0.03*(A[6]/14 - 90*(32.9/A[4]))) + exp(-0.03*(A[6]/14 - 90*(32.9/A[4]))));
      T64p = 1+(exp(0.03*(A[6]/14 - 90*(32.9/A[4]))) - exp(-0.03*(A[6]/14 - 90*(32.9/A[4])))) / (exp(0.03*(A[6]/14 - 90*(32.9/A[4]))) + exp(-0.03*(A[6]/14 - 90*(32.9/A[4]))));

      der( A[11])  =0.0001604  *H_minus(A[6]/ECFV2,4.103,69,12.5,0.9) -0.0001604*A[11];

      //phosphate
      der(A[3])=0;
      der(A[5])=0;
      der(A[8])=0;
      end Calcium;

      package Factors
        model H

         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));
         parameter Real alpha "maximum responce";
         parameter Real delta "affinity";
         parameter Real gamma=1 "exponent";
          Real effect;

        equation
          effect = alpha*u^gamma/(delta^gamma+u^gamma);
          y = effect * yBase;
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end H;

        model H_plus
         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));
         parameter Real alpha "maximum responce";
         parameter Real delta "affinity";
         parameter Real gamma=1 "exponent";
         parameter Real ro "minimum responce";
          Real effect;

        equation
          effect = ro+(alpha-ro)*u^gamma/(delta^gamma+u^gamma);
          y = effect * yBase;
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end H_plus;

        model H_minus
         extends Physiolibrary.Icons.BaseFactorIcon3;
         Modelica.Blocks.Interfaces.RealInput u
                      annotation (Placement(transformation(extent={{-118,44},{-78,
                    84}}),
                iconTransformation(extent={{-108,-10},{-88,10}})));
         parameter Real alpha "maximum responce";
         parameter Real delta "affinity";
         parameter Real gamma=1 "exponent";
         parameter Real ro "minimum responce";
          Real effect;

        equation
          effect = alpha-(alpha-ro)*u^gamma/(delta^gamma+u^gamma);
          y = effect * yBase;
          annotation ( Documentation(revisions="<html>
<p><i>2009-2010</i></p>
<p>Marek Matejak, Charles University, Prague, Czech Republic </p>
</html>"));
        end H_minus;
      end Factors;

      model CaGILumen
      import Physiomodel;
        extends Physiolibrary.Icons.GILumen;
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
          Placement(transformation(extent={{90,-10},{110,10}}),
            iconTransformation(extent={{90,-10},{110,10}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-96,70},{-76,90}}), iconTransformation(
              extent={{-96,70},{-76,90}})));
      Physiolibrary.Chemical.Components.Substance GILumen(useNormalizedVolume=
            false, solute_start=(1.3)/1000)
        annotation (Placement(transformation(extent={{-24,-4},{-4,16}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{-50,30},{-30,50}})));
      Physiolibrary.Chemical.Components.SolutePump v_1to4_active(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{32,0},{52,20}})));
        Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={-36,12})));
        Physiomodel.Electrolytes.Calcium2.Factors.H_plus H21_plus(
          delta=0.75,
          gamma=4,
          ro=0.25,
          alpha=1.0805625)
          annotation (Placement(transformation(extent={{-30,38},{-50,58}})));
      Physiolibrary.Chemical.Components.SolutePump v_1to4_passive(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{32,-8},{52,-28}})));
        Modelica.Blocks.Math.Gain k_1to4(k=0.0495)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={30,-36})));
        Physiomodel.Electrolytes.Calcium2.Factors.H d21(alpha=2, delta=0.75)
          annotation (Placement(transformation(extent={{32,12},{52,32}})));
      Physiomodel.Metabolism.deprecated.MolarStorageCompartment CaTransporters(
          initialSoluteMass=0.5)
        annotation (Placement(transformation(extent={{32,50},{52,70}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump1(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{10,50},{30,70}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut inputPump2(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{74,50},{94,70}})));
        Physiomodel.Electrolytes.Calcium2.Factors.H_plus H62_plus(
          alpha=0.037,
          delta=90,
          ro=0.003)
          annotation (Placement(transformation(extent={{10,58},{30,78}})));
        Physiomodel.Electrolytes.Calcium2.Factors.H_minus H62_minus(
          alpha=0.037,
          delta=90,
          ro=0.003)
          annotation (Placement(transformation(extent={{74,58},{94,78}})));
        Modelica.Blocks.Math.Feedback feedback annotation (Placement(
              transformation(
              extent={{6,-6},{-6,6}},
              rotation=90,
              origin={20,80})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=1)
        annotation (Placement(transformation(extent={{8,90},{16,98}})));
        Physiomodel.Electrolytes.Calcium2.Factors.H H1to4(alpha=0.9, delta=1)
          annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={42,30})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={10,30})));
      equation
        connect(inputPump.q_out, GILumen.q_out) annotation (Line(
            points={{-30,40},{-14,40},{-14,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(GILumen.q_out, v_1to4_active.q_in)  annotation (Line(
            points={{-14,6},{10,6},{10,10},{32,10}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(v_1to4_active.q_out, q_out)  annotation (Line(
            points={{52,10},{80,10},{80,0},{100,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(mlTOlitre.y, GILumen.solutionVolume) annotation (Line(
          points={{-31.6,12},{-24,12},{-24,10},{-18,10}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.GILumenVolume_Mass, mlTOlitre.u) annotation (Line(
            points={{-86,80},{-86,12},{-40.8,12}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.Diet_Ca_Intake, H21_plus.yBase) annotation (Line(
            points={{-86,80},{-86,50},{-40,50}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(H21_plus.y, inputPump.soluteFlow) annotation (Line(
          points={{-40,44},{-36,44}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(GILumen.q_out, v_1to4_passive.q_in) annotation (Line(
            points={{-14,6},{10,6},{10,-18},{32,-18}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(v_1to4_passive.q_out, q_out) annotation (Line(
            points={{52,-18},{80,-18},{80,0},{100,0}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(GILumen.solute, k_1to4.u) annotation (Line(
          points={{-14,-4},{-14,-36},{25.2,-36}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(k_1to4.y, v_1to4_passive.soluteFlow) annotation (Line(
            points={{34.4,-36},{46,-36},{46,-22}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(GILumen.solute, d21.u) annotation (Line(
          points={{-14,-4},{-14,-18},{4,-18},{4,22},{32.2,22}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(d21.y, v_1to4_active.soluteFlow) annotation (Line(
            points={{42,18},{42,16},{42,14},{46,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(inputPump1.q_out, CaTransporters.q_out) annotation (Line(
            points={{26,60},{42,60}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(CaTransporters.q_out, inputPump2.q_in) annotation (Line(
            points={{42,60},{78,60}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(H62_plus.y, inputPump1.soluteFlow) annotation (Line(
          points={{20,64},{24,64}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(H62_minus.y, inputPump2.soluteFlow) annotation (Line(
          points={{84,64},{88,64}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.Calcitriol, H62_plus.u) annotation (Line(
            points={{-86,80},{-86,100},{-10,100},{-10,68},{10.2,68}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.Calcitriol, H62_minus.u) annotation (Line(
            points={{-86,80},{-86,100},{56,100},{56,68},{74.2,68}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(CaTransporters.soluteMass, H21_plus.u) annotation (Line(
            points={{42,52.6},{42,48},{-30.2,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CaTransporters.soluteMass, H62_minus.yBase) annotation (Line(
            points={{42,52.6},{42,48},{98,48},{98,80},{84,80},{84,70}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(feedback.y, H62_plus.yBase) annotation (Line(
            points={{20,74.6},{20,70}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(feedback.u2, CaTransporters.soluteMass) annotation (Line(
            points={{24.8,80},{98,80},{98,48},{42,48},{42,52.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant.y, feedback.u1) annotation (Line(
            points={{17,94},{20,94},{20,84.8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CaTransporters.soluteMass, H1to4.yBase) annotation (Line(
            points={{42,52.6},{42,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H1to4.y, d21.yBase) annotation (Line(
            points={{42,26},{42,24}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, H1to4.u) annotation (Line(
          points={{14,30},{32.2,30}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(GILumen.q_out, concentrationMeasure.q_in) annotation (Line(
            points={{-14,6},{8,6},{8,30}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{-108,-110},{104,-130}},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid,
                textString="%name",
                lineColor={0,0,127})}));
      end CaGILumen;

      model Ca
      import Physiomodel;
      Physiomodel.Electrolytes.Calcium.Bladder Bladder(useNormalizedVolume=
            false, solute_start=(0)/1000)
        annotation (Placement(transformation(extent={{-64,-80},{-44,-60}})));
        Modelica.Blocks.Math.Gain mlTOlitre1(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={-72,-64})));
      Physiolibrary.Chemical.Components.Substance CaPool(
        stateName="CaPool.Mass",
        useNormalizedVolume=false,
        solute_start=(33592.71023539913)/1000)
        annotation (Placement(transformation(extent={{-44,-4},{-24,16}})));
        Modelica.Blocks.Math.Gain mlTOlitre(k=0.001)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={-54,14})));
      Physiolibrary.Types.BusConnector busConnector
        annotation (Placement(transformation(extent={{-88,78},{-68,98}})));
        Physiomodel.Electrolytes.Calcium2.CaGILumen intestine
          annotation (Placement(transformation(extent={{-76,44},{-56,64}})));
        Physiomodel.Electrolytes.Calcium2.CaKidneyExcretion kidney
          annotation (Placement(transformation(extent={{-64,-44},{-44,-24}})));
        Physiomodel.Electrolytes.Calcium2.Bone bone
          annotation (Placement(transformation(extent={{34,-4},{54,16}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure(
          unitsString="mmol/l") annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={-18,22})));
      equation
      connect(mlTOlitre1.y, Bladder.solutionVolume) annotation (Line(
          points={{-67.6,-64},{-62,-64}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.BladderVolume_Mass,mlTOlitre1. u) annotation (Line(
            points={{-78,88},{-80,88},{-80,-64},{-76.8,-64}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(mlTOlitre.y, CaPool.solutionVolume) annotation (Line(
          points={{-49.6,14},{-45.8,14},{-45.8,12},{-42,12}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(busConnector.ECFV_Vol,mlTOlitre. u) annotation (Line(
            points={{-78,88},{-80,88},{-80,14},{-58.8,14}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(intestine.q_out, CaPool.q_out) annotation (Line(
            points={{-56,54},{-28,54},{-28,6},{-34,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector, intestine.busConnector) annotation (Line(
            points={{-78,88},{-80,88},{-80,62},{-74.6,62}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(kidney.q_in, CaPool.q_out) annotation (Line(
            points={{-52,-34},{-38,-34},{-38,6},{-34,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector, kidney.busConnector) annotation (Line(
            points={{-78,88},{-80,88},{-80,-25},{-63,-25}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(kidney.q_out, Bladder.q_out) annotation (Line(
            points={{-52,-44},{-54,-44},{-54,-70}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(CaPool.q_out, bone.q_in) annotation (Line(
            points={{-34,6},{42,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector, bone.busConnector) annotation (Line(
            points={{-78,88},{36,88},{36,14.8}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(CaPool.q_out, concentrationMeasure.q_in) annotation (Line(
            points={{-34,6},{-28,6},{-28,22},{-18,22}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, busConnector.CaPool_conc_per_liter)
        annotation (Line(
          points={{-18,26},{-18,88},{-78,88}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      end Ca;

      model CaKidneyExcretion
        extends Physiolibrary.Icons.Kidney;
      Physiolibrary.Chemical.Components.Stream v_4to_u_glomerulalFiltration(
          useSolutionFlowInput=true)
        annotation (Placement(transformation(extent={{16,-84},{32,-68}})));
        Factors.H H4to_u(delta=1.573, alpha=12.0877126)
          annotation (Placement(transformation(extent={{14,-4},{34,16}})));
        Factors.H H7_4to_u(delta=53.9/14, alpha=1.0615)
          annotation (Placement(transformation(extent={{14,-12},{34,8}})));
        Factors.H_minus H64_minus(
          alpha=2,
          delta=90,
          ro=0)
          annotation (Placement(transformation(extent={{14,-74},{34,-54}})));
      Physiolibrary.Blocks.Factors.Normalization simpleMultiply
        annotation (Placement(transformation(extent={{14,-64},{34,-44}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=0.3)
        annotation (Placement(transformation(extent={{-4,-58},{4,-50}})));
      Physiolibrary.Chemical.Components.SolutePump v_4to_u_reabsorbtion(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(
            extent={{10,-10},{-10,10}},
            origin={24,-22})));
        Factors.H_minus H64_minus1(
          alpha=2,
          delta=90,
          ro=0) annotation (Placement(transformation(extent={{14,-20},{34,0}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=1)
        annotation (Placement(transformation(extent={{12,12},{20,20}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={-16,6})));
      Physiolibrary.Types.BusConnector busConnector
        annotation (Placement(transformation(extent={{-100,80},{-80,100}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
          Placement(transformation(extent={{-68,-2},{-48,20}}),
            iconTransformation(extent={{10,-10},{30,10}})));
      Physiolibrary.Chemical.Interfaces.ChemicalPort_b q_out annotation (
          Placement(transformation(extent={{10,-110},{30,-90}}),
            iconTransformation(extent={{10,-110},{30,-90}})));
        Modelica.Blocks.Math.Gain to_liters_per_hours(k=60/1000)
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={18,-42})));
      equation

        connect(busConnector.Calcitriol, H64_minus.u) annotation (Line(
            points={{-90,90},{-10,90},{-10,-64},{14.2,-64}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
      connect(H64_minus.y, v_4to_u_glomerulalFiltration.solutionFlow)
        annotation (Line(
          points={{24,-66},{24,-71.2}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(simpleMultiply.y, H64_minus.yBase) annotation (Line(
            points={{24,-56},{24,-62}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant.y, simpleMultiply.u) annotation (Line(
            points={{4.4,-54},{14.2,-54}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(v_4to_u_reabsorbtion.q_in, v_4to_u_glomerulalFiltration.q_out)
          annotation (Line(
            points={{34,-22},{40,-22},{40,-76},{32,-76}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(busConnector.Calcitriol, H64_minus1.u) annotation (Line(
            points={{-90,90},{-10,90},{-10,-10},{14.2,-10}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(H64_minus1.y, v_4to_u_reabsorbtion.soluteFlow) annotation (Line(
            points={{24,-12},{24,-16}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H7_4to_u.y, H64_minus1.yBase) annotation (Line(
            points={{24,-4},{24,-8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H4to_u.y, H7_4to_u.yBase) annotation (Line(
            points={{24,4},{24,0}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.PTH, H7_4to_u.u) annotation (Line(
            points={{-90,90},{-10,90},{-10,-2},{14.2,-2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(Constant1.y, H4to_u.yBase) annotation (Line(
            points={{20.4,16},{24,16},{24,8}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(concentrationMeasure.concentration, H4to_u.u) annotation (Line(
          points={{-12,6},{1.1,6},{1.1,6},{14.2,6}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(q_in, v_4to_u_reabsorbtion.q_out) annotation (Line(
            points={{-58,9},{-16,9},{-16,-22},{14,-22}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(q_in, concentrationMeasure.q_in) annotation (Line(
            points={{-58,9},{-16,9},{-16,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(q_in, v_4to_u_glomerulalFiltration.q_in) annotation (Line(
            points={{-58,9},{-16,9},{-16,-76},{16,-76}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(v_4to_u_glomerulalFiltration.q_out, q_out) annotation (Line(
            points={{32,-76},{40,-76},{40,-100},{20,-100}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(to_liters_per_hours.y, simpleMultiply.yBase) annotation (Line(
            points={{22.4,-42},{24,-42},{24,-52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.Glomerulus_GFR, to_liters_per_hours.u) annotation (
           Line(
            points={{-90,90},{-10,90},{-10,-42},{13.2,-42}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-112,120},{100,100}},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid,
                textString="%name",
                lineColor={0,0,127})}));
      end CaKidneyExcretion;

      model Bone
        extends Physiolibrary.Icons.Bone;
      Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (
          Placement(transformation(extent={{-70,-14},{-50,6}}),
            iconTransformation(extent={{-30,-10},{-10,10}})));
      Physiolibrary.Chemical.Components.SolutePump v_4to12(useSoluteFlowInput=
            true)
        annotation (Placement(transformation(extent={{-34,-4},{-14,16}})));
      Physiolibrary.Types.BusConnector busConnector
        annotation (Placement(transformation(extent={{-90,78},{-70,98}})));
      Physiomodel.Metabolism.deprecated.MolarStorageCompartment
        Ca_immediately_changeable(initialSoluteMass=100)
        annotation (Placement(transformation(extent={{8,-18},{28,2}})));
      Physiomodel.Metabolism.deprecated.MolarStorageCompartment
        Ca_nonimmediately_changeable(initialSoluteMass=249000)
        annotation (Placement(transformation(extent={{74,-18},{94,2}})));
      Physiolibrary.Chemical.Components.SolutePump flux1(useSoluteFlowInput=
            true)
        annotation (Placement(transformation(extent={{48,-12},{62,-26}})));
      Physiolibrary.Chemical.Components.SolutePump flux2(useSoluteFlowInput=
            true)
        annotation (Placement(transformation(extent={{62,-6},{48,8}})));
        Modelica.Blocks.Math.Gain k_12to13(k=1/(30*24))
        "\"assumed that all Ca immediatebly changable could become nonimmediately changable (if there is only one way of change) after one month\""
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              origin={46,-30})));
        Modelica.Blocks.Math.Gain k_13to12(k=(1/(30*24))*(100/249000))
        "\"value calculated from k_12to13\""
                                       annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=180,
              origin={66,14})));
      Physiolibrary.Chemical.Components.SolutePump v_12to4(useSoluteFlowInput=
            true)
        annotation (Placement(transformation(extent={{-14,-8},{-34,-28}})));

        model CalciumToBone

          Modelica.Blocks.Interfaces.RealInput Ca
                                           annotation (Placement(transformation(extent={
                    {-100,20},{-60,60}}), iconTransformation(extent={{-100,20},{-60,60}})));
          Modelica.Blocks.Interfaces.RealInput Osteoblast
                                                   annotation (Placement(transformation(
                  extent={{-100,-60},{-60,-20}}), iconTransformation(extent={{-100,-60},
                    {-60,-20}})));
          Modelica.Blocks.Interfaces.RealOutput fluxToBone
                                                    annotation (Placement(
                transformation(extent={{60,-20},{100,20}}), iconTransformation(extent={{
                    60,-20},{100,20}})));
        equation
          fluxToBone=3.667*Ca/2.35*(1-0.1144)+0.1144*(Osteoblast/0.00501324);
        end CalciumToBone;

        model CalciumFromBone

          Modelica.Blocks.Interfaces.RealInput RANK_RANKL
                                           annotation (Placement(transformation(extent={{-98,20},
                    {-58,60}}),           iconTransformation(extent={{-100,20},{-60,60}})));
          Modelica.Blocks.Interfaces.RealInput Osteoclast
                                                   annotation (Placement(transformation(
                  extent={{-98,-60},{-58,-20}}),  iconTransformation(extent={{-100,-60},
                    {-60,-20}})));
          Modelica.Blocks.Interfaces.RealOutput fluxToBone
                                                    annotation (Placement(
                transformation(extent={{62,-20},{102,20}}), iconTransformation(extent={{60,-20},
                    {100,20}})));
        equation

        end CalciumFromBone;

        CalciumToBone calciumToBone
          annotation (Placement(transformation(extent={{-34,40},{-14,20}})));
        CalciumFromBone calciumFromBone annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              origin={-24,-42})));
        Osteoblast osteoblast
          annotation (Placement(transformation(extent={{-34,58},{-14,78}})));
        Osteoclast osteoclast
          annotation (Placement(transformation(extent={{-34,-78},{-14,-58}})));
        RANK_RANKL RANK_RANKL_
          annotation (Placement(transformation(extent={{32,46},{52,66}})));
      equation
        connect(q_in, v_4to12.q_in)    annotation (Line(
            points={{-60,-4},{-50,-4},{-50,6},{-34,6}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(Ca_immediately_changeable.q_out, flux1.q_in) annotation (Line(
            points={{18,-8},{38,-8},{38,-19},{48,-19}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flux1.q_out, Ca_nonimmediately_changeable.q_out) annotation (Line(
            points={{62,-19},{72,-19},{72,-8},{84,-8}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flux2.q_in, Ca_nonimmediately_changeable.q_out) annotation (Line(
            points={{62,1},{72,1},{72,-8},{84,-8}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(Ca_immediately_changeable.q_out, flux2.q_out) annotation (Line(
            points={{18,-8},{38,-8},{38,1},{48,1}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(flux1.soluteFlow, k_12to13.y) annotation (Line(
            points={{55,-23.2},{55,-30},{50.4,-30}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Ca_immediately_changeable.soluteMass, k_12to13.u) annotation (Line(
            points={{18,-15.4},{18,-30},{41.2,-30}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(k_13to12.y, flux2.soluteFlow) annotation (Line(
            points={{61.6,14},{55,14},{55,5.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Ca_nonimmediately_changeable.soluteMass, k_13to12.u) annotation (Line(
            points={{84,-15.4},{84,-20},{98,-20},{98,14},{70.8,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(v_4to12.q_out, Ca_immediately_changeable.q_out) annotation (Line(
            points={{-14,6},{2,6},{2,-8},{18,-8}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(v_12to4.q_in, Ca_immediately_changeable.q_out) annotation (Line(
            points={{-14,-18},{2,-18},{2,-8},{18,-8}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(v_12to4.q_out, q_in) annotation (Line(
            points={{-34,-18},{-50,-18},{-50,-4},{-60,-4}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(calciumToBone.fluxToBone, v_4to12.soluteFlow) annotation (Line(
            points={{-16,30},{-10,30},{-10,16},{-24,16},{-24,12}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.CaPool_conc_per_liter, calciumToBone.Ca) annotation (
            Line(
            points={{-80,88},{-80,26},{-32,26}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(calciumFromBone.fluxToBone, v_12to4.soluteFlow) annotation (Line(
            points={{-16,-42},{-10,-42},{-10,-28},{-24,-28},{-24,-24}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(osteoblast.Osteoblasts, calciumToBone.Osteoblast) annotation (Line(
            points={{-16,60},{-10,60},{-10,44},{-40,44},{-40,34},{-32,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.BCL2, osteoblast.BCL2) annotation (Line(
            points={{-80,88},{-80,72},{-32,72}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.active_TGF_beta, osteoblast.active_TGF_beta) annotation (
           Line(
            points={{-80,88},{-80,64},{-32,64}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(osteoclast.Osteoclasts, calciumFromBone.Osteoclast) annotation (Line(
            points={{-16,-68},{-8,-68},{-8,-54},{-40,-54},{-40,-46},{-32,-46}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.active_TGF_beta, osteoclast.active_TGF_beta) annotation (
           Line(
            points={{-80,88},{-80,-68},{-32,-68}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(RANK_RANKL_.RANK_RANKL, calciumFromBone.RANK_RANKL) annotation (Line(
            points={{50,56},{100,56},{100,-80},{-66,-80},{-66,-38},{-32,-38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(osteoblast.Osteoblasts, RANK_RANKL_.Osteoblasts) annotation (Line(
            points={{-16,60},{-8,60},{-8,60},{34,60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(osteoblast.RespondingOsteoblasts, RANK_RANKL_.RespondingOsteoblasts)
          annotation (Line(
            points={{-16,64},{-8,64},{-8,64},{34,64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.active_TGF_beta, RANK_RANKL_.active_TGF_beta)
          annotation (Line(
            points={{-80,88},{-80,48},{34,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.PTH, RANK_RANKL_.PTH) annotation (Line(
            points={{-80,88},{-80,54},{34,54}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        annotation ( Icon(coordinateSystem(preserveAspectRatio=false,
                extent={{-100,-100},{100,100}}), graphics={Text(
                extent={{-112,-98},{100,-118}},
                fillColor={255,255,255},
                fillPattern=FillPattern.Solid,
                textString="%name",
                lineColor={0,0,127})}));
      end Bone;

      package setup
        model CaInputs

        Physiolibrary.Types.BusConnector busConnector
          annotation (Placement(transformation(extent={{-88,78},{-68,98}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant ECFV_Vol(units=
              "ml", k=14000)
          annotation (Placement(transformation(extent={{-68,46},{-60,54}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant Calcitriol(k=90)
          annotation (Placement(transformation(extent={{-68,70},{-60,78}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant PTH(k=3.85)
          annotation (Placement(transformation(extent={{-68,58},{-60,66}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass(units="ml", k=10)
          annotation (Placement(transformation(extent={{-68,32},{-60,40}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass1(units="ml", k=1000)
          annotation (Placement(transformation(extent={{-68,18},{-60,26}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant
          BladderVolume_Mass2(units="ml", k=1)
          annotation (Placement(transformation(extent={{-68,4},{-60,12}})));
        Physiolibrary.Types.Constants.VolumeFlowRateConst BladderVolume_Mass3(k=
             100)
          annotation (Placement(transformation(extent={{-68,-14},{-60,-6}})));
        Physiolibrary.Types.Constants.DeprecatedUntypedConstant PTH1(k=16.8/14)
          annotation (Placement(transformation(extent={{-68,-28},{-60,-20}})));
        equation
          connect(busConnector.ECFV_Vol, ECFV_Vol.y) annotation (Line(
              points={{-78,88},{2,88},{2,50},{-59.6,50}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(busConnector.BladderVolume_Mass, BladderVolume_Mass.y) annotation (
              Line(
              points={{-78,88},{2,88},{2,36},{-59.6,36}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None), Text(
              string="%first",
              index=-1,
              extent={{-6,3},{-6,3}}));
          connect(BladderVolume_Mass1.y, busConnector.GILumenVolume_Mass)
            annotation (Line(
              points={{-59.6,22},{2,22},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(BladderVolume_Mass2.y, busConnector.Diet_Ca_Intake)
            annotation (Line(
              points={{-59.6,8},{2,8},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(BladderVolume_Mass3.y, busConnector.Glomerulus_GFR)
            annotation (Line(
              points={{-59.6,-10},{2,-10},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
          connect(PTH1.y, busConnector.ctPO4) annotation (Line(
              points={{-59.6,-24},{2,-24},{2,88},{-78,88}},
              color={0,0,127},
              smooth=Smooth.None), Text(
              string="%second",
              index=1,
              extent={{6,3},{6,3}}));
        end CaInputs;
      end setup;

      package test
        model T
          setup.CaInputs caInputs
            annotation (Placement(transformation(extent={{-56,-20},{-36,0}})));
          Ca ca
            annotation (Placement(transformation(extent={{-6,-22},{14,-2}})));
          Hormones.PTH PTH
            annotation (Placement(transformation(extent={{-22,22},{-2,42}})));
          Hormones.Calcitriol calcitriol
            annotation (Placement(transformation(extent={{-24,52},{-4,72}})));
        equation
          connect(caInputs.busConnector, ca.busConnector) annotation (Line(
              points={{-53.8,-1.2},{-28.9,-1.2},{-28.9,-3.2},{-3.8,-3.2}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(caInputs.busConnector, PTH.busConnector) annotation (Line(
              points={{-53.8,-1.2},{-53.8,40.6},{-20.2,40.6}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
          connect(caInputs.busConnector, calcitriol.busConnector) annotation (
              Line(
              points={{-53.8,-1.2},{-53.8,70.4},{-21.6,70.4},{-21.6,70.2}},
              color={0,0,255},
              thickness=0.5,
              smooth=Smooth.None));
        end T;
      end test;

      model Osteoblast

        Modelica.Blocks.Interfaces.RealInput active_TGF_beta
                                         annotation (Placement(transformation(extent={{-100,
                  -60},{-60,-20}}),     iconTransformation(extent={{-100,-60},{-60,-20}})));
        Modelica.Blocks.Interfaces.RealOutput Osteoblasts
                                                  annotation (Placement(
              transformation(extent={{60,-100},{100,-60}}),
                                                          iconTransformation(extent={{60,-100},
                  {100,-60}})));
        Modelica.Blocks.Interfaces.RealInput BCL2
                                         annotation (Placement(transformation(extent={{-100,
                  -60},{-60,-20}}),     iconTransformation(extent={{-100,20},{-60,60}})));

      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=
            0.00501324)
        annotation (Placement(transformation(extent={{10,-8},{26,8}})));
        Modelica.Blocks.Interfaces.RealOutput RespondingOsteoblasts
                                                  annotation (Placement(
              transformation(extent={{60,-60},{100,-20}}),iconTransformation(extent={{60,-60},
                  {100,-20}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=
            0.00104122)
        annotation (Placement(transformation(extent={{10,52},{26,68}})));
      equation
        connect(Constant.y, Osteoblasts) annotation (Line(
            points={{26.8,0},{53.4,0},{53.4,-80},{80,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant1.y, RespondingOsteoblasts) annotation (Line(
            points={{26.8,60},{53.4,60},{53.4,-40},{80,-40}},
            color={0,0,127},
            smooth=Smooth.None));
      end Osteoblast;

      model Osteoclast
        Modelica.Blocks.Interfaces.RealInput active_TGF_beta
                                         annotation (Placement(transformation(extent={{-100,
                  -20},{-60,20}}),      iconTransformation(extent={{-100,-20},{
                  -60,20}})));
        Modelica.Blocks.Interfaces.RealOutput Osteoclasts
                                                  annotation (Placement(
              transformation(extent={{60,-20},{100,20}}), iconTransformation(extent={{
                  60,-20},{100,20}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=
            0.001154)
        annotation (Placement(transformation(extent={{16,-8},{32,8}})));
      equation
        connect(Constant.y, Osteoclasts) annotation (Line(
            points={{32.8,0},{80,0}},
            color={0,0,127},
            smooth=Smooth.None));
      end Osteoclast;

      model RANK_RANKL
        Modelica.Blocks.Interfaces.RealOutput RANK_RANKL
                                                  annotation (Placement(
              transformation(extent={{60,-20},{100,20}}), iconTransformation(extent={{60,-20},
                  {100,20}})));
        Modelica.Blocks.Interfaces.RealInput active_TGF_beta
                                         annotation (Placement(transformation(extent={{-100,
                  -100},{-60,-60}}),    iconTransformation(extent={{-100,-100},
                  {-60,-60}})));
        Modelica.Blocks.Interfaces.RealInput Osteoblasts
                                         annotation (Placement(transformation(extent={{-100,20},
                  {-60,60}}),           iconTransformation(extent={{-100,20},{
                  -60,60}})));
        Modelica.Blocks.Interfaces.RealInput PTH
                                         annotation (Placement(transformation(extent={{-100,
                  -40},{-60,0}}),       iconTransformation(extent={{-100,-40},{
                  -60,0}})));
        Modelica.Blocks.Interfaces.RealInput RespondingOsteoblasts
                                         annotation (Placement(transformation(extent={{-100,20},
                  {-60,60}}),           iconTransformation(extent={{-100,60},{
                  -60,100}})));
      end RANK_RANKL;
    end Calcium2;

    model SweatGlandSalt
      extends Physiolibrary.Icons.SweatGland;

      parameter Real FractReabBasic=0.8;
      parameter Real FractReabK=log( FractReabBasic)  / 15.0;

    Physiolibrary.Blocks.Factors.Spline AldoEffect(data={{0,0.5,0.0},{12,1.0,
          0.03},{100,2.0,0.0}}, Xscale=1e-9/0.036)
      annotation (Placement(transformation(extent={{-40,32},{-20,52}})));
    Physiolibrary.Types.Constants.FractionConst             Constant(k=1)
      annotation (Placement(transformation(extent={{-40,56},{-32,64}})));
      Modelica.Blocks.Math.Division division
        annotation (Placement(transformation(extent={{-4,32},{16,52}})));
      Modelica.Blocks.Math.Exp FractReab
        annotation (Placement(transformation(extent={{26,32},{46,52}})));
      Modelica.Blocks.Math.Product product
        annotation (Placement(transformation(extent={{-48,4},{-28,24}})));
    Physiolibrary.Types.Constants.FractionConst             Constant1(k=
          FractReabK)
      annotation (Placement(transformation(extent={{-72,4},{-64,12}})));
      Modelica.Blocks.Math.Product Reab
        annotation (Placement(transformation(extent={{72,26},{92,46}})));
      Modelica.Blocks.Math.Feedback Outflow annotation (Placement(
            transformation(
            extent={{-10,10},{10,-10}},
            rotation=270,
            origin={78,-12})));
    Physiolibrary.Chemical.Interfaces.ChemicalPort_a salt annotation (Placement(
          transformation(extent={{-110,-70},{-90,-50}}), iconTransformation(
            extent={{-110,-70},{-90,-50}})));
    Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut outputPump(soluteFlow(
          start=0), useSoluteFlowInput=true)
      annotation (Placement(transformation(extent={{66,-72},{90,-48}})));
      Physiolibrary.Chemical.Sensors.ConcentrationMeasure    concentrationMeasure
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            origin={2,-58})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-88,76},{-76,88}}), iconTransformation(extent=
             {{60,60},{100,100}})));
      Modelica.Blocks.Math.Product SaltInflow
        annotation (Placement(transformation(extent={{16,-30},{36,-10}})));
    equation
      connect(Constant.y, AldoEffect.yBase) annotation (Line(
          points={{-31,60},{-30,60},{-30,44}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(AldoEffect.y, division.u2) annotation (Line(
          points={{-30,38},{-30,36},{-6,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(division.y, FractReab.u) annotation (Line(
          points={{17,42},{24,42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(product.y, division.u1) annotation (Line(
          points={{-27,14},{-14,14},{-14,48},{-6,48}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant1.y, product.u2) annotation (Line(
          points={{-63,8},{-50,8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FractReab.y, Reab.u1) annotation (Line(
          points={{47,42},{70,42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Reab.y, Outflow.u2) annotation (Line(
          points={{93,36},{100,36},{100,-12},{86,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(salt, outputPump.q_in) annotation (Line(
          points={{-100,-60},{66,-60}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(outputPump.soluteFlow, Outflow.y) annotation (Line(
        points={{82.8,-55.2},{82.8,-38},{78,-38},{78,-21}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(salt, concentrationMeasure.q_in) annotation (Line(
          points={{-100,-60},{2,-60}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector.SweatGland_H2ORate, product.u1) annotation (Line(
          points={{-82,82},{-80,82},{-80,20},{-50,20}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
    connect(concentrationMeasure.concentration, SaltInflow.u2) annotation (Line(
        points={{2,-54},{2,-26},{14,-26}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.SweatGland_H2ORate, SaltInflow.u1) annotation (Line(
          points={{-82,82},{-80,82},{-80,-14},{14,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(SaltInflow.y, Reab.u2) annotation (Line(
          points={{37,-20},{54,-20},{54,30},{70,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SaltInflow.y, Outflow.u1) annotation (Line(
          points={{37,-20},{54,-20},{54,2},{78,2},{78,-4}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(busConnector.Aldosterone, AldoEffect.u) annotation (Line(
        points={{-82,82},{-80,82},{-80,42},{-38,42}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    end SweatGlandSalt;

    model Bladder
      extends Physiolibrary.Icons.Bladder;

      parameter String stateVarName;

      Physiolibrary.Chemical.Components.Substance                Bladder(
                               stateName=stateVarName, useNormalizedVolume=
          false)
        annotation (Placement(transformation(extent={{-12,-52},{8,-32}})));
    Physiolibrary.Chemical.Components.Clearance bladderVoid(
        useSolutionFlowInput=true)
      annotation (Placement(transformation(extent={{28,-48},{40,-36}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{8,-28},{20,-16}}), iconTransformation(extent=
              {{60,60},{100,100}})));
    Physiolibrary.Chemical.Interfaces.ChemicalPort_a q_in annotation (Placement(
          transformation(extent={{0,0},{20,20}}), iconTransformation(extent={{-10,
              70},{10,90}})));
    equation
      connect(Bladder.q_out,bladderVoid. q_in) annotation (Line(
          points={{-2,-42},{28,-42}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(bladderVoid.solutionFlow, busConnector.BladderVoidFlow) annotation (
       Line(
        points={{34,-37.8},{34,-22},{14,-22}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      connect(q_in, Bladder.q_out) annotation (Line(
          points={{10,10},{-32,10},{-32,-42},{-2,-42}},
          color={200,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(busConnector.BladderVolume_Mass, Bladder.solutionVolume)
      annotation (Line(
        points={{14,-22},{-6,-22},{-6,-38}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    end Bladder;

    model ElectrolytesProperties
      extends Physiolibrary.Icons.Electrolytes;
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-106,88},{-88,106}}), iconTransformation(
            extent={{-120,20},{-80,60}})));
    Physiolibrary.Types.Constants.AmountOfSubstanceConst
                                                  OsmCell_OtherCations(k=0.692)
      annotation (Placement(transformation(extent={{4,-72},{24,-52}})));
    Physiolibrary.Types.Constants.AmountOfSubstanceConst
                                                  CellElectrolytesMass(k=1)
      annotation (Placement(transformation(extent={{6,-96},{26,-76}})));
      Modelica.Blocks.Math.Add3 Cells(
        k3=-1,
        k1=2,
        k2=2)  annotation (Placement(transformation(extent={{48,-68},{68,-48}})));
    Physiolibrary.Types.Constants.AmountOfSubstanceConst
                                                  OsmECFV_OtherAnions(k=0.373)
      annotation (Placement(transformation(extent={{-84,-10},{-74,0}})));
      Modelica.Blocks.Math.Sum ECF(nin=8)
        annotation (Placement(transformation(extent={{-64,-6},{-44,14}})));
      Modelica.Blocks.Math.Sum BloodCations(nin=2,
      k=ones(2)*Modelica.Constants.F,
      y(unit="C/m3"))
        annotation (Placement(transformation(extent={{-76,38},{-56,58}})));
      Modelica.Blocks.Math.Feedback lessPO4
        annotation (Placement(transformation(extent={{76,74},{96,54}})));
      Modelica.Blocks.Math.Feedback lessSO4
        annotation (Placement(transformation(extent={{76,92},{96,72}})));
      Modelica.Blocks.Math.Add3 AnFlow(
      k1=Modelica.Constants.F,
      k2=Modelica.Constants.F,
      k3=2*Modelica.Constants.F)
        annotation (Placement(transformation(extent={{-80,-72},{-60,-52}})));
      Modelica.Blocks.Math.Add3 CatFlow(
      k1=Modelica.Constants.F,
      k2=Modelica.Constants.F,
      k3=Modelica.Constants.F)
        annotation (Placement(transformation(extent={{-80,-44},{-60,-24}})));
      Modelica.Blocks.Math.Feedback CollectingDuct_NetSumCats(y(unit="C"))
        annotation (Placement(transformation(extent={{-44,-44},{-24,-24}})));
      Modelica.Blocks.Math.Sum StrongAnions(nin=5,
      k=ones(5)*Modelica.Constants.F,
      y(unit="C/m3")) "{KA,PO4,SO4,Lac,Cl}"
        annotation (Placement(transformation(extent={{-82,70},{-62,90}})));
      Modelica.Blocks.Math.Feedback ECF_SID(y(unit="C/m3", displayUnit="meq/l"))
      "extracellular fluid strong ion difference"   annotation (Placement(
            transformation(
            extent={{-10,10},{10,-10}},
            origin={0,64})));
      Modelica.Blocks.Math.Feedback lessCl
        annotation (Placement(transformation(extent={{78,52},{98,32}})));
    Modelica.Blocks.Math.Gain toCharge1(k=Modelica.Constants.F)
      annotation (Placement(transformation(extent={{60,52},{68,60}})));
    Modelica.Blocks.Math.Gain toCharge2(k=2*Modelica.Constants.F)
      annotation (Placement(transformation(extent={{60,84},{68,92}})));
    Modelica.Blocks.Math.Gain toCharge3(k=Modelica.Constants.F)
      annotation (Placement(transformation(extent={{58,66},{66,74}})));
    Physiolibrary.Types.Constants.OneConst                  const
      annotation (Placement(transformation(extent={{24,12},{34,22}})));
      Modelica.Blocks.Math.Feedback Pct      annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            origin={47,17})));
      Modelica.Blocks.Math.Product plasma_part(y(unit="C/m3", displayUnit=
            "mEq/l")) annotation (Placement(transformation(
          extent={{-5,-5},{5,5}},
          origin={69,17})));
      Modelica.Blocks.Math.Product ery_part(y(unit="C/m3", displayUnit=
            "mEq/l"))                       annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            origin={69,-3})));
      Modelica.Blocks.Math.Add blood_SID(y(unit="C/m3", displayUnit="meq/l"))
      annotation (Placement(transformation(extent={{80,0},{90,10}})));
      Physiolibrary.Types.Constants.VolumeDensityOfChargeConst _RBC_SID(k=
          3184016.2167) "cations expect potassium"
      annotation (Placement(transformation(extent={{48,-10},{56,-2}})));
    equation
      connect(busConnector.KCell_Mass, Cells.u1)  annotation (Line(
          points={{-97,97},{-96,97},{-96,-86},{-22,-86},{-22,-50},{46,-50}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(OsmCell_OtherCations.y, Cells.u2)  annotation (Line(
          points={{26.5,-62},{28,-62},{28,-58},{46,-58}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(CellElectrolytesMass.y, Cells.u3)  annotation (Line(
          points={{28.5,-86},{31.5,-86},{31.5,-66},{46,-66}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.NaPool_mass, ECF.u[1])  annotation (Line(
          points={{-97,97},{-96,97},{-96,12},{-66,12},{-66,2.25}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.KPool_mass, ECF.u[2])  annotation (Line(
          points={{-97,97},{-96,97},{-96,8},{-66,8},{-66,2.75}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.ClPool_mass, ECF.u[3])  annotation (Line(
          points={{-97,97},{-97,10},{-66,10},{-66,3.25}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(OsmECFV_OtherAnions.y, ECF.u[8])  annotation (Line(
          points={{-72.75,-5},{-66,-5},{-66,5.75}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.NaPool, BloodCations.u[1]) annotation (Line(
          points={{-97,97},{-97,64},{-78,64},{-78,47}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.KPool, BloodCations.u[2]) annotation (Line(
          points={{-97,97},{-96,97},{-96,66},{-78,66},{-78,49}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(lessSO4.y, busConnector.BloodIons_StrongAnionsLessSO4)   annotation (Line(
          points={{95,82},{100,82},{100,97},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.BloodIons_StrongAnionsLessPO4, lessPO4.y)   annotation (
          Line(
          points={{-97,97},{100,97},{100,64},{95,64}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(CollectingDuct_NetSumCats.y, busConnector.CollectingDuct_NetSumCats)
        annotation (Line(
          points={{-25,-34},{100,-34},{100,96},{-96,96},{-96,97},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CatFlow.y, CollectingDuct_NetSumCats.u1) annotation (Line(
          points={{-59,-34},{-42,-34}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(AnFlow.y, CollectingDuct_NetSumCats.u2) annotation (Line(
          points={{-59,-62},{-34,-62},{-34,-42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.CD_NH4_Outflow, CatFlow.u1)
                                                 annotation (Line(
          points={{-97,97},{-96,97},{-96,-26},{-82,-26}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.CD_PO4_Outflow, AnFlow.u2) annotation (Line(
          points={{-97,97},{-96,97},{-96,-62},{-82,-62}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.CD_SO4_Outflow, AnFlow.u3) annotation (Line(
          points={{-97,97},{-96,97},{-96,-70},{-82,-70}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(BloodCations.y, ECF_SID.u1) annotation (Line(
          points={{-55,48},{-16,48},{-16,64},{-8,64}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.PO4Pool, StrongAnions.u[2])
        annotation (Line(
          points={{-97,97},{-96,97},{-96,79.2},{-84,79.2}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.SO4Pool, StrongAnions.u[3])
        annotation (Line(
          points={{-97,97},{-97,80},{-84,80}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ClPool, StrongAnions.u[5])
        annotation (Line(
          points={{-97,97},{-94,97},{-94,80},{-84,80},{-84,81.6}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.PO4Pool_Osmoles, ECF.u[4]) annotation (Line(
          points={{-97,97},{-96,97},{-96,4},{-68,4},{-68,3.75},{-66,3.75}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.SO4Pool_Osmoles, ECF.u[5]) annotation (Line(
          points={{-97,97},{-96,97},{-96,14},{-66,14},{-66,4.25}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(busConnector.LacPool, StrongAnions.u[4])
            annotation (Line(
          points={{-97,97},{-97,80.8},{-84,80.8}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(ECF.y, busConnector.OsmECFV_Electrolytes)
        annotation (Line(
          points={{-43,4},{-30,4},{-30,-14},{-97,-14},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Cells.y, busConnector.OsmCell_Electrolytes)
        annotation (Line(
          points={{69,-58},{100,-58},{100,96},{-97,96},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.KAPool, StrongAnions.u[1])
        annotation (Line(
          points={{-97,97},{-97,78.4},{-84,78.4}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector.CD_KA_Outflow, AnFlow.u1)                annotation (
         Line(
          points={{-97,97},{-97,-54},{-82,-54}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.KAPool_Osmoles, ECF.u[7])                annotation (
         Line(
          points={{-97,97},{-96,97},{-96,16},{-66,16},{-66,5.25}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(BloodCations.y, busConnector.BloodIons_Cations)
        annotation (Line(
          points={{-55,48},{-16,48},{-16,94},{-97,94},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

      connect(busConnector.CD_Na_Outflow, CatFlow.u2) annotation (Line(
          points={{-97,97},{-97,-34},{-82,-34}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.CD_K_Outflow, CatFlow.u3) annotation (Line(
          points={{-97,97},{-97,-42},{-82,-42}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(BloodCations.y, busConnector.BloodCations) annotation (Line(
          points={{-55,48},{-16,48},{-16,97},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(StrongAnions.y, busConnector.BloodIons_StrongAnions) annotation (
         Line(
          points={{-61,80},{100,80},{100,97},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(StrongAnions.y, lessSO4.u1)   annotation (Line(
          points={{-61,80},{74,80},{74,82},{78,82}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(StrongAnions.y, lessPO4.u1)   annotation (Line(
          points={{-61,80},{74,80},{74,64},{78,64}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(StrongAnions.y, ECF_SID.u2) annotation (Line(
          points={{-61,80},{0,80},{0,72}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(StrongAnions.y, lessCl.u1) annotation (Line(
          points={{-61,80},{74,80},{74,42},{80,42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(lessCl.y, busConnector.BloodIons_StrongAnionsLessCl) annotation (
          Line(
          points={{97,42},{100,42},{100,97},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(toCharge1.y, lessCl.u2) annotation (Line(
        points={{68.4,56},{76,56},{76,50},{88,50}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.ClPool_conc_per_liter, toCharge1.u) annotation (Line(
        points={{-97,97},{50,97},{50,56},{59.2,56}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(lessSO4.u2, toCharge2.y) annotation (Line(
        points={{86,90},{78,90},{78,88},{68.4,88}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.SO4Pool_conc_per_liter, toCharge2.u) annotation (Line(
        points={{-97,97},{50,97},{50,88},{59.2,88}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(lessPO4.u2, toCharge3.y) annotation (Line(
        points={{86,72},{76,72},{76,70},{66.4,70}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.PO4Pool_conc_per_liter, toCharge3.u) annotation (Line(
        points={{-97,97},{48,97},{48,70},{57.2,70}},
        color={255,0,0},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      connect(ECF_SID.y, busConnector.Plasma_SID) annotation (Line(
          points={{9,64},{36,64},{36,97},{-97,97}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

      connect(const.y, Pct.u1) annotation (Line(
          points={{35.25,17},{43,17}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(ery_part.y, blood_SID.u2) annotation (Line(
        points={{74.5,-3},{74.5,2},{79,2}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(plasma_part.y, blood_SID.u1) annotation (Line(
        points={{74.5,17},{74.5,8},{79,8}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(ECF_SID.y, plasma_part.u1) annotation (Line(
        points={{9,64},{40,64},{40,26},{63,26},{63,20}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(Pct.y, plasma_part.u2) annotation (Line(
        points={{51.5,17},{51.5,14},{63,14}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.BloodVol_Hct, Pct.u2) annotation (Line(
          points={{-97,97},{-97,20},{10,20},{10,0},{47,0},{47,13}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.BloodVol_Hct,ery_part. u1) annotation (Line(
          points={{-97,97},{-97,20},{10,20},{10,0},{63,0}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
    connect(blood_SID.y, busConnector.Blood_SID) annotation (Line(
        points={{90.5,5},{100,5},{100,97},{-97,97}},
        color={0,0,127},
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
    connect(_RBC_SID.y, ery_part.u2) annotation (Line(
        points={{57,-6},{63,-6}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.LacPool_Mass, ECF.u[6]) annotation (Line(
        points={{-97,97},{-97,24},{-96,24},{-96,6},{-66,6},{-66,4.75}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(preserveAspectRatio=true,
              extent={{-100,-100},{100,100}}), graphics={               Text(
              extent={{-122,-58},{120,-92}},
              lineColor={0,0,255},
              textString="%name")}),
        Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
    end ElectrolytesProperties;

    model Electrolytes
        extends Physiolibrary.Icons.Electrolytes;
      Sodium.Sodium sodium
        annotation (Placement(transformation(extent={{-80,60},{-60,80}})));
      Potassium.Potassium potassium
        annotation (Placement(transformation(extent={{-44,60},{-24,80}})));
      Chloride.Chloride2 chloride
        annotation (Placement(transformation(extent={{-10,60},{10,80}})));
      Phosphate.Phosphate3 phosphate
        annotation (Placement(transformation(extent={{-44,16},{-24,36}})));
      Sulphate.Sulphate2 sulphate
      annotation (Placement(transformation(extent={{-10,16},{10,36}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{82,36},{106,60}}), iconTransformation(extent=
              {{-120,20},{-80,60}})));
      ElectrolytesProperties electrolytesProperties
        annotation (Placement(transformation(extent={{48,18},{68,38}})));
    NH4.Ammonium ammonium
      annotation (Placement(transformation(extent={{-86,16},{-66,36}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst CD_Ca_Outflow(k=2e-07)
      "calcium outflow to urine needed for urine acid-base"
      annotation (Placement(transformation(extent={{-54,-22},{-34,-2}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst CD_Mg_Outflow(k=5e-08)
      "magnesium outflow to urine needed for urine acid-base"
      annotation (Placement(transformation(extent={{-54,-44},{-34,-24}})));

    AcidBase.AcidBase acidBase
      annotation (Placement(transformation(extent={{42,72},{62,92}})));
    equation
      connect(sodium.busConnector, busConnector) annotation (Line(
          points={{-62,78},{-62,48},{94,48}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, potassium.busConnector) annotation (Line(
          points={{94,48},{-26,48},{-26,78}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, chloride.busConnector) annotation (Line(
          points={{94,48},{8.1,48},{8.1,78.1}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector, electrolytesProperties.busConnector) annotation (
          Line(
          points={{94,48},{48,48},{48,32}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
    connect(sulphate.busConnector, busConnector) annotation (Line(
        points={{8,34},{8,48},{94,48}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None));
      connect(phosphate.busConnector, busConnector) annotation (Line(
          points={{-26,34},{-26,48},{94,48}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
    connect(ammonium.busConnector, busConnector) annotation (Line(
        points={{-67.9,34.1},{-67.9,48},{94,48}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None));

      connect(CD_Ca_Outflow.y, busConnector.CD_Ca_Outflow) annotation (Line(
          points={{-31.5,-12},{94,-12},{94,48}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CD_Mg_Outflow.y, busConnector.CD_Mg_Outflow) annotation (Line(
          points={{-31.5,-34},{94,-34},{94,48}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

    connect(busConnector, acidBase.busConnector) annotation (Line(
        points={{94,48},{74,48},{74,82.2},{52,82.2}},
        color={255,204,51},
        thickness=0.5,
        smooth=Smooth.None));
      annotation (                                        Icon(coordinateSystem(preserveAspectRatio=true,
              extent={{-100,-100},{100,100}}), graphics={               Text(
              extent={{-122,-58},{120,-92}},
              lineColor={0,0,255},
              textString="%name")}),
        Documentation(revisions="<html>

<table>
<tr>
<td>Author:</td>
<td>Marek Matejak</td>
</tr>
<tr>
<td>License:</td>
<td><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </td>
</tr>
<tr>
<td>By:</td>
<td>Charles University, Prague</td>
</tr>
<tr>
<td>Date of:</td>
<td>2009</td>
</tr>
<tr>
<td>References:</td>
<td>Tom Coleman: QHP 2008 beta 3, University of Mississippi Medical Center</td>
</tr><tr>
<td></td>
<td>Noriaki Ikeda: A model of overall regulation of body fluids (1979), Kitasato University</td>
</tr>
</table>
<br/><p>Copyright &copy; 2014 Marek Matejak, Charles University in Prague.</p><br/>

</html>"));
    end Electrolytes;

    package IO_Bus
        extends Physiolibrary.Types.IO_Bus;

      redeclare model extends Variables

      AcidBase.AcidBase_variables acidBase_variables(T(redeclare block Variable
            =                                                                     T.Variable))
          annotation (Placement(transformation(extent={{4,-88},{24,-68}})));

      T.VolumeDensityOfCharge BloodCations(varName="BloodIons.Cations")
        "Sum of all cations concentrations in blood."
      annotation (Placement(transformation(extent={{-36,10},{-30,16}})));
      T.MolarFlowRate CD_K_Outflow(varName="CD_K.Outflow")
        "Collecting duct potassium outflow to urine."
      annotation (Placement(transformation(extent={{-36,40},{-30,46}})));
      T.MolarFlowRate CD_Na_Outflow(varName="CD_Na.Outflow")
        "Collecting duct sodium outflow to urine."
      annotation (Placement(transformation(extent={{-36,60},{-30,66}})));
      T.MolarFlowRate CD_PO4_Outflow(varName="CD_PO4.Outflow")
        "Collecting duct phosphates outflow to urine."
      annotation (Placement(transformation(extent={{-36,70},{-30,76}})));
      T.Fraction DT_AldosteroneEffect(varName="DT_AldosteroneEffect")
        "Aldosterone effect to distal tubule reabsorbtion."
      annotation (Placement(transformation(extent={{-36,80},{-30,86}})));
      T.MolarFlowRate DT_Na_Outflow(varName="DT_Na.Outflow")
        "Distal tubule sodium outflow."
      annotation (Placement(transformation(extent={{-36,90},{-30,96}})));
      T.MolarFlowRate DT_Na_Reab(varName="DT_Na.Reab")
        "Distal tubule sodium reabsorbtion."
      annotation (Placement(transformation(extent={{-36,100},{-30,106}})));
      T.AmountOfSubstance GILumenPotassium_Mass(varName="GILumenPotassium.Mass")
        "Potasium mass in intestines."
      annotation (Placement(transformation(extent={{-36,110},{-30,116}})));
      T.AmountOfSubstance GILumenSodium_Mass(varName="GILumenSodium.Mass")
        "Sodium mass in intestines."
      annotation (Placement(transformation(extent={{-36,120},{-30,126}})));
      T.MolarFlowRate PotassiumToCells(varName="KCell.Change")
        "PotasiumToCells"
      annotation (Placement(transformation(extent={{-36,140},{-30,146}})));
      T.Concentration KCell_conc(varName="KCell.[K+(mEq/L)]")
        "Intracellular potassium concentration."
      annotation (Placement(transformation(extent={{-36,150},{-30,156}})));
      T.Concentration KPool_per_liter(varName="KPool.[K+(mEq/L)]")
        "Potassium extracellular concentration."
      annotation (Placement(transformation(extent={{-36,160},{-30,166}})));
      T.Fraction LH_Na_FractReab(varName="LH_Na.FractReab")
        "Sodium reabsorbtion fraction (=reabsorbed/inflowed) in loop of Henle."
      annotation (Placement(transformation(extent={{-36,170},{-30,176}})));

      T.MolarFlowRate LH_Na_Reab(varName="LH_Na.Reab")
        "Sodium reabsorbtion in loop of Henle."
      annotation (Placement(transformation(extent={{-36,180},{-30,186}})));
      T.Concentration MD_Na(varName="MD_Na.[Na+(mEq/L)]")
        "Kidney nephron - Maculla densa sodium concentration."
      annotation (Placement(transformation(extent={{-36,190},{-30,196}})));
      T.Osmolarity MedullaNa_Osmolarity(varName="MedullaNa.Osmolarity")
        "Kidney medulla interstitial sodium osmolarity."
      annotation (Placement(transformation(extent={{-36,200},{-30,206}})));
      T.Concentration MedullaNa_conc(varName="MedullaNa.[Na+]", storeUnit="mol/l")
        "Kidney medulla interstitial sodium concentration."
      annotation (Placement(transformation(extent={{-36,210},{-30,216}})));
      T.AmountOfSubstance OsmCell_Electrolytes(varName="OsmCell.Electrolytes")
        "Intracellular electrolites osmoles."
      annotation (Placement(transformation(extent={{-36,220},{-30,226}})));
      T.AmountOfSubstance OsmECFV_Electrolytes(varName="OsmECFV.Electrolytes")
        "Extracellular electrolites osmoles."
      annotation (Placement(transformation(extent={{-36,230},{-30,236}})));
      T.Concentration ctPO4(varName="PO4Pool.[PO4--(mEq/L)]")
        "Extracellular phosphates concentration."
      annotation (Placement(transformation(extent={{-36,240},{-30,246}})));
      T.Fraction PT_Na_FractReab(varName="PT_Na.FractReab")
        "Proximal tubule sodium reabsorbtion fraction (=reabsorbed/inflowed)."
      annotation (Placement(transformation(extent={{-36,250},{-30,256}})));

      T.MolarFlowRate PT_Na_Reab(varName="PT_Na.Reab")
        "Proximal tubule sodium reabsorbtion."
      annotation (Placement(transformation(extent={{-36,260},{-30,266}})));
      T.MolarFlowRate CD_NH4_Outflow(varName="CD_NH4.Outflow")
        "Collecting duct amonium outflow to urine."
      annotation (Placement(transformation(extent={{-68,50},{-62,56}})));
      T.VolumeDensityOfCharge BloodIons_Cations1(varName="BloodIons.[SID(mEq/L)]")
        "Sum of all cations concentrations in blood."
      annotation (Placement(transformation(extent={{-68,28},{-62,34}})));
      T.MolarFlowRate CD_Cl_Outflow1(varName="CD_Cl.Outflow")
        "Collecting duct chloride outflow to urine."
      annotation (Placement(transformation(extent={{-66,-6},{-60,0}})));
      T.MolarFlowRate CD_Mg_Outflow(varName="CD_Mg_Outflow")
        "Collecting duct chloride outflow to urine."
      annotation (Placement(transformation(extent={{-66,-22},{-60,-16}})));
      T.MolarFlowRate CD_Ca_Outflow3(varName="CD_Ca_Outflow")
        "Collecting duct calcium outflow to urine."
      annotation (Placement(transformation(extent={{-66,-38},{-60,-32}})));
      T.MolarFlowRate CD_SO4_Outflow(varName="CD_SO4_Outflow")
        "Collecting duct sulfate outflow to urine."
      annotation (Placement(transformation(extent={{-66,-54},{-60,-48}})));

      equation
      connect(BloodCations.y, busConnector.BloodCations) annotation (Line(
       points={{-29.7,13},{90,13},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(CD_K_Outflow.y, busConnector.CD_K_Outflow) annotation (Line(
       points={{-29.7,43},{90,43},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(CD_Na_Outflow.y, busConnector.CD_Na_Outflow) annotation (Line(
       points={{-29.7,63},{90,63},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(CD_PO4_Outflow.y, busConnector.CD_PO4_Outflow) annotation (Line(
       points={{-29.7,73},{90,73},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(DT_AldosteroneEffect.y, busConnector.DT_AldosteroneEffect) annotation (Line(
       points={{-29.7,83},{90,83},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(DT_Na_Outflow.y, busConnector.DT_Na_Outflow) annotation (Line(
       points={{-29.7,93},{90,93},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(DT_Na_Reab.y, busConnector.DT_Na_Reab) annotation (Line(
       points={{-29.7,103},{90,103},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GILumenPotassium_Mass.y, busConnector.GILumenPotassium_Mass) annotation (Line(
       points={{-29.7,113},{90,113},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GILumenSodium_Mass.y, busConnector.GILumenSodium_Mass) annotation (Line(
       points={{-29.7,123},{90,123},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(PotassiumToCells.y, busConnector.PotassiumToCells) annotation (Line(
       points={{-29.7,143},{90,143},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LH_Na_FractReab.y, busConnector.LH_Na_FractReab) annotation (Line(
       points={{-29.7,173},{90,173},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LH_Na_Reab.y, busConnector.LH_Na_Reab) annotation (Line(
       points={{-29.7,183},{90,183},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(MD_Na.y, busConnector.MD_Na) annotation (Line(
       points={{-29.7,193},{90,193},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(MedullaNa_Osmolarity.y, busConnector.MedullaNa_Osmolarity) annotation (Line(
       points={{-29.7,203},{90,203},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(MedullaNa_conc.y, busConnector.MedullaNa_conc) annotation (Line(
       points={{-29.7,213},{90,213},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(OsmCell_Electrolytes.y, busConnector.OsmCell_Electrolytes) annotation (Line(
       points={{-29.7,223},{90,223},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(OsmECFV_Electrolytes.y, busConnector.OsmECFV_Electrolytes) annotation (Line(
       points={{-29.7,233},{90,233},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(ctPO4.y, busConnector.ctPO4) annotation (Line(
       points={{-29.7,243},{90,243},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(PT_Na_FractReab.y, busConnector.PT_Na_FractReab) annotation (Line(
       points={{-29.7,253},{90,253},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(PT_Na_Reab.y, busConnector.PT_Na_Reab) annotation (Line(
       points={{-29.7,263},{90,263},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

        connect(KPool_per_liter.y, busConnector.KPool) annotation (
           Line(
            points={{-29.7,163},{90,163},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KCell_conc.y, busConnector.KCell_conc) annotation (Line(
          points={{-29.7,153},{90,153},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CD_NH4_Outflow.y, busConnector.CD_NH4_Outflow) annotation (Line(
          points={{-61.7,53},{90,53},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CD_Cl_Outflow1.y, busConnector.CD_Cl_Outflow) annotation (Line(
          points={{-59.7,-3},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CD_Mg_Outflow.y, busConnector.CD_Mg_Outflow) annotation (Line(
          points={{-59.7,-19},{90,-19},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CD_Ca_Outflow3.y, busConnector.CD_Ca_Outflow) annotation (Line(
          points={{-59.7,-35},{11.15,-35},{11.15,-2},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(CD_SO4_Outflow.y, busConnector.CD_SO4_Outflow) annotation (Line(
          points={{-59.7,-51},{90,-51},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(acidBase_variables.busConnector, busConnector) annotation (Line(
          points={{12,-78},{90,-78},{90,-2}},
          color={255,204,51},
          thickness=0.5,
          smooth=Smooth.None));
      connect(BloodIons_Cations1.y, busConnector.Plasma_SID) annotation (Line(
          points={{-61.7,31},{90,31},{90,34},{90,34},{90,32},{90,32},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{18,98},{100,60}},
                lineColor={0,0,0},
                textString="vars"), Text(
                extent={{-120,-58},{122,-92}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model Electrolytes_test
      import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.Electrolytes electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Electrolytes.IO_Bus.OutputComparison electrolytes_dif
          annotation (Placement(transformation(extent={{48,-38},{68,-18}})));
        Physiomodel.Electrolytes.IO_Bus.OutputToFile electrolytes_varsToFile
          annotation (Placement(transformation(extent={{22,-34},{42,-14}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{74,-20},{-6,-20},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector, electrolytes_dif.busConnector)
          annotation (Line(
            points={{74,-20},{66,-20},{66,-28},{58,-28}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes_varsToFile.busConnector, electrolytes.busConnector)
          annotation (Line(
            points={{32,-24},{44,-24},{44,-20},{74,-20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        annotation (        experiment(StopTime=86400));
      end Electrolytes_test;

      model Electrolytes_test_SI
      import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.Electrolytes electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile_SI hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Electrolytes.IO_Bus.OutputComparison_SI electrolytes_dif
          annotation (Placement(transformation(extent={{48,-38},{68,-18}})));
        Physiomodel.Electrolytes.IO_Bus.OutputToFile_SI electrolytes_varsToFile
          annotation (Placement(transformation(extent={{22,-34},{42,-14}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{74,-20},{-6,-20},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector, electrolytes_dif.busConnector)
          annotation (Line(
            points={{74,-20},{66,-20},{66,-28},{58,-28}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes_varsToFile.busConnector, electrolytes.busConnector)
          annotation (Line(
            points={{32,-24},{44,-24},{44,-20},{74,-20}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Electrolytes_test_SI;

      model ElectrolytesAndProteins_test_SI
      import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.Electrolytes electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile_SI hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.Water3                  water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,11},{-69,11}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{74,-20},{-6,-20},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end ElectrolytesAndProteins_test_SI;
    end IO_Bus;

    annotation (Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2008-2015</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: HumMod 1.6, University of Mississippi Medical Center</p></td>
</tr>
</table>
<p>Copyright &copy; 2008-2015 Marek Matejak, Charles University in Prague.</p>
</html>", info="<html>
<p>Electrolytes have four main functions:</p>
<ul>
<li>Establish the osmotic concentration gradients on cell membranes</li>
<li>With balanced concentrations together with acid-base buffers establish the optimal acidity.</li>
<li>With balanced concentrations together with radicals and antioxidants establish the optimal reduction potential.</li>
<li>Electric signaling of cells such as neural action potential is possible because of passive/active selective membrane transports of electrolytes.</li>
</ul>
<p><br>The main electrolytes are:</p>
<ul>
<li>Sodium (Na+). Reabsorption of sodium in kidney nephrons is one of the main power for reabsorption of water [Wright1982,Bruun1990]. This process is driven by aldosterone[Young1976,Stanton1986] and angiotensin II [Ofangii1986,Lohmeier1998,Seeliger1999]. Sodium is reabsorbed in each part of nephron in different way such as from proximal tubule [Wiederholt1967,Gullans1985], from loop of Henle [Cortney1966] or from distal tubule[Morgan1969]. Other type of excretion is by sweating[Epstein1999,Quinton1991,Sato1989].</li>
<li>Potassuim (K+). The main compartment for potassium is intracellular fluid. Excretion of potassium by nephrons is driven also by aldosterone feedback control [Young1976, Young1983, Young1988]. The amount of secreted potassium to urine is dependent also on potasium plasma concentration [Toussaint1962] and on sodium excretion [Good1984,Young1984]. Other type of excretion is by sweating[Epstein1999,Quinton1991,Sato1989].</li>
<li>Chloride(Cl-) is the main plasma anion. His renal excretion such as renal excretion of amonium and bicarbonates is driven by the acidity of plasma [Cogan1979,Sartorius1949]. Other type of excretion is by sweating[Epstein1999,Quinton1991,Sato1989].</li>
<li>Amonium(NH4+) is formed and excreted in kidney to compensate plasma hydrogen ions concentration[Rodriguez-Nichols1984], because its production consume the free hydrogen ions changing to a strong cation at pH&LT;=7.4.  </li>
<li>Phosphates(H2PO4-, HPO4^2-) and sulphate(SO4^2-) has no renal reabsorption, which means, that their excretion to urine is dependent only on Donnan&apos;s equilibrium on glomerular membrane [Donnan1911]. </li>
</ul>
</html>"));
  end Electrolytes;


  package Nerves "Autonimic Nerves"
    extends Physiolibrary.Icons.NervesLib;
    model BaroReceptorAdaptation
      extends Physiolibrary.Icons.Barroreceptor;
      Physiolibrary.Types.RealIO.PressureInput pressure
                                             annotation (Placement(transformation(
              extent={{-120,-20},{-80,20}}), iconTransformation(extent={{-110,-10},
                {-90,10}})));
    Physiolibrary.Blocks.Math.Integrator adaptivePressure(
      y_start=AdaptivePressure,
      stateName="Baroreflex.AdaptedPressure",
        k=1/Tau)
      annotation (Placement(transformation(extent={{-22,-10},{-2,10}})));
      Modelica.Blocks.Math.Feedback pressureChange
        annotation (Placement(transformation(extent={{-70,-10},{-50,10}})));
    Physiolibrary.Blocks.Interpolation.Curve pressureChangeOnNA(
      x=PressureChangeOnNA[:, 1],
      y=PressureChangeOnNA[:, 2],
      slope=PressureChangeOnNA[:, 3],
        Xscale=101325/760)
      annotation (Placement(transformation(extent={{30,16},{66,52}})));
      Physiolibrary.Types.RealIO.FractionOutput NA
        annotation (Placement(transformation(extent={{80,-20},{120,20}})));
      parameter Physiolibrary.Types.Pressure AdaptivePressure(displayUnit="mmHg");
      parameter Physiolibrary.Types.Time Tau(displayUnit="h");
      parameter Real PressureChangeOnNA[3,:];

    equation
      connect(pressureChange.u2, adaptivePressure.y) annotation (Line(
          points={{-60,-8},{-60,-22},{12,-22},{12,0},{-1,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(pressureChange.y, adaptivePressure.u) annotation (Line(
          points={{-51,0},{-24,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(pressureChangeOnNA.val, NA) annotation (Line(
          points={{66,34},{88,34},{88,0},{100,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(pressureChange.y, pressureChangeOnNA.u) annotation (Line(
          points={{-51,0},{-40,0},{-40,34},{30,34}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(pressure, pressureChange.u1) annotation (Line(
          points={{-100,0},{-68,0}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={
            Text(
              extent={{-122,130},{118,102}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name")}));
    end BaroReceptorAdaptation;

    model SympatheticCNS
    extends Physiolibrary.Icons.SympatheticNerves;
      parameter Real BaroEffect[:,3]={{ 0.0,  1.5,  0}, { 1.0,  1.0,  -0.5}, { 2.0,  0.5,  0}};
      parameter Real LowPressureEffect[:, 3]={{ 0.0,  1.1,  0}, { 1.0,  1.0,  -0.1}, { 4.0,  0.9,  0}};
      parameter Real FuelEffect[:,3]={{ 0.30,  0.0,  0}, { 0.60,  3.0,  0}, { 0.80,  0.0,  0}};
      parameter Real A2ConcEffect[:,3]={{ 1.7,  1.0,  0}, { 2.3,  1.4,  0}};

      Modelica.Blocks.Interfaces.RealInput CarotidSinusReceptors
        annotation (Placement(transformation(extent={{-100,60},{-60,100}}),
            iconTransformation(extent={{-100,60},{-60,100}})));
      Modelica.Blocks.Interfaces.RealInput LowPressureReceptors
        annotation (Placement(transformation(extent={{-120,20},{-80,60}})));
    Physiolibrary.Blocks.Interpolation.Curve baroEffect(
      x=BaroEffect[:, 1],
      y=BaroEffect[:, 2],
      slope=BaroEffect[:, 3])
      annotation (Placement(transformation(extent={{-46,70},{-26,90}})));
    Physiolibrary.Blocks.Interpolation.Curve lowPressureEffect(
      x=LowPressureEffect[:, 1],
      y=LowPressureEffect[:, 2],
      slope=LowPressureEffect[:, 3])
      annotation (Placement(transformation(extent={{-46,30},{-26,50}})));
      Modelica.Blocks.Interfaces.RealInput brain_Fuel_FractUseDelay
        annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));
    Physiolibrary.Blocks.Interpolation.Curve fuelEffect(
      x=FuelEffect[:, 1],
      y=FuelEffect[:, 2],
      slope=FuelEffect[:, 3])
      annotation (Placement(transformation(extent={{-46,-10},{-26,10}})));
      Physiolibrary.Types.RealIO.ConcentrationInput Angiotensin2 annotation (
        Placement(transformation(extent={{-100,-100},{-60,-60}}),
          iconTransformation(extent={{-100,-100},{-60,-60}})));
      Modelica.Blocks.Math.Product reflexNA
        annotation (Placement(transformation(extent={{-2,54},{18,74}})));
      Modelica.Blocks.Math.Product neuralActivity
        annotation (Placement(transformation(extent={{56,-10},{76,10}})));
      Modelica.Blocks.Math.Sum stimulus(nin=3)
        annotation (Placement(transformation(extent={{28,8},{48,28}})));
      Physiolibrary.Types.RealIO.FrequencyOutput
                                            NA(
                                        displayUnit="Hz")
        annotation (Placement(transformation(extent={{80,-80},{120,-40}}),
            iconTransformation(extent={{80,-80},{120,-40}})));
      Modelica.Blocks.Interfaces.RealInput ExerciseSymps_TotalEffect
        annotation (Placement(transformation(extent={{-120,-60},{-80,-20}})));
      Modelica.Blocks.Math.Gain gain(k=1.5)
        annotation (Placement(transformation(extent={{84,-4},{92,4}})));
      Modelica.Blocks.Interfaces.RealOutput SympsCNS_A2Effect
        annotation (Placement(transformation(extent={{82,18},{122,58}}),
            iconTransformation(extent={{80,20},{120,60}})));
      Modelica.Blocks.Interfaces.RealOutput SympsCNS_BaroEffect
        annotation (Placement(transformation(extent={{60,60},{100,100}}),
            iconTransformation(extent={{60,60},{100,100}})));
    Physiolibrary.Blocks.Factors.Spline V0_A2_Effect(
      Xscale=1e-9/Substances.AngiotensinII.mw,
      UsePositiveLog10=true,
      data=A2ConcEffect)
      annotation (Placement(transformation(extent={{-30,-89},{-10,-69}})));
    Physiolibrary.Types.Constants.FractionConst fraction(k(displayUnit="1") = 1)
      annotation (Placement(transformation(extent={{-34,-64},{-26,-56}})));
    equation
      connect(CarotidSinusReceptors, baroEffect.u) annotation (Line(
          points={{-80,80},{-46,80}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(LowPressureReceptors, lowPressureEffect.u) annotation (Line(
          points={{-100,40},{-46,40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain_Fuel_FractUseDelay, fuelEffect.u) annotation (Line(
          points={{-100,0},{-46,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(baroEffect.val, reflexNA.u1) annotation (Line(
          points={{-26,80},{-14,80},{-14,70},{-4,70}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(lowPressureEffect.val, reflexNA.u2) annotation (Line(
          points={{-26,40},{-14,40},{-14,58},{-4,58}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(fuelEffect.val, stimulus.u[1])
                                         annotation (Line(
          points={{-26,0},{20,0},{20,18},{26,18},{26,16.6667}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(stimulus.y, neuralActivity.u1)
                                  annotation (Line(
          points={{49,18},{49.5,18},{49.5,6},{54,6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(reflexNA.y, stimulus.u[2])
                                     annotation (Line(
          points={{19,64},{22,64},{22,18},{26,18}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ExerciseSymps_TotalEffect, stimulus.u[3]) annotation (Line(
          points={{-100,-40},{22,-40},{22,19.3333},{26,19.3333}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(neuralActivity.y, gain.u) annotation (Line(
          points={{77,0},{83.2,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain.y, NA) annotation (Line(
          points={{92.4,0},{96,0},{96,-60},{100,-60}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(baroEffect.val, SympsCNS_BaroEffect) annotation (Line(
          points={{-26,80},{80,80}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(Angiotensin2, V0_A2_Effect.u) annotation (Line(
        points={{-80,-80},{-46,-80},{-46,-79},{-28,-79}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(V0_A2_Effect.y, SympsCNS_A2Effect) annotation (Line(
        points={{-20,-83},{-20,-96},{38,-96},{38,38},{102,38}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(V0_A2_Effect.y, neuralActivity.u2) annotation (Line(
        points={{-20,-83},{-20,-96},{38,-96},{38,-6},{54,-6}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(fraction.y, V0_A2_Effect.yBase) annotation (Line(
        points={{-25,-60},{-20,-60},{-20,-77}},
        color={0,0,127},
        smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-160,198},{156,164}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name")}));
    end SympatheticCNS;

    model ExerciseSympathetic
    extends Physiolibrary.Icons.PhysicalExercise;
      parameter Real MotorRadiation_TotalEffect[:,3]={{    0,  0.0,  0.004}, {  500,  2.2,  0.002}, { 1000,  2.6,  0}};
      parameter Real PhOnNerveActivity[:,3]={{ 6.5,  5.0,  0}, { 6.9,  0.0,  0}};

    Physiolibrary.Blocks.Interpolation.Curve
      SkeletalMuscle_Metaboreflex_NerveActivity(
      x=PhOnNerveActivity[:, 1],
      y=PhOnNerveActivity[:, 2],
      slope=PhOnNerveActivity[:, 3])
      annotation (Placement(transformation(extent={{-54,20},{-34,40}})));
      Physiolibrary.Types.RealIO.pHInput   SkeletalMuscle_Ph
        annotation (Placement(transformation(extent={{-136,0},{-96,40}}),
            iconTransformation(extent={{-120,20},{-80,60}})));
    Physiolibrary.Blocks.Interpolation.Curve motorRadiation_TotalEffect(
      x=MotorRadiation_TotalEffect[:, 1],
      y=MotorRadiation_TotalEffect[:, 2],
      slope=MotorRadiation_TotalEffect[:, 3])
      annotation (Placement(transformation(extent={{-54,-10},{-34,10}})));
      Modelica.Blocks.Math.Sum totalEffect(nin=2)
        annotation (Placement(transformation(extent={{32,-10},{52,10}})));
      Modelica.Blocks.Math.Gain gain(k=0.32)
        annotation (Placement(transformation(extent={{-26,26},{-18,34}})));
      Physiolibrary.Types.RealIO.FractionOutput ExerciseSymps_TotalEffect
        annotation (Placement(transformation(extent={{78,-20},{118,20}})));
      Physiolibrary.Types.RealIO.PowerInput ExerciseMetabolism_TotalWats
        annotation (Placement(transformation(extent={{-118,-60},{-78,-20}}),
            iconTransformation(extent={{-118,-60},{-78,-20}})));
    equation
      connect(SkeletalMuscle_Ph, SkeletalMuscle_Metaboreflex_NerveActivity.u)
                                            annotation (Line(
          points={{-116,20},{-85,20},{-85,30},{-54,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SkeletalMuscle_Metaboreflex_NerveActivity.val, gain.u)
        annotation (Line(
          points={{-34,30},{-26.8,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gain.y, totalEffect.u[1])
                                 annotation (Line(
          points={{-17.6,30},{6,30},{6,-1},{30,-1}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(motorRadiation_TotalEffect.val, totalEffect.u[2])
                                                         annotation (Line(
          points={{-34,0},{-1.9,0},{-1.9,1},{30,1}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ExerciseMetabolism_TotalWats, motorRadiation_TotalEffect.u)
                                            annotation (Line(
          points={{-98,-40},{-76,-40},{-76,0},{-54,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(totalEffect.y, ExerciseSymps_TotalEffect) annotation (Line(
          points={{53,0},{98,0}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={
            Text(
              extent={{-132,142},{130,106}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name")}));
    end ExerciseSympathetic;

    model VagusNerve
    extends Physiolibrary.Icons.NervusVagus;
      parameter Real SympsOnParasymps[:,3]={{ 0.0,  8.0,  0}, { 1.5,  2.0,  -2.0}, { 4.5,  0.0,  0}};

    Physiolibrary.Blocks.Interpolation.Curve sympsOnParasymps(
      x=SympsOnParasymps[:, 1],
      y=SympsOnParasymps[:, 2],
      slope=SympsOnParasymps[:, 3])
      annotation (Placement(transformation(extent={{-54,-10},{-34,10}})));
      Physiolibrary.Types.RealIO.FrequencyOutput VagusNerve_NA_Hz
        annotation (Placement(transformation(extent={{78,-20},{118,20}})));
      Physiolibrary.Types.RealIO.FrequencyInput SympsCNS_NA_Hz
        annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));
    equation
      connect(SympsCNS_NA_Hz, sympsOnParasymps.u)
                                            annotation (Line(
          points={{-100,0},{-54,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sympsOnParasymps.val, VagusNerve_NA_Hz) annotation (Line(
          points={{-34,0},{98,0}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={
            Text(
              extent={{-104,136},{100,102}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name")}));
    end VagusNerve;

    model GangliaKidney
      extends Physiolibrary.Icons.Kidney;
      parameter Real LowPressureEffect[:,3]={{ 0.0,  1.5,  0}, { 1.0,  1.0,  -0.4}, { 4.0,  0.2,  0}};
      parameter Real FuelEffect[:,3]={{ 0.30,  0.0,  0}, { 0.60,  3.0,  0}, { 0.80,  0.0,  0}};

      Modelica.Blocks.Interfaces.RealInput SympsCNS_BaroEffect
        annotation (Placement(transformation(extent={{-120,-60},{-80,-20}}),
            iconTransformation(extent={{-120,-60},{-80,-20}})));
      Modelica.Blocks.Interfaces.RealOutput NA
        annotation (Placement(transformation(extent={{60,42},{100,82}})));
      Modelica.Blocks.Interfaces.RealInput LowPressureReceptors_NA
        annotation (Placement(transformation(extent={{-120,20},{-80,60}}),
            iconTransformation(extent={{-120,20},{-80,60}})));
      Modelica.Blocks.Interfaces.RealInput brain_Fuel_FractUseDelay
        annotation (Placement(transformation(extent={{-100,60},{-60,100}}),
            iconTransformation(extent={{-100,60},{-60,100}})));
      Modelica.Blocks.Interfaces.RealInput SympsCNS_A2Effect
        annotation (Placement(transformation(extent={{-100,-100},{-60,-60}}),
            iconTransformation(extent={{-100,-100},{-60,-60}})));
      Modelica.Blocks.Interfaces.RealInput ExerciseSymps_TotalEffect
        annotation (Placement(transformation(extent={{-120,-20},{-80,20}}),
            iconTransformation(extent={{-120,-20},{-80,20}})));
      Modelica.Blocks.Math.Product      ReflexNA
        annotation (Placement(transformation(extent={{-12,4},{8,24}})));
    Physiolibrary.Blocks.Interpolation.Curve LowPressureEffectCurve(
      x=LowPressureEffect[:, 1],
      y=LowPressureEffect[:, 2],
      slope=LowPressureEffect[:, 3])
      annotation (Placement(transformation(extent={{-66,22},{-30,58}})));
    Physiolibrary.Blocks.Interpolation.Curve FuelEffectCurve(
      x=FuelEffect[:, 1],
      y=FuelEffect[:, 2],
      slope=FuelEffect[:, 3])
      annotation (Placement(transformation(extent={{-34,62},{2,98}})));
      Modelica.Blocks.Math.Sum sum1(nin=3)
        annotation (Placement(transformation(extent={{32,16},{52,36}})));
      Modelica.Blocks.Math.Product NeuralActivity
        annotation (Placement(transformation(extent={{62,-28},{82,-8}})));
      Modelica.Blocks.Math.Gain toHz(k=1.5)
        annotation (Placement(transformation(extent={{88,-4},{96,4}})));
    equation
      connect(LowPressureReceptors_NA, LowPressureEffectCurve.u) annotation (Line(
          points={{-100,40},{-66,40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain_Fuel_FractUseDelay, FuelEffectCurve.u) annotation (Line(
          points={{-80,80},{-34,80}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ReflexNA.y, sum1.u[1]) annotation (Line(
          points={{9,14},{18,14},{18,24.6667},{30,24.6667}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ExerciseSymps_TotalEffect, sum1.u[2]) annotation (Line(
          points={{-100,0},{16,0},{16.8848,25.502},{30,26}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(FuelEffectCurve.val, sum1.u[3]) annotation (Line(
          points={{2,80},{16,80},{16,26},{30,26},{30,27.3333}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sum1.y, NeuralActivity.u1) annotation (Line(
          points={{53,26},{56,26},{56,-12},{60,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsCNS_A2Effect, NeuralActivity.u2) annotation (Line(
          points={{-80,-80},{42,-80},{42,-24},{60,-24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(NeuralActivity.y, toHz.u) annotation (Line(
          points={{83,-18},{86,-18},{86,0},{87.2,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(toHz.y, NA) annotation (Line(
          points={{96.4,0},{98,0},{98,36},{68,36},{68,62},{80,62}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(LowPressureEffectCurve.val, ReflexNA.u1) annotation (Line(
        points={{-30,40},{-22,40},{-22,20},{-14,20}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(SympsCNS_BaroEffect, ReflexNA.u2) annotation (Line(
        points={{-100,-40},{-58,-40},{-58,8},{-14,8}},
        color={0,0,127},
        smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-112,138},{110,106}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name"), Ellipse(extent={{-106,104},{100,-98}},
                lineColor={0,0,0})}));
    end GangliaKidney;

    model BetaReceptorsActivityFactor
      //extends Library.BaseFactor2;

      Modelica.Blocks.Interfaces.RealInput GangliaGeneral_NA(final quantity=
            "Frequency", final displayUnit="Hz")       annotation (Placement(transformation(extent={{-100,40},
                {-80,60}}), iconTransformation(extent={{-108,-70},{-88,-50}})));
      Modelica.Blocks.Interfaces.RealInput BetaPool_Effect
                                          annotation (Placement(transformation(extent={{-100,0},
                {-80,20}}),
            iconTransformation(extent={{-108,50},{-88,70}})));
      Modelica.Blocks.Interfaces.RealInput BetaBlockade_Effect
                   annotation (Placement(transformation(extent={{-42,-46},{-22,-26}}),
            iconTransformation(extent={{-108,-10},{-88,10}})));
      Modelica.Blocks.Interfaces.RealInput yBase
                               annotation (Placement(transformation(extent={{-10,-10},
                {10,10}},
            rotation=270,
            origin={86,90}),
            iconTransformation(extent={{-10,-10},{10,10}},rotation=270,
            origin={0,70})));
      Modelica.Blocks.Interfaces.RealOutput y
                            annotation (Placement(transformation(extent={{-10,-10},
                {10,10}},
            rotation=270,
            origin={80,-90}),
            iconTransformation(extent={{-10,-10},{10,10}},  rotation=270,
            origin={0,-70})));

      parameter Real NEURALK(displayUnit="1/Hz") = 0.333;
      parameter Real HUMORALK = 0.5;
      parameter Boolean Switch = false;
      parameter Real Setting = 0;

      Modelica.Blocks.Math.Add TotalAgonism(k1=NEURALK, k2=HUMORALK)
        annotation (Placement(transformation(extent={{-58,20},{-38,40}})));
      Modelica.Blocks.Logical.Switch switch1
        annotation (Placement(transformation(extent={{18,28},{38,48}})));
    Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=Switch)
      annotation (Placement(transformation(extent={{-28,38},{-8,58}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=Setting)
      annotation (Placement(transformation(extent={{-30,76},{-10,96}})));
      Modelica.Blocks.Math.Product Activity
        annotation (Placement(transformation(extent={{-6,-40},{14,-20}})));
      Modelica.Blocks.Math.Product SympsEffect
                                            annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={80,-66})));
    equation

      connect(Activity.u2, BetaBlockade_Effect) annotation (Line(
          points={{-8,-36},{-32,-36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Activity.u1, switch1.y)
                                     annotation (Line(
          points={{-8,-24},{-20,-24},{-20,2},{62,2},{62,38},{39,38}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(switch1.u3, TotalAgonism.y)
                                 annotation (Line(
          points={{16,30},{-37,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(switch1.u2, booleanConstant.y) annotation (Line(
          points={{16,38},{-2,38},{-2,48},{-7,48}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(switch1.u1, Constant.y) annotation (Line(
          points={{16,46},{10,46},{10,86},{-7.5,86}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(yBase, SympsEffect.u1)
                                  annotation (Line(
          points={{86,90},{86,-54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsEffect.y, y)
                             annotation (Line(
          points={{80,-77},{80,-90}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GangliaGeneral_NA, TotalAgonism.u1) annotation (Line(
          points={{-90,50},{-70,50},{-70,36},{-60,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BetaPool_Effect, TotalAgonism.u2)  annotation (Line(
          points={{-90,10},{-70,10},{-70,24},{-60,24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Activity.y, SympsEffect.u2) annotation (Line(
          points={{15,-30},{74,-30},{74,-54}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                -100},{100,100}}), graphics={Rectangle(
              extent={{-100,70},{100,-70}},
              lineColor={112,143,0},
              fillPattern=FillPattern.Sphere,
              fillColor={255,255,255}), Text(
              extent={{-88,-40},{100,48}},
              lineColor={0,0,0},
              fillPattern=FillPattern.Sphere,
              fillColor={85,255,170},
              textString="%name")}));
    end BetaReceptorsActivityFactor;

    model AplhaReceptorsActivityFactor
      //extends Library.BaseFactor2;

      Physiolibrary.Types.RealIO.FractionInput GangliaGeneral_NA(displayUnit="1")       annotation (Placement(transformation(extent={{-100,40},
                {-80,60}}), iconTransformation(extent={{-108,-70},{-88,-50}})));
      Physiolibrary.Types.RealIO.FractionInput AlphaPool_Effect
                                          annotation (Placement(transformation(extent={{-100,0},
                {-80,20}}),
            iconTransformation(extent={{-108,50},{-88,70}})));
      Physiolibrary.Types.RealIO.FractionInput AlphaBlockade_Effect
                   annotation (Placement(transformation(extent={{-42,-46},{-22,-26}}),
            iconTransformation(extent={{-108,-10},{-88,10}})));
      Modelica.Blocks.Interfaces.RealInput yBase
                               annotation (Placement(transformation(extent={{-10,-10},
                {10,10}},
            rotation=270,
            origin={86,90}),
            iconTransformation(extent={{-10,-10},{10,10}},rotation=270,
            origin={0,70})));
      Modelica.Blocks.Interfaces.RealOutput y
                            annotation (Placement(transformation(extent={{-10,-10},
                {10,10}},
            rotation=270,
            origin={80,-90}),
            iconTransformation(extent={{-10,-10},{10,10}},  rotation=270,
            origin={0,-70})));

      parameter Real[:,3] data;

      parameter Physiolibrary.Types.Fraction NEURALK = 0.333;
      parameter Physiolibrary.Types.Fraction HUMORALK = 0.5;
      parameter Boolean Switch = false;
      parameter Physiolibrary.Types.Fraction Setting = 0;

      Modelica.Blocks.Math.Add TotalAgonism(k1=NEURALK, k2=HUMORALK)
        annotation (Placement(transformation(extent={{-58,20},{-38,40}})));
      Modelica.Blocks.Logical.Switch switch1
        annotation (Placement(transformation(extent={{18,28},{38,48}})));
    Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=Switch)
      annotation (Placement(transformation(extent={{-28,38},{-8,58}})));
    Physiolibrary.Types.Constants.FractionConst             Constant(k=Setting)
      annotation (Placement(transformation(extent={{-30,76},{-10,96}})));
    Physiolibrary.Blocks.Interpolation.Curve SympsOnConductance(
      x=data[:, 1],
      y=data[:, 2],
      slope=data[:, 3])
      annotation (Placement(transformation(extent={{30,-40},{50,-20}})));
      Modelica.Blocks.Math.Product Activity
        annotation (Placement(transformation(extent={{-6,-40},{14,-20}})));
      Modelica.Blocks.Math.Product SympsEffect
                                            annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={80,-66})));
    equation

      connect(SympsEffect.u2, SympsOnConductance.val)
                                      annotation (Line(
          points={{74,-54},{74,-30},{50,-30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsOnConductance.u, Activity.y)
                                  annotation (Line(
          points={{30,-30},{15,-30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Activity.u2, AlphaBlockade_Effect)
                                                annotation (Line(
          points={{-8,-36},{-32,-36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Activity.u1, switch1.y)
                                     annotation (Line(
          points={{-8,-24},{-20,-24},{-20,2},{62,2},{62,38},{39,38}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(switch1.u3, TotalAgonism.y)
                                 annotation (Line(
          points={{16,30},{-37,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(switch1.u2, booleanConstant.y) annotation (Line(
          points={{16,38},{-2,38},{-2,48},{-7,48}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(switch1.u1, Constant.y) annotation (Line(
          points={{16,46},{10,46},{10,86},{-7.5,86}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(yBase, SympsEffect.u1)
                                  annotation (Line(
          points={{86,90},{86,-54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsEffect.y, y)
                             annotation (Line(
          points={{80,-77},{80,-90}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GangliaGeneral_NA, TotalAgonism.u1) annotation (Line(
          points={{-90,50},{-70,50},{-70,36},{-60,36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(AlphaPool_Effect, TotalAgonism.u2) annotation (Line(
          points={{-90,10},{-70,10},{-70,24},{-60,24}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                -100},{100,100}}), graphics={Rectangle(
              extent={{-100,70},{100,-70}},
              lineColor={112,143,0},
              fillPattern=FillPattern.Sphere,
              fillColor={255,255,255}), Text(
              extent={{-88,-40},{100,48}},
              lineColor={0,0,0},
              fillPattern=FillPattern.Sphere,
              fillColor={85,255,170},
              textString="%name")}));
    end AplhaReceptorsActivityFactor;

    model Pituitary
      extends Physiolibrary.Icons.Hypophysis;
      parameter Real BaroreflexOnBaroEffectData[:,3]={{ 0.0,  1.5,  0}, { 1.0,  1.0,  -0.5}, { 2.0,  0.5,  0}};

    Physiolibrary.Blocks.Interpolation.Curve BaroreflexOnBaroEffect(
      x=BaroreflexOnBaroEffectData[:, 1],
      y=BaroreflexOnBaroEffectData[:, 2],
      slope=BaroreflexOnBaroEffectData[:, 3])
      annotation (Placement(transformation(extent={{-54,-10},{-34,10}})));
      Modelica.Blocks.Interfaces.RealOutput BaroEffect
        annotation (Placement(transformation(extent={{78,-20},{118,20}})));
      Modelica.Blocks.Interfaces.RealInput Baroreflex_NA
        annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));
      Modelica.Blocks.Math.Feedback sub
        annotation (Placement(transformation(extent={{-18,-10},{2,10}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=1)
      annotation (Placement(transformation(extent={{-22,-20},{-14,-12}})));
      Modelica.Blocks.Math.Add add
        annotation (Placement(transformation(extent={{46,-10},{66,10}})));
      Modelica.Blocks.Math.Product product
        annotation (Placement(transformation(extent={{12,2},{32,22}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant BaroSensitivity(k=1)
      annotation (Placement(transformation(extent={{-12,30},{-4,38}})));
    equation
      connect(Baroreflex_NA, BaroreflexOnBaroEffect.u)
                                            annotation (Line(
          points={{-100,0},{-54,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BaroreflexOnBaroEffect.val, sub.u1) annotation (Line(
          points={{-34,0},{-16,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, sub.u2) annotation (Line(
          points={{-13,-16},{-8,-16},{-8,-8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(add.y, BaroEffect) annotation (Line(
          points={{67,0},{98,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, add.u2) annotation (Line(
          points={{-13,-16},{16,-16},{16,-6},{44,-6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(product.y, add.u1) annotation (Line(
          points={{33,12},{38,12},{38,6},{44,6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sub.y, product.u2) annotation (Line(
          points={{1,0},{6,0},{6,6},{10,6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BaroSensitivity.y, product.u1) annotation (Line(
          points={{-3,34},{4,34},{4,18},{10,18}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=false, extent={{-100,-100},{100,100}}),
            graphics={Text(
              extent={{-110,128},{110,102}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name")}));
    end Pituitary;

    model Hypothalamus

      Modelica.Blocks.Interfaces.RealInput BrainFunctionEffect
        annotation (Placement(transformation(extent={{-120,40},{-80,80}})));
      Modelica.Blocks.Interfaces.RealOutput HypothalamusSkinFlow_NA
        annotation (Placement(transformation(extent={{80,-40},{120,0}})));
      Physiolibrary.Types.RealIO.TemperatureInput HeatCore_Temp
        annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));
    Physiolibrary.Blocks.Factors.Spline TemperatureEffect_(data={{-2.0,0.0,0},{
          0.0,1.0,1.8},{2.0,4.0,0}})
      annotation (Placement(transformation(extent={{-52,-24},{-32,-4}})));
      Modelica.Blocks.Math.Feedback feedback annotation (Placement(
            transformation(
            extent={{6,-6},{-6,6}},
            rotation=180,
            origin={-60,-14})));
    Physiolibrary.Types.Constants.TemperatureConst temperatureConstant(k=310.15)
      annotation (Placement(transformation(extent={{-44,-6},{-52,2}})));
    Physiolibrary.Blocks.Factors.Spline SkinTempOffset(data={{24 + 273.15,0.0,0},
          {32 + 273.15,-1.0,0}})
      annotation (Placement(transformation(extent={{-62,-62},{-42,-42}})));
      Physiolibrary.Types.RealIO.TemperatureInput HeatSkin_Temp
        annotation (Placement(transformation(extent={{-120,-60},{-80,-20}})));
    Physiolibrary.Types.Constants.TemperatureConst temperatureConstant1(k=310.15)
      annotation (Placement(transformation(extent={{-40,-46},{-48,-38}})));
      Modelica.Blocks.Math.Feedback feedback1 annotation (Placement(
            transformation(
            extent={{6,-6},{-6,6}},
            rotation=180,
            origin={-52,-80})));
    Physiolibrary.Blocks.Interpolation.Curve NerveActivity(
      x={-2,0},
      y={4,0},
      slope={0,0})
      annotation (Placement(transformation(extent={{-32,-90},{-12,-70}})));
      Physiolibrary.Blocks.Factors.SplineLag      HypothalamusShiveringAcclimation(
        HalfTime=7*86400*Modelica.Math.log(2),
        integrator(y_start=0),
        stateName="HypothalamusShiveringAcclimation.Offset",
      data={{20 + 273.15,0.3,0},{28 + 273.15,0.0,-0.04},{39 + 273.15,-0.3,0}})
        annotation (Placement(transformation(extent={{-62,-72},{-42,-52}})));
      Modelica.Blocks.Interfaces.RealOutput HypothalamusShivering_NA
        annotation (Placement(transformation(extent={{80,-100},{120,-60}})));
      Modelica.Blocks.Interfaces.RealOutput HypothalamusSweating_NA
        annotation (Placement(transformation(extent={{80,20},{120,60}})));
    Physiolibrary.Blocks.Interpolation.Curve NerveActivity1(
      slope={0,0},
      x={0,2},
      y={0,4}) annotation (Placement(transformation(extent={{64,30},{84,50}})));
      Modelica.Blocks.Math.Feedback feedback2 annotation (Placement(
            transformation(
            extent={{6,-6},{-6,6}},
            rotation=180,
            origin={50,40})));
      Modelica.Blocks.Math.Sum SetPoint(nin=3)
        annotation (Placement(transformation(extent={{40,70},{48,78}})));
    Physiolibrary.Types.Constants.TemperatureConst temperatureConstant2(k=310.15)
      annotation (Placement(transformation(extent={{24,80},{32,88}})));
    Physiolibrary.Blocks.Interpolation.Curve SkinTempOffset_Sweating(
      slope={0,0},
      y={1,0},
      x={25 + 273.15,35 + 273.15})
               annotation (Placement(transformation(extent={{-2,14},{18,34}})));
      Physiolibrary.Blocks.Factors.SplineLag      HypothalamusSweatingAcclimation1(
        integrator(y_start=0),
        HalfTime=7*86400*Modelica.Math.log(2),
        stateName="HypothalamusSweatingAcclimation.Offset",
      data={{20 + 273.15,0.3,0},{28 + 273.15,0.0,-0.04},{39 + 273.15,-0.3,0}})
        annotation (Placement(transformation(extent={{-2,70},{18,90}})));
    Physiolibrary.Types.Constants.OneConst                  Constant
      annotation (Placement(transformation(extent={{-2,84},{6,92}})));
    equation
      connect(TemperatureEffect_.u, feedback.y) annotation (Line(
          points={{-50,-14},{-54.6,-14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(feedback.u2, temperatureConstant.y) annotation (Line(
          points={{-60,-9.2},{-60,-2},{-53,-2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(TemperatureEffect_.yBase, BrainFunctionEffect) annotation (Line(
          points={{-42,-12},{-42,60},{-100,60}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(TemperatureEffect_.y, HypothalamusSkinFlow_NA) annotation (Line(
          points={{-42,-18},{-42,-20},{100,-20}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HeatCore_Temp, feedback.u1) annotation (Line(
          points={{-100,0},{-72,0},{-72,-14},{-64.8,-14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HeatSkin_Temp, SkinTempOffset.u) annotation (Line(
          points={{-100,-40},{-68,-40},{-68,-52},{-60,-52}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(temperatureConstant1.y, SkinTempOffset.yBase) annotation (Line(
          points={{-49,-42},{-52,-42},{-52,-50}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HeatCore_Temp, feedback1.u1) annotation (Line(
          points={{-100,0},{-72,0},{-72,-80},{-56.8,-80}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(feedback1.y, NerveActivity.u) annotation (Line(
          points={{-46.6,-80},{-32,-80}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HeatSkin_Temp, HypothalamusShiveringAcclimation.u)
                                                                annotation (
          Line(
          points={{-100,-40},{-68,-40},{-68,-62},{-60,-62}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SkinTempOffset.y, HypothalamusShiveringAcclimation.yBase)
        annotation (Line(
          points={{-52,-56},{-52,-60}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HypothalamusShiveringAcclimation.y, feedback1.u2)
                                                               annotation (Line(
          points={{-52,-66},{-52,-75.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(NerveActivity.val, HypothalamusShivering_NA) annotation (Line(
          points={{-12,-80},{100,-80}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(NerveActivity1.val, HypothalamusSweating_NA) annotation (Line(
          points={{84,40},{100,40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(feedback2.u1, HeatCore_Temp) annotation (Line(
          points={{45.2,40},{-72,40},{-72,0},{-100,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(feedback2.y, NerveActivity1.u) annotation (Line(
          points={{55.4,40},{64,40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SetPoint.y, feedback2.u2) annotation (Line(
          points={{48.4,74},{50,74},{50,44.8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(temperatureConstant2.y, SetPoint.u[1]) annotation (Line(
          points={{33,84},{34,84},{34,73.4667},{39.2,73.4667}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SkinTempOffset_Sweating.val, SetPoint.u[2]) annotation (Line(
          points={{18,24},{36,24},{36,74},{39.2,74}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HeatSkin_Temp, SkinTempOffset_Sweating.u) annotation (Line(
          points={{-100,-40},{-68,-40},{-68,-34},{-12,-34},{-12,24},{-2,24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HypothalamusSweatingAcclimation1.y, SetPoint.u[3]) annotation (
          Line(
          points={{8,76},{8,74.5333},{39.2,74.5333}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HeatSkin_Temp, HypothalamusSweatingAcclimation1.u) annotation (
          Line(
          points={{-100,-40},{-68,-40},{-68,-34},{-12,-34},{-12,80},{0,80}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(Constant.y, HypothalamusSweatingAcclimation1.yBase) annotation (
          Line(
          points={{7,88},{8,88},{8,82}},
          color={0,0,127},
          smooth=Smooth.None));
    end Hypothalamus;

    model SA_Node
    extends Physiolibrary.Icons.SinoatrialNode;
      parameter Real SympatheticEffect[:,3]={{ 0.0,    0,  0}, { 1.0,   10,  10}, { 5.0,  120,  0}};
      parameter Real ParasympatheticEffect[:,3]={{ 0.0,    0,  0}, { 2.0,  -20,  -8}, { 8.0,  -40,  0}};

      Modelica.Blocks.Interfaces.RealInput GangliaGeneral_NA
        annotation (Placement(transformation(extent={{-120,-40},{-80,0}})));
    Physiolibrary.Blocks.Interpolation.Curve parasympatheticEffect(
      x=ParasympatheticEffect[:, 1],
      y=ParasympatheticEffect[:, 2],
      slope=ParasympatheticEffect[:, 3],
      Yscale=1/60)
      annotation (Placement(transformation(extent={{-50,-70},{-30,-50}})));
      Modelica.Blocks.Math.Sum rate(nin=3)
        annotation (Placement(transformation(extent={{64,-10},{84,10}})));
      Modelica.Blocks.Interfaces.RealOutput Rate
        annotation (Placement(transformation(extent={{78,-20},{118,20}})));
      Physiolibrary.Types.RealIO.FrequencyInput VagusNerve_NA_Hz
        annotation (Placement(transformation(extent={{-120,-80},{-80,-40}})));
      Physiomodel.Nerves.BetaReceptorsActivityFactor betaReceptorsActivityFactor
        annotation (Placement(transformation(extent={{10,62},{30,82}})));
    Physiolibrary.Types.Constants.OneConst                  Constant
      annotation (Placement(transformation(extent={{-2,82},{10,94}})));
    Physiolibrary.Types.Constants.FrequencyConst            Constant1(k(
          displayUnit="1/min") = 1.3666666666667)
      annotation (Placement(transformation(extent={{-6,-10},{14,10}})));
      Modelica.Blocks.Interfaces.RealInput BetaBlockade_Effect
        annotation (Placement(transformation(extent={{-120,0},{-80,40}})));
      Modelica.Blocks.Interfaces.RealInput BetaPool_Effect
        annotation (Placement(transformation(extent={{-120,40},{-80,80}})));
    Physiolibrary.Blocks.Interpolation.Curve sympatheticEffect(
      x=SympatheticEffect[:, 1],
      y=SympatheticEffect[:, 2],
      slope=SympatheticEffect[:, 3],
      Yscale=1/60)
      annotation (Placement(transformation(extent={{26,20},{46,40}})));
    equation
      connect(parasympatheticEffect.val, rate.u[2])      annotation (Line(
          points={{-30,-60},{54.1,-60},{54.1,1.11022e-016},{62,1.11022e-016}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(VagusNerve_NA_Hz, parasympatheticEffect.u)
                                            annotation (Line(
          points={{-100,-60},{-50,-60}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(rate.y, Rate) annotation (Line(
          points={{85,0},{98,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, betaReceptorsActivityFactor.yBase) annotation (Line(
          points={{11.5,88},{20,88},{20,79}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant1.y, rate.u[1]) annotation (Line(
          points={{16.5,0},{14,0},{14,-1.33333},{62,-1.33333}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BetaPool_Effect, betaReceptorsActivityFactor.BetaPool_Effect)
        annotation (Line(
          points={{-100,60},{-46,60},{-46,78},{10.2,78}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(betaReceptorsActivityFactor.BetaBlockade_Effect, BetaBlockade_Effect)
        annotation (Line(
          points={{10.2,72},{-40,72},{-40,20},{-100,20}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GangliaGeneral_NA, betaReceptorsActivityFactor.GangliaGeneral_NA)
        annotation (Line(
          points={{-100,-20},{-30,-20},{-30,66},{10.2,66}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(betaReceptorsActivityFactor.y, sympatheticEffect.u) annotation (
          Line(
          points={{20,65},{20,30},{26,30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sympatheticEffect.val, rate.u[3]) annotation (Line(
          points={{46,30},{54,30},{54,1.33333},{62,1.33333}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={
            Text(
              extent={{-102,134},{100,102}},
              lineColor={0,0,0},
              fillColor={213,255,170},
              fillPattern=FillPattern.Solid,
              textString="%name")}));
    end SA_Node;

    model Nerves
     extends Physiolibrary.Icons.Nerves;
    BaroReceptorAdaptation Baroreflex(
      PressureChangeOnNA={{-50.0,0.0,0},{0.0,1.0,0.02},{50.0,2.0,0}},
      AdaptivePressure(displayUnit="mmHg") = 12914.659691877,
      Tau(displayUnit="h") = 36000) annotation (Placement(transformation(
          extent={{9,9},{-9,-9}},
          rotation=180,
          origin={-41,45})));
      ExerciseSympathetic exercise                   annotation (Placement(
            transformation(extent={{-62,-68},{-42,-48}})));
      SympatheticCNS sympatheticCNS
        annotation (Placement(transformation(extent={{-2,-86},{18,-66}})));
      VagusNerve vagusNerve
        annotation (Placement(transformation(extent={{46,-98},{66,-78}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-78,76},{-58,96}}), iconTransformation(extent=
             {{-98,56},{-58,96}})));
      GangliaKidney gangliaKidney
        annotation (Placement(transformation(extent={{38,-16},{58,4}})));
      Modelica.Blocks.Math.Gain AdrenalNerve(k=0.667)
      "from Hz to normal activity"
        annotation (Placement(transformation(extent={{52,-36},{60,-28}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=1)
      annotation (Placement(transformation(extent={{62,-16},{70,-8}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant KidneyAlpha_PT_NA(k=
         1) annotation (Placement(transformation(extent={{62,2},{70,10}})));
      Pituitary pituitary
        annotation (Placement(transformation(extent={{44,34},{64,54}})));
    equation
      connect(sympatheticCNS.ExerciseSymps_TotalEffect, exercise.ExerciseSymps_TotalEffect)
        annotation (Line(
          points={{-2,-80},{-30,-80},{-30,-58},{-42.2,-58}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(vagusNerve.SympsCNS_NA_Hz,sympatheticCNS. NA) annotation (Line(
          points={{46,-88},{30,-88},{30,-82},{18,-82}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sympatheticCNS.NA, busConnector.GangliaGeneral_NA) annotation (
          Line(
          points={{18,-82},{30,-82},{30,98},{-68,98},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Baroreflex.NA, sympatheticCNS.CarotidSinusReceptors) annotation (
          Line(
          points={{-32,45},{-8,45},{-8,-68},{0,-68}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.CarotidSinusArteryPressure, Baroreflex.pressure)
        annotation (Line(
          points={{-68,86},{-88,86},{-88,45},{-50,45}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(exercise.ExerciseSymps_TotalEffect, gangliaKidney.ExerciseSymps_TotalEffect)
        annotation (Line(
          points={{-42.2,-58},{-30,-58},{-30,-38},{22,-38},{22,-6},{38,-6}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.brain_Fuel_FractUseDelay, gangliaKidney.brain_Fuel_FractUseDelay)
        annotation (Line(
          points={{-68,86},{-88,86},{-88,2},{40,2}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(gangliaKidney.NA, busConnector.GangliaKidney_NA) annotation (Line(
          points={{56,0.2},{100,0.2},{100,98},{-68,98},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(sympatheticCNS.SympsCNS_BaroEffect, gangliaKidney.SympsCNS_BaroEffect)
        annotation (Line(
          points={{16,-68},{24,-68},{24,-10},{38,-10}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sympatheticCNS.SympsCNS_A2Effect, gangliaKidney.SympsCNS_A2Effect)
        annotation (Line(
          points={{18,-72},{26,-72},{26,-14},{40,-14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.ExerciseMetabolism_TotalWatts, exercise.ExerciseMetabolism_TotalWats)
        annotation (Line(
          points={{-68,86},{-88,86},{-88,-62},{-61.8,-62}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(sympatheticCNS.NA, AdrenalNerve.u) annotation (Line(
          points={{18,-82},{36,-82},{36,-32},{51.2,-32}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(AdrenalNerve.y, busConnector.AdrenalNerve_NA) annotation (Line(
          points={{60.4,-32},{100,-32},{100,98},{-88,98},{-88,86},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant.y, busConnector.Kidney_Alpha_NA) annotation (Line(
          points={{71,-12},{100,-12},{100,98},{-88,98},{-88,86},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(KidneyAlpha_PT_NA.y, busConnector.KidneyAlpha_PT_NA) annotation (Line(
          points={{71,6},{100,6},{100,98},{-88,98},{-88,86},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Baroreflex.NA, pituitary.Baroreflex_NA) annotation (Line(
          points={{-32,45},{-8,45},{-8,44},{44,44}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(pituitary.BaroEffect, busConnector.SympsCNS_PituitaryNA)
        annotation (Line(
          points={{63.8,44},{100,44},{100,98},{-88,98},{-88,86},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(busConnector.skeletalMuscle_pH_intracellular, exercise.SkeletalMuscle_Ph)
        annotation (Line(
          points={{-68,86},{-88,86},{-88,-54},{-62,-54}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(vagusNerve.VagusNerve_NA_Hz, busConnector.VagusNerve_NA_Hz)
        annotation (Line(
          points={{65.8,-88},{100,-88},{100,86},{-68,86}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(busConnector.Angiotensin2, sympatheticCNS.Angiotensin2)
      annotation (Line(
        points={{-68,86},{-88,86},{-88,-92},{-40,-92},{-40,-84},{0,-84}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.brain_Fuel_FractUseDelay, sympatheticCNS.brain_Fuel_FractUseDelay)
      annotation (Line(
        points={{-68,86},{-88,86},{-88,-76},{-2,-76}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.AtrialLowPressureReceptors_NA, gangliaKidney.LowPressureReceptors_NA)
      annotation (Line(
        points={{-68,86},{-88,86},{-88,-2},{38,-2}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(busConnector.AtrialLowPressureReceptors_NA, sympatheticCNS.LowPressureReceptors)
      annotation (Line(
        points={{-68,86},{-88,86},{-88,-72},{-2,-72}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
            graphics={                      Text(
              extent={{-120,-70},{122,-104}},
              lineColor={0,0,255},
              textString="%name")}));
    end Nerves;

    package IO_Bus
        extends Physiolibrary.Types.IO_Bus;

      redeclare model extends Variables

      T.Fraction AdrenalNerve_NA(varName="AdrenalNerve.NA")
        "Nerve activity of adrenal nerve."
      annotation (Placement(transformation(extent={{-36,10},{-30,16}})));
      T.Frequency GangliaGeneral_NA(varName="GangliaGeneral.NA(Hz)", storeUnit="Hz")
        "Neural activity of autonomous sympathetic nervous system."
      annotation (Placement(transformation(extent={{-36,20},{-30,26}})));
      T.Frequency GangliaKidney_NA(varName="GangliaKidney.NA(Hz)", storeUnit="Hz")
        "Sympathetis kidney ganglia neural activity."
      annotation (Placement(transformation(extent={{-36,30},{-30,36}})));
      T.Frequency VagusNerve(varName="VagusNerve.NA(Hz)", storeUnit="Hz")
        "Neurus vagus activity."
      annotation (Placement(transformation(extent={{-36,-12},{-30,-6}})));
      T.Fraction Kidney_Alpha_NA(varName="Kidney-Alpha.NA")
        "Kidney alpha neural activity effect."
      annotation (Placement(transformation(extent={{-36,70},{-30,76}})));
      T.Fraction KidneyAlpha_PT_NA(varName="Kidney-Alpha.PT_NA")
        "Kidney alpha proximal tubule neural activity effect."
      annotation (Placement(transformation(extent={{-36,80},{-30,86}})));
      T.Fraction SympsCNS_PituitaryNA(varName="SympsCNS.PituitaryNA")
        "Sympathetis pituitary nerve activity."
      annotation (Placement(transformation(extent={{-36,110},{-30,116}})));
      equation

      connect(AdrenalNerve_NA.y, busConnector.AdrenalNerve_NA) annotation (Line(
       points={{-29.7,13},{90,13},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GangliaGeneral_NA.y, busConnector.GangliaGeneral_NA) annotation (Line(
       points={{-29.7,23},{90,23},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GangliaKidney_NA.y, busConnector.GangliaKidney_NA) annotation (Line(
       points={{-29.7,33},{90,33},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Kidney_Alpha_NA.y, busConnector.Kidney_Alpha_NA) annotation (Line(
       points={{-29.7,73},{90,73},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KidneyAlpha_PT_NA.y, busConnector.KidneyAlpha_PT_NA) annotation (Line(
       points={{-29.7,83},{90,83},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(SympsCNS_PituitaryNA.y, busConnector.SympsCNS_PituitaryNA) annotation (Line(
       points={{-29.7,113},{90,113},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

        connect(VagusNerve.y, busConnector.VagusNerve_NA_Hz) annotation (Line(
            points={{-29.7,-9},{66,-9},{66,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{18,78},{100,40}},
                lineColor={0,0,0},
                textString="vars"), Text(
                extent={{-124,-54},{118,-88}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model Nerves_test
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile
                                                nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.Nerves nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Nerves.IO_Bus.OutputComparison nerves_dif
          annotation (Placement(transformation(extent={{44,44},{64,64}})));
        Physiomodel.Nerves.IO_Bus.OutputToFile nerves_varsToFile
          annotation (Placement(transformation(extent={{18,32},{38,52}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,55.6},{76.2,55.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(nerves_dif.busConnector, nerves.busConnector) annotation (Line(
            points={{54,54},{64,54},{64,55.6},{76.2,55.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(nerves.busConnector, nerves_varsToFile.busConnector)
          annotation (Line(
            points={{76.2,55.6},{28,55.6},{28,42}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Nerves_test;

      model Nerves_test_SI
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI
                                                nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile_SI electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile_SI hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.Nerves nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
        Physiomodel.Nerves.IO_Bus.OutputComparison_SI nerves_dif
          annotation (Placement(transformation(extent={{44,44},{64,64}})));
        Physiomodel.Nerves.IO_Bus.OutputToFile_SI nerves_varsToFile
          annotation (Placement(transformation(extent={{18,32},{38,52}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,55.6},{76.2,55.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(nerves_dif.busConnector, nerves.busConnector) annotation (Line(
            points={{54,54},{64,54},{64,55.6},{76.2,55.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(nerves.busConnector, nerves_varsToFile.busConnector)
          annotation (Line(
            points={{76.2,55.6},{28,55.6},{28,42}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Nerves_test_SI;
    end IO_Bus;

    annotation (Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2008-2015</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: HumMod 1.6, University of Mississippi Medical Center</p></td>
</tr>
</table>
<p>Copyright &copy; 2008-2015 Marek Matejak, Charles University in Prague.</p>
</html>", info="<html>
<p>General</p>
<p>The book about autonimic nerve functions by Matias and Bannister [Mathias2013]. Autonomic response is sympathetic (through alpha/beta receptors, connected with catecholamines) or parasympathetic (nervus vagus).</p>
<p><br>Baroreflex</p>
<p>Blood pressure, vasoconstriction[Drees1974,Risoe1994] and heart rate is driven by baroreflex [Conci2001,Williamson1993,Plotts1993]. The pressure is measured in carotid sinus receptors [Hayward1993,Imaizumi1993,Mendelowitz1988,Plotts1993,VanDeBorne1999] and ventricular receptors [Little1975,Wennergren1976]. Integration of measured signal is processed in the solitary nucleus of medulla oblongata [Rogers1993]. </p>
<p><br>Thermoregulation</p>
<p>Themperature signal from terrmoreceptors is processed by the preoptic area of the anterior hypothalamus [Kelso1982,Dodt1952,Hensel1953].</p>
</html>"));
  end Nerves;


  package Heat "Body Temperature Balance"
    extends Physiolibrary.Icons.HeatLib;

    model TissuesHeat
     extends Physiolibrary.Icons.Tissues;

      Tissues.Bone Bone
        annotation (Placement(transformation(extent={{64,30},{44,50}})));

      Tissues.Fat Fat
        annotation (Placement(transformation(extent={{64,-62},{44,-42}})));

      Tissues.Brain Brain
        annotation (Placement(transformation(extent={{-58,-2},{-38,18}})));

      Tissues.RightHeart RightHeart
        annotation (Placement(transformation(extent={{-58,30},{-38,50}})));

      Tissues.RespiratoryMuscle RespiratoryMuscle
        annotation (Placement(transformation(extent={{-58,-30},{-38,-10}})));

      Tissues.OtherTissue OtherTissue
        annotation (Placement(transformation(extent={{64,-88},{44,-68}})));

      Tissues.Liver Liver
        annotation (Placement(transformation(extent={{64,58},{44,78}})));

      Tissues.LeftHeart LeftHeart
        annotation (Placement(transformation(extent={{-58,-62},{-38,-42}})));

      Tissues.Kidney Kidney
        annotation (Placement(transformation(extent={{64,-32},{44,-12}})));

      Tissues.GITract GITract
        annotation (Placement(transformation(extent={{64,-2},{44,18}})));

    Physiolibrary.Types.BusConnector busConnector
      annotation (Placement(transformation(extent={{-108,72},{-68,112}})));

    equation
      connect(busConnector.core_T, Brain.BaseT)
        annotation (Line(
          points={{-88,92},{-62,92},{-62,8},{-58,8}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-5,0},{-5,0}}));
      connect(busConnector.core_T, RespiratoryMuscle.BaseT)
        annotation (Line(
          points={{-88,92},{-62,92},{-62,-20},{-58,-20}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-5,0},{-5,0}}));
      connect(busConnector.core_T, LeftHeart.BaseT)
        annotation (Line(
          points={{-88,92},{-62,92},{-62,-52},{-58,-52}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-5,0},{-5,0}}));
      connect(busConnector.core_T, RightHeart.BaseT)
        annotation (Line(
          points={{-88,92},{-62,92},{-62,40},{-58,40}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-5,0},{-5,0}}));
      connect(Bone.BaseT, busConnector.core_T)  annotation (
          Line(
          points={{64,40},{68,40},{68,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,0},{5,0}}));
      connect(Liver.BaseT, busConnector.core_T)  annotation (
         Line(
          points={{64,68},{68,68},{68,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,0},{5,0}}));
      connect(Kidney.BaseT, busConnector.core_T)
        annotation (Line(
          points={{64,-22},{68,-22},{68,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,0},{5,0}}));
      connect(GITract.BaseT, busConnector.core_T)
        annotation (Line(
          points={{64,8},{68,8},{68,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,0},{5,0}}));
      connect(Fat.BaseT, busConnector.core_T)  annotation (
          Line(
          points={{64,-52},{68,-52},{68,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,0},{5,0}}));
      connect(OtherTissue.BaseT, busConnector.core_T)
        annotation (Line(
          points={{64,-78},{68,-78},{68,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,0},{5,0}}));

      connect(RightHeart.T, busConnector.rightHeart_T) annotation (Line(
          points={{-38,40},{-34,40},{-34,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(Brain.T, busConnector.brain_T) annotation (Line(
          points={{-38,8},{-34,8},{-34,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(RespiratoryMuscle.T, busConnector.respiratoryMuscle_T) annotation (Line(
          points={{-38,-20},{-34,-20},{-34,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(LeftHeart.T, busConnector.leftHeart_T) annotation (Line(
          points={{-38,-52},{-34,-52},{-34,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

      connect(busConnector.liver_T, Liver.T) annotation (Line(
          points={{-88,92},{40,92},{40,68},{44,68}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.bone_T, Bone.T) annotation (Line(
          points={{-88,92},{40,92},{40,40},{44,40}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));

      connect(busConnector.GITract_T, GITract.T) annotation (Line(
          points={{-88,92},{40,92},{40,8},{44,8}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));

      connect(busConnector.kidney_T, Kidney.T) annotation (Line(
          points={{-88,92},{40,92},{40,-22},{44,-22}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));

      connect(busConnector.fat_T, Fat.T) annotation (Line(
          points={{-88,92},{40,92},{40,-52},{44,-52}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));

      connect(busConnector.otherTissue_T, OtherTissue.T) annotation (Line(
          points={{-88,92},{40,92},{40,-78},{44,-78}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));

      annotation (        Documentation(info="<html>
<p>Heat in tissues. Temperatures are in celsius degrees.</p>
</html>",     revisions="<html>
<p>Marek Matejak, 24.12.2009</p>
</html>"));
    end TissuesHeat;

    package Tissues
      model TissueTemperature

        Physiolibrary.Types.RealIO.TemperatureInput BaseT(
                                            displayUnit="degC")
          annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));
        Physiolibrary.Types.RealIO.TemperatureOutput T(
                                         displayUnit="degC")
          annotation (Placement(transformation(extent={{80,-20},{120,20}})));
      equation
        T=BaseT;
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true, extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-148,-98},{100,-124}},
                lineColor={0,0,255},
                textString="%name"), Rectangle(extent={{-100,100},{100,-100}},
                  lineColor={0,0,255})}));
      end TissueTemperature;

      model RightHeart
        extends TissueTemperature;
        extends Physiolibrary.Icons.RightHeart;
      end RightHeart;

      model Brain
        extends TissueTemperature;
          extends Physiolibrary.Icons.Brain;
      end Brain;

      model RespiratoryMuscle
        extends TissueTemperature;
        extends Physiolibrary.Icons.RespiratoryMuscle;
      end RespiratoryMuscle;

      model LeftHeart
        extends TissueTemperature;
          extends Physiolibrary.Icons.LeftHeart;
      end LeftHeart;

      model Liver
        extends TissueTemperature;
          extends Physiolibrary.Icons.Liver;
      end Liver;

      model Bone
        extends TissueTemperature;
        extends Physiolibrary.Icons.Bone;
      end Bone;

        model GITract
        extends TissueTemperature;
          extends Physiolibrary.Icons.GITract;
        end GITract;

      model Kidney
        extends TissueTemperature;
          extends Physiolibrary.Icons.Kidney;
      end Kidney;

      model Fat
        extends TissueTemperature;
          extends Physiolibrary.Icons.Fat;
      end Fat;

      model OtherTissue
        extends TissueTemperature;
          extends Physiolibrary.Icons.OtherTissue;
      end OtherTissue;

    end Tissues;

    model BladderHeat
      extends Physiolibrary.Icons.Bladder;

      parameter Physiolibrary.Types.Density urineDensity = 1000; // kg/m3
    Physiolibrary.Thermal.Components.HeatAccumulation Bladder(
      stateName="BladderTemperature.Mass",
      useMassInput=true,
      relativeHeat_start=0)
      annotation (Placement(transformation(extent={{6,-80},{26,-60}})));
                            //(259707.204) - 310.15*weight*(4186.8))
    //    initialTemperature(displayUnit="degC"),
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-72,-44},{-52,-24}}), iconTransformation(
            extent={{-104,86},{-84,106}})));
    Physiolibrary.Thermal.Sources.MassOutflow bladderVoid(useMassFlowInput=true)
      annotation (Placement(transformation(extent={{54,-72},{66,-60}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_a positiveHeatFlow annotation (
        Placement(transformation(extent={{-6,26},{14,46}}), iconTransformation(
            extent={{-6,66},{14,86}})));
    Modelica.Blocks.Math.Gain density(k=urineDensity) "kg/m3"
      annotation (Placement(transformation(extent={{26,-44},{46,-24}})));
    Modelica.Blocks.Math.Gain density1(k=urineDensity) "kg/m3"
      annotation (Placement(transformation(extent={{-36,-72},{-16,-52}})));
    equation
      connect(Bladder.q_in, bladderVoid.q_in) annotation (Line(
          points={{16,-70},{36,-70},{36,-66},{54,-66}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(positiveHeatFlow, Bladder.q_in) annotation (Line(
          points={{4,36},{16,36},{16,-70}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
    connect(busConnector.BladderVoidFlow, density.u) annotation (Line(
        points={{-62,-34},{24,-34}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(density.y, bladderVoid.massFlow) annotation (Line(
        points={{47,-34},{56,-34},{56,-61.8},{55.2,-61.8}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(density1.y, Bladder.weight) annotation (Line(
        points={{-15,-62},{6,-62}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.BladderVolume_Mass, density1.u) annotation (Line(
        points={{-62,-34},{-62,-62},{-38,-62}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    end BladderHeat;

    model GILumenHeat
      extends Physiolibrary.Icons.GILumen;

      parameter Physiolibrary.Types.Density ChymusDensity=1000;

    Physiolibrary.Thermal.Components.HeatAccumulation GILumen(
      stateName="GILumenTemperature.Mass",
      useMassInput=true,
      relativeHeat_start=0)
      annotation (Placement(transformation(extent={{-50,-82},{-30,-62}})));
                           //(1293302.52) - 310.15*weight*(4186.8))

    //  initialTemperature(displayUnit="degC") = 310,
    Physiolibrary.Thermal.Components.Conductor resistorWithCondParam(
        Conductance(displayUnit="kcal/(min.degC)") =            0.6978)
      annotation (Placement(transformation(
          extent={{-10,-10},{10,10}},
          rotation=90,
          origin={-26,-44})));
    Physiolibrary.Thermal.Components.Stream Convection(
        useMassFlowInput=true, SpecificHeat=4186.8)
                               annotation (Placement(transformation(
          extent={{-10,10},{10,-10}},
          rotation=90,
          origin={-8,-28})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-100,-10},{-80,10}}), iconTransformation(
            extent={{-104,86},{-84,106}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_b q_out annotation (Placement(
          transformation(extent={{-46,0},{-6,40}}), iconTransformation(extent={
              {-10,-10},{10,10}})));
    Modelica.Blocks.Math.Gain absorbedChymusDensity(
        y(unit="kg/s"),
        u(unit="m3/s"),
        k(unit="kg/m3") = ChymusDensity)
                        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=180,
            origin={16,-36})));
      Physiolibrary.Thermal.Sources.MassInflow massInflow(
        useMassFlowInput=true,
        useTemperatureInput=true,
        SpecificHeat(displayUnit="kcal/(kg.K)")) annotation (Placement(
            transformation(
            extent={{10,-10},{-10,10}},
            rotation=90,
            origin={-40,-28})));
    Modelica.Blocks.Math.Gain absorbedChymusDensity1(
        y(unit="kg/s"),
        u(unit="m3/s"),
        k(unit="kg/m3") = ChymusDensity)
                        annotation (Placement(transformation(
            extent={{4,-4},{-4,4}},
            rotation=180,
            origin={-56,-20})));
    Modelica.Blocks.Math.Gain absorbedChymusDensity2(
        k(unit="kg/m3") = ChymusDensity,
      u(unit="m3"),
      y(unit="kg"))     annotation (Placement(transformation(
            extent={{4,-4},{-4,4}},
            rotation=180,
            origin={-68,-64})));
    equation
      connect(GILumen.q_in,resistorWithCondParam. q_in) annotation (Line(
          points={{-40,-72},{-26,-72},{-26,-54}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(GILumen.q_in,Convection. q_in) annotation (Line(
          points={{-40,-72},{-8,-72},{-8,-38}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(Convection.q_out, q_out) annotation (Line(
          points={{-8,-18},{-8,20},{-26,20}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(resistorWithCondParam.q_out, q_out) annotation (Line(
          points={{-26,-34},{-26,20}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(absorbedChymusDensity.u, busConnector.GILumenVolume_Absorption)
        annotation (Line(
          points={{20.8,-36},{36,-36},{36,-92},{-90,-92},{-90,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Convection.massFlow, absorbedChymusDensity.y) annotation (Line(
          points={{-1,-36},{11.6,-36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(massInflow.q_out, GILumen.q_in) annotation (Line(
          points={{-40,-38},{-40,-72}},
          color={191,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(busConnector.DietGoalH2O_DegK, massInflow.t) annotation (Line(
        points={{-90,0},{-90,-28},{-47,-28}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(absorbedChymusDensity1.y, massInflow.massFlow)
      annotation (Line(
        points={{-51.6,-20},{-47,-20}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.GILumenVolume_Intake, absorbedChymusDensity1.u) annotation (Line(
        points={{-90,0},{-90,-20},{-60.8,-20}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    connect(GILumen.weight, absorbedChymusDensity2.y) annotation (Line(
        points={{-50,-64},{-63.6,-64}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(busConnector.GILumenVolume_Mass, absorbedChymusDensity2.u)
      annotation (Line(
        points={{-90,0},{-90,-64},{-72.8,-64}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    end GILumenHeat;

    model MuscleHeat
    extends Physiolibrary.Icons.SkeletalMuscle;
    Physiolibrary.Thermal.Components.HeatAccumulation skeletalMuscle(
      stateName="HeatSkeletalMuscle.Mass",
      q_in(T(start=310.666)),
      useMassInput=true,
      relativeHeat_start=0)
      annotation (Placement(transformation(extent={{-8,-8},{12,12}})));
                           //(29579490.792) - 310.15*weight*(3475.044))

         // initialTemperature=310.166,
    Physiolibrary.Thermal.Components.IdealRadiator muscleFlux(SpecificHeat=
          3851.856, useMassFlowInput=true)
      annotation (Placement(transformation(extent={{40,-8},{20,12}})));
    Modelica.Blocks.Math.Gain bloodDensity(
        y(unit="kg/s"),
        k(unit="kg/m3") = 1000,
        u(unit="m3/s")) annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={38,24})));
    Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow Metabolism2
      annotation (Placement(transformation(extent={{-38,-24},{-18,-4}})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-102,32},{-82,52}}), iconTransformation(
            extent={{-104,86},{-84,106}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_b q_out annotation (Placement(
          transformation(extent={{10,-70},{50,-30}}), iconTransformation(extent=
             {{-10,-10},{10,10}})));
      Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor temperatureSensor
        annotation (Placement(transformation(extent={{-50,-72},{-70,-52}})));
    equation
      connect(busConnector.skeletalMuscle_BloodFlow, bloodDensity.u) annotation (
          Line(
          points={{-92,42},{38,42},{38,28.8}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
    connect(Metabolism2.port, skeletalMuscle.q_in) annotation (Line(
        points={{-18,-14},{-6,-14},{-6,2},{2,2}},
        color={255,128,0},
        thickness=1,
        smooth=Smooth.None));
      connect(bloodDensity.y, muscleFlux.massFlow) annotation (Line(
          points={{38,19.6},{38,9}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(skeletalMuscle.q_in, muscleFlux.q_out) annotation (Line(
        points={{2,2},{16,2},{16,12},{30,12}},
        color={255,128,0},
        thickness=1,
        smooth=Smooth.None));
    connect(muscleFlux.q_in, q_out) annotation (Line(
        points={{40,4},{44,4},{44,-22},{30,-22},{30,-50}},
        color={255,128,0},
        thickness=1,
        smooth=Smooth.None));
      connect(busConnector.skeletalMuscle_SizeMass, skeletalMuscle.weight)
        annotation (Line(
          points={{-92,42},{-92,10},{-8,10}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.skeletalMuscle_T, temperatureSensor.T) annotation (Line(
          points={{-92,42},{-92,-62},{-70,-62}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(skeletalMuscle.q_in, temperatureSensor.port) annotation (Line(
          points={{2,2},{-6,2},{-6,-62},{-50,-62}},
          color={191,0,0},
          thickness=1,
          smooth=Smooth.None));
    connect(busConnector.skeletalMuscle_heatProduction, Metabolism2.Q_flow)
      annotation (Line(
        points={{-92,42},{-66,42},{-66,-14},{-38,-14}},
        color={0,0,255},
        thickness=0.5,
        smooth=Smooth.None), Text(
        string="%first",
        index=-1,
        extent={{-6,3},{-6,3}}));
    end MuscleHeat;

    model SkinHeat2
      extends Physiolibrary.Icons.Skin;
    Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow Metabolism1
      annotation (Placement(transformation(extent={{0,-72},{20,-52}})));
    Physiolibrary.Thermal.Components.HeatAccumulation skin(
      stateName="HeatSkin.Mass",
      useMassInput=true,
      relativeHeat_start=-75362.4)
      annotation (Placement(transformation(extent={{30,-72},{50,-52}})));
                            //(2363163.8976) - 310.15*weight*(3475.044))

          //initialTemperature=300.731,
    Physiolibrary.Thermal.Components.IdealRadiator skinFlux(
      useMassFlowInput=true, SpecificHeat(displayUnit="kcal/(kg.K)") = 3851.856)
      annotation (Placement(transformation(extent={{38,-40},{58,-20}})));
    Modelica.Blocks.Math.Gain bloodDensity(
        y(unit="kg/s"),
        k(unit="kg/m3") = 1000,
        u(unit="m3/s")) annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={40,-14})));
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-82,34},{-62,54}}), iconTransformation(extent=
             {{-90,-30},{-70,-10}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_a positiveHeatFlow annotation (
        Placement(transformation(extent={{2,-32},{10,-24}}), iconTransformation(
            extent={{-32,-70},{-12,-50}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_b q_out annotation (Placement(
          transformation(extent={{72,-82},{112,-42}}), iconTransformation(
            extent={{-30,8},{-10,28}})));
      Modelica.Blocks.Math.Feedback pressureGradient
        annotation (Placement(transformation(extent={{-46,-24},{-26,-4}})));
      Modelica.Blocks.Math.Product bloodFlow
        annotation (Placement(transformation(extent={{10,2},{30,-18}})));
    Physiolibrary.Blocks.Factors.Normalization TermoregulationEffect
      annotation (Placement(transformation(extent={{72,0},{96,24}})));
      Physiolibrary.Types.RealIO.FrequencyInput
                                           HypothalamusSkinFlow_NervesActivity
                                                  annotation (Placement(
            transformation(extent={{-68,10},{-48,30}}), iconTransformation(
              extent={{-100,-80},{-60,-40}})));
      Modelica.Blocks.Interfaces.RealOutput skin_T
                                            annotation (Placement(
            transformation(extent={{78,-108},{98,-88}}),
                                                       iconTransformation(
              extent={{40,-40},{80,0}})));
    Physiolibrary.Blocks.Interpolation.Curve SympsDilateEffect(
      x={0.0,1.0,4.0},
      y={0.3,1.0,8.0},
      slope={0,2.2,0})
      annotation (Placement(transformation(extent={{-32,10},{-12,30}})));
    Physiolibrary.Blocks.Factors.Spline LocalTempVsNA(data={{1.2,1.0,0},{1.5,
          0.0,0}})
      annotation (Placement(transformation(extent={{-20,76},{0,96}})));
      Nerves.AplhaReceptorsActivityFactor AplhaReceptors_Skin(       data={{
            0.0,0.3,0},{1.0,0.0,-0.3},{5.0,-0.9,0}})
        annotation (Placement(transformation(extent={{-34,50},{-14,70}})));
    Physiolibrary.Blocks.Factors.Spline LocalTempEffect(data={{10.8 + 273.15,-0.8,0},
            {29.0 + 273.15,0.0,0.1},{45.0 + 273.15,4.0,0}})
      annotation (Placement(transformation(extent={{-18,62},{2,82}})));
    Physiolibrary.Types.Constants.FractionConst
      Skin_BasicConductance_1(k=1)
      annotation (Placement(transformation(extent={{-4,94},{-8,90}})));
    Physiolibrary.Blocks.Math.Add add(k=1)
      annotation (Placement(transformation(extent={{32,50},{40,58}})));
    Physiolibrary.Blocks.Math.Add add1(k=1)
      annotation (Placement(transformation(extent={{32,38},{40,46}})));
    Physiolibrary.Blocks.Factors.Normalization SympsEffect_Skin
      annotation (Placement(transformation(extent={{74,38},{94,58}})));
    Physiolibrary.Blocks.Factors.Normalization LocalTempEffect_Skin
      annotation (Placement(transformation(extent={{74,46},{94,66}})));
      Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor temperatureSensor
        annotation (Placement(transformation(extent={{44,-94},{64,-74}})));
    equation
    connect(Metabolism1.port, skin.q_in) annotation (Line(
        points={{20,-62},{40,-62}},
        color={255,128,0},
        thickness=1,
        smooth=Smooth.None));
      connect(skinFlux.q_out,skin. q_in) annotation (Line(
          points={{48,-20},{48,-44},{40,-44},{40,-62}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinFlux.q_in, positiveHeatFlow) annotation (Line(
          points={{38,-28},{6,-28}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skin.q_in, q_out) annotation (Line(
          points={{40,-62},{92,-62}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector.SystemicArtys_Pressure, pressureGradient.u1)
                                                                annotation (
          Line(
          points={{-72,44},{-74,44},{-74,-14},{-44,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.SystemicVeins_Pressure, pressureGradient.u2)
                                                                annotation (
          Line(
          points={{-72,44},{-74,44},{-74,-22},{-36,-22}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(pressureGradient.y, bloodFlow.u1)
                                      annotation (Line(
          points={{-27,-14},{8,-14}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(bloodFlow.y, bloodDensity.u) annotation (Line(
          points={{31,-8},{40,-8},{40,-9.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(TermoregulationEffect.y, bloodFlow.u2)
                                               annotation (Line(
          points={{84,7.2},{8,7.2},{8,-2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsDilateEffect.val, busConnector.skinFlow_termoregulationEffect)
        annotation (Line(
          points={{-12,20},{0,20},{0,0},{-72,0},{-72,44}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(HypothalamusSkinFlow_NervesActivity, SympsDilateEffect.u)
        annotation (Line(
          points={{-58,20},{-32,20}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsDilateEffect.val, TermoregulationEffect.u) annotation (Line(
          points={{-12,20},{0,20},{0,12},{74.4,12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(LocalTempVsNA.yBase,Skin_BasicConductance_1. y) annotation (Line(
          points={{-10,88},{-10,92},{-8.5,92}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(LocalTempEffect.yBase,LocalTempVsNA. y) annotation (Line(
          points={{-8,74},{-8,80},{-10,80},{-10,82}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.skin_T,LocalTempEffect. u) annotation (Line(
          points={{-72,44},{-72,72},{-16,72}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.AlphaPool_Effect,AplhaReceptors_Skin. AlphaPool_Effect)
        annotation (Line(
          points={{-72,44},{-72,66},{-33.8,66}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.AlphaBlocade_Effect,AplhaReceptors_Skin. AlphaBlockade_Effect)
        annotation (Line(
          points={{-72,44},{-72,60},{-33.8,60}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.GangliaGeneral_NA,AplhaReceptors_Skin. GangliaGeneral_NA)
        annotation (Line(
          points={{-72,44},{-72,54},{-33.8,54}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(AplhaReceptors_Skin.yBase,LocalTempVsNA. y) annotation (Line(
          points={{-24,67},{-24,80},{-10,80},{-10,82}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(LocalTempEffect.y,add. u) annotation (Line(
          points={{-8,68},{-8,54},{31.2,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(add1.u,AplhaReceptors_Skin. y) annotation (Line(
          points={{31.2,42},{-24,42},{-24,53}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsEffect_Skin.u,add1. y) annotation (Line(
          points={{76,48},{56,48},{56,42},{40.4,42}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(add.y,LocalTempEffect_Skin. u) annotation (Line(
          points={{40.4,54},{58,54},{58,56},{76,56}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.skin_conductanceWithoutTermoregulationEffect,
        LocalTempEffect_Skin.yBase) annotation (Line(
          points={{-72,44},{-72,96},{84,96},{84,58}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(LocalTempEffect_Skin.y, SympsEffect_Skin.yBase) annotation (Line(
          points={{84,52},{84,50}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SympsEffect_Skin.y, TermoregulationEffect.yBase) annotation (Line(
          points={{84,44},{84,14.4}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(HypothalamusSkinFlow_NervesActivity, LocalTempVsNA.u) annotation (
         Line(
          points={{-58,20},{-42,20},{-42,86},{-18,86}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(bloodDensity.y, skinFlux.massFlow) annotation (Line(
          points={{40,-18.4},{40,-23}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.skinSizeMass, skin.weight) annotation (Line(
          points={{-72,44},{-72,-54},{30,-54}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.MetabolismCaloriesUsed_SkinHeat, Metabolism1.Q_flow)
        annotation (Line(
          points={{-72,44},{-72,-62},{0,-62}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(skin.q_in, temperatureSensor.port) annotation (Line(
          points={{40,-62},{42,-62},{42,-84},{44,-84}},
          color={191,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(temperatureSensor.T, busConnector.skin_T) annotation (Line(
          points={{64,-84},{74,-84},{74,-100},{-72,-100},{-72,44}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(temperatureSensor.T, skin_T) annotation (Line(
          points={{64,-84},{74,-84},{74,-98},{88,-98}},
          color={0,0,127},
          smooth=Smooth.None));
    end SkinHeat2;

    model Heat2
     extends Physiolibrary.Icons.Heat;
    //      initialTemperature(displayUnit="degC") = 310.15,
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-104,86},{-84,106}}), iconTransformation(
            extent={{-104,86},{-84,106}})));
      Physiolibrary.Thermal.Sources.MassOutflow HeatInsensibleSkin(
        q_in(T(start=303.824)),
        VaporizationHeat=2428344,
        SpecificHeat=4186.8,
        useMassFlowInput=true)
        annotation (Placement(transformation(extent={{66,-12},{86,8}})));
    Physiolibrary.Types.Constants.MassFlowRateConst massFlowConstant(k=6.1666666666667e-06)
      annotation (Placement(transformation(extent={{62,10},{68,16}})));
    Physiolibrary.Thermal.Components.Conductor conduction(useConductanceInput=
          true)
      annotation (Placement(transformation(extent={{74,-60},{94,-40}})));
    Physiolibrary.Blocks.Factors.Spline WindEffect(data={{0.0,1.0,0},{20.0,4.0,
          0}}, Xscale=0.44704)
      annotation (Placement(transformation(extent={{94,-48},{74,-28}})));
    Physiolibrary.Blocks.Factors.Spline BloodFlowEffect(data={{0,0.8,0},{250,
          1.0,1.0E-3},{8000,8.0,0}}, Xscale=1e-6/60)
      annotation (Placement(transformation(extent={{94,-42},{74,-22}})));
    Physiolibrary.Blocks.Factors.Spline ClothesEffect(data={{0.0,4.0,0},{2.0,
          1.0,-1.2},{4.0,0.2,0}})
      annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
    Physiolibrary.Types.Constants.ThermalConductanceConst Constant(k(displayUnit="kcal/(min.K)")=
             2.37252)
      annotation (Placement(transformation(extent={{74,-20},{82,-12}})));
    Physiolibrary.Types.Constants.FractionConst             Constant1(k=2)
      annotation (Placement(transformation(extent={{58,-28},{66,-20}})));
    Physiolibrary.Thermal.Sources.UnlimitedHeat ambientTemperature(T=298.15)
      annotation (Placement(transformation(extent={{58,-88},{78,-68}})));
    Physiolibrary.Thermal.Components.Conductor radiation(useConductanceInput=
          true)
      annotation (Placement(transformation(extent={{26,-88},{46,-68}})));
    Physiolibrary.Blocks.Factors.Spline ClothesEffect1(data={{0.0,4.0,0},{2.0,
          1.0,-1.2},{4.0,0.2,0}})
      annotation (Placement(transformation(extent={{26,-78},{46,-58}})));
    Physiolibrary.Types.Constants.ThermalConductanceConst Constant3(k=4.74504)
      annotation (Placement(transformation(extent={{24,-62},{32,-54}})));
      TissuesHeat otherTissuesHeat
        annotation (Placement(transformation(extent={{-86,-76},{-64,-54}})));
    Physiolibrary.Thermal.Components.Stream toUrine(
      q_in(T(start=310.16)),
      SpecificHeat=4186.8,
      useMassFlowInput=true) annotation (Placement(transformation(
          extent={{-10,10},{10,-10}},
          rotation=270,
          origin={2,-36})));
      BladderHeat bladderHeat
        annotation (Placement(transformation(extent={{-10,-76},{10,-56}})));
      GILumenHeat gILumenHeat(GILumen(q_in(T(start=308.099)), useMassInput=true))
        annotation (Placement(transformation(extent={{-86,-22},{-66,-2}})));
      SkinHeat2 skinHeat
                        annotation (Placement(transformation(
            extent={{-15,-15},{15,15}},
            rotation=270,
            origin={33,-13})));
      MuscleHeat muscleHeat
        annotation (Placement(transformation(extent={{-54,-74},{-26,-42}})));
      Nerves.Hypothalamus hypothalamus
        annotation (Placement(transformation(extent={{16,62},{36,82}})));
      Skin.SweatGland sweatGland
        annotation (Placement(transformation(extent={{72,36},{92,56}})));
      Lungs lungs
        annotation (Placement(transformation(extent={{-40,18},{-20,38}})));
      Core core1
        annotation (Placement(transformation(extent={{-36,-12},{-16,8}})));
    Modelica.Blocks.Math.Gain urineDensity(
        y(unit="kg/s"),
        k(unit="kg/m3") = 1000,
        u(unit="m3/s")) annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            origin={-16,-38})));
    equation
      connect(BloodFlowEffect.y, WindEffect.yBase) annotation (Line(
          points={{84,-36},{84,-36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ClothesEffect.y, BloodFlowEffect.yBase) annotation (Line(
          points={{84,-28},{84,-30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, ClothesEffect.yBase) annotation (Line(
          points={{83,-16},{84,-16},{84,-22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant1.y, ClothesEffect.u) annotation (Line(
          points={{67,-24},{76,-24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.skin_BloodFlow, BloodFlowEffect.u) annotation (Line(
          points={{-94,96},{98,96},{98,-32},{92,-32}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(conduction.q_out, ambientTemperature.port) annotation (Line(
          points={{94,-50},{98,-50},{98,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(Constant1.y, ClothesEffect1.u) annotation (Line(
          points={{67,-24},{70,-24},{70,-34},{22,-34},{22,-68},{28,-68}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant3.y, ClothesEffect1.yBase) annotation (Line(
          points={{33,-58},{36,-58},{36,-66}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(radiation.q_out, ambientTemperature.port) annotation (Line(
          points={{46,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector, otherTissuesHeat.busConnector) annotation (Line(
          points={{-94,96},{-94,-54.88},{-84.68,-54.88}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(toUrine.q_out, bladderHeat.positiveHeatFlow) annotation (Line(
          points={{2,-46},{2,-58.4},{0.4,-58.4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector, bladderHeat.busConnector) annotation (Line(
          points={{-94,96},{-94,-84},{-24,-84},{-24,-56.4},{-9.4,-56.4}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(gILumenHeat.busConnector, busConnector) annotation (Line(
          points={{-85.4,-2.4},{-94,-2.4},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(skinHeat.q_out, HeatInsensibleSkin.q_in)
                                              annotation (Line(
          points={{35.7,-10},{36,-10},{36,-4},{44,-4},{44,-2},{66,-2}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinHeat.q_out, conduction.q_in) annotation (Line(
          points={{35.7,-10},{46,-10},{46,-50},{74,-50}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinHeat.q_out, radiation.q_in) annotation (Line(
          points={{35.7,-10},{46,-10},{46,-50},{18,-50},{18,-78},{26,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinHeat.busConnector, busConnector) annotation (Line(
          points={{30,-1},{30,18},{100,18},{100,96},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(muscleHeat.busConnector, busConnector) annotation (Line(
          points={{-53.16,-42.64},{-52,-42},{-94,-42},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector.brain_FunctionEffect,hypothalamus. BrainFunctionEffect)
        annotation (Line(
          points={{-94,96},{-76,96},{-76,78},{16,78}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(hypothalamus.HypothalamusSkinFlow_NA, skinHeat.HypothalamusSkinFlow_NervesActivity)
        annotation (Line(
          points={{36,70},{44,70},{44,20},{24,20},{24,-1}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(skinHeat.skin_T, hypothalamus.HeatSkin_Temp) annotation (Line(
          points={{30,-22},{30,-22},{-4,-20},{-4,68},{16,68}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hypothalamus.HypothalamusSweating_NA, sweatGland.HypothalamusSweating_NA)
        annotation (Line(
          points={{36,76},{48,76},{48,40},{74,40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sweatGland.busConnector, busConnector) annotation (Line(
          points={{89,53},{98,53},{98,96},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(skinHeat.q_out, sweatGland.port_a) annotation (Line(
          points={{35.7,-10},{46,-10},{46,36},{82,36}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(sweatGland.port_b, ambientTemperature.port) annotation (Line(
          points={{82,56},{104,56},{104,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(lungs.busConnector, busConnector) annotation (Line(
          points={{-37.2,27.4},{-94,27.4},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(lungs.positiveHeatFlow, core1.positiveHeatFlow) annotation (Line(
          points={{-31.4,23.4},{-26,23.4},{-26,-1.4},{-25.8,-1.4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(core1.positiveHeatFlow, skinHeat.positiveHeatFlow) annotation (
          Line(
          points={{-25.8,-1.4},{-25.8,6.6},{2,6.6},{2,-9.7},{24,-9.7}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(core1.positiveHeatFlow, toUrine.q_in) annotation (Line(
          points={{-25.8,-1.4},{-10,-1.4},{-10,-26},{2,-26}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(core1.positiveHeatFlow, muscleHeat.q_out) annotation (Line(
          points={{-25.8,-1.4},{-25.8,-12},{-26,-12},{-26,-58},{-40,-58}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));

      connect(core1.positiveHeatFlow, gILumenHeat.q_out) annotation (Line(
          points={{-25.8,-1.4},{-26,-1.4},{-26,-12},{-76,-12}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(core1.core_T, hypothalamus.HeatCore_Temp) annotation (Line(
          points={{-20,-4},{0,-4},{0,72},{16,72}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(core1.busConnector, busConnector) annotation (Line(
          points={{-26,6.2},{-26,14.2},{-58,14.2},{-58,96},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(lungs.air, ambientTemperature.port) annotation (Line(
          points={{-31.4,34.2},{-31.4,58},{104,58},{104,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(hypothalamus.HypothalamusShivering_NA, busConnector.HypothalamusShivering_NerveActivity)
        annotation (Line(
          points={{36,64},{42,64},{42,96},{-94,96}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(WindEffect.y, conduction.conductance) annotation (Line(
          points={{84,-42},{84,-46}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ClothesEffect1.y, radiation.conductance) annotation (Line(
          points={{36,-72},{36,-74}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(massFlowConstant.y, HeatInsensibleSkin.massFlow) annotation (Line(
        points={{68.75,13},{68,13},{68,5}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.CD_H2O_Outflow, urineDensity.u) annotation (Line(
          points={{-94,96},{-94,-84},{-24,-84},{-24,-38},{-20.8,-38}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(urineDensity.y, toUrine.massFlow) annotation (Line(
          points={{-11.6,-38},{-8,-38},{-8,-28},{-5,-28}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(core1.positiveHeatFlow, busConnector.coreHeat) annotation (Line(
        points={{-25.8,-1.4},{-25.8,-6},{-58,-6},{-58,96},{-94,96}},
        color={191,0,0},
        thickness=1,
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      connect(WindEffect.u, busConnector.WindSpeed) annotation (Line(
          points={{92,-38},{100,-38},{100,96},{-94,96}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={               Text(
              extent={{-94,-100},{94,-126}},
              lineColor={0,0,255},
              textString="%name")}));
    end Heat2;

    package Skin
      model Skin
        extends Physiolibrary.Icons.Skin;
        parameter Real bodyPart=1/3;
      Physiolibrary.Types.Constants.VolumeFlowRateConst flowConstant(k=1*
            bodyPart)
        annotation (Placement(transformation(extent={{62,80},{70,88}})));
      Physiolibrary.Blocks.Factors.Spline NerveEffect(data={{0.0,0.0,0.0},{4.0,
            30.0,0.0}})
        annotation (Placement(transformation(extent={{62,54},{82,74}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-100,81},{-80,101}}), iconTransformation(
              extent={{60,60},{80,80}})));
      Physiolibrary.Blocks.Factors.Normalization FuelEffect
        annotation (Placement(transformation(extent={{62,42},{82,62}})));
      Physiomodel.Metabolism.deprecated.Input2EffectDelayed AcclimationEffect(Tau=6,
          data={{60,0.5,0.0},{85,1.0,0.05},{100,2.0,0.0}})
        annotation (Placement(transformation(extent={{62,22},{82,42}})));
      Physiolibrary.Blocks.Factors.Normalization SkinFunctionEffect
        annotation (Placement(transformation(extent={{62,2},{82,22}})));
        Physiolibrary.NonSIunits.degC_to_degF degC_to_degF
          annotation (Placement(transformation(extent={{48,28},{56,36}})));
        Physiolibrary.Chemical.MassStorageCompartment          SweatFuel(
            initialSoluteMass=1, stateName="SweatFuel.Mass")
          annotation (Placement(transformation(extent={{56,-52},{78,-32}})));
        Physiolibrary.Chemical.InputPump          inputPump
          annotation (Placement(transformation(extent={{34,-52},{54,-32}})));
        Physiolibrary.Chemical.OutputPump          outputPump
          annotation (Placement(transformation(extent={{82,-52},{102,-32}})));
        Modelica.Blocks.Math.Gain gain(k=0.0004) annotation (Placement(
              transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={92,-26})));
      Physiolibrary.Blocks.Factors.Spline MassEffect(data={{0.9,1.0,0.0},{1.0,
            0.0,0.0}})
        annotation (Placement(transformation(extent={{34,-38},{54,-18}})));
      Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant(k=0.004)
        annotation (Placement(transformation(extent={{34,-20},{42,-12}})));
        Modelica.Blocks.Math.Feedback H2OOutflow
          annotation (Placement(transformation(extent={{-2,-12},{-18,4}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab(k=0)
        annotation (Placement(transformation(extent={{-26,-22},{-18,-14}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab1(k=0.37*
            bodyPart)
        annotation (Placement(transformation(extent={{-48,-64},{-40,-56}})));
        Modelica.Blocks.Logical.Switch switch1
          annotation (Placement(transformation(extent={{-28,-82},{-8,-62}})));
        Modelica.Blocks.Logical.Greater greater
          annotation (Placement(transformation(extent={{-70,-82},{-50,-62}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab2(k=0)
        annotation (Placement(transformation(extent={{-74,-98},{-66,-90}})));
      Physiolibrary.Osmotic.Interfaces.OsmoticPort_b q_out annotation (
          Placement(transformation(extent={{-48,-44},{-30,-28}}),
            iconTransformation(extent={{-90,-50},{-70,-30}})));
      Physiolibrary.Osmotic.Sources.SolventOutflux sweat(useSolutionFlowInput=
            true)
        annotation (Placement(transformation(extent={{-62,-46},{-82,-26}})));
      Physiolibrary.Osmotic.Sources.SolventOutflux vapor(useSolutionFlowInput=
            true)
        annotation (Placement(transformation(extent={{6,-92},{26,-72}})));
        Modelica.Blocks.Interfaces.RealOutput LiquidVol(
                                                 final displayUnit="ml")
        "all tissue water volume"
          annotation (Placement(transformation(extent={{90,70},{130,110}}),
              iconTransformation(extent={{80,60},{120,100}})));
      equation
        connect(flowConstant.y, NerveEffect.yBase) annotation (Line(
            points={{71,84},{72,84},{72,66}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.HypothalamusSweating_NA, NerveEffect.u)
          annotation (Line(
            points={{-90,91},{-56,91},{-56,64},{64,64}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.skin_FunctionEffect, SkinFunctionEffect.u)
          annotation (Line(
            points={{-90,91},{-56,91},{-56,12},{64,12}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(AcclimationEffect.y, SkinFunctionEffect.yBase) annotation (Line(
            points={{72,30},{72,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(NerveEffect.y, FuelEffect.yBase) annotation (Line(
            points={{72,60},{72,54}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FuelEffect.y, AcclimationEffect.yBase) annotation (Line(
            points={{72,50},{72,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.skin_T, degC_to_degF.degC) annotation (Line(
            points={{-90,91},{-56,91},{-56,32},{47.2,32}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(degC_to_degF.degF, AcclimationEffect.u) annotation (Line(
            points={{56.8,32},{62.2,32}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SweatFuel.soluteMass, FuelEffect.u) annotation (Line(
            points={{67,-49.4},{67,-58},{22,-58},{22,52},{62.2,52}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(inputPump.q_out, SweatFuel.q_out) annotation (Line(
            points={{50,-42},{67,-42}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(SweatFuel.q_out, outputPump.q_in) annotation (Line(
            points={{67,-42},{86,-42}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(gain.y, outputPump.desiredFlow) annotation (Line(
            points={{92,-30.4},{92,-38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(MassEffect.y, inputPump.desiredFlow) annotation (Line(
            points={{44,-30},{44,-38}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SweatFuel.soluteMass, MassEffect.u) annotation (Line(
            points={{67,-49.4},{67,-58},{22,-58},{22,-28},{34.2,-28}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant.y, MassEffect.yBase) annotation (Line(
            points={{43,-16},{44,-16},{44,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SkinFunctionEffect.y, H2OOutflow.u1) annotation (Line(
            points={{72,8},{72,-4},{-3.6,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2OReab.y, H2OOutflow.u2) annotation (Line(
            points={{-17,-18},{-10,-18},{-10,-10.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SkinFunctionEffect.y, gain.u) annotation (Line(
            points={{72,8},{72,-4},{92,-4},{92,-21.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(greater.y, switch1.u2) annotation (Line(
            points={{-49,-72},{-30,-72}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(H2OReab1.y, switch1.u1) annotation (Line(
            points={{-39,-60},{-36,-60},{-36,-64},{-30,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2OReab2.y, switch1.u3) annotation (Line(
            points={{-65,-94},{-34,-94},{-34,-80},{-30,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2OReab2.y, greater.u2) annotation (Line(
            points={{-65,-94},{-60,-94},{-60,-86},{-76,-86},{-76,-80},{-72,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.skin_BloodFlow, greater.u1) annotation (Line(
            points={{-90,91},{-90,-72},{-72,-72}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(vapor.q_in, q_out) annotation (Line(
            points={{10,-82},{4,-82},{4,-36},{-39,-36}},
            color={127,127,0},
            thickness=1,
            smooth=Smooth.None));
        connect(sweat.q_in, q_out) annotation (Line(
            points={{-66,-36},{-39,-36}},
            color={127,127,0},
            thickness=1,
            smooth=Smooth.None));
      connect(switch1.y, vapor.solutionFlow) annotation (Line(
          points={{-7,-72},{16,-72},{16,-78}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(H2OOutflow.y, sweat.solutionFlow) annotation (Line(
          points={{-17.2,-4},{-72,-4},{-72,-32}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-155,-83},{126,-108}},
                lineColor={0,0,255},
                textString="%name")}));
      end Skin;

      model SweatGland
        extends Physiolibrary.Icons.SweatGland;

      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-100,81},{-80,101}}), iconTransformation(
              extent={{60,60},{80,80}})));
      Physiolibrary.Blocks.Factors.Normalization FuelEffect
        annotation (Placement(transformation(extent={{62,42},{82,62}})));
        Physiolibrary.Blocks.Factors.SplineLag      AcclimationEffect(
                                                           HalfTime=6*86400*Modelica.Math.log(2),
          stateName="SweatAcclimation.Effect",
          data={{60 + 459.67,0.5,0.0},{85 + 459.67,1.0,0.05},{100 + 459.67,2.0,0.0}},
          Xscale=5/9)
          annotation (Placement(transformation(extent={{62,22},{82,42}})));

      Physiolibrary.Blocks.Factors.Normalization SkinFunctionEffect
        annotation (Placement(transformation(extent={{62,2},{82,22}})));
        Physiolibrary.Chemical.Components.Substance             SweatFuel(
                                 stateName="SweatFuel.Mass", solute_start(
            displayUnit="mol") = 1)
          annotation (Placement(transformation(extent={{56,-52},{78,-32}})));
      Physiolibrary.Chemical.Sources.UnlimitedSolutePump inputPump(
          useSoluteFlowInput=true)
        annotation (Placement(transformation(extent={{34,-52},{54,-32}})));
        Physiolibrary.Chemical.Sources.UnlimitedSolutePumpOut
                                                    outputPump(useSoluteFlowInput=true)
          annotation (Placement(transformation(extent={{82,-52},{102,-32}})));
        Modelica.Blocks.Math.Gain gain(k=0.4)    annotation (Placement(
              transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={92,-26})));
      Physiolibrary.Blocks.Factors.Spline MassEffect(data={{0.9,1.0,0.0},{1.0,
            0.0,0.0}})
        annotation (Placement(transformation(extent={{34,-38},{54,-18}})));
      Physiolibrary.Types.Constants.MolarFlowRateConst        Constant(k(displayUnit="mol/min")=
               6.6666666666667e-05)
        annotation (Placement(transformation(extent={{34,-20},{42,-12}})));
        Modelica.Blocks.Math.Feedback H2OOutflow
          annotation (Placement(transformation(extent={{18,-12},{2,4}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab(k=0)
        annotation (Placement(transformation(extent={{-6,-22},{2,-14}})));
        Modelica.Blocks.Interfaces.RealInput HypothalamusSweating_NA
                                                    annotation (Placement(
              transformation(extent={{-14,60},{6,80}}),   iconTransformation(
                extent={{-100,-80},{-60,-40}})));
      Physiolibrary.Thermal.Interfaces.HeatPort_a port_a annotation (Placement(
            transformation(extent={{-52,-76},{-46,-70}}), iconTransformation(
              extent={{-10,-110},{10,-90}})));
      Physiolibrary.Thermal.Interfaces.HeatPort_b port_b annotation (Placement(
            transformation(extent={{-24,-104},{-14,-94}}), iconTransformation(
              extent={{-10,90},{10,110}})));
        Modelica.Blocks.Math.Min H2OEvaporation annotation (Placement(
              transformation(
              extent={{-6,-6},{6,6}},
              rotation=180,
              origin={-50,-8})));
      Physiolibrary.Thermal.Sources.MassOutflow HeatSweatEvaporation(
          VaporizationHeat=2428344, useMassFlowInput=true) annotation (
          Placement(transformation(
            extent={{-10,10},{10,-10}},
            rotation=180,
            origin={-70,-74})));
      Physiolibrary.Blocks.Factors.Spline WindEffect(data={{0,1.0,0.0},{20,1.5,
            0.0}}, Xscale=0.44704)
        annotation (Placement(transformation(extent={{-94,-30},{-74,-10}})));
      Gases.Ventilation.VaporPressure vaporPressure
        annotation (Placement(transformation(extent={{-86,20},{-66,40}})));
        Modelica.Blocks.Math.Feedback Gradient
          annotation (Placement(transformation(extent={{8,-8},{-8,8}},
              rotation=90,
              origin={-54,16})));
      Gases.Ventilation.VaporPressure vaporPressure1 annotation (Placement(
            transformation(
            extent={{-10,-10},{10,10}},
            origin={-76,62})));
        Modelica.Blocks.Math.Product air_pH2O
          annotation (Placement(transformation(extent={{-54,56},{-44,46}})));
      Modelica.Blocks.Math.Gain sweatDensity(
          y(unit="kg/s"),
          k(unit="kg/m3") = 1000,
          u(unit="m3/s")) annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=270,
              origin={-20,-24})));
      Physiolibrary.Thermal.Components.Stream HeatSweatConvection(
                    useMassFlowInput=true, SpecificHeat=4186.8)
        annotation (Placement(transformation(extent={{-30,-84},{-10,-64}})));
      Physiolibrary.Blocks.Interpolation.Curve BasicEvaporation(
        slope={0,0},
        val(displayUnit="kg/s", nominal=0.001/60),
        u(displayUnit="Pa", nominal=(101325/760)),
        x={0,40},
        y={0,20},
        Xscale=101325/760,
        Yscale=0.001/60)                           annotation (Placement(
            transformation(
            extent={{-10,10},{10,-10}},
            rotation=180,
            origin={-80,8})));
      Modelica.Blocks.Math.Gain sweatDensity2(
          y(unit="kg/s"),
          k(unit="kg/m3") = 1000,
          u(unit="m3/s")) annotation (Placement(transformation(
              extent={{-4,-4},{4,4}},
              rotation=180,
              origin={-34,-4})));
      Physiolibrary.Blocks.Factors.Spline NerveEffect(data={{0.0,0.0,0.0},{4.0,30.0,0.0}})
        annotation (Placement(transformation(extent={{62,60},{82,80}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2ORateBasic(k=1.6666666666667e-08)
          annotation (Placement(transformation(extent={{46,86},{54,94}})));
      equation
        connect(busConnector.skin_FunctionEffect, SkinFunctionEffect.u)
          annotation (Line(
            points={{-90,91},{30,91},{30,12},{64,12}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(AcclimationEffect.y, SkinFunctionEffect.yBase) annotation (Line(
            points={{72,28},{72,14}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FuelEffect.y, AcclimationEffect.yBase) annotation (Line(
            points={{72,48},{72,34}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(inputPump.q_out, SweatFuel.q_out) annotation (Line(
            points={{54,-42},{67,-42}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
        connect(SweatFuel.q_out, outputPump.q_in) annotation (Line(
            points={{67,-42},{82,-42}},
            color={200,0,0},
            thickness=1,
            smooth=Smooth.None));
      connect(MassEffect.y, inputPump.soluteFlow) annotation (Line(
          points={{44,-32},{44,-38},{48,-38}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(Constant.y, MassEffect.yBase) annotation (Line(
            points={{43,-16},{44,-16},{44,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SkinFunctionEffect.y, H2OOutflow.u1) annotation (Line(
            points={{72,8},{72,-4},{16.4,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2OReab.y, H2OOutflow.u2) annotation (Line(
            points={{3,-18},{10,-18},{10,-10.4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(SkinFunctionEffect.y, gain.u) annotation (Line(
            points={{72,8},{72,-4},{92,-4},{92,-21.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(port_a, HeatSweatEvaporation.q_in) annotation (Line(
            points={{-49,-73},{-54.5,-73},{-54.5,-74},{-60,-74}},
            color={255,128,0},
            thickness=1,
            smooth=Smooth.None));
        connect(WindEffect.y, H2OEvaporation.u1) annotation (Line(
            points={{-84,-24},{-84,-28},{-36,-28},{-36,-11.6},{-42.8,-11.6}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.EnvironmentRelativeHumidity, air_pH2O.u1)
          annotation (Line(
            points={{-90,91},{-100,91},{-100,48},{-55,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(busConnector.AmbientTemperature, vaporPressure1.T) annotation (
            Line(
            points={{-90,91},{-100,91},{-100,62},{-84.6,62}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(air_pH2O.y, Gradient.u2) annotation (Line(
            points={{-43.5,51},{-40,51},{-40,16},{-47.6,16}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.skin_T, vaporPressure.T) annotation (Line(
            points={{-90,91},{-100,91},{-100,30},{-84.6,30}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(H2OOutflow.y, busConnector.SweatDuct_H2OOutflow) annotation (
            Line(
            points={{2.8,-4},{-26,-4},{-26,92},{-90,92},{-90,91}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(H2OOutflow.y, sweatDensity.u) annotation (Line(
            points={{2.8,-4},{-20,-4},{-20,-19.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(port_a,HeatSweatConvection. q_in) annotation (Line(
            points={{-49,-73},{-41.5,-73},{-41.5,-74},{-30,-74}},
            color={255,128,0},
            thickness=1,
            smooth=Smooth.None));
        connect(HeatSweatConvection.q_out, port_b) annotation (Line(
            points={{-10,-74},{-10,-99},{-19,-99}},
            color={255,128,0},
            thickness=1,
            smooth=Smooth.None));
      connect(vaporPressure1.VaporPressure_, air_pH2O.u2) annotation (Line(
          points={{-64.6,62},{-55,62},{-55,54}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(vaporPressure.VaporPressure_, Gradient.u1) annotation (Line(
          points={{-64.6,30},{-54,30},{-54,22.4}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Gradient.y, BasicEvaporation.u) annotation (Line(
          points={{-54,8.8},{-62,8.8},{-62,8},{-70,8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BasicEvaporation.val, WindEffect.yBase) annotation (Line(
          points={{-90,8},{-92,8},{-92,-10},{-84,-10},{-84,-18}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(H2OOutflow.y, sweatDensity2.u) annotation (Line(
            points={{2.8,-4},{-29.2,-4}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(sweatDensity2.y, H2OEvaporation.u2) annotation (Line(
            points={{-38.4,-4},{-40,-4},{-40,-4.4},{-42.8,-4.4}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(H2OEvaporation.y, HeatSweatEvaporation.massFlow) annotation (Line(
          points={{-56.6,-8},{-62,-8},{-62,-67}},
          color={0,0,127},
          smooth=Smooth.None));
        connect(sweatDensity.y, HeatSweatConvection.massFlow) annotation (Line(
            points={{-20,-28.4},{-20,-67},{-28,-67}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(busConnector.WindSpeed, WindEffect.u) annotation (Line(
          points={{-90,91},{-100,91},{-100,-20},{-92,-20}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
        connect(busConnector.skin_T, AcclimationEffect.u) annotation (Line(
            points={{-90,91},{30,91},{30,32},{64,32}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(FuelEffect.yBase, NerveEffect.y) annotation (Line(
            points={{72,54},{72,66}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2ORateBasic.y, NerveEffect.yBase) annotation (Line(
            points={{55,90},{72,90},{72,72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(HypothalamusSweating_NA, NerveEffect.u) annotation (Line(
            points={{-4,70},{64,70}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(outputPump.soluteFlow, gain.y) annotation (Line(
            points={{96,-38},{96,-30.4},{92,-30.4}},
            color={0,0,127},
            smooth=Smooth.None));
      connect(SweatFuel.solute, MassEffect.u) annotation (Line(
          points={{73.6,-52},{68,-52},{68,-62},{24,-62},{24,-28},{36,-28}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(SweatFuel.solute, FuelEffect.u) annotation (Line(
          points={{73.6,-52},{68,-52},{68,-62},{24,-62},{24,52},{64,52}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-137,-103},{144,-128}},
                lineColor={0,0,255},
                textString="%name")}));
      end SweatGland;

      model InsensibleSkin
        extends Physiolibrary.Icons.Skin;
        parameter Real bodyPart=1/3;
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-100,81},{-80,101}}), iconTransformation(
              extent={{60,60},{80,80}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab1(k=0.37*
            bodyPart)
        annotation (Placement(transformation(extent={{-48,-64},{-40,-56}})));
      Physiolibrary.Osmotic.Interfaces.OsmoticPort_b q_out annotation (
          Placement(transformation(extent={{-48,-44},{-30,-28}}),
            iconTransformation(extent={{-90,-50},{-70,-30}})));
      Physiolibrary.Osmotic.Sources.SolventOutflux vapor(useSolutionFlowInput=
            true)
        annotation (Placement(transformation(extent={{6,-92},{26,-72}})));
      equation
        connect(vapor.q_in, q_out) annotation (Line(
            points={{10,-82},{4,-82},{4,-36},{-39,-36}},
            color={127,127,0},
            thickness=1,
            smooth=Smooth.None));
      connect(H2OReab1.y, vapor.solutionFlow) annotation (Line(
          points={{-39,-60},{16,-60},{16,-78}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-155,-83},{126,-108}},
                lineColor={0,0,255},
                textString="%name")}));
      end InsensibleSkin;

      model InsensibleSkin2
        extends Physiolibrary.Icons.Skin;
        parameter Real bodyPart=1/3;
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-100,81},{-80,101}}), iconTransformation(
              extent={{60,60},{80,80}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab1(k=0.37*
            bodyPart)
        annotation (Placement(transformation(extent={{-48,-64},{-40,-56}})));
        Modelica.Blocks.Logical.Switch switch1
          annotation (Placement(transformation(extent={{-28,-82},{-8,-62}})));
        Modelica.Blocks.Logical.Greater greater
          annotation (Placement(transformation(extent={{-70,-82},{-50,-62}})));
      Physiolibrary.Types.Constants.VolumeFlowRateConst H2OReab2(k=0)
        annotation (Placement(transformation(extent={{-74,-98},{-66,-90}})));
      Physiolibrary.Osmotic.Interfaces.OsmoticPort_b q_out annotation (
          Placement(transformation(extent={{-48,-44},{-30,-28}}),
            iconTransformation(extent={{-90,-50},{-70,-30}})));
      Physiolibrary.Osmotic.Sources.SolventOutflux vapor(useSolutionFlowInput=
            true)
        annotation (Placement(transformation(extent={{6,-92},{26,-72}})));
      equation
        connect(greater.y, switch1.u2) annotation (Line(
            points={{-49,-72},{-30,-72}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(H2OReab1.y, switch1.u1) annotation (Line(
            points={{-39,-60},{-36,-60},{-36,-64},{-30,-64}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2OReab2.y, switch1.u3) annotation (Line(
            points={{-65,-94},{-34,-94},{-34,-80},{-30,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(H2OReab2.y, greater.u2) annotation (Line(
            points={{-65,-94},{-60,-94},{-60,-86},{-76,-86},{-76,-80},{-72,-80}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(busConnector.skin_BloodFlow, greater.u1) annotation (Line(
            points={{-90,91},{-90,-72},{-72,-72}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(vapor.q_in, q_out) annotation (Line(
            points={{10,-82},{4,-82},{4,-36},{-39,-36}},
            color={127,127,0},
            thickness=1,
            smooth=Smooth.None));
      connect(switch1.y, vapor.solutionFlow) annotation (Line(
          points={{-7,-72},{16,-72},{16,-78}},
          color={0,0,127},
          smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
              graphics={Text(
                extent={{-155,-83},{126,-108}},
                lineColor={0,0,255},
                textString="%name")}));
      end InsensibleSkin2;
    end Skin;

    model Lungs
       extends Physiolibrary.Icons.Lungs;
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-76,32},{-56,52}}), iconTransformation(extent=
             {{-82,-16},{-62,4}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_a positiveHeatFlow annotation (
        Placement(transformation(extent={{0,-14},{20,6}}),iconTransformation(
            extent={{-24,-56},{-4,-36}})));
      Physiolibrary.Thermal.Sources.MassOutflow lungsVapor(
        useMassFlowInput=true,
      VaporizationHeat(displayUnit="kcal/g") = 2428344,
      SpecificHeat=4186.8)
        annotation (Placement(transformation(extent={{62,-14},{82,6}})));
      Modelica.Blocks.Math.Feedback gradient
        annotation (Placement(transformation(extent={{-32,74},{-12,94}})));
    Gases.Ventilation.VaporPressure vaporPressure1 annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-62,56})));
      Modelica.Blocks.Math.Product air_pH2O
        annotation (Placement(transformation(extent={{-42,60},{-32,70}})));
    Gases.Ventilation.VaporPressure vaporPressure2 annotation (Placement(
          transformation(
          extent={{-10,-10},{10,10}},
          origin={-52,84})));
      Modelica.Blocks.Math.Division division
        annotation (Placement(transformation(extent={{-2,46},{18,66}})));
      Modelica.Blocks.Math.Product product
        annotation (Placement(transformation(extent={{34,36},{54,56}})));
      Modelica.Blocks.Math.Gain K(k=0.80E-3)
        annotation (Placement(transformation(extent={{64,36},{84,56}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_b air annotation (Placement(
          transformation(extent={{-92,-14},{-72,6}}),   iconTransformation(
            extent={{-24,52},{-4,72}})));
    Physiolibrary.Thermal.Components.Conductor resistorWithCond(
        useConductanceInput=true)
      annotation (Placement(transformation(extent={{-32,-14},{-12,6}})));
      Modelica.Blocks.Math.Gain SpecificHeat_Air(k=0.31*4186.4)
        annotation (Placement(transformation(extent={{-48,6},{-28,26}})));
    Modelica.Blocks.Math.Gain waterDensity(
        y(unit="kg/s"),
        k(unit="kg/m3") = 1000,
        u(unit="m3/s")) annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=270,
            origin={73,17})));
    equation

      connect(positiveHeatFlow, lungsVapor.q_in) annotation (Line(
          points={{10,-4},{62,-4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector.AmbientTemperature, vaporPressure1.T) annotation (
          Line(
          points={{-66,42},{-90,42},{-90,56},{-70.6,56}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.EnvironmentRelativeHumidity, air_pH2O.u1)
        annotation (Line(
          points={{-66,42},{-90,42},{-90,68},{-43,68}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.core_T, vaporPressure2.T) annotation (Line(
          points={{-66,42},{-90,42},{-90,84},{-60.6,84}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(air_pH2O.y, gradient.u2) annotation (Line(
          points={{-31.5,65},{-22,65},{-22,76}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(gradient.y, division.u1) annotation (Line(
          points={{-13,84},{-8,84},{-8,62},{-4,62}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(division.y, product.u1) annotation (Line(
          points={{19,56},{26,56},{26,52},{32,52}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.BreathingTotalVentilation, product.u2) annotation (
          Line(
          points={{-66,42},{-18,42},{-18,40},{32,40}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(product.y, K.u) annotation (Line(
          points={{55,46},{62,46}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(positiveHeatFlow, resistorWithCond.q_out) annotation (Line(
          points={{10,-4},{-12,-4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(resistorWithCond.q_in, air) annotation (Line(
          points={{-32,-4},{-82,-4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector.BreathingTotalVentilation, SpecificHeat_Air.u)
        annotation (Line(
          points={{-66,42},{-66,16},{-50,16}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(waterDensity.y, lungsVapor.massFlow) annotation (Line(
          points={{73,11.5},{73,7.75},{64,7.75},{64,3}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(K.y, waterDensity.u) annotation (Line(
          points={{85,46},{92,46},{92,30},{73,30},{73,23}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(vaporPressure1.VaporPressure_, air_pH2O.u2) annotation (Line(
        points={{-50.6,56},{-48,56},{-48,62},{-43,62}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(vaporPressure2.VaporPressure_, gradient.u1) annotation (Line(
        points={{-40.6,84},{-30,84}},
        color={0,0,127},
        smooth=Smooth.None));
      connect(busConnector.BarometerPressure, division.u2) annotation (Line(
          points={{-66,42},{-36,42},{-36,50},{-4,50}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(SpecificHeat_Air.y, resistorWithCond.conductance) annotation (Line(
          points={{-27,16},{-22,16},{-22,0}},
          color={0,0,127},
          smooth=Smooth.None));
    end Lungs;

    model Core
       extends Physiolibrary.Icons.HeatCore;
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-82,34},{-62,54}}), iconTransformation(extent=
             {{-10,72},{10,92}})));
    Physiolibrary.Thermal.Interfaces.HeatPort_a positiveHeatFlow annotation (
        Placement(transformation(extent={{2,-8},{10,0}}), iconTransformation(
            extent={{-8,-4},{12,16}})));
    Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow CoreMetabolism
      annotation (Placement(transformation(extent={{-32,-28},{-12,-8}})));
    Physiolibrary.Thermal.Components.HeatAccumulation core(
      stateName="HeatCore.Mass",
      useMassInput=true,
      relativeHeat_start=0)
      annotation (Placement(transformation(extent={{-6,-54},{14,-34}})));
                           //(45005587.92) - 310.15*weight*(3475.044))

      Physiolibrary.Types.RealIO.TemperatureOutput
                                            core_T
                                            annotation (Placement(
            transformation(extent={{32,-102},{52,-82}}),
                                                       iconTransformation(
              extent={{40,-40},{80,0}})));
      Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor temperatureSensor
        annotation (Placement(transformation(extent={{20,-54},{40,-34}})));
    equation

    connect(CoreMetabolism.port, core.q_in) annotation (Line(
        points={{-12,-18},{-2,-18},{-2,-44},{4,-44}},
        color={255,128,0},
        thickness=1,
        smooth=Smooth.None));
      connect(core.q_in, positiveHeatFlow) annotation (Line(
          points={{4,-44},{6,-44},{6,-4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector.MetabolismCaloriesUsed_CoreHeat, CoreMetabolism.Q_flow)
        annotation (Line(
          points={{-72,44},{-72,-18},{-32,-18}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.WeightCore, core.weight) annotation (Line(
          points={{-72,44},{-72,-36},{-6,-36}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(core.q_in, temperatureSensor.port) annotation (Line(
          points={{4,-44},{20,-44}},
          color={191,0,0},
          thickness=1,
          smooth=Smooth.None));
      connect(temperatureSensor.T, busConnector.core_T) annotation (Line(
          points={{40,-44},{52,-44},{52,70},{-72,70},{-72,44}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(temperatureSensor.T, busConnector.HeatCore_Temp) annotation (Line(
          points={{40,-44},{52,-44},{52,44},{-72,44}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(temperatureSensor.T, core_T) annotation (Line(
          points={{40,-44},{46,-44},{46,-76},{16,-76},{16,-92},{42,-92}},
          color={0,0,127},
          smooth=Smooth.None));
    end Core;

    package IO_Bus
        extends Physiolibrary.Types.IO_Bus;
      redeclare model extends Variables

      T.Temperature GITract_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,10},{-30,16}})));
      T.Temperature HeatCore_Temp(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,20},{-30,26}})));
      T.Temperature bone_T(varName="HeatCore.Temp(C)") "Body core temperature."
      annotation (Placement(transformation(extent={{-36,30},{-30,36}})));
      T.Temperature brain_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,40},{-30,46}})));
      T.Temperature core_T(varName="HeatCore.Temp(C)") "Body core temperature."
      annotation (Placement(transformation(extent={{-36,50},{-30,56}})));
      T.Temperature fat_T(varName="HeatCore.Temp(C)") "Body core temperature."
      annotation (Placement(transformation(extent={{-36,60},{-30,66}})));
      T.Temperature kidney_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,70},{-30,76}})));
      T.Temperature liver_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,80},{-30,86}})));
      T.Temperature otherTissue_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,90},{-30,96}})));
      T.Temperature respiratoryMuscle_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,100},{-30,106}})));
      T.Temperature rightHeart_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,110},{-30,116}})));
      T.Temperature skeletalMuscle_T(varName="HeatSkeletalMuscle.Temp(C)")
        "Skeletal muscle temperature."
      annotation (Placement(transformation(extent={{-36,120},{-30,126}})));
      T.Temperature skin_T(varName="HeatSkin.Temp(C)") "Skin temperature."
      annotation (Placement(transformation(extent={{-36,130},{-30,136}})));
      T.Temperature leftHeart_T(varName="HeatCore.Temp(C)")
        "Body core temperature."
      annotation (Placement(transformation(extent={{-36,-2},{-30,4}})));
      T.Fraction skinFlow_termoregulationEffect(varName=
              "Skin-Flow.SympsDilateEffect")
        "Skin vasodilatation effect on blood flow conductance."
      annotation (Placement(transformation(extent={{-36,-16},{-30,-10}})));
      T.HeatFlowRate skeletalMuscle_shiveringCals(varName=
              "SkeletalMuscle-Metabolism.ShiveringCals", storeUnit="cal/min")
        "Calories flow consumption by skeletal muscle shivering."
      annotation (Placement(transformation(extent={{-36,-32},{-30,-26}})));
      T.VolumeFlowRate SweatDuct_H2OOutflow(varName="SweatDuct.H2OOutflow")
        "Sweat duct H2O outflow."
      annotation (Placement(transformation(extent={{-36,-54},{-30,-48}})));
      T.Fraction hypothalamusShivering_NerveActivity(
                                                  varName=
              "HypothalamusShivering.NerveActivity", storeUnit="1")
        "Neural activity from hypothalamus shivering centrum."
      annotation (Placement(transformation(extent={{-34,-70},{-28,-64}})));
      equation
      connect(GITract_T.y, busConnector.GITract_T) annotation (Line(
       points={{-29.7,13},{90,13},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(HeatCore_Temp.y, busConnector.HeatCore_Temp) annotation (Line(
       points={{-29.7,23},{90,23},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(bone_T.y, busConnector.bone_T) annotation (Line(
       points={{-29.7,33},{90,33},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(brain_T.y, busConnector.brain_T) annotation (Line(
       points={{-29.7,43},{90,43},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(core_T.y, busConnector.core_T) annotation (Line(
       points={{-29.7,53},{90,53},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(fat_T.y, busConnector.fat_T) annotation (Line(
       points={{-29.7,63},{90,63},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(kidney_T.y, busConnector.kidney_T) annotation (Line(
       points={{-29.7,73},{90,73},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(liver_T.y, busConnector.liver_T) annotation (Line(
       points={{-29.7,83},{90,83},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(otherTissue_T.y, busConnector.otherTissue_T) annotation (Line(
       points={{-29.7,93},{90,93},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(respiratoryMuscle_T.y, busConnector.respiratoryMuscle_T) annotation (Line(
       points={{-29.7,103},{90,103},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(rightHeart_T.y, busConnector.rightHeart_T) annotation (Line(
       points={{-29.7,113},{90,113},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_T.y, busConnector.skeletalMuscle_T) annotation (Line(
       points={{-29.7,123},{90,123},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skin_T.y, busConnector.skin_T) annotation (Line(
       points={{-29.7,133},{90,133},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(leftHeart_T.y, busConnector.leftHeart_T) annotation (Line(
            points={{-29.7,1},{72,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(skinFlow_termoregulationEffect.y, busConnector.skinFlow_termoregulationEffect)
          annotation (Line(
            points={{-29.7,-13},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(skeletalMuscle_shiveringCals.y, busConnector.skeletalMuscle_shiveringCals)
          annotation (Line(
            points={{-29.7,-29},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(SweatDuct_H2OOutflow.y, busConnector.SweatDuct_H2OOutflow)
          annotation (Line(
            points={{-29.7,-51},{25.15,-51},{25.15,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(hypothalamusShivering_NerveActivity.y, busConnector.HypothalamusShivering_NerveActivity)
        annotation (Line(
          points={{-27.7,-67},{90,-67},{90,-2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={
              Text(
                extent={{18,98},{100,60}},
                lineColor={0,0,0},
                textString="vars"),
              Text(
                extent={{-122,-102},{120,-136}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model Heat_test
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.Heat2 heat
          annotation (Placement(transformation(extent={{-26,30},{-46,50}})));
        Physiomodel.Heat.IO_Bus.OutputComparison heat_dif
          annotation (Placement(transformation(extent={{-64,34},{-44,54}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-34,50},{-14,70}}), iconTransformation(
              extent={{-104,86},{-84,106}})));
        Physiomodel.Heat.IO_Bus.OutputToFile heat_varsToFile
          annotation (Placement(transformation(extent={{-92,26},{-72,46}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-26.6,49.6},{-6,49.6},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat_dif.busConnector, heat.busConnector) annotation (Line(
            points={{-54,44},{-42,44},{-42,49.6},{-26.6,49.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector, busConnector) annotation (Line(
            points={{-26.6,49.6},{-26.6,55.8},{-24,55.8},{-24,60}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(busConnector, heat_varsToFile.busConnector) annotation (Line(
            points={{-24,60},{-65,60},{-65,36},{-82,36}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Heat_test;

      model Heat_test_SI
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile_SI electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile_SI hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.Heat2 heat
          annotation (Placement(transformation(extent={{-26,30},{-46,50}})));
        Physiomodel.Heat.IO_Bus.OutputComparison_SI heat_dif
          annotation (Placement(transformation(extent={{-64,34},{-44,54}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{-34,50},{-14,70}}), iconTransformation(
              extent={{-104,86},{-84,106}})));
        Physiomodel.Heat.IO_Bus.OutputToFile_SI heat_varsToFile
          annotation (Placement(transformation(extent={{-92,26},{-72,46}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-26.6,49.6},{-6,49.6},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat_dif.busConnector, heat.busConnector) annotation (Line(
            points={{-54,44},{-42,44},{-42,49.6},{-26.6,49.6}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector, busConnector) annotation (Line(
            points={{-26.6,49.6},{-26.6,55.8},{-24,55.8},{-24,60}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(busConnector, heat_varsToFile.busConnector) annotation (Line(
            points={{-24,60},{-65,60},{-65,36},{-82,36}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Heat_test_SI;
    end IO_Bus;

    model Heat3
     extends Physiolibrary.Icons.Heat;
    //      initialTemperature(displayUnit="degC") = 310.15,
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-104,86},{-84,106}}), iconTransformation(
            extent={{-104,86},{-84,106}})));
      Physiolibrary.Thermal.Sources.MassOutflow HeatInsensibleSkin(
        q_in(T(start=303.824)),
        VaporizationHeat=2428344,
        SpecificHeat=4186.8,
        useMassFlowInput=true)
        annotation (Placement(transformation(extent={{66,-12},{86,8}})));
    Physiolibrary.Types.Constants.MassFlowRateConst massFlowConstant(k=6.1666666666667e-06)
      annotation (Placement(transformation(extent={{62,10},{68,16}})));
    Physiolibrary.Thermal.Components.Conductor conduction(useConductanceInput=
          true)
      annotation (Placement(transformation(extent={{74,-60},{94,-40}})));
    Physiolibrary.Blocks.Factors.Spline WindEffect(data={{0.0,1.0,0},{20.0,4.0,
          0}}, Xscale=0.44704)
      annotation (Placement(transformation(extent={{94,-48},{74,-28}})));
    Physiolibrary.Blocks.Factors.Spline BloodFlowEffect(data={{0,0.8,0},{250,
          1.0,1.0E-3},{8000,8.0,0}}, Xscale=1e-6/60)
      annotation (Placement(transformation(extent={{94,-42},{74,-22}})));
    Physiolibrary.Blocks.Factors.Spline ClothesEffect(data={{0.0,4.0,0},{2.0,
          1.0,-1.2},{4.0,0.2,0}})
      annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
    Physiolibrary.Types.Constants.ThermalConductanceConst Constant(k(displayUnit="kcal/(min.K)")=
             2.37252)
      annotation (Placement(transformation(extent={{74,-20},{82,-12}})));
    Physiolibrary.Types.Constants.FractionConst             Constant1(k=2)
      annotation (Placement(transformation(extent={{58,-28},{66,-20}})));
    Physiolibrary.Thermal.Sources.UnlimitedHeat ambientTemperature(T=298.15)
      annotation (Placement(transformation(extent={{58,-88},{78,-68}})));
    Physiolibrary.Thermal.Components.Conductor radiation(useConductanceInput=
          true)
      annotation (Placement(transformation(extent={{26,-88},{46,-68}})));
    Physiolibrary.Blocks.Factors.Spline ClothesEffect1(data={{0.0,4.0,0},{2.0,
          1.0,-1.2},{4.0,0.2,0}})
      annotation (Placement(transformation(extent={{26,-78},{46,-58}})));
    Physiolibrary.Types.Constants.ThermalConductanceConst Constant3(k=4.74504)
      annotation (Placement(transformation(extent={{24,-62},{32,-54}})));
      TissuesHeat otherTissuesHeat
        annotation (Placement(transformation(extent={{-86,-76},{-64,-54}})));
      SkinHeat2 skinHeat
                        annotation (Placement(transformation(
            extent={{-15,-15},{15,15}},
            rotation=270,
            origin={33,-13})));
      MuscleHeat muscleHeat
        annotation (Placement(transformation(extent={{-54,-74},{-26,-42}})));
      Nerves.Hypothalamus hypothalamus
        annotation (Placement(transformation(extent={{16,62},{36,82}})));
      Skin.SweatGland sweatGland
        annotation (Placement(transformation(extent={{72,36},{92,56}})));
      Lungs lungs
        annotation (Placement(transformation(extent={{-40,18},{-20,38}})));
      Core core1
        annotation (Placement(transformation(extent={{-36,-12},{-16,8}})));
    equation
      connect(BloodFlowEffect.y, WindEffect.yBase) annotation (Line(
          points={{84,-36},{84,-36}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ClothesEffect.y, BloodFlowEffect.yBase) annotation (Line(
          points={{84,-28},{84,-30}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant.y, ClothesEffect.yBase) annotation (Line(
          points={{83,-16},{84,-16},{84,-22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant1.y, ClothesEffect.u) annotation (Line(
          points={{67,-24},{76,-24}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(busConnector.skin_BloodFlow, BloodFlowEffect.u) annotation (Line(
          points={{-94,96},{98,96},{98,-32},{92,-32}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(conduction.q_out, ambientTemperature.port) annotation (Line(
          points={{94,-50},{98,-50},{98,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(Constant1.y, ClothesEffect1.u) annotation (Line(
          points={{67,-24},{70,-24},{70,-34},{22,-34},{22,-68},{28,-68}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant3.y, ClothesEffect1.yBase) annotation (Line(
          points={{33,-58},{36,-58},{36,-66}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(radiation.q_out, ambientTemperature.port) annotation (Line(
          points={{46,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(busConnector, otherTissuesHeat.busConnector) annotation (Line(
          points={{-94,96},{-94,-54.88},{-84.68,-54.88}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(skinHeat.q_out, HeatInsensibleSkin.q_in)
                                              annotation (Line(
          points={{35.7,-10},{36,-10},{36,-4},{44,-4},{44,-2},{66,-2}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinHeat.q_out, conduction.q_in) annotation (Line(
          points={{35.7,-10},{46,-10},{46,-50},{74,-50}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinHeat.q_out, radiation.q_in) annotation (Line(
          points={{35.7,-10},{46,-10},{46,-50},{18,-50},{18,-78},{26,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(skinHeat.busConnector, busConnector) annotation (Line(
          points={{30,-1},{30,18},{100,18},{100,96},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(muscleHeat.busConnector, busConnector) annotation (Line(
          points={{-53.16,-42.64},{-52,-42},{-94,-42},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(busConnector.brain_FunctionEffect,hypothalamus. BrainFunctionEffect)
        annotation (Line(
          points={{-94,96},{-76,96},{-76,78},{16,78}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(hypothalamus.HypothalamusSkinFlow_NA, skinHeat.HypothalamusSkinFlow_NervesActivity)
        annotation (Line(
          points={{36,70},{44,70},{44,20},{24,20},{24,-1}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(skinHeat.skin_T, hypothalamus.HeatSkin_Temp) annotation (Line(
          points={{30,-22},{30,-22},{-4,-20},{-4,68},{16,68}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(hypothalamus.HypothalamusSweating_NA, sweatGland.HypothalamusSweating_NA)
        annotation (Line(
          points={{36,76},{48,76},{48,40},{74,40}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(sweatGland.busConnector, busConnector) annotation (Line(
          points={{89,53},{98,53},{98,96},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(skinHeat.q_out, sweatGland.port_a) annotation (Line(
          points={{35.7,-10},{46,-10},{46,36},{82,36}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(sweatGland.port_b, ambientTemperature.port) annotation (Line(
          points={{82,56},{104,56},{104,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(lungs.busConnector, busConnector) annotation (Line(
          points={{-37.2,27.4},{-94,27.4},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(lungs.positiveHeatFlow, core1.positiveHeatFlow) annotation (Line(
          points={{-31.4,23.4},{-26,23.4},{-26,-1.4},{-25.8,-1.4}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(core1.positiveHeatFlow, skinHeat.positiveHeatFlow) annotation (
          Line(
          points={{-25.8,-1.4},{-25.8,6.6},{2,6.6},{2,-9.7},{24,-9.7}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(core1.positiveHeatFlow, muscleHeat.q_out) annotation (Line(
          points={{-25.8,-1.4},{-25.8,-12},{-26,-12},{-26,-58},{-40,-58}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));

      connect(core1.core_T, hypothalamus.HeatCore_Temp) annotation (Line(
          points={{-20,-4},{0,-4},{0,72},{16,72}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(core1.busConnector, busConnector) annotation (Line(
          points={{-26,6.2},{-26,14.2},{-58,14.2},{-58,96},{-94,96}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(lungs.air, ambientTemperature.port) annotation (Line(
          points={{-31.4,34.2},{-31.4,58},{104,58},{104,-78},{78,-78}},
          color={255,128,0},
          thickness=1,
          smooth=Smooth.None));
      connect(hypothalamus.HypothalamusShivering_NA, busConnector.HypothalamusShivering_NerveActivity)
        annotation (Line(
          points={{36,64},{42,64},{42,96},{-94,96}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(WindEffect.y, conduction.conductance) annotation (Line(
          points={{84,-42},{84,-46}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(ClothesEffect1.y, radiation.conductance) annotation (Line(
          points={{36,-72},{36,-74}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(massFlowConstant.y, HeatInsensibleSkin.massFlow) annotation (Line(
        points={{68.75,13},{68,13},{68,5}},
        color={0,0,127},
        smooth=Smooth.None));
    connect(core1.positiveHeatFlow, busConnector.coreHeat) annotation (Line(
        points={{-25.8,-1.4},{-25.8,-6},{-58,-6},{-58,96},{-94,96}},
        color={191,0,0},
        thickness=1,
        smooth=Smooth.None), Text(
        string="%second",
        index=1,
        extent={{6,3},{6,3}}));
      connect(WindEffect.u, busConnector.WindSpeed) annotation (Line(
          points={{92,-38},{100,-38},{100,96},{-94,96}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation ( Icon(coordinateSystem(
              preserveAspectRatio=true,  extent={{-100,-100},{100,100}}),
            graphics={               Text(
              extent={{-94,-100},{94,-126}},
              lineColor={0,0,255},
              textString="%name")}));
    end Heat3;
    annotation (Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2008-2015</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: HumMod 1.6, University of Mississippi Medical Center</p></td>
</tr>
</table>
<p>Copyright &copy; 2008-2015 Marek Matejak, Charles University in Prague.</p>
</html>", info="<html>
<p>Thermoregulation [Benzinger1969,Hardy1961,Schreider1957] maintains the body temperature around 37degC. Heat is produced mostly by metabolismus or work of muscles [Saltin1966]. It is transported to environment[Consolazio1963] through skin, where the skin temperature depends on skin blood flow [Adolph1946,Hardy1938,Hsieh1965,Kamon1968,Pennes1948]. Body can be also heated or cooled by food or drinks [Gephart1915]. </p>
<p>The temperature is from heat energy calculated using specific heat capacity of tissues [Burton1935,Lipkin1954].</p>
<p>Thermoreceptors measure the temperature throughout the body and send the signal to hypothalamic centre of termoregulation[Kelso1982,Dodt1952,Hensel1953]. Main response on hypertermia [Blatteis1997,Hart1982,Gaus1917,Consolazio1961] is skin vasodilation and sweating[Armstrong1991,Epstein1999,Latzka1999,Morimoto1998,Quinton1991,Sato1977,1989a,b], where sweat glands could suffer with fatigue[Wyndham1966]. Main responses on hypotermia [Molnar1946,Talbott1941] is skin vasoconstriction and shivering[Carlson1954,Lampietro1960]. The neural acclination are more complex and is different for short time and long time responses [Horowitz2003,Armstrong1991,Piwonka1967].</p>
<p>The spontaneus loss of heat is by lungs evaporization[Brabbia1957]. </p>
<p>Temperature has effect on chemical reactions, so the metabolic processes are dependent on it [Abramson1958,Consolazio1961,Dirmi1980,Talbott1941,Matsuoka1994] as well as metabolism of leg muscle[Fink1975]. But the main problem with temperature is denaturisation of proteins at high temperature [Katschinski2004].</p>
</html>"));
  end Heat;


  package Setup "Environment Influences"
    extends Physiolibrary.Icons.SetupLib;

    model Setup
      extends Physiolibrary.Icons.Setup;
    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{54,-24},{74,-4}}), iconTransformation(extent=
              {{60,40},{100,80}})));
      Exercise exercise
        annotation (Placement(transformation(extent={{0,10},{20,30}})));
      Tissues tissuesSetup
        annotation (Placement(transformation(extent={{20,-58},{40,-38}})));
      Blood bloodInOut
        annotation (Placement(transformation(extent={{-24,-60},{-4,-40}})));
      Enviroment enviroment
        annotation (Placement(transformation(extent={{-36,14},{-16,34}})));
      Posture posture
        annotation (Placement(transformation(extent={{38,4},{58,24}})));
      Diet diet
        annotation (Placement(transformation(extent={{-76,14},{-56,34}})));
      Drugs drugs
        annotation (Placement(transformation(extent={{-68,-58},{-48,-38}})));
      Secretion secretion
        annotation (Placement(transformation(extent={{-50,42},{-30,62}})));
      Anesthesia anesthesia
        annotation (Placement(transformation(extent={{-16,42},{4,62}})));
      Unpaired unpaired
        annotation (Placement(transformation(extent={{58,-62},{78,-42}})));
    equation
      connect(enviroment.busConnector, busConnector) annotation (Line(
          points={{-28,24},{-38,24},{-38,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(exercise.busConnector, busConnector) annotation (Line(
          points={{8,20},{-2,20},{-2,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(tissuesSetup.busConnector, busConnector) annotation (Line(
          points={{28,-48},{16,-48},{16,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(bloodInOut.busConnector, busConnector) annotation (Line(
          points={{-16,-50},{-22,-50},{-22,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(posture.busConnector, busConnector) annotation (Line(
          points={{46,14},{38,14},{38,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(diet.busConnector, busConnector) annotation (Line(
          points={{-68,24},{-76,24},{-76,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(drugs.busConnector, busConnector) annotation (Line(
          points={{-60,-48},{-66,-48},{-66,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(secretion.busConnector, busConnector) annotation (Line(
          points={{-42,52},{-50,52},{-50,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(anesthesia.busConnector, busConnector) annotation (Line(
          points={{-8,52},{-16,52},{-16,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      connect(unpaired.busConnector, busConnector) annotation (Line(
          points={{66,-52},{66,-33},{66,-14},{64,-14}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true,  extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-120,-42},{122,-76}},
              lineColor={0,0,255},
              textString="%name")}));
    end Setup;

    model Enviroment

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const2(k=9.81)
      annotation (Placement(transformation(extent={{14,36},{8,42}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant77(k=760)
      annotation (Placement(transformation(extent={{34,76},{28,82}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant78(k=760)
      annotation (Placement(transformation(extent={{34,68},{28,74}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant8(k=0)
      annotation (Placement(transformation(extent={{76,90},{68,98}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Gravity_Gz(k=1)
      annotation (Placement(transformation(extent={{14,28},{8,34}})));
    Physiolibrary.Types.Constants.FractionConst EnvironmentRelativeHumidity(k=
          0.7000000000000001)
      annotation (Placement(transformation(extent={{-84,12},{-78,18}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant AmbientTemperature(
        k=22.2)
      annotation (Placement(transformation(extent={{-84,20},{-78,26}})));
    equation
      connect(busConnector.BarometerPressure,Constant77. y)
        annotation (Line(
          points={{-33,-13},{-33,79},{27.25,79}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.AirSupplyInspiredAirPressure,Constant78. y)
        annotation (Line(
          points={{-33,-13},{-33,71},{27.25,71}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(busConnector.pCO,Constant8. y) annotation (Line(
          points={{-33,-13},{46,-13},{46,94},{67,94}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(Gravity_Gz.y, busConnector.Gravity_Gz) annotation (Line(
          points={{7.25,31},{-33,31},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity.y, busConnector.EnvironmentRelativeHumidity)
        annotation (Line(
          points={{-77.25,15},{8,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(AmbientTemperature.y, busConnector.AmbientTemperature)
        annotation (Line(
          points={{-77.25,23},{-33,23},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="enviroment")}));
    end Enviroment;

    model Diet

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-24,-4}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant14(k=0)
      annotation (Placement(transformation(extent={{24,40},{16,48}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant15(k=0)
      annotation (Placement(transformation(extent={{24,48},{16,56}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant16(k=0)
      annotation (Placement(transformation(extent={{24,56},{16,64}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant17(k=0)
      annotation (Placement(transformation(extent={{24,64},{16,72}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant18(k=0)
      annotation (Placement(transformation(extent={{24,72},{16,80}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant19(k=
          0.128213)
      annotation (Placement(transformation(extent={{24,80},{16,88}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant20(k=0)
      annotation (Placement(transformation(extent={{24,88},{16,96}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant21(k=0)
      annotation (Placement(transformation(extent={{58,-98},{50,-90}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant22(k=0)
      annotation (Placement(transformation(extent={{80,-90},{72,-82}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant23(k=0)
      annotation (Placement(transformation(extent={{36,-74},{28,-66}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant24(k=0)
      annotation (Placement(transformation(extent={{82,-64},{74,-56}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant25(k=0)
      annotation (Placement(transformation(extent={{36,-44},{28,-36}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant26(k=
          5.2e-002)
      annotation (Placement(transformation(extent={{-66,-72},{-74,-64}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant27(k=0)
      annotation (Placement(transformation(extent={{24,32},{16,40}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant28(k=0)
      annotation (Placement(transformation(extent={{82,-28},{74,-20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant29(k=0)
      annotation (Placement(transformation(extent={{82,-20},{74,-12}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant30(k=0)
      annotation (Placement(transformation(extent={{82,-12},{74,-4}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant31(k=0)
      annotation (Placement(transformation(extent={{82,-4},{74,4}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant32(k=0)
      annotation (Placement(transformation(extent={{82,4},{74,12}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant33(k=
          0.142459)
      annotation (Placement(transformation(extent={{82,12},{74,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant34(k=0)
      annotation (Placement(transformation(extent={{82,20},{74,28}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst PO4(k(displayUnit=
            "mmol/min") = 0.022)
      annotation (Placement(transformation(extent={{-94,-32},{-86,-24}})));
    Physiolibrary.Types.Constants.MolarFlowRateConst SO4(k=0.037)
      annotation (Placement(transformation(extent={{-94,-50},{-86,-42}})));
    Physiolibrary.Types.Constants.TemperatureConst          DietGoalH2O_DegK(k=294.261)
      annotation (Placement(transformation(extent={{-94,-14},{-88,-8}})));
    equation
      connect(Constant14.y,busConnector. IVDrip_NaRate) annotation (Line(
          points={{15,44},{-32,44},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant15.y,busConnector. Transfusion_NaRate) annotation (Line(
          points={{15,52},{-32,52},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant16.y,busConnector. SweatDuct_NaRate) annotation (Line(
          points={{15,60},{-32,60},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant17.y,busConnector. Hemorrhage_NaRate) annotation (Line(
          points={{15,68},{-32,68},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant18.y,busConnector. DialyzerActivity_Na_Flux) annotation (
          Line(
          points={{15,76},{-32,76},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant19.y,busConnector. DietIntakeElectrolytes_Na) annotation (
          Line(
          points={{15,84},{-32,84},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant20.y,busConnector. GILumenDiarrhea_NaLoss) annotation (Line(
          points={{15,92},{-32,92},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant21.y,busConnector. IVDrip_KRate) annotation (Line(
          points={{49,-94},{-32,-94},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant22.y,busConnector. Transfusion_KRate) annotation (Line(
          points={{71,-86},{-32,-86},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant23.y,busConnector. SweatDuct_KRate) annotation (Line(
          points={{27,-70},{-32,-70},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant24.y,busConnector. Hemorrhage_KRate) annotation (Line(
          points={{73,-60},{-32,-60},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant25.y,busConnector. DialyzerActivity_K_Flux) annotation (
          Line(
          points={{27,-40},{-32,-40},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant26.y,busConnector. DietIntakeElectrolytes_K) annotation (
          Line(
          points={{-75,-68},{-32,-68},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant27.y,busConnector. GILumenDiarrhea_KLoss) annotation (Line(
          points={{15,36},{-32,36},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant28.y,busConnector. IVDrip_ClRate) annotation (Line(
          points={{73,-24},{-32,-24},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant29.y,busConnector. Transfusion_ClRate) annotation (Line(
          points={{73,-16},{-32,-16},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant30.y,busConnector. SweatDuct_ClRate) annotation (Line(
          points={{73,-8},{-32,-8},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant31.y,busConnector. Hemorrhage_ClRate) annotation (Line(
          points={{73,0},{-32,0},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant32.y,busConnector. DialyzerActivity_Cl_Flux) annotation (
          Line(
          points={{73,8},{-32,8},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant33.y,busConnector. DietIntakeElectrolytes_Cl) annotation (
          Line(
          points={{73,16},{-32,16},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(Constant34.y, busConnector.GILumenVomitus_ClLoss) annotation (Line(
          points={{73,24},{-32,24},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None));
    connect(PO4.y, busConnector.DietIntakeElectrolytes_PO4) annotation (Line(
        points={{-85,-28},{-80,-28},{-80,-30},{-32,-30},{-32,-12}},
        color={0,0,127},
        thickness=0.5,
        smooth=Smooth.None));
    connect(SO4.y, busConnector.DietIntakeElectrolytes_SO4) annotation (Line(
        points={{-85,-46},{-32,-46},{-32,-12}},
        color={0,0,127},
        thickness=0.5,
        smooth=Smooth.None));
      connect(DietGoalH2O_DegK.y, busConnector.DietGoalH2O_DegK) annotation (
          Line(
          points={{-87.25,-11},{-84,-12},{-32,-12}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="diet")}));
    end Diet;

    model Exercise

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const7(k=1)
      annotation (Placement(transformation(extent={{-90,-88},{-84,-82}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const24(k=0)
      annotation (Placement(transformation(extent={{-90,-80},{-84,-74}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const25(k=0)
      annotation (Placement(transformation(extent={{-90,-48},{-84,-42}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const19(k=1)
      annotation (Placement(transformation(extent={{-90,-36},{-84,-30}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const14(k=0.37)
      annotation (Placement(transformation(extent={{-96,-16},{-90,-10}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const15(k=0.27)
      annotation (Placement(transformation(extent={{-96,-6},{-90,0}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const11(k=0)
      annotation (Placement(transformation(extent={{-80,22},{-76,26}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const2(k=0)
      annotation (Placement(transformation(extent={{-90,-64},{-84,-58}})));
    equation
      connect(const7.y,busConnector. Exercise_MusclePump_Effect) annotation (
          Line(
          points={{-83.25,-85},{-48,-85},{-48,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const24.y,busConnector. Exercise_Metabolism_ContractionRate)
        annotation (Line(
          points={{-83.25,-77},{-48,-77},{-48,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const25.y,busConnector. Exercise_Metabolism_MotionWatts)
        annotation (Line(
          points={{-83.25,-45},{-48,-45},{-48,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const19.y, busConnector.LegMusclePump_Effect) annotation (Line(
          points={{-83.25,-33},{-47.85,-33},{-47.85,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const14.y, busConnector.HeatInsensibleSkin_H2O)  annotation (Line(
          points={{-89.25,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const15.y, busConnector.HeatInsensibleLung_H2O)  annotation (Line(
          points={{-89.25,-3},{-48.9,-3},{-48.9,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const11.y, busConnector.HeatSweating_H2O) annotation (Line(
          points={{-75.5,24},{-32.9,24},{-32.9,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const2.y, busConnector.ExerciseMetabolism_TotalWatts) annotation (
         Line(
          points={{-83.25,-61},{-48,-61},{-48,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const11.y, busConnector.SweatDuct_H2OOutflow) annotation (Line(
          points={{-75.5,24},{-33,24},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true,  extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="exercise")}));
    end Exercise;

    model Posture

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const36(k=0)
      annotation (Placement(transformation(extent={{64,50},{58,56}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const37(k=0)
      annotation (Placement(transformation(extent={{64,44},{58,50}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const10(k=0)
      annotation (Placement(transformation(extent={{64,32},{58,38}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant integerConstant(k=
          Physiomodel.Water.Hydrostatics.Posture.Lying)
      annotation (Placement(transformation(extent={{18,12},{24,18}})));
    equation
      connect(const36.y,busConnector. LowerTorsoArtyHeight)
        annotation (Line(
          points={{57.25,53},{52,53},{52,58},{-38,58},{-38,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const37.y,busConnector. LowerTorsoVeinHeight)
        annotation (Line(
          points={{57.25,47},{52,47},{52,58},{-38,58},{-38,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const10.y,busConnector. CarotidSinusHeight)
        annotation (Line(
          points={{57.25,35},{52,35},{52,58},{-38,58},{-38,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(integerConstant.y, busConnector.Status_Posture) annotation (Line(
          points={{24.75,15},{62.15,15},{62.15,-13},{-33,-13}},
          color={0,0,255},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="posture")}));
    end Posture;

    model Drugs

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const38(k=0)
      annotation (Placement(transformation(extent={{26,-72},{20,-66}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=0)
      annotation (Placement(transformation(extent={{-80,-88},{-72,-80}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant2(k=0)
      annotation (Placement(transformation(extent={{-92,6},{-84,14}})));
    equation
      connect(const38.y, busConnector.FurosemidePool_Loss) annotation (Line(
          points={{19.25,-69},{-33,-69},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant1.y,busConnector. FurosemidePool_Furosemide_conc)
        annotation (Line(
          points={{-71,-84},{-38,-84},{-38,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant2.y,busConnector. ThiazidePool_Thiazide_conc) annotation (
          Line(
          points={{-83,10},{-62,10},{-62,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="drugs")}));
    end Drugs;

    model Blood

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const41(k=0)
      annotation (Placement(transformation(extent={{-90,-2},{-84,4}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const5(k=0)
      annotation (Placement(transformation(extent={{-90,-36},{-84,-30}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const6(k=0)
      annotation (Placement(transformation(extent={{-92,-78},{-86,-72}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const(k=0)
      annotation (Placement(transformation(extent={{-90,10},{-86,14}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const22(k=0)
      annotation (Placement(transformation(extent={{-90,-24},{-86,-20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const16(k=0)
      annotation (Placement(transformation(extent={{-90,-62},{-86,-58}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const1(k=0)
      annotation (Placement(transformation(extent={{-90,-52},{-86,-48}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const2(k=0)
      annotation (Placement(transformation(extent={{-90,-44},{-84,-38}})));
    equation
      connect(const6.y, busConnector.Hemorrhage_ProteinRate) annotation (Line(
          points={{-85.25,-75},{-85.25,-75.5},{-33,-75.5},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const5.y, busConnector.Transfusion_ProteinRate) annotation (Line(
          points={{-83.25,-33},{-83.25,-32.5},{-33,-32.5},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const41.y, busConnector.IVDripProteinRate) annotation (Line(
          points={{-83.25,1},{-83.25,0.5},{-33,0.5},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const.y, busConnector.IVDrip_H2ORate)  annotation (Line(
          points={{-85.5,12},{-39.85,12},{-39.85,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const22.y, busConnector.Transfusion_PlasmaRate)
                                                             annotation (Line(
          points={{-85.5,-22},{-33,-22},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const16.y, busConnector.Hemorrhage_PlasmaRate)
                                                            annotation (Line(
          points={{-85.5,-60},{-33,-60},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const1.y, busConnector.Hemorrhage_RBCRate) annotation (Line(
          points={{-85.5,-50},{-33,-50},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const2.y, busConnector.Transfusion_RBCRate) annotation (Line(
          points={{-83.25,-41},{-33,-41},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="blood +-")}));
    end Blood;

    model Tissues

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
      Modelica.Blocks.Sources.Step step(
        startTime=600,
        height=0,
        offset=-3)
        annotation (Placement(transformation(extent={{-88,-40},{-78,-30}})));
      Modelica.Blocks.Sources.Step step1(
        offset=-4,
        startTime=600,
        height=0)
        annotation (Placement(transformation(extent={{-88,-26},{-78,-16}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant12(k=1)
      annotation (Placement(transformation(extent={{-90,46},{-84,52}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant11(k=0)
      annotation (Placement(transformation(extent={{-90,52},{-84,58}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant1(k=1)
      annotation (Placement(transformation(extent={{-88,22},{-80,30}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant21(units=
          "ml", k=31)
      annotation (Placement(transformation(extent={{-86,70},{-78,78}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant Constant2(k=1)
      annotation (Placement(transformation(extent={{-88,10},{-80,18}})));
    equation
      connect(step.y,busConnector. Pericardium_Pressure)          annotation (
         Line(
          points={{-77.5,-35},{-32,-35},{-32,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(step1.y,busConnector. Thorax_AvePressure)          annotation (
          Line(
          points={{-77.5,-21},{-33,-21},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant12.y, busConnector.Thorax_LungInflation)
        annotation (Line(
          points={{-83.25,49},{-33,49},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant11.y, busConnector.ExcessLungWater_Volume)
        annotation (Line(
          points={{-83.25,55},{-33,55},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant1.y, busConnector.Kidney_NephronCount_Total_xNormal)
        annotation (Line(
          points={{-79,26},{-34,26},{-34,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant21.y, busConnector.Medulla_Volume)        annotation (Line(
          points={{-77,74},{-34,74},{-34,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Constant2.y, busConnector.Kidney_NephronCount_Filtering_xNormal)
        annotation (Line(
          points={{-79,14},{-34,14},{-34,-13},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="tissues")}));
    end Tissues;

    model Secretion "of urine and faeces"

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const9(k=0)
      annotation (Placement(transformation(extent={{-60,24},{-56,28}})));
    equation
      connect(const9.y, busConnector.BladerVoidFlow) annotation (Line(
          points={{-55.5,26},{-33,26},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const9.y, busConnector.BladderVoidFlow) annotation (Line(
          points={{-55.5,26},{-33,26},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="secretion")}));
    end Secretion;

    model Anesthesia

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{-40,-20},{-26,-6}}), iconTransformation(
            extent={{-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const9(k=1)
      annotation (Placement(transformation(extent={{-60,24},{-56,28}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant const1(k=1)
      annotation (Placement(transformation(extent={{-76,14},{-72,18}})));
    equation
      connect(const9.y, busConnector.AnesthesiaTidalVolume) annotation (Line(
          points={{-55.5,26},{-33,26},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(const1.y, busConnector.Anesthesia_VascularConductance)
        annotation (Line(
          points={{-71.5,16},{-33,16},{-33,-13}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-100,-20},{100,-60}},
              lineColor={0,0,0},
              textString="anesthesia")}),        Documentation(info="<html>
<p>effect 1 means no anesthesia</p>
</html>"));
    end Anesthesia;

    model Unpaired

    Physiolibrary.Types.BusConnector busConnector annotation (Placement(
          transformation(extent={{72,-2},{86,12}}), iconTransformation(extent={
              {-40,-20},{0,20}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant HeatShivering_Cals(
        k=0.)
      annotation (Placement(transformation(extent={{-96,-70},{-90,-64}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant
      HypothalamusSkinFlow_NervesActivity(k=0.935029749050722)
      annotation (Placement(transformation(extent={{-96,-78},{-90,-72}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant
      HypothalamusTSH_TemperatureEffect(k=1.03855784498264)
      annotation (Placement(transformation(extent={{-96,-62},{-90,-56}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant
      skeletalMuscle_SizeMass(k=26743.5620376591)
      annotation (Placement(transformation(extent={{-96,22},{-90,28}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant skinSizeMass(k=
          2792.87262585285)
      annotation (Placement(transformation(extent={{-96,28},{-90,34}})));
    Physiolibrary.Types.Constants.DeprecatedUntypedConstant WeightCore(k=
          48332.7389031163)
      annotation (Placement(transformation(extent={{-96,34},{-90,40}})));
    equation
    connect(skeletalMuscle_SizeMass.y, busConnector.skeletalMuscle_SizeMass) annotation (Line(
     points={{-89.25,25},{79,25},{79,5}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skinSizeMass.y, busConnector.skinSizeMass) annotation (Line(
     points={{-89.25,31},{79,31},{79,5}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(WeightCore.y, busConnector.WeightCore) annotation (Line(
     points={{-89.25,37},{79,37},{79,5}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    end Unpaired;

    package IO_Bus
      extends Physiolibrary.Types.IO_Bus;

      redeclare model extends Variables
        extends Physiolibrary.Icons.Setup;

      T.Pressure AirSupplyInspiredAirPressure(varName="AirSupply-InspiredAir.Pressure")
      annotation (Placement(transformation(extent={{-78,22},{-70,14}})));
      T.Fraction Anesthesia_VascularConductance(varName="Anesthesia.VascularConductance")
      annotation (Placement(transformation(extent={{-80,-144},{-74,-138}})));
      T.Fraction AnesthesiaTidalVolume(varName="Anesthesia.TidalVolume")
      annotation (Placement(transformation(extent={{-80,-134},{-74,-128}})));
      T.Pressure BarometerPressure(varName="Barometer.Pressure")
      annotation (Placement(transformation(extent={{-86,38},{-80,44}})));
      T.Position CarotidSinusHeight(varName="Hydrostatics.CarotidCM")
      annotation (Placement(transformation(extent={{68,36},{74,42}})));
      T.MolarFlowRate DialyzerActivity_Cl_Flux(varName="DialyzerActivity.Cl-Flux")
      annotation (Placement(transformation(extent={{-80,-84},{-74,-78}})));
      T.MolarFlowRate DialyzerActivity_K_Flux(varName="DialyzerActivity.K+Flux")
      annotation (Placement(transformation(extent={{-80,-74},{-74,-68}})));
      T.MolarFlowRate DialyzerActivity_Na_Flux(varName="DialyzerActivity.Na+Flux")
      annotation (Placement(transformation(extent={{-80,-64},{-74,-58}})));
      T.Temperature DietGoalH2O_DegK(varName="DietGoalH2O.DegK",storeUnit="K")
      annotation (Placement(transformation(extent={{-80,-54},{-74,-48}})));
      T.MolarFlowRate DietIntakeElectrolytes_Cl(varName="DietIntakeElectrolytes.Cl-_mEq/Min")
      annotation (Placement(transformation(extent={{-80,-44},{-74,-38}})));
      T.MolarFlowRate DietIntakeElectrolytes_K(varName="DietIntakeElectrolytes.K+_mEq/Min")
      annotation (Placement(transformation(extent={{-80,-30},{-74,-24}})));
      T.MolarFlowRate DietIntakeElectrolytes_Na(varName="DietIntakeElectrolytes.Na+_mEq/Min")
      annotation (Placement(transformation(extent={{-80,-24},{-74,-18}})));
      T.MolarFlowRate DietIntakeElectrolytes_PO4(varName="DietIntakeElectrolytes.PO4--mEq/Min")
      annotation (Placement(transformation(extent={{-80,-14},{-74,-8}})));
      T.MolarFlowRate DietIntakeElectrolytes_SO4(varName="DietIntakeElectrolytes.SO4--mEq/Min")
      annotation (Placement(transformation(extent={{-80,-4},{-74,2}})));
      T.Frequency Exercise_Metabolism_ContractionRate(varName="Exercise-Metabolism.ContractionRate")
      annotation (Placement(transformation(extent={{-144,46},{-138,52}})));
      T.Power ExerciseMetabolism_MotionWatts(varName="Exercise-Metabolism.MotionWatts", storeUnit="W")
      annotation (Placement(transformation(extent={{-140,22},{-134,28}})));
      T.Power ExerciseMetabolism_TotalWatts(varName="Exercise-Metabolism.TotalWatts", storeUnit="W")
      annotation (Placement(transformation(extent={{-140,30},{-134,36}})));
      T.Concentration FurosemidePool_Furosemide_conc(varName="FurosemidePool.[Furosemide]", storeUnit="mg/l", unitConversions=Substances.Furosemide.unitConversions)
      annotation (Placement(transformation(extent={{-80,66},{-74,72}})));
      T.MolarFlowRate FurosemidePool_Loss(varName="FurosemidePool.Loss", storeUnit="mg/min", unitConversions=Substances.Furosemide.unitConversions)
      annotation (Placement(transformation(extent={{-80,76},{-74,82}})));
      T.Fraction Gravity_Gz(varName="Gravity.Gz")
      annotation (Placement(transformation(extent={{-80,86},{-74,92}})));
      T.MolarFlowRate GILumenDiarrhea_KLoss(varName="GILumenDiarrhea.K+Loss")
      annotation (Placement(transformation(extent={{-80,96},{-74,102}})));
      T.MolarFlowRate GILumenDiarrhea_NaLoss(varName="GILumenDiarrhea.Na+Loss")
      annotation (Placement(transformation(extent={{-80,106},{-74,112}})));
      T.MolarFlowRate GILumenVomitus_ClLoss(varName="GILumenVomitus.Cl-Loss")
      annotation (Placement(transformation(extent={{-80,116},{-74,122}})));
      T.MolarFlowRate Hemorrhage_ClRate(varName="Hemorrhage.ClRate")
      annotation (Placement(transformation(extent={{72,-176},{78,-170}})));
      T.MolarFlowRate Hemorrhage_KRate(varName="Hemorrhage.KRate")
      annotation (Placement(transformation(extent={{60,-142},{66,-136}})));
      T.MolarFlowRate Hemorrhage_NaRate(varName="Hemorrhage.NaRate")
      annotation (Placement(transformation(extent={{72,-168},{78,-162}})));
      T.VolumeFlowRate Hemorrhage_PlasmaRate(varName="Hemorrhage.PlasmaRate")
      annotation (Placement(transformation(extent={{72,-158},{78,-152}})));
      T.MolarFlowRate Hemorrhage_ProteinRate(varName="Hemorrhage.ProteinRate", storeUnit="mmol/min")
      annotation (Placement(transformation(extent={{72,-148},{78,-142}})));
      T.VolumeFlowRate Hemorrhage_RBCRate(varName="Hemorrhage.RBCRate")
      annotation (Placement(transformation(extent={{72,-138},{78,-132}})));
      T.MolarFlowRate IVDrip_ClRate(varName="IVDrip.ClRate")
      annotation (Placement(transformation(extent={{72,-128},{78,-122}})));
      T.VolumeFlowRate IVDrip_H2ORate(varName="IVDrip.H2ORate")
      annotation (Placement(transformation(extent={{72,-118},{78,-112}})));
      T.MolarFlowRate IVDrip_KRate(varName="IVDrip.KRate")
      annotation (Placement(transformation(extent={{72,-108},{78,-102}})));
      T.MolarFlowRate IVDrip_NaRate(varName="IVDrip.NaRate")
      annotation (Placement(transformation(extent={{72,-98},{78,-92}})));
      T.Fraction Kidney_NephronCount_Filtering_xNormal(varName="Kidney-NephronCount.Filtering(xNormal)")
      annotation (Placement(transformation(extent={{72,-88},{78,-82}})));
      T.Fraction Kidney_NephronCount_Total_xNormal(varName="Kidney-NephronCount.Total(xNormal)")
      annotation (Placement(transformation(extent={{72,-78},{78,-72}})));
      T.Fraction LegMusclePump_Effect(varName="LegMusclePump.Effect")
      annotation (Placement(transformation(extent={{-128,-28},{-122,-22}})));
      T.Position LowerTorsoArtyHeight(varName="Hydrostatics.LowerTorsoCM")
      annotation (Placement(transformation(extent={{72,-58},{78,-52}})));
      T.Position LowerTorsoVeinHeight(varName="Hydrostatics.LowerTorsoCM")
      annotation (Placement(transformation(extent={{72,-48},{78,-42}})));
      T.Pressure pCO(varName="pCO")
      annotation (Placement(transformation(extent={{-78,8},{-72,14}})));
      T.Pressure Pericardium_Pressure(varName="Pericardium-Cavity.Pressure")
      annotation (Placement(transformation(extent={{-102,2},{-96,8}})));
      T.Mass skeletalMuscle_SizeMass(varName="SkeletalMuscle-Size.Mass", storeUnit="g")
      annotation (Placement(transformation(extent={{50,164},{56,170}})));
      T.Mass skinSizeMass(varName="Skin-Size.Mass")
      annotation (Placement(transformation(extent={{100,158},{106,164}})));
      T.Fraction Status_Posture(varName="Status.Posture")
      annotation (Placement(transformation(extent={{70,42},{76,48}})));
      T.MassConcentration ThiazidePool_Thiazide_conc(varName="ThiazidePool.[Thiazide]", storeUnit="mg/l")
      annotation (Placement(transformation(extent={{72,62},{78,68}})));
      T.Pressure Thorax_AvePressure(varName="Thorax.AvePressure")
      annotation (Placement(transformation(extent={{72,72},{78,78}})));
      T.Fraction Thorax_LungInflation(varName="Thorax.LungInflation")
      annotation (Placement(transformation(extent={{72,82},{78,88}})));
      T.MolarFlowRate Transfusion_ClRate(varName="Transfusion.ClRate")
      annotation (Placement(transformation(extent={{72,92},{78,98}})));
      T.MolarFlowRate Transfusion_KRate(varName="Transfusion.KRate")
      annotation (Placement(transformation(extent={{72,102},{78,108}})));
      T.MolarFlowRate Transfusion_NaRate(varName="Transfusion.NaRate")
      annotation (Placement(transformation(extent={{72,112},{78,118}})));
      T.VolumeFlowRate Transfusion_PlasmaRate(varName="Transfusion.PlasmaRate")
      annotation (Placement(transformation(extent={{72,122},{78,128}})));
      T.MolarFlowRate Transfusion_ProteinRate(varName="Transfusion.ProteinRate", storeUnit="mmol/min")
      annotation (Placement(transformation(extent={{72,132},{78,138}})));
      T.VolumeFlowRate Transfusion_RBCRate(varName="Transfusion.RBCRate")
      annotation (Placement(transformation(extent={{72,142},{78,148}})));
      T.Mass WeightCore(varName="Weight.Core")
      annotation (Placement(transformation(extent={{72,152},{78,158}})));

      T.MolarFlowRate IVDrip_ProteinRate(varName="IVDrip.ProteinRate", storeUnit="mmol/min")
      annotation (Placement(transformation(extent={{72,-124},{78,-118}})));
      T.Temperature AmbientTemperature(varName=
              "AmbientTemperature.Temp(C)")
      annotation (Placement(transformation(extent={{-82,44},{-76,50}})));
      T.Fraction EnvironmentRelativeHumidity(varName=
              "EnvironmentRelativeHumidity")
      annotation (Placement(transformation(extent={{-82,24},{-76,30}})));
      T.VolumeFlowRate DietIntakeH2O_Rate(varName="DietIntakeH2O.Rate(mL/Min)")
      annotation (Placement(transformation(extent={{-78,-20},{-72,-14}})));
      T.VolumeFlowRate DialyzerActivity_UltrafiltrationRate(
            varName="DialyzerActivity.UltrafiltrationRate")
      annotation (Placement(transformation(extent={{-86,-80},{-74,-68}})));
      T.VolumeFlowRate Hemorrhage_PlasmaRate1(                         varName="Hemorrhage.H2ORate")
      annotation (Placement(transformation(extent={{98,-168},{110,-156}})));
      T.VolumeFlowRate Transfusion_PlasmaRate1(                         varName="Transfusion.H2ORate")
      annotation (Placement(transformation(extent={{88,114},{98,124}})));
      T.VolumeFlowRate GILumenVomitus_H2OTarget(varName=
              "GILumenVomitus.H2OTarget")
      annotation (Placement(transformation(extent={{-84,122},{-72,134}})));
      T.VolumeFlowRate GILumenDiarrhea_H2OTarget(varName=
              "GILumenDiarrhea.H2OTarget")
      annotation (Placement(transformation(extent={{-82,132},{-70,144}})));
      T.Velocity Wind_MPH(varName="Wind.MPH",storeUnit="MPH")
      annotation (Placement(transformation(extent={{-84,52},{-78,58}})));
      T.AmountOfSubstance GILumenFiber(varName="GILumenVolume.[Fiber]", storeUnit="osm")
          annotation (Placement(transformation(extent={{-82,142},{-70,154}})));
      T.Pressure EnvironmentRelativeHumidity_VaporPressure(varName="RelativeHumidity.VaporPressure",
            storeUnit="mmHg")
          annotation (Placement(transformation(extent={{-82,32},{-76,38}})));
      equation
        connect( Gravity_Gz.y,busConnector.Gravity_Gz)          annotation (Line(
            points={{-73.7,89},{90,89},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(BarometerPressure.y,busConnector.BarometerPressure)
          annotation (Line(
            points={{-79.7,41},{4,41},{4,-2},{90,-2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(AirSupplyInspiredAirPressure.y,busConnector.AirSupplyInspiredAirPressure)
          annotation (Line(
            points={{-69.6,18},{4,18},{4,-2},{90,-2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect(pCO.y,busConnector.pCO) annotation (Line(
            points={{-71.7,11},{90,11},{90,-2}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None), Text(
            string="%first",
            index=-1,
            extent={{-6,3},{-6,3}}));
        connect( IVDrip_NaRate.y,busConnector. IVDrip_NaRate) annotation (Line(
            points={{78.3,-95},{90,-95},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( Transfusion_NaRate.y,busConnector. Transfusion_NaRate) annotation (Line(
            points={{78.3,115},{90,115},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( Hemorrhage_NaRate.y,busConnector. Hemorrhage_NaRate) annotation (Line(
            points={{78.3,-165},{90,-165},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( DialyzerActivity_Na_Flux.y,busConnector. DialyzerActivity_Na_Flux) annotation (
            Line(
            points={{-73.7,-61},{90,-61},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( DietIntakeElectrolytes_Na.y,busConnector. DietIntakeElectrolytes_Na) annotation (
            Line(
            points={{-73.7,-21},{90,-21},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( GILumenDiarrhea_NaLoss.y,busConnector. GILumenDiarrhea_NaLoss) annotation (Line(
            points={{-73.7,109},{90,109},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( IVDrip_KRate.y,busConnector. IVDrip_KRate) annotation (Line(
            points={{78.3,-105},{90,-105},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( Transfusion_KRate.y,busConnector. Transfusion_KRate) annotation (Line(
            points={{78.3,105},{90,105},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( Hemorrhage_KRate.y,busConnector. Hemorrhage_KRate) annotation (Line(
            points={{66.3,-139},{90,-139},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( DialyzerActivity_K_Flux.y,busConnector. DialyzerActivity_K_Flux) annotation (
            Line(
            points={{-73.7,-71},{90,-71},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( DietIntakeElectrolytes_K.y,busConnector. DietIntakeElectrolytes_K) annotation (
            Line(
            points={{-73.7,-27},{90,-27},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( GILumenDiarrhea_KLoss.y,busConnector. GILumenDiarrhea_KLoss) annotation (Line(
            points={{-73.7,99},{90,99},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( IVDrip_ClRate.y,busConnector. IVDrip_ClRate) annotation (Line(
            points={{78.3,-125},{90,-125},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( Transfusion_ClRate.y,busConnector. Transfusion_ClRate) annotation (Line(
            points={{78.3,95},{90,95},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( Hemorrhage_ClRate.y,busConnector. Hemorrhage_ClRate) annotation (Line(
            points={{78.3,-173},{90,-173},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( DialyzerActivity_Cl_Flux.y,busConnector. DialyzerActivity_Cl_Flux) annotation (
            Line(
            points={{-73.7,-81},{90,-81},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect( DietIntakeElectrolytes_Cl.y,busConnector. DietIntakeElectrolytes_Cl) annotation (
            Line(
            points={{-73.7,-41},{90,-41},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(GILumenVomitus_ClLoss.y,busConnector.GILumenVomitus_ClLoss) annotation (Line(
            points={{-73.7,119},{90,119},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(DietIntakeElectrolytes_PO4.y,busConnector.DietIntakeElectrolytes_PO4) annotation (Line(
            points={{-73.7,-11},{6,-11},{6,-2},{90,-2}},
            color={0,0,127},
            thickness=0.5,
            smooth=Smooth.None));
        connect(DietIntakeElectrolytes_SO4.y,busConnector.DietIntakeElectrolytes_SO4) annotation (Line(
            points={{-73.7,-1},{90,-1},{90,-2}},
            color={0,0,127},
            thickness=0.5,
            smooth=Smooth.None));
        connect(DietGoalH2O_DegK.y,busConnector.DietGoalH2O_DegK) annotation (
            Line(
            points={{-73.7,-51},{-73.7,-50},{-28,-50},{-28,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( Exercise_Metabolism_ContractionRate.y,busConnector. Exercise_Metabolism_ContractionRate)
          annotation (Line(
            points={{-137.7,49},{90,49},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(LegMusclePump_Effect.y,busConnector.LegMusclePump_Effect) annotation (Line(
            points={{-121.7,-25},{94.15,-25},{94.15,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(ExerciseMetabolism_TotalWatts.y,busConnector.ExerciseMetabolism_TotalWatts) annotation (
           Line(
            points={{-133.7,33},{90,33},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( LowerTorsoArtyHeight.y,busConnector. LowerTorsoArtyHeight)
          annotation (Line(
            points={{78.3,-55},{-6,-55},{-6,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( LowerTorsoVeinHeight.y,busConnector. LowerTorsoVeinHeight)
          annotation (Line(
            points={{78.3,-45},{-6,-45},{-6,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( CarotidSinusHeight.y,busConnector. CarotidSinusHeight)
          annotation (Line(
            points={{74.3,39},{0,39},{0,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Status_Posture.y,busConnector.Status_Posture) annotation (Line(
            points={{76.3,45},{6.15,45},{6.15,-2},{90,-2}},
            color={0,0,255},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( FurosemidePool_Furosemide_conc.y,busConnector. FurosemidePool_Furosemide_conc)
          annotation (Line(
            points={{-73.7,69},{8,69},{8,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( ThiazidePool_Thiazide_conc.y,busConnector. ThiazidePool_Thiazide_conc) annotation (
            Line(
            points={{78.3,65},{90,65},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(FurosemidePool_Loss.y,busConnector.FurosemidePool_Loss) annotation (Line(
            points={{-73.7,79},{90,79},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(IVDrip_H2ORate.y,busConnector.IVDrip_H2ORate)  annotation (Line(
            points={{78.3,-115},{0.15,-115},{0.15,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Transfusion_PlasmaRate.y,busConnector.Transfusion_PlasmaRate)
                                                               annotation (Line(
            points={{78.3,125},{90,125},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Hemorrhage_PlasmaRate.y,busConnector.Hemorrhage_PlasmaRate)
                                                              annotation (Line(
            points={{78.3,-155},{90,-155},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Hemorrhage_RBCRate.y,busConnector.Hemorrhage_RBCRate) annotation (Line(
            points={{78.3,-135},{90,-135},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Transfusion_RBCRate.y,busConnector.Transfusion_RBCRate) annotation (Line(
            points={{78.3,145},{90,145},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( Pericardium_Pressure.y,busConnector. Pericardium_Pressure)          annotation (
           Line(
            points={{-95.7,5},{90,5},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect( Thorax_AvePressure.y,busConnector. Thorax_AvePressure)          annotation (
            Line(
            points={{78.3,75},{90,75},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Thorax_LungInflation.y,busConnector.Thorax_LungInflation)
          annotation (Line(
            points={{78.3,85},{90,85},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Kidney_NephronCount_Total_xNormal.y,busConnector.Kidney_NephronCount_Total_xNormal)
          annotation (Line(
            points={{78.3,-75},{6,-75},{6,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Kidney_NephronCount_Filtering_xNormal.y,busConnector.Kidney_NephronCount_Filtering_xNormal)
          annotation (Line(
            points={{78.3,-85},{90,-85},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(AnesthesiaTidalVolume.y,busConnector.AnesthesiaTidalVolume)
                                                              annotation (Line(
            points={{-73.7,-131},{90,-131},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Anesthesia_VascularConductance.y,busConnector.Anesthesia_VascularConductance)
          annotation (Line(
            points={{-73.7,-141},{90,-141},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skeletalMuscle_SizeMass.y,busConnector.skeletalMuscle_SizeMass) annotation (Line(
       points={{56.3,167},{90,167},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(skinSizeMass.y,busConnector.skinSizeMass) annotation (Line(
       points={{106.3,161},{90,161},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(WeightCore.y,busConnector.WeightCore) annotation (Line(
       points={{78.3,155},{90,155},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

        connect(AmbientTemperature.y, busConnector.AmbientTemperature)
          annotation (Line(
            points={{-75.7,47},{90,47},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(EnvironmentRelativeHumidity.y, busConnector.EnvironmentRelativeHumidity)
          annotation (Line(
            points={{-75.7,27},{90,27},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(DietIntakeH2O_Rate.y, busConnector.DietIntakeH2O_Rate) annotation (Line(
       points={{-71.7,-17},{90,-17},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(DialyzerActivity_UltrafiltrationRate.y, busConnector.DialyzerActivity_UltrafiltrationRate)
          annotation (Line(
            points={{-73.4,-74},{90,-74},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Hemorrhage_PlasmaRate1.y, busConnector.Hemorrhage_H2ORate)
                                                                        annotation (Line(
       points={{110.6,-162},{90,-162},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Transfusion_PlasmaRate1.y, busConnector.Transfusion_H2ORate)
                                                                          annotation (Line(
       points={{98.5,119},{-14,119},{-14,36},{90,36},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumenDiarrhea_H2OTarget.y, busConnector.GILumenDiarrhea_H2OTarget)
          annotation (Line(
            points={{-69.4,138},{0,138},{0,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumenVomitus_H2OTarget.y, busConnector.GILumenVomitus_H2OTarget)
          annotation (Line(
            points={{-71.4,128},{90,128},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(EnvironmentRelativeHumidity_VaporPressure.y, busConnector.EnviromentRelativeHumidity_VaporPressure)
          annotation (Line(
            points={{-75.7,35},{90,35},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Wind_MPH.y, busConnector.WindSpeed) annotation (Line(
            points={{-77.7,55},{90,55},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(GILumenFiber.y, busConnector.GILumenFiber_Mass) annotation (Line(
            points={{-69.4,148},{90,148},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(IVDrip_ProteinRate.y, busConnector.IVDripProteinRate) annotation (
            Line(
            points={{78.3,-121},{90,-121},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Hemorrhage_ProteinRate.y, busConnector.Hemorrhage_ProteinRate)
          annotation (Line(
            points={{78.3,-145},{78.3,-146.5},{90,-146.5},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(Transfusion_ProteinRate.y, busConnector.Transfusion_ProteinRate)
          annotation (Line(
            points={{78.3,135},{90,135},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        connect(ExerciseMetabolism_MotionWatts.y, busConnector.Exercise_Metabolism_MotionWatts)
          annotation (Line(
            points={{-133.7,25},{90,25},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=true,  extent={{-100,
                  -100},{100,100}}), graphics={Text(
                extent={{-120,-42},{122,-76}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model Setup_test
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{30,-46},{44,-32}}), iconTransformation(
              extent={{-40,-20},{0,20}})));
        Physiomodel.Setup.IO_Bus.OutputComparison setup_dif
          annotation (Placement(transformation(extent={{-46,-94},{-26,-74}})));
        Physiomodel.Setup.IO_Bus.OutputToFile setup_varsToFile
          annotation (Placement(transformation(extent={{14,-98},{34,-78}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector, busConnector) annotation (Line(
            points={{52,-70},{37,-70},{37,-39}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup_dif.busConnector, setup.busConnector) annotation (Line(
            points={{-36,-84},{-6,-84},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup_varsToFile.busConnector, setup.busConnector) annotation (
            Line(
            points={{24,-88},{-6,-88},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Setup_test;

      model Setup_test_SI
        import Physiomodel;
        Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile_SI nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile_SI electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile_SI hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-106},{4,-86}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.IO_Bus.InputFromFile_SI status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{30,-46},{44,-32}}), iconTransformation(
              extent={{-40,-20},{0,20}})));
        Physiomodel.Setup.IO_Bus.OutputComparison_SI setup_dif
          annotation (Placement(transformation(extent={{-46,-94},{-26,-74}})));
        Physiomodel.Setup.IO_Bus.OutputToFile_SI setup_varsToFile
          annotation (Placement(transformation(extent={{14,-98},{34,-78}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-96},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-96},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-96},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-96},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-96},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-96},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{52,-70},{-6,-70},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector, busConnector) annotation (Line(
            points={{52,-70},{37,-70},{37,-39}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup_dif.busConnector, setup.busConnector) annotation (Line(
            points={{-36,-84},{-6,-84},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup_varsToFile.busConnector, setup.busConnector) annotation (
            Line(
            points={{24,-88},{-6,-88},{-6,-96}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      end Setup_test_SI;
    end IO_Bus;

    model ConstantSetup
      extends Physiolibrary.Icons.Setup;

      package T = Physiolibrary.Types.RealTypeInputParameters;
  protected
    T.Pressure AirSupplyInspiredAirPressure(varName="AirSupply-InspiredAir.Pressure")
    annotation (Placement(transformation(extent={{-80,-154},{-74,-148}})));
    T.Fraction Anesthesia_VascularConductance(varName="Anesthesia.VascularConductance")
    annotation (Placement(transformation(extent={{-80,-144},{-74,-138}})));
    T.Fraction AnesthesiaTidalVolume(varName="Anesthesia.TidalVolume")
    annotation (Placement(transformation(extent={{-80,-134},{-74,-128}})));
    T.Pressure BarometerPressure(varName="Barometer.Pressure")
    annotation (Placement(transformation(extent={{-80,-124},{-74,-118}})));
    T.Position CarotidSinusHeight(varName="Hydrostatics.CarotidCM")
    annotation (Placement(transformation(extent={{-80,-94},{-74,-88}})));
    T.MolarFlowRate DialyzerActivity_Cl_Flux(varName="DialyzerActivity.Cl-Flux")
    annotation (Placement(transformation(extent={{-80,-84},{-74,-78}})));
    T.MolarFlowRate DialyzerActivity_K_Flux(varName="DialyzerActivity.K+Flux")
    annotation (Placement(transformation(extent={{-80,-74},{-74,-68}})));
    T.MolarFlowRate DialyzerActivity_Na_Flux(varName="DialyzerActivity.Na+Flux")
    annotation (Placement(transformation(extent={{-80,-64},{-74,-58}})));
    T.Temperature DietGoalH2O_DegK(varName="DietGoalH2O.DegK",storeUnit="K")
    annotation (Placement(transformation(extent={{-80,-54},{-74,-48}})));
    T.MolarFlowRate DietIntakeElectrolytes_Cl(varName="DietIntakeElectrolytes.Cl-_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-44},{-74,-38}})));
    T.MolarFlowRate DietIntakeElectrolytes_K(varName="DietIntakeElectrolytes.K+_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-34},{-74,-28}})));
    T.MolarFlowRate DietIntakeElectrolytes_Na(varName="DietIntakeElectrolytes.Na+_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-24},{-74,-18}})));
    T.MolarFlowRate DietIntakeElectrolytes_PO4(varName="DietIntakeElectrolytes.PO4--mEq/Min")
    annotation (Placement(transformation(extent={{-80,-14},{-74,-8}})));
    T.MolarFlowRate DietIntakeElectrolytes_SO4(varName="DietIntakeElectrolytes.SO4--mEq/Min")
    annotation (Placement(transformation(extent={{-80,-4},{-74,2}})));
    T.Frequency Exercise_Metabolism_ContractionRate(varName="Exercise-Metabolism.ContractionRate")
    annotation (Placement(transformation(extent={{-80,16},{-74,22}})));
    T.Power Exercise_Metabolism_MotionWatts(varName="Exercise-Metabolism.MotionWatts", storeUnit="W")
    annotation (Placement(transformation(extent={{-80,26},{-74,32}})));
    T.Power ExerciseMetabolism_TotalWatts(varName="Exercise-Metabolism.TotalWatts", storeUnit="W")
    annotation (Placement(transformation(extent={{-80,56},{-74,62}})));
    T.Concentration FurosemidePool_Furosemide_conc(varName="FurosemidePool.[Furosemide]", storeUnit="mg/l", unitConversions=Substances.Furosemide.unitConversions)
    annotation (Placement(transformation(extent={{-80,66},{-74,72}})));
    T.MolarFlowRate FurosemidePool_Loss(varName="FurosemidePool.Loss", storeUnit="mg/min", unitConversions=Substances.Furosemide.unitConversions)
    annotation (Placement(transformation(extent={{-80,76},{-74,82}})));
    T.Fraction Gravity_Gz(varName="Gravity.Gz")
    annotation (Placement(transformation(extent={{-80,86},{-74,92}})));
    T.MolarFlowRate GILumenDiarrhea_KLoss(varName="GILumenDiarrhea.K+Loss")
    annotation (Placement(transformation(extent={{-80,96},{-74,102}})));
    T.MolarFlowRate GILumenDiarrhea_NaLoss(varName="GILumenDiarrhea.Na+Loss")
    annotation (Placement(transformation(extent={{-80,106},{-74,112}})));
    T.MolarFlowRate GILumenVomitus_ClLoss(varName="GILumenVomitus.Cl-Loss")
    annotation (Placement(transformation(extent={{-80,116},{-74,122}})));
    T.MolarFlowRate Hemorrhage_ClRate(varName="Hemorrhage.ClRate")
    annotation (Placement(transformation(extent={{68,16},{74,22}})));
    T.MolarFlowRate Hemorrhage_KRate(varName="Hemorrhage.KRate")
    annotation (Placement(transformation(extent={{68,28},{74,34}})));
    T.MolarFlowRate Hemorrhage_NaRate(varName="Hemorrhage.NaRate")
    annotation (Placement(transformation(extent={{72,-168},{78,-162}})));
    T.VolumeFlowRate Hemorrhage_PlasmaRate(varName="Hemorrhage.PlasmaRate")
    annotation (Placement(transformation(extent={{72,-158},{78,-152}})));
    T.MolarFlowRate Hemorrhage_ProteinRate(varName="Hemorrhage.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{72,-148},{78,-142}})));
    T.VolumeFlowRate Hemorrhage_RBCRate(varName="Hemorrhage.RBCRate")
    annotation (Placement(transformation(extent={{72,-138},{78,-132}})));
    T.MolarFlowRate IVDrip_ClRate(varName="IVDrip.ClRate")
    annotation (Placement(transformation(extent={{72,-128},{78,-122}})));
    T.VolumeFlowRate IVDrip_H2ORate(varName="IVDrip.H2ORate")
    annotation (Placement(transformation(extent={{72,-118},{78,-112}})));
    T.MolarFlowRate IVDrip_KRate(varName="IVDrip.KRate")
    annotation (Placement(transformation(extent={{72,-108},{78,-102}})));
    T.MolarFlowRate IVDrip_NaRate(varName="IVDrip.NaRate")
    annotation (Placement(transformation(extent={{72,-98},{78,-92}})));
    T.Fraction Kidney_NephronCount_Filtering_xNormal(varName="Kidney-NephronCount.Filtering(xNormal)")
    annotation (Placement(transformation(extent={{72,-88},{78,-82}})));
    T.Fraction Kidney_NephronCount_Total_xNormal(varName="Kidney-NephronCount.Total(xNormal)")
    annotation (Placement(transformation(extent={{72,-78},{78,-72}})));
    T.Fraction LegMusclePump_Effect(varName="LegMusclePump.Effect")
    annotation (Placement(transformation(extent={{72,-68},{78,-62}})));
    T.Position LowerTorsoArtyHeight(varName="Hydrostatics.LowerTorsoCM")
    annotation (Placement(transformation(extent={{72,-58},{78,-52}})));
    T.Position LowerTorsoVeinHeight(varName="Hydrostatics.LowerTorsoCM")
    annotation (Placement(transformation(extent={{72,-48},{78,-42}})));
    T.Pressure pCO(varName="pCO")
    annotation (Placement(transformation(extent={{72,-28},{78,-22}})));
    T.Pressure Pericardium_Pressure(varName="Pericardium-Cavity.Pressure")
    annotation (Placement(transformation(extent={{72,-18},{78,-12}})));
    T.Mass skeletalMuscle_SizeMass(varName="SkeletalMuscle-Size.Mass", storeUnit="g")
    annotation (Placement(transformation(extent={{72,-8},{78,-2}})));
    T.Mass skinSizeMass(varName="Skin-Size.Mass")
    annotation (Placement(transformation(extent={{72,2},{78,8}})));
    T.Fraction Status_Posture(varName="Status.Posture")
    annotation (Placement(transformation(extent={{70,42},{76,48}})));
    T.MassConcentration ThiazidePool_Thiazide_conc(varName="ThiazidePool.[Thiazide]", storeUnit="mg/l")
    annotation (Placement(transformation(extent={{72,62},{78,68}})));
    T.Pressure Thorax_AvePressure(varName="Thorax.AvePressure")
    annotation (Placement(transformation(extent={{72,72},{78,78}})));
    T.Fraction Thorax_LungInflation(varName="Thorax.LungInflation")
    annotation (Placement(transformation(extent={{72,82},{78,88}})));
    T.MolarFlowRate Transfusion_ClRate(varName="Transfusion.ClRate")
    annotation (Placement(transformation(extent={{72,92},{78,98}})));
    T.MolarFlowRate Transfusion_KRate(varName="Transfusion.KRate")
    annotation (Placement(transformation(extent={{72,102},{78,108}})));
    T.MolarFlowRate Transfusion_NaRate(varName="Transfusion.NaRate")
    annotation (Placement(transformation(extent={{72,112},{78,118}})));
    T.VolumeFlowRate Transfusion_PlasmaRate(varName="Transfusion.PlasmaRate")
    annotation (Placement(transformation(extent={{72,122},{78,128}})));
    T.MolarFlowRate Transfusion_ProteinRate(varName="Transfusion.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{72,132},{78,138}})));
    T.VolumeFlowRate Transfusion_RBCRate(varName="Transfusion.RBCRate")
    annotation (Placement(transformation(extent={{72,142},{78,148}})));
    T.Mass WeightCore(varName="Weight.Core")
    annotation (Placement(transformation(extent={{72,152},{78,158}})));

    T.MolarFlowRate IVDrip_ProteinRate(varName="IVDrip.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{-90,-40},{-84,-34}})));
    T.Temperature AmbientTemperature(varName=
            "AmbientTemperature.Temp(C)")
    annotation (Placement(transformation(extent={{-94,10},{-88,16}})));
    T.Fraction EnvironmentRelativeHumidity(varName=
            "EnvironmentRelativeHumidity")
    annotation (Placement(transformation(extent={{-102,-12},{-96,-6}})));
    T.VolumeFlowRate DietIntakeH2O_Rate(varName="DietIntakeH2O.Rate(mL/Min)")
    annotation (Placement(transformation(extent={{-102,-20},{-96,-14}})));
    T.VolumeFlowRate DialyzerActivity_UltrafiltrationRate(
          varName="DialyzerActivity.UltrafiltrationRate")
    annotation (Placement(transformation(extent={{-134,0},{-122,12}})));
    T.VolumeFlowRate Hemorrhage_PlasmaRate1(                         varName="Hemorrhage.H2ORate")
    annotation (Placement(transformation(extent={{-132,18},{-120,30}})));
    T.VolumeFlowRate Transfusion_PlasmaRate1(                         varName="Transfusion.H2ORate")
    annotation (Placement(transformation(extent={{-130,30},{-120,40}})));
    T.VolumeFlowRate GILumenVomitus_H2OTarget(varName=
            "GILumenVomitus.H2OTarget")
    annotation (Placement(transformation(extent={{-84,122},{-72,134}})));
    T.VolumeFlowRate GILumenDiarrhea_H2OTarget(varName=
            "GILumenDiarrhea.H2OTarget")
    annotation (Placement(transformation(extent={{-82,132},{-70,144}})));
    T.Velocity Wind_MPH(varName="Wind.MPH",storeUnit="MPH")
    annotation (Placement(transformation(extent={{-46,6},{-40,12}})));
    T.AmountOfSubstance GILumenFiber(varName="GILumenVolume.[Fiber]", storeUnit="osm")
        annotation (Placement(transformation(extent={{-82,142},{-70,154}})));
    T.Pressure EnvironmentRelativeHumidity_VaporPressure(varName="RelativeHumidity.VaporPressure",
          storeUnit="mmHg")
        annotation (Placement(transformation(extent={{-92,-2},{-86,4}})));
  public
      Physiolibrary.Types.BusConnector busConnector
        annotation (Placement(transformation(extent={{6,2},{46,42}})));
    equation
      connect( Gravity_Gz.y,busConnector.Gravity_Gz)          annotation (Line(
          points={{-73.25,89},{26,89},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(BarometerPressure.y,busConnector.BarometerPressure)
        annotation (Line(
          points={{-73.25,-121},{4,-121},{4,22},{26,22}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(AirSupplyInspiredAirPressure.y,busConnector.AirSupplyInspiredAirPressure)
        annotation (Line(
          points={{-73.25,-151},{4,-151},{4,22},{26,22}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(pCO.y,busConnector.pCO) annotation (Line(
          points={{78.75,-25},{26,-25},{26,22}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect( IVDrip_NaRate.y,busConnector. IVDrip_NaRate) annotation (Line(
          points={{78.75,-95},{26,-95},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_NaRate.y,busConnector. Transfusion_NaRate) annotation (Line(
          points={{78.75,115},{26,115},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_NaRate.y,busConnector. Hemorrhage_NaRate) annotation (Line(
          points={{78.75,-165},{26,-165},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_Na_Flux.y,busConnector. DialyzerActivity_Na_Flux) annotation (
          Line(
          points={{-73.25,-61},{26,-61},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_Na.y,busConnector. DietIntakeElectrolytes_Na) annotation (
          Line(
          points={{-73.25,-21},{26,-21},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( GILumenDiarrhea_NaLoss.y,busConnector. GILumenDiarrhea_NaLoss) annotation (Line(
          points={{-73.25,109},{26,109},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( IVDrip_KRate.y,busConnector. IVDrip_KRate) annotation (Line(
          points={{78.75,-105},{26,-105},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_KRate.y,busConnector. Transfusion_KRate) annotation (Line(
          points={{78.75,105},{26,105},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_KRate.y,busConnector. Hemorrhage_KRate) annotation (Line(
          points={{74.75,31},{26,31},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_K_Flux.y,busConnector. DialyzerActivity_K_Flux) annotation (
          Line(
          points={{-73.25,-71},{26,-71},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_K.y,busConnector. DietIntakeElectrolytes_K) annotation (
          Line(
          points={{-73.25,-31},{26,-31},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( GILumenDiarrhea_KLoss.y,busConnector. GILumenDiarrhea_KLoss) annotation (Line(
          points={{-73.25,99},{26,99},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( IVDrip_ClRate.y,busConnector. IVDrip_ClRate) annotation (Line(
          points={{78.75,-125},{26,-125},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_ClRate.y,busConnector. Transfusion_ClRate) annotation (Line(
          points={{78.75,95},{26,95},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_ClRate.y,busConnector. Hemorrhage_ClRate) annotation (Line(
          points={{74.75,19},{26,19},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_Cl_Flux.y,busConnector. DialyzerActivity_Cl_Flux) annotation (
          Line(
          points={{-73.25,-81},{26,-81},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_Cl.y,busConnector. DietIntakeElectrolytes_Cl) annotation (
          Line(
          points={{-73.25,-41},{26,-41},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GILumenVomitus_ClLoss.y,busConnector.GILumenVomitus_ClLoss) annotation (Line(
          points={{-73.25,119},{26,119},{26,22}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(DietIntakeElectrolytes_PO4.y,busConnector.DietIntakeElectrolytes_PO4) annotation (Line(
          points={{-73.25,-11},{6,-11},{6,22},{26,22}},
          color={0,0,127},
          thickness=0.5,
          smooth=Smooth.None));
      connect(DietIntakeElectrolytes_SO4.y,busConnector.DietIntakeElectrolytes_SO4) annotation (Line(
          points={{-73.25,-1},{26,-1},{26,22}},
          color={0,0,127},
          thickness=0.5,
          smooth=Smooth.None));
      connect(DietGoalH2O_DegK.y,busConnector.DietGoalH2O_DegK) annotation (
          Line(
          points={{-73.25,-51},{-73.25,-50},{-28,-50},{-28,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Exercise_Metabolism_ContractionRate.y,busConnector. Exercise_Metabolism_ContractionRate)
        annotation (Line(
          points={{-73.25,19},{26,19},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Exercise_Metabolism_MotionWatts.y,busConnector. Exercise_Metabolism_MotionWatts)
        annotation (Line(
          points={{-73.25,29},{26,29},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(LegMusclePump_Effect.y,busConnector.LegMusclePump_Effect) annotation (Line(
          points={{78.75,-65},{-7.85,-65},{-7.85,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(ExerciseMetabolism_TotalWatts.y,busConnector.ExerciseMetabolism_TotalWatts) annotation (
         Line(
          points={{-73.25,59},{26,59},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( LowerTorsoArtyHeight.y,busConnector. LowerTorsoArtyHeight)
        annotation (Line(
          points={{78.75,-55},{-6,-55},{-6,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( LowerTorsoVeinHeight.y,busConnector. LowerTorsoVeinHeight)
        annotation (Line(
          points={{78.75,-45},{-6,-45},{-6,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( CarotidSinusHeight.y,busConnector. CarotidSinusHeight)
        annotation (Line(
          points={{-73.25,-91},{0,-91},{0,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Status_Posture.y,busConnector.Status_Posture) annotation (Line(
          points={{76.75,45},{4.15,45},{4.15,22},{26,22}},
          color={0,0,255},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( FurosemidePool_Furosemide_conc.y,busConnector. FurosemidePool_Furosemide_conc)
        annotation (Line(
          points={{-73.25,69},{8,69},{8,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( ThiazidePool_Thiazide_conc.y,busConnector. ThiazidePool_Thiazide_conc) annotation (
          Line(
          points={{78.75,65},{26,65},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(FurosemidePool_Loss.y,busConnector.FurosemidePool_Loss) annotation (Line(
          points={{-73.25,79},{26,79},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(IVDrip_H2ORate.y,busConnector.IVDrip_H2ORate)  annotation (Line(
          points={{78.75,-115},{0.15,-115},{0.15,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_PlasmaRate.y,busConnector.Transfusion_PlasmaRate)
                                                             annotation (Line(
          points={{78.75,125},{26,125},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_PlasmaRate.y,busConnector.Hemorrhage_PlasmaRate)
                                                            annotation (Line(
          points={{78.75,-155},{26,-155},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_RBCRate.y,busConnector.Hemorrhage_RBCRate) annotation (Line(
          points={{78.75,-135},{26,-135},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_RBCRate.y,busConnector.Transfusion_RBCRate) annotation (Line(
          points={{78.75,145},{26,145},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Pericardium_Pressure.y,busConnector. Pericardium_Pressure)          annotation (
         Line(
          points={{78.75,-15},{26,-15},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Thorax_AvePressure.y,busConnector. Thorax_AvePressure)          annotation (
          Line(
          points={{78.75,75},{26,75},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Thorax_LungInflation.y,busConnector.Thorax_LungInflation)
        annotation (Line(
          points={{78.75,85},{26,85},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Total_xNormal.y,busConnector.Kidney_NephronCount_Total_xNormal)
        annotation (Line(
          points={{78.75,-75},{6,-75},{6,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Filtering_xNormal.y,busConnector.Kidney_NephronCount_Filtering_xNormal)
        annotation (Line(
          points={{78.75,-85},{26,-85},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(AnesthesiaTidalVolume.y,busConnector.AnesthesiaTidalVolume)
                                                            annotation (Line(
          points={{-73.25,-131},{26,-131},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Anesthesia_VascularConductance.y,busConnector.Anesthesia_VascularConductance)
        annotation (Line(
          points={{-73.25,-141},{26,-141},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skeletalMuscle_SizeMass.y,busConnector.skeletalMuscle_SizeMass) annotation (Line(
     points={{78.75,-5},{26,-5},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skinSizeMass.y,busConnector.skinSizeMass) annotation (Line(
     points={{78.75,5},{26,5},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(WeightCore.y,busConnector.WeightCore) annotation (Line(
     points={{78.75,155},{26,155},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

      connect(AmbientTemperature.y, busConnector.AmbientTemperature)
        annotation (Line(
          points={{-87.25,13},{26,13},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity.y, busConnector.EnvironmentRelativeHumidity)
        annotation (Line(
          points={{-95.25,-9},{26,-9},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(DietIntakeH2O_Rate.y, busConnector.DietIntakeH2O_Rate) annotation (Line(
     points={{-95.25,-17},{26,-17},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(DialyzerActivity_UltrafiltrationRate.y, busConnector.DialyzerActivity_UltrafiltrationRate)
        annotation (Line(
          points={{-120.5,6},{-110,6},{-110,56},{26,56},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_PlasmaRate1.y, busConnector.Hemorrhage_H2ORate)
                                                                      annotation (Line(
     points={{-118.5,24},{-116,24},{-116,56},{-178,56},{-178,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_PlasmaRate1.y, busConnector.Transfusion_H2ORate)
                                                                        annotation (Line(
     points={{-118.75,35},{-118,35},{-118,56},{-178,56},{-178,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenDiarrhea_H2OTarget.y, busConnector.GILumenDiarrhea_H2OTarget)
        annotation (Line(
          points={{-68.5,138},{0,138},{0,22},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenVomitus_H2OTarget.y, busConnector.GILumenVomitus_H2OTarget)
        annotation (Line(
          points={{-70.5,128},{26,128},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity_VaporPressure.y, busConnector.EnviromentRelativeHumidity_VaporPressure)
        annotation (Line(
          points={{-85.25,1},{26,1},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Wind_MPH.y, busConnector.WindSpeed) annotation (Line(
          points={{-39.25,9},{26,9},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenFiber.y, busConnector.GILumenFiber_Mass) annotation (Line(
          points={{-68.5,148},{26,148},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(IVDrip_ProteinRate.y, busConnector.IVDripProteinRate) annotation (
          Line(
          points={{-83.25,-37},{26,-37},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_ProteinRate.y, busConnector.Hemorrhage_ProteinRate)
        annotation (Line(
          points={{78.75,-145},{78.75,-146.5},{26,-146.5},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_ProteinRate.y, busConnector.Transfusion_ProteinRate)
        annotation (Line(
          points={{78.75,135},{26,135},{26,22}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true,  extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-120,-42},{122,-76}},
              lineColor={0,0,255},
              textString="%name")}));
    end ConstantSetup;

    model ExcerciseSetup
      extends Physiolibrary.Icons.Setup;

      package T = Physiolibrary.Types.RealTypeInputParameters;
  protected
    T.Pressure AirSupplyInspiredAirPressure(varName="AirSupply-InspiredAir.Pressure")
    annotation (Placement(transformation(extent={{-80,-154},{-74,-148}})));
    T.Fraction Anesthesia_VascularConductance(varName="Anesthesia.VascularConductance")
    annotation (Placement(transformation(extent={{-80,-144},{-74,-138}})));
    T.Fraction AnesthesiaTidalVolume(varName="Anesthesia.TidalVolume")
    annotation (Placement(transformation(extent={{-80,-134},{-74,-128}})));
    T.Pressure BarometerPressure(varName="Barometer.Pressure")
    annotation (Placement(transformation(extent={{-80,-124},{-74,-118}})));
    T.Position CarotidSinusHeight(varName="Hydrostatics.CarotidCM")
    annotation (Placement(transformation(extent={{-80,-94},{-74,-88}})));
    T.MolarFlowRate DialyzerActivity_Cl_Flux(varName="DialyzerActivity.Cl-Flux")
    annotation (Placement(transformation(extent={{-80,-84},{-74,-78}})));
    T.MolarFlowRate DialyzerActivity_K_Flux(varName="DialyzerActivity.K+Flux")
    annotation (Placement(transformation(extent={{-80,-74},{-74,-68}})));
    T.MolarFlowRate DialyzerActivity_Na_Flux(varName="DialyzerActivity.Na+Flux")
    annotation (Placement(transformation(extent={{-80,-64},{-74,-58}})));
    T.Temperature DietGoalH2O_DegK(varName="DietGoalH2O.DegK",storeUnit="K")
    annotation (Placement(transformation(extent={{-80,-54},{-74,-48}})));
    T.MolarFlowRate DietIntakeElectrolytes_Cl(varName="DietIntakeElectrolytes.Cl-_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-44},{-74,-38}})));
    T.MolarFlowRate DietIntakeElectrolytes_K(varName="DietIntakeElectrolytes.K+_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-34},{-74,-28}})));
    T.MolarFlowRate DietIntakeElectrolytes_Na(varName="DietIntakeElectrolytes.Na+_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-24},{-74,-18}})));
    T.MolarFlowRate DietIntakeElectrolytes_PO4(varName="DietIntakeElectrolytes.PO4--mEq/Min")
    annotation (Placement(transformation(extent={{-80,-14},{-74,-8}})));
    T.MolarFlowRate DietIntakeElectrolytes_SO4(varName="DietIntakeElectrolytes.SO4--mEq/Min")
    annotation (Placement(transformation(extent={{-80,-4},{-74,2}})));
    T.Frequency Exercise_Metabolism_ContractionRate(varName="Exercise-Metabolism.ContractionRate")
    annotation (Placement(transformation(extent={{-82,44},{-76,50}})));
    T.Power Exercise_Metabolism_MotionWatts(varName="Exercise-Metabolism.MotionWatts", storeUnit="W")
    annotation (Placement(transformation(extent={{-82,36},{-76,42}})));
    T.Power ExerciseMetabolism_TotalWatts(varName="Exercise-Metabolism.TotalWatts", storeUnit="W")
    annotation (Placement(transformation(extent={{-82,52},{-76,58}})));
    T.Concentration FurosemidePool_Furosemide_conc(varName="FurosemidePool.[Furosemide]", storeUnit="mg/l", unitConversions=Substances.Furosemide.unitConversions)
    annotation (Placement(transformation(extent={{-80,66},{-74,72}})));
    T.MolarFlowRate FurosemidePool_Loss(varName="FurosemidePool.Loss", storeUnit="mg/min", unitConversions=Substances.Furosemide.unitConversions)
    annotation (Placement(transformation(extent={{-80,76},{-74,82}})));
    T.Fraction Gravity_Gz(varName="Gravity.Gz")
    annotation (Placement(transformation(extent={{-80,86},{-74,92}})));
    T.MolarFlowRate GILumenDiarrhea_KLoss(varName="GILumenDiarrhea.K+Loss")
    annotation (Placement(transformation(extent={{-80,96},{-74,102}})));
    T.MolarFlowRate GILumenDiarrhea_NaLoss(varName="GILumenDiarrhea.Na+Loss")
    annotation (Placement(transformation(extent={{-80,106},{-74,112}})));
    T.MolarFlowRate GILumenVomitus_ClLoss(varName="GILumenVomitus.Cl-Loss")
    annotation (Placement(transformation(extent={{-80,116},{-74,122}})));
    T.MolarFlowRate Hemorrhage_ClRate(varName="Hemorrhage.ClRate")
    annotation (Placement(transformation(extent={{68,16},{74,22}})));
    T.MolarFlowRate Hemorrhage_KRate(varName="Hemorrhage.KRate")
    annotation (Placement(transformation(extent={{68,28},{74,34}})));
    T.MolarFlowRate Hemorrhage_NaRate(varName="Hemorrhage.NaRate")
    annotation (Placement(transformation(extent={{72,-168},{78,-162}})));
    T.VolumeFlowRate Hemorrhage_PlasmaRate(varName="Hemorrhage.PlasmaRate")
    annotation (Placement(transformation(extent={{72,-158},{78,-152}})));
    T.MolarFlowRate Hemorrhage_ProteinRate(varName="Hemorrhage.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{72,-148},{78,-142}})));
    T.VolumeFlowRate Hemorrhage_RBCRate(varName="Hemorrhage.RBCRate")
    annotation (Placement(transformation(extent={{72,-138},{78,-132}})));
    T.MolarFlowRate IVDrip_ClRate(varName="IVDrip.ClRate")
    annotation (Placement(transformation(extent={{72,-128},{78,-122}})));
    T.VolumeFlowRate IVDrip_H2ORate(varName="IVDrip.H2ORate")
    annotation (Placement(transformation(extent={{72,-118},{78,-112}})));
    T.MolarFlowRate IVDrip_KRate(varName="IVDrip.KRate")
    annotation (Placement(transformation(extent={{72,-108},{78,-102}})));
    T.MolarFlowRate IVDrip_NaRate(varName="IVDrip.NaRate")
    annotation (Placement(transformation(extent={{72,-98},{78,-92}})));
    T.Fraction Kidney_NephronCount_Filtering_xNormal(varName="Kidney-NephronCount.Filtering(xNormal)")
    annotation (Placement(transformation(extent={{72,-88},{78,-82}})));
    T.Fraction Kidney_NephronCount_Total_xNormal(varName="Kidney-NephronCount.Total(xNormal)")
    annotation (Placement(transformation(extent={{72,-78},{78,-72}})));
    T.Fraction LegMusclePump_Effect(varName="LegMusclePump.Effect")
    annotation (Placement(transformation(extent={{72,-68},{78,-62}})));
    T.Position LowerTorsoArtyHeight(varName="Hydrostatics.LowerTorsoCM")
    annotation (Placement(transformation(extent={{72,-58},{78,-52}})));
    T.Position LowerTorsoVeinHeight(varName="Hydrostatics.LowerTorsoCM")
    annotation (Placement(transformation(extent={{72,-48},{78,-42}})));
    T.Pressure pCO(varName="pCO")
    annotation (Placement(transformation(extent={{72,-28},{78,-22}})));
    T.Pressure Pericardium_Pressure(varName="Pericardium-Cavity.Pressure")
    annotation (Placement(transformation(extent={{72,-18},{78,-12}})));
    T.Mass skeletalMuscle_SizeMass(varName="SkeletalMuscle-Size.Mass", storeUnit="g")
    annotation (Placement(transformation(extent={{72,-8},{78,-2}})));
    T.Mass skinSizeMass(varName="Skin-Size.Mass")
    annotation (Placement(transformation(extent={{72,2},{78,8}})));
    T.Fraction Status_Posture(varName="Status.Posture")
    annotation (Placement(transformation(extent={{70,42},{76,48}})));
    T.MassConcentration ThiazidePool_Thiazide_conc(varName="ThiazidePool.[Thiazide]", storeUnit="mg/l")
    annotation (Placement(transformation(extent={{72,62},{78,68}})));
    T.Pressure Thorax_AvePressure(varName="Thorax.AvePressure")
    annotation (Placement(transformation(extent={{72,72},{78,78}})));
    T.Fraction Thorax_LungInflation(varName="Thorax.LungInflation")
    annotation (Placement(transformation(extent={{72,82},{78,88}})));
    T.MolarFlowRate Transfusion_ClRate(varName="Transfusion.ClRate")
    annotation (Placement(transformation(extent={{72,92},{78,98}})));
    T.MolarFlowRate Transfusion_KRate(varName="Transfusion.KRate")
    annotation (Placement(transformation(extent={{72,102},{78,108}})));
    T.MolarFlowRate Transfusion_NaRate(varName="Transfusion.NaRate")
    annotation (Placement(transformation(extent={{72,112},{78,118}})));
    T.VolumeFlowRate Transfusion_PlasmaRate(varName="Transfusion.PlasmaRate")
    annotation (Placement(transformation(extent={{72,122},{78,128}})));
    T.MolarFlowRate Transfusion_ProteinRate(varName="Transfusion.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{72,132},{78,138}})));
    T.VolumeFlowRate Transfusion_RBCRate(varName="Transfusion.RBCRate")
    annotation (Placement(transformation(extent={{72,142},{78,148}})));
    T.Mass WeightCore(varName="Weight.Core")
    annotation (Placement(transformation(extent={{72,152},{78,158}})));

    T.MolarFlowRate IVDrip_ProteinRate(varName="IVDrip.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{-90,-40},{-84,-34}})));
    T.Temperature AmbientTemperature(varName=
            "AmbientTemperature.Temp(C)")
    annotation (Placement(transformation(extent={{-94,10},{-88,16}})));
    T.Fraction EnvironmentRelativeHumidity(varName=
            "EnvironmentRelativeHumidity")
    annotation (Placement(transformation(extent={{-102,-12},{-96,-6}})));
    T.VolumeFlowRate DietIntakeH2O_Rate(varName="DietIntakeH2O.Rate(mL/Min)")
    annotation (Placement(transformation(extent={{-102,-20},{-96,-14}})));
    T.VolumeFlowRate DialyzerActivity_UltrafiltrationRate(
          varName="DialyzerActivity.UltrafiltrationRate")
    annotation (Placement(transformation(extent={{96,-128},{108,-116}})));
    T.VolumeFlowRate Hemorrhage_PlasmaRate1(                         varName="Hemorrhage.H2ORate")
    annotation (Placement(transformation(extent={{98,-110},{110,-98}})));
    T.VolumeFlowRate Transfusion_PlasmaRate1(                         varName="Transfusion.H2ORate")
    annotation (Placement(transformation(extent={{100,-98},{110,-88}})));
    T.VolumeFlowRate GILumenVomitus_H2OTarget(varName=
            "GILumenVomitus.H2OTarget")
    annotation (Placement(transformation(extent={{-84,122},{-72,134}})));
    T.VolumeFlowRate GILumenDiarrhea_H2OTarget(varName=
            "GILumenDiarrhea.H2OTarget")
    annotation (Placement(transformation(extent={{-82,132},{-70,144}})));
    T.Velocity Wind_MPH(varName="Wind.MPH",storeUnit="MPH")
    annotation (Placement(transformation(extent={{-46,6},{-40,12}})));
    T.AmountOfSubstance GILumenFiber(varName="GILumenVolume.[Fiber]", storeUnit="osm")
        annotation (Placement(transformation(extent={{-82,142},{-70,154}})));
    T.Pressure EnvironmentRelativeHumidity_VaporPressure(varName="RelativeHumidity.VaporPressure",
          storeUnit="mmHg")
        annotation (Placement(transformation(extent={{-92,-2},{-86,4}})));
  public
    Physiolibrary.Types.BusConnector busConnector
      annotation (Placement(transformation(extent={{4,-18},{44,22}})));
    equation
      connect( Gravity_Gz.y,busConnector.Gravity_Gz)          annotation (Line(
          points={{-73.25,89},{24,89},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(BarometerPressure.y,busConnector.BarometerPressure)
        annotation (Line(
          points={{-73.25,-121},{4,-121},{4,2},{24,2}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(AirSupplyInspiredAirPressure.y,busConnector.AirSupplyInspiredAirPressure)
        annotation (Line(
          points={{-73.25,-151},{4,-151},{4,2},{24,2}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(pCO.y,busConnector.pCO) annotation (Line(
          points={{78.75,-25},{24,-25},{24,2}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect( IVDrip_NaRate.y,busConnector. IVDrip_NaRate) annotation (Line(
          points={{78.75,-95},{24,-95},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_NaRate.y,busConnector. Transfusion_NaRate) annotation (Line(
          points={{78.75,115},{24,115},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_NaRate.y,busConnector. Hemorrhage_NaRate) annotation (Line(
          points={{78.75,-165},{24,-165},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_Na_Flux.y,busConnector. DialyzerActivity_Na_Flux) annotation (
          Line(
          points={{-73.25,-61},{24,-61},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_Na.y,busConnector. DietIntakeElectrolytes_Na) annotation (
          Line(
          points={{-73.25,-21},{24,-21},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( GILumenDiarrhea_NaLoss.y,busConnector. GILumenDiarrhea_NaLoss) annotation (Line(
          points={{-73.25,109},{24,109},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( IVDrip_KRate.y,busConnector. IVDrip_KRate) annotation (Line(
          points={{78.75,-105},{24,-105},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_KRate.y,busConnector. Transfusion_KRate) annotation (Line(
          points={{78.75,105},{24,105},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_KRate.y,busConnector. Hemorrhage_KRate) annotation (Line(
          points={{74.75,31},{24,31},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_K_Flux.y,busConnector. DialyzerActivity_K_Flux) annotation (
          Line(
          points={{-73.25,-71},{24,-71},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_K.y,busConnector. DietIntakeElectrolytes_K) annotation (
          Line(
          points={{-73.25,-31},{24,-31},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( GILumenDiarrhea_KLoss.y,busConnector. GILumenDiarrhea_KLoss) annotation (Line(
          points={{-73.25,99},{24,99},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( IVDrip_ClRate.y,busConnector. IVDrip_ClRate) annotation (Line(
          points={{78.75,-125},{24,-125},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_ClRate.y,busConnector. Transfusion_ClRate) annotation (Line(
          points={{78.75,95},{24,95},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_ClRate.y,busConnector. Hemorrhage_ClRate) annotation (Line(
          points={{74.75,19},{24,19},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_Cl_Flux.y,busConnector. DialyzerActivity_Cl_Flux) annotation (
          Line(
          points={{-73.25,-81},{24,-81},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_Cl.y,busConnector. DietIntakeElectrolytes_Cl) annotation (
          Line(
          points={{-73.25,-41},{24,-41},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GILumenVomitus_ClLoss.y,busConnector.GILumenVomitus_ClLoss) annotation (Line(
          points={{-73.25,119},{24,119},{24,2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(DietIntakeElectrolytes_PO4.y,busConnector.DietIntakeElectrolytes_PO4) annotation (Line(
          points={{-73.25,-11},{6,-11},{6,2},{24,2}},
          color={0,0,127},
          thickness=0.5,
          smooth=Smooth.None));
      connect(DietIntakeElectrolytes_SO4.y,busConnector.DietIntakeElectrolytes_SO4) annotation (Line(
          points={{-73.25,-1},{24,-1},{24,2}},
          color={0,0,127},
          thickness=0.5,
          smooth=Smooth.None));
      connect(DietGoalH2O_DegK.y,busConnector.DietGoalH2O_DegK) annotation (
          Line(
          points={{-73.25,-51},{-73.25,-50},{-28,-50},{-28,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Exercise_Metabolism_ContractionRate.y,busConnector. Exercise_Metabolism_ContractionRate)
        annotation (Line(
          points={{-75.25,47},{24,47},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Exercise_Metabolism_MotionWatts.y,busConnector. Exercise_Metabolism_MotionWatts)
        annotation (Line(
          points={{-75.25,39},{24,39},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(LegMusclePump_Effect.y,busConnector.LegMusclePump_Effect) annotation (Line(
          points={{78.75,-65},{-7.85,-65},{-7.85,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(ExerciseMetabolism_TotalWatts.y,busConnector.ExerciseMetabolism_TotalWatts) annotation (
         Line(
          points={{-75.25,55},{24,55},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( LowerTorsoArtyHeight.y,busConnector. LowerTorsoArtyHeight)
        annotation (Line(
          points={{78.75,-55},{-6,-55},{-6,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( LowerTorsoVeinHeight.y,busConnector. LowerTorsoVeinHeight)
        annotation (Line(
          points={{78.75,-45},{-6,-45},{-6,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( CarotidSinusHeight.y,busConnector. CarotidSinusHeight)
        annotation (Line(
          points={{-73.25,-91},{0,-91},{0,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Status_Posture.y,busConnector.Status_Posture) annotation (Line(
          points={{76.75,45},{4.15,45},{4.15,2},{24,2}},
          color={0,0,255},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( FurosemidePool_Furosemide_conc.y,busConnector. FurosemidePool_Furosemide_conc)
        annotation (Line(
          points={{-73.25,69},{8,69},{8,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( ThiazidePool_Thiazide_conc.y,busConnector. ThiazidePool_Thiazide_conc) annotation (
          Line(
          points={{78.75,65},{24,65},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(FurosemidePool_Loss.y,busConnector.FurosemidePool_Loss) annotation (Line(
          points={{-73.25,79},{24,79},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(IVDrip_H2ORate.y,busConnector.IVDrip_H2ORate)  annotation (Line(
          points={{78.75,-115},{0.15,-115},{0.15,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_PlasmaRate.y,busConnector.Transfusion_PlasmaRate)
                                                             annotation (Line(
          points={{78.75,125},{24,125},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_PlasmaRate.y,busConnector.Hemorrhage_PlasmaRate)
                                                            annotation (Line(
          points={{78.75,-155},{24,-155},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_RBCRate.y,busConnector.Hemorrhage_RBCRate) annotation (Line(
          points={{78.75,-135},{24,-135},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_RBCRate.y,busConnector.Transfusion_RBCRate) annotation (Line(
          points={{78.75,145},{24,145},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Pericardium_Pressure.y,busConnector. Pericardium_Pressure)          annotation (
         Line(
          points={{78.75,-15},{24,-15},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Thorax_AvePressure.y,busConnector. Thorax_AvePressure)          annotation (
          Line(
          points={{78.75,75},{24,75},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Thorax_LungInflation.y,busConnector.Thorax_LungInflation)
        annotation (Line(
          points={{78.75,85},{24,85},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Total_xNormal.y,busConnector.Kidney_NephronCount_Total_xNormal)
        annotation (Line(
          points={{78.75,-75},{6,-75},{6,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Filtering_xNormal.y,busConnector.Kidney_NephronCount_Filtering_xNormal)
        annotation (Line(
          points={{78.75,-85},{24,-85},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(AnesthesiaTidalVolume.y,busConnector.AnesthesiaTidalVolume)
                                                            annotation (Line(
          points={{-73.25,-131},{24,-131},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Anesthesia_VascularConductance.y,busConnector.Anesthesia_VascularConductance)
        annotation (Line(
          points={{-73.25,-141},{24,-141},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skeletalMuscle_SizeMass.y,busConnector.skeletalMuscle_SizeMass) annotation (Line(
     points={{78.75,-5},{24,-5},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skinSizeMass.y,busConnector.skinSizeMass) annotation (Line(
     points={{78.75,5},{24,5},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(WeightCore.y,busConnector.WeightCore) annotation (Line(
     points={{78.75,155},{24,155},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

      connect(AmbientTemperature.y, busConnector.AmbientTemperature)
        annotation (Line(
          points={{-87.25,13},{24,13},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity.y, busConnector.EnvironmentRelativeHumidity)
        annotation (Line(
          points={{-95.25,-9},{24,-9},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(DietIntakeH2O_Rate.y, busConnector.DietIntakeH2O_Rate) annotation (Line(
     points={{-95.25,-17},{24,-17},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(DialyzerActivity_UltrafiltrationRate.y, busConnector.DialyzerActivity_UltrafiltrationRate)
        annotation (Line(
          points={{109.5,-122},{24,-122},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_PlasmaRate1.y, busConnector.Hemorrhage_H2ORate)
                                                                      annotation (Line(
     points={{111.5,-104},{18,-104},{18,54},{24,54},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_PlasmaRate1.y, busConnector.Transfusion_H2ORate)
                                                                        annotation (Line(
     points={{111.25,-93},{-48,-93},{-48,36},{24,36},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenDiarrhea_H2OTarget.y, busConnector.GILumenDiarrhea_H2OTarget)
        annotation (Line(
          points={{-68.5,138},{0,138},{0,2},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenVomitus_H2OTarget.y, busConnector.GILumenVomitus_H2OTarget)
        annotation (Line(
          points={{-70.5,128},{24,128},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity_VaporPressure.y, busConnector.EnviromentRelativeHumidity_VaporPressure)
        annotation (Line(
          points={{-85.25,1},{24,1},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Wind_MPH.y, busConnector.WindSpeed) annotation (Line(
          points={{-39.25,9},{24,9},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenFiber.y, busConnector.GILumenFiber_Mass) annotation (Line(
          points={{-68.5,148},{24,148},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(IVDrip_ProteinRate.y, busConnector.IVDripProteinRate) annotation (
          Line(
          points={{-83.25,-37},{24,-37},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_ProteinRate.y, busConnector.Hemorrhage_ProteinRate)
        annotation (Line(
          points={{78.75,-145},{78.75,-146.5},{24,-146.5},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_ProteinRate.y, busConnector.Transfusion_ProteinRate)
        annotation (Line(
          points={{78.75,135},{24,135},{24,2}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true,  extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-120,-42},{122,-76}},
              lineColor={0,0,255},
              textString="%name")}));
    end ExcerciseSetup;

    model HemorrhageSetup
      extends Physiolibrary.Icons.Setup;

      package T = Physiolibrary.Types.RealTypeInputParameters;

  protected
    T.Pressure AirSupplyInspiredAirPressure(varName="AirSupply-InspiredAir.Pressure")
    annotation (Placement(transformation(extent={{-80,-154},{-74,-148}})));
    T.Fraction Anesthesia_VascularConductance(varName="Anesthesia.VascularConductance")
    annotation (Placement(transformation(extent={{-80,-144},{-74,-138}})));
    T.Fraction AnesthesiaTidalVolume(varName="Anesthesia.TidalVolume")
    annotation (Placement(transformation(extent={{-80,-134},{-74,-128}})));
    T.Pressure BarometerPressure(varName="Barometer.Pressure")
    annotation (Placement(transformation(extent={{-80,-124},{-74,-118}})));
    T.Position CarotidSinusHeight(varName="Hydrostatics.CarotidCM")
    annotation (Placement(transformation(extent={{-80,-94},{-74,-88}})));
    T.MolarFlowRate DialyzerActivity_Cl_Flux(varName="DialyzerActivity.Cl-Flux")
    annotation (Placement(transformation(extent={{-80,-84},{-74,-78}})));
    T.MolarFlowRate DialyzerActivity_K_Flux(varName="DialyzerActivity.K+Flux")
    annotation (Placement(transformation(extent={{-80,-74},{-74,-68}})));
    T.MolarFlowRate DialyzerActivity_Na_Flux(varName="DialyzerActivity.Na+Flux")
    annotation (Placement(transformation(extent={{-80,-64},{-74,-58}})));
    T.Temperature DietGoalH2O_DegK(varName="DietGoalH2O.DegK",storeUnit="K")
    annotation (Placement(transformation(extent={{-80,-54},{-74,-48}})));
    T.MolarFlowRate DietIntakeElectrolytes_Cl(varName="DietIntakeElectrolytes.Cl-_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-44},{-74,-38}})));
    T.MolarFlowRate DietIntakeElectrolytes_K(varName="DietIntakeElectrolytes.K+_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-34},{-74,-28}})));
    T.MolarFlowRate DietIntakeElectrolytes_Na(varName="DietIntakeElectrolytes.Na+_mEq/Min")
    annotation (Placement(transformation(extent={{-80,-24},{-74,-18}})));
    T.MolarFlowRate DietIntakeElectrolytes_PO4(varName="DietIntakeElectrolytes.PO4--mEq/Min")
    annotation (Placement(transformation(extent={{-80,-14},{-74,-8}})));
    T.MolarFlowRate DietIntakeElectrolytes_SO4(varName="DietIntakeElectrolytes.SO4--mEq/Min")
    annotation (Placement(transformation(extent={{-80,-4},{-74,2}})));
    T.Frequency Exercise_Metabolism_ContractionRate(varName="Exercise-Metabolism.ContractionRate")
    annotation (Placement(transformation(extent={{-76,32},{-70,38}})));
    T.Power Exercise_Metabolism_MotionWatts(varName="Exercise-Metabolism.MotionWatts", storeUnit="W")
    annotation (Placement(transformation(extent={{-76,38},{-70,44}})));
    T.Power ExerciseMetabolism_TotalWatts(varName="Exercise-Metabolism.TotalWatts", storeUnit="W")
    annotation (Placement(transformation(extent={{-76,44},{-70,50}})));
    T.Concentration FurosemidePool_Furosemide_conc(varName="FurosemidePool.[Furosemide]", storeUnit="mg/l", unitConversions=Substances.Furosemide.unitConversions)
    annotation (Placement(transformation(extent={{-80,66},{-74,72}})));
    T.MolarFlowRate FurosemidePool_Loss(varName="FurosemidePool.Loss", storeUnit="mg/min", unitConversions=Substances.Furosemide.unitConversions)
    annotation (Placement(transformation(extent={{-80,76},{-74,82}})));
    T.Fraction Gravity_Gz(varName="Gravity.Gz")
    annotation (Placement(transformation(extent={{-80,86},{-74,92}})));
    T.MolarFlowRate GILumenDiarrhea_KLoss(varName="GILumenDiarrhea.K+Loss")
    annotation (Placement(transformation(extent={{-80,96},{-74,102}})));
    T.MolarFlowRate GILumenDiarrhea_NaLoss(varName="GILumenDiarrhea.Na+Loss")
    annotation (Placement(transformation(extent={{-80,106},{-74,112}})));
    T.MolarFlowRate GILumenVomitus_ClLoss(varName="GILumenVomitus.Cl-Loss")
    annotation (Placement(transformation(extent={{-80,116},{-74,122}})));
    T.MolarFlowRate Hemorrhage_ClRate(varName="Hemorrhage.ClRate")
    annotation (Placement(transformation(extent={{68,16},{74,22}})));
    T.MolarFlowRate Hemorrhage_KRate(varName="Hemorrhage.KRate")
    annotation (Placement(transformation(extent={{68,28},{74,34}})));
    T.MolarFlowRate Hemorrhage_NaRate(varName="Hemorrhage.NaRate")
    annotation (Placement(transformation(extent={{72,-168},{78,-162}})));
    T.VolumeFlowRate Hemorrhage_PlasmaRate(varName="Hemorrhage.PlasmaRate")
    annotation (Placement(transformation(extent={{72,-158},{78,-152}})));
    T.MolarFlowRate Hemorrhage_ProteinRate(varName="Hemorrhage.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{72,-148},{78,-142}})));
    T.VolumeFlowRate Hemorrhage_RBCRate(varName="Hemorrhage.RBCRate")
    annotation (Placement(transformation(extent={{72,-138},{78,-132}})));
    T.MolarFlowRate IVDrip_ClRate(varName="IVDrip.ClRate")
    annotation (Placement(transformation(extent={{72,-128},{78,-122}})));
    T.VolumeFlowRate IVDrip_H2ORate(varName="IVDrip.H2ORate")
    annotation (Placement(transformation(extent={{72,-118},{78,-112}})));
    T.MolarFlowRate IVDrip_KRate(varName="IVDrip.KRate")
    annotation (Placement(transformation(extent={{72,-108},{78,-102}})));
    T.MolarFlowRate IVDrip_NaRate(varName="IVDrip.NaRate")
    annotation (Placement(transformation(extent={{72,-98},{78,-92}})));
    T.Fraction Kidney_NephronCount_Filtering_xNormal(varName="Kidney-NephronCount.Filtering(xNormal)")
    annotation (Placement(transformation(extent={{72,-88},{78,-82}})));
    T.Fraction Kidney_NephronCount_Total_xNormal(varName="Kidney-NephronCount.Total(xNormal)")
    annotation (Placement(transformation(extent={{72,-78},{78,-72}})));
    T.Fraction LegMusclePump_Effect(varName="LegMusclePump.Effect")
    annotation (Placement(transformation(extent={{72,-68},{78,-62}})));
    T.Position LowerTorsoArtyHeight(varName="Hydrostatics.LowerTorsoCM")
    annotation (Placement(transformation(extent={{72,-58},{78,-52}})));
    T.Position LowerTorsoVeinHeight(varName="Hydrostatics.LowerTorsoCM")
    annotation (Placement(transformation(extent={{72,-48},{78,-42}})));
    T.Pressure pCO(varName="pCO")
    annotation (Placement(transformation(extent={{72,-28},{78,-22}})));
    T.Pressure Pericardium_Pressure(varName="Pericardium-Cavity.Pressure")
    annotation (Placement(transformation(extent={{72,-18},{78,-12}})));
    T.Mass skeletalMuscle_SizeMass(varName="SkeletalMuscle-Size.Mass", storeUnit="g")
    annotation (Placement(transformation(extent={{72,-8},{78,-2}})));
    T.Mass skinSizeMass(varName="Skin-Size.Mass")
    annotation (Placement(transformation(extent={{72,2},{78,8}})));
    T.Fraction Status_Posture(varName="Status.Posture")
    annotation (Placement(transformation(extent={{70,42},{76,48}})));
    T.MassConcentration ThiazidePool_Thiazide_conc(varName="ThiazidePool.[Thiazide]", storeUnit="mg/l")
    annotation (Placement(transformation(extent={{72,62},{78,68}})));
    T.Pressure Thorax_AvePressure(varName="Thorax.AvePressure")
    annotation (Placement(transformation(extent={{72,72},{78,78}})));
    T.Fraction Thorax_LungInflation(varName="Thorax.LungInflation")
    annotation (Placement(transformation(extent={{72,82},{78,88}})));
    T.MolarFlowRate Transfusion_ClRate(varName="Transfusion.ClRate")
    annotation (Placement(transformation(extent={{72,92},{78,98}})));
    T.MolarFlowRate Transfusion_KRate(varName="Transfusion.KRate")
    annotation (Placement(transformation(extent={{72,102},{78,108}})));
    T.MolarFlowRate Transfusion_NaRate(varName="Transfusion.NaRate")
    annotation (Placement(transformation(extent={{72,112},{78,118}})));
    T.VolumeFlowRate Transfusion_PlasmaRate(varName="Transfusion.PlasmaRate")
    annotation (Placement(transformation(extent={{72,122},{78,128}})));
    T.MolarFlowRate Transfusion_ProteinRate(varName="Transfusion.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{72,132},{78,138}})));
    T.VolumeFlowRate Transfusion_RBCRate(varName="Transfusion.RBCRate")
    annotation (Placement(transformation(extent={{72,142},{78,148}})));
    T.Mass WeightCore(varName="Weight.Core")
    annotation (Placement(transformation(extent={{72,152},{78,158}})));

    T.MolarFlowRate IVDrip_ProteinRate(varName="IVDrip.ProteinRate", storeUnit="mmol/min")
    annotation (Placement(transformation(extent={{-90,-40},{-84,-34}})));
    T.Temperature AmbientTemperature(varName=
            "AmbientTemperature.Temp(C)")
    annotation (Placement(transformation(extent={{-94,10},{-88,16}})));
    T.Fraction EnvironmentRelativeHumidity(varName=
            "EnvironmentRelativeHumidity")
    annotation (Placement(transformation(extent={{-102,-12},{-96,-6}})));
    T.VolumeFlowRate DietIntakeH2O_Rate(varName="DietIntakeH2O.Rate(mL/Min)")
    annotation (Placement(transformation(extent={{-102,-20},{-96,-14}})));
    T.VolumeFlowRate DialyzerActivity_UltrafiltrationRate(
          varName="DialyzerActivity.UltrafiltrationRate")
    annotation (Placement(transformation(extent={{-134,0},{-122,12}})));
    T.VolumeFlowRate Hemorrhage_PlasmaRate1(                         varName="Hemorrhage.H2ORate")
    annotation (Placement(transformation(extent={{-132,18},{-120,30}})));
    T.VolumeFlowRate Transfusion_PlasmaRate1(                         varName="Transfusion.H2ORate")
    annotation (Placement(transformation(extent={{-130,30},{-120,40}})));
    T.VolumeFlowRate GILumenVomitus_H2OTarget(varName=
            "GILumenVomitus.H2OTarget")
    annotation (Placement(transformation(extent={{-84,122},{-72,134}})));
    T.VolumeFlowRate GILumenDiarrhea_H2OTarget(varName=
            "GILumenDiarrhea.H2OTarget")
    annotation (Placement(transformation(extent={{-82,132},{-70,144}})));
    T.Velocity Wind_MPH(varName="Wind.MPH",storeUnit="MPH")
    annotation (Placement(transformation(extent={{-46,6},{-40,12}})));
    T.AmountOfSubstance GILumenFiber(varName="GILumenVolume.[Fiber]", storeUnit="osm")
        annotation (Placement(transformation(extent={{-82,142},{-70,154}})));
    T.Pressure EnvironmentRelativeHumidity_VaporPressure(varName="RelativeHumidity.VaporPressure",
          storeUnit="mmHg")
        annotation (Placement(transformation(extent={{-92,-2},{-86,4}})));

  public
    Physiolibrary.Types.BusConnector busConnector
      annotation (Placement(transformation(extent={{-6,-20},{34,20}})));
    equation
      connect( Gravity_Gz.y,busConnector.Gravity_Gz)          annotation (Line(
          points={{-73.25,89},{14,89},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(BarometerPressure.y,busConnector.BarometerPressure)
        annotation (Line(
          points={{-73.25,-121},{14,-121},{14,0}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(AirSupplyInspiredAirPressure.y,busConnector.AirSupplyInspiredAirPressure)
        annotation (Line(
          points={{-73.25,-151},{14,-151},{14,0}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect(pCO.y,busConnector.pCO) annotation (Line(
          points={{78.75,-25},{14,-25},{14,0}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None), Text(
          string="%first",
          index=-1,
          extent={{-6,3},{-6,3}}));
      connect( IVDrip_NaRate.y,busConnector. IVDrip_NaRate) annotation (Line(
          points={{78.75,-95},{14,-95},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_NaRate.y,busConnector. Transfusion_NaRate) annotation (Line(
          points={{78.75,115},{14,115},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_NaRate.y,busConnector. Hemorrhage_NaRate) annotation (Line(
          points={{78.75,-165},{14,-165},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_Na_Flux.y,busConnector. DialyzerActivity_Na_Flux) annotation (
          Line(
          points={{-73.25,-61},{14,-61},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_Na.y,busConnector. DietIntakeElectrolytes_Na) annotation (
          Line(
          points={{-73.25,-21},{14,-21},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( GILumenDiarrhea_NaLoss.y,busConnector. GILumenDiarrhea_NaLoss) annotation (Line(
          points={{-73.25,109},{14,109},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( IVDrip_KRate.y,busConnector. IVDrip_KRate) annotation (Line(
          points={{78.75,-105},{14,-105},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_KRate.y,busConnector. Transfusion_KRate) annotation (Line(
          points={{78.75,105},{14,105},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_KRate.y,busConnector. Hemorrhage_KRate) annotation (Line(
          points={{74.75,31},{14,31},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_K_Flux.y,busConnector. DialyzerActivity_K_Flux) annotation (
          Line(
          points={{-73.25,-71},{14,-71},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_K.y,busConnector. DietIntakeElectrolytes_K) annotation (
          Line(
          points={{-73.25,-31},{14,-31},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( GILumenDiarrhea_KLoss.y,busConnector. GILumenDiarrhea_KLoss) annotation (Line(
          points={{-73.25,99},{14,99},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( IVDrip_ClRate.y,busConnector. IVDrip_ClRate) annotation (Line(
          points={{78.75,-125},{14,-125},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Transfusion_ClRate.y,busConnector. Transfusion_ClRate) annotation (Line(
          points={{78.75,95},{14,95},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( Hemorrhage_ClRate.y,busConnector. Hemorrhage_ClRate) annotation (Line(
          points={{74.75,19},{14,19},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DialyzerActivity_Cl_Flux.y,busConnector. DialyzerActivity_Cl_Flux) annotation (
          Line(
          points={{-73.25,-81},{14,-81},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect( DietIntakeElectrolytes_Cl.y,busConnector. DietIntakeElectrolytes_Cl) annotation (
          Line(
          points={{-73.25,-41},{14,-41},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(GILumenVomitus_ClLoss.y,busConnector.GILumenVomitus_ClLoss) annotation (Line(
          points={{-73.25,119},{14,119},{14,0}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(DietIntakeElectrolytes_PO4.y,busConnector.DietIntakeElectrolytes_PO4) annotation (Line(
          points={{-73.25,-11},{6,-11},{6,0},{14,0}},
          color={0,0,127},
          thickness=0.5,
          smooth=Smooth.None));
      connect(DietIntakeElectrolytes_SO4.y,busConnector.DietIntakeElectrolytes_SO4) annotation (Line(
          points={{-73.25,-1},{14,-1},{14,0}},
          color={0,0,127},
          thickness=0.5,
          smooth=Smooth.None));
      connect(DietGoalH2O_DegK.y,busConnector.DietGoalH2O_DegK) annotation (
          Line(
          points={{-73.25,-51},{-73.25,-50},{-28,-50},{-28,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Exercise_Metabolism_ContractionRate.y,busConnector. Exercise_Metabolism_ContractionRate)
        annotation (Line(
          points={{-69.25,35},{14,35},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Exercise_Metabolism_MotionWatts.y,busConnector. Exercise_Metabolism_MotionWatts)
        annotation (Line(
          points={{-69.25,41},{14,41},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(LegMusclePump_Effect.y,busConnector.LegMusclePump_Effect) annotation (Line(
          points={{78.75,-65},{-7.85,-65},{-7.85,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(ExerciseMetabolism_TotalWatts.y,busConnector.ExerciseMetabolism_TotalWatts) annotation (
         Line(
          points={{-69.25,47},{14,47},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( LowerTorsoArtyHeight.y,busConnector. LowerTorsoArtyHeight)
        annotation (Line(
          points={{78.75,-55},{-6,-55},{-6,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( LowerTorsoVeinHeight.y,busConnector. LowerTorsoVeinHeight)
        annotation (Line(
          points={{78.75,-45},{-6,-45},{-6,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( CarotidSinusHeight.y,busConnector. CarotidSinusHeight)
        annotation (Line(
          points={{-73.25,-91},{0,-91},{0,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Status_Posture.y,busConnector.Status_Posture) annotation (Line(
          points={{76.75,45},{4.15,45},{4.15,0},{14,0}},
          color={0,0,255},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( FurosemidePool_Furosemide_conc.y,busConnector. FurosemidePool_Furosemide_conc)
        annotation (Line(
          points={{-73.25,69},{8,69},{8,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( ThiazidePool_Thiazide_conc.y,busConnector. ThiazidePool_Thiazide_conc) annotation (
          Line(
          points={{78.75,65},{14,65},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(FurosemidePool_Loss.y,busConnector.FurosemidePool_Loss) annotation (Line(
          points={{-73.25,79},{14,79},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(IVDrip_H2ORate.y,busConnector.IVDrip_H2ORate)  annotation (Line(
          points={{78.75,-115},{0.15,-115},{0.15,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_PlasmaRate.y,busConnector.Transfusion_PlasmaRate)
                                                             annotation (Line(
          points={{78.75,125},{14,125},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_PlasmaRate.y,busConnector.Hemorrhage_PlasmaRate)
                                                            annotation (Line(
          points={{78.75,-155},{14,-155},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_RBCRate.y,busConnector.Hemorrhage_RBCRate) annotation (Line(
          points={{78.75,-135},{14,-135},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_RBCRate.y,busConnector.Transfusion_RBCRate) annotation (Line(
          points={{78.75,145},{14,145},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Pericardium_Pressure.y,busConnector. Pericardium_Pressure)          annotation (
         Line(
          points={{78.75,-15},{14,-15},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect( Thorax_AvePressure.y,busConnector. Thorax_AvePressure)          annotation (
          Line(
          points={{78.75,75},{14,75},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Thorax_LungInflation.y,busConnector.Thorax_LungInflation)
        annotation (Line(
          points={{78.75,85},{14,85},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Total_xNormal.y,busConnector.Kidney_NephronCount_Total_xNormal)
        annotation (Line(
          points={{78.75,-75},{6,-75},{6,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Kidney_NephronCount_Filtering_xNormal.y,busConnector.Kidney_NephronCount_Filtering_xNormal)
        annotation (Line(
          points={{78.75,-85},{14,-85},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(AnesthesiaTidalVolume.y,busConnector.AnesthesiaTidalVolume)
                                                            annotation (Line(
          points={{-73.25,-131},{14,-131},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Anesthesia_VascularConductance.y,busConnector.Anesthesia_VascularConductance)
        annotation (Line(
          points={{-73.25,-141},{14,-141},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skeletalMuscle_SizeMass.y,busConnector.skeletalMuscle_SizeMass) annotation (Line(
     points={{78.75,-5},{14,-5},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(skinSizeMass.y,busConnector.skinSizeMass) annotation (Line(
     points={{78.75,5},{14,5},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(WeightCore.y,busConnector.WeightCore) annotation (Line(
     points={{78.75,155},{14,155},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));

      connect(AmbientTemperature.y, busConnector.AmbientTemperature)
        annotation (Line(
          points={{-87.25,13},{14,13},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity.y, busConnector.EnvironmentRelativeHumidity)
        annotation (Line(
          points={{-95.25,-9},{14,-9},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
    connect(DietIntakeH2O_Rate.y, busConnector.DietIntakeH2O_Rate) annotation (Line(
     points={{-95.25,-17},{14,-17},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(DialyzerActivity_UltrafiltrationRate.y, busConnector.DialyzerActivity_UltrafiltrationRate)
        annotation (Line(
          points={{-120.5,6},{-110,6},{-110,56},{14,56},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_PlasmaRate1.y, busConnector.Hemorrhage_H2ORate)
                                                                      annotation (Line(
     points={{-118.5,24},{-116,24},{-116,56},{-178,56},{-178,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_PlasmaRate1.y, busConnector.Transfusion_H2ORate)
                                                                        annotation (Line(
     points={{-118.75,35},{-118,35},{-118,56},{-178,56},{-178,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenDiarrhea_H2OTarget.y, busConnector.GILumenDiarrhea_H2OTarget)
        annotation (Line(
          points={{-68.5,138},{0,138},{0,0},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenVomitus_H2OTarget.y, busConnector.GILumenVomitus_H2OTarget)
        annotation (Line(
          points={{-70.5,128},{14,128},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(EnvironmentRelativeHumidity_VaporPressure.y, busConnector.EnviromentRelativeHumidity_VaporPressure)
        annotation (Line(
          points={{-85.25,1},{14,1},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Wind_MPH.y, busConnector.WindSpeed) annotation (Line(
          points={{-39.25,9},{14,9},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(GILumenFiber.y, busConnector.GILumenFiber_Mass) annotation (Line(
          points={{-68.5,148},{14,148},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(IVDrip_ProteinRate.y, busConnector.IVDripProteinRate) annotation (
          Line(
          points={{-83.25,-37},{14,-37},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Hemorrhage_ProteinRate.y, busConnector.Hemorrhage_ProteinRate)
        annotation (Line(
          points={{78.75,-145},{78.75,-146.5},{14,-146.5},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      connect(Transfusion_ProteinRate.y, busConnector.Transfusion_ProteinRate)
        annotation (Line(
          points={{78.75,135},{14,135},{14,0}},
          color={0,0,127},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{6,3},{6,3}}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true,  extent={{-100,
                -100},{100,100}}), graphics={Text(
              extent={{-120,-42},{122,-76}},
              lineColor={0,0,255},
              textString="%name")}));
    end HemorrhageSetup;
    annotation (Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2008-2015</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: HumMod 1.6, University of Mississippi Medical Center</p></td>
</tr>
</table>
<p>Copyright &copy; 2008-2015 Marek Matejak, Charles University in Prague.</p>
</html>"));
  end Setup;


  package Status "Fitness Status of Tissue Structures and Functionality"
   extends Physiolibrary.Icons.StatusLib;
    model TissuesFitness
     extends Physiolibrary.Icons.Status;
      Tissues.SkeletalMuscle skeletalMuscle
        annotation (Placement(transformation(extent={{-80,64},{-60,84}})));

      Tissues.Bone bone
        annotation (Placement(transformation(extent={{-80,32},{-60,52}})));

      Tissues.Fat fat
        annotation (Placement(transformation(extent={{-80,-58},{-60,-38}})));

      Tissues.Brain brain
        annotation (Placement(transformation(extent={{0,30},{20,50}})));

      Tissues.RightHeart rightHeart
        annotation (Placement(transformation(extent={{0,-90},{20,-70}})));

      Tissues.RespiratoryMuscle respiratoryMuscle
        annotation (Placement(transformation(extent={{-80,-28},{-60,-8}})));

      Tissues.OtherTissue otherTissue
        annotation (Placement(transformation(extent={{-80,2},{-60,22}})));

      Tissues.Liver liver
        annotation (Placement(transformation(extent={{0,64},{20,84}})));

      Tissues.LeftHeart leftHeart
        annotation (Placement(transformation(extent={{0,-60},{20,-40}})));

      Tissues.Kidney kidney
        annotation (Placement(transformation(extent={{0,-30},{20,-10}})));

      Tissues.GITract GITract
        annotation (Placement(transformation(extent={{0,-2},{20,18}})));

    Physiolibrary.Types.BusConnector busConnector
      annotation (Placement(transformation(extent={{-108,72},{-68,112}})));
      Tissues.Skin skin
        annotation (Placement(transformation(extent={{-80,-88},{-60,-68}})));

      PatientStatus patientStatus
        annotation (Placement(transformation(extent={{74,16},{94,36}})));
    equation

      connect(bone.pH_intracellular, busConnector.bone_pH_intracellular)        annotation (
         Line(
          points={{-61,50},{-20,50},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(brain.pH_intracellular, busConnector.brain_pH_intracellular)
        annotation (Line(
          points={{19,48},{46,48},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(fat.pH_intracellular, busConnector.fat_pH_intracellular)     annotation (
          Line(
          points={{-61,-40},{-20,-40},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(GITract.pH_intracellular, busConnector.GITract_pH_intracellular)
        annotation (Line(
          points={{19,16},{46,16},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(kidney.pH_intracellular, busConnector.kidney_pH_intracellular)
        annotation (Line(
          points={{19,-12},{46,-12},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(leftHeart.pH_intracellular, busConnector.leftHeart_pH_intracellular)
        annotation (Line(
          points={{19,-42},{46,-42},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(liver.pH_intracellular, busConnector.liver_pH_intracellular)
        annotation (Line(
          points={{19,82},{46,82},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(otherTissue.pH_intracellular, busConnector.otherTissue_pH_intracellular)
        annotation (Line(
          points={{-61,20},{-20,20},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(respiratoryMuscle.pH_intracellular, busConnector.respiratoryMuscle_pH_intracellular)
        annotation (Line(
          points={{-61,-10},{-20,-10},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(rightHeart.pH_intracellular, busConnector.rightHeart_pH_intracellular)
        annotation (Line(
          points={{19,-72},{46,-72},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skin.pH_intracellular, busConnector.skin_pH_intracellular)     annotation (
         Line(
          points={{-61,-70},{-20,-70},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skeletalMuscle.pH_intracellular, busConnector.skeletalMuscle_pH_intracellular)
        annotation (Line(
          points={{-61,82},{-20.5,82},{-20.5,92},{-88,92}},
          color={127,0,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));

      connect(bone.T, busConnector.bone_T)        annotation (
         Line(
          points={{-61,46},{-20,46},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(brain.T, busConnector.brain_T)
        annotation (Line(
          points={{19,44},{46,44},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(fat.T, busConnector.fat_T)     annotation (
          Line(
          points={{-61,-44},{-20,-44},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(GITract.T, busConnector.GITract_T)
        annotation (Line(
          points={{19,12},{46,12},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(kidney.T, busConnector.kidney_T)
        annotation (Line(
          points={{19,-16},{46,-16},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(leftHeart.T, busConnector.leftHeart_T)
        annotation (Line(
          points={{19,-46},{46,-46},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(liver.T, busConnector.liver_T)
        annotation (Line(
          points={{19,78},{46,78},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(otherTissue.T, busConnector.otherTissue_T)
        annotation (Line(
          points={{-61,16},{-20,16},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(respiratoryMuscle.T, busConnector.respiratoryMuscle_T)
        annotation (Line(
          points={{-61,-14},{-20,-14},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(rightHeart.T, busConnector.rightHeart_T)
        annotation (Line(
          points={{19,-76},{46,-76},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skin.T, busConnector.skin_T)     annotation (
         Line(
          points={{-61,-74},{-20,-74},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skeletalMuscle.T, busConnector.skeletalMuscle_T)
        annotation (Line(
          points={{-61,78},{-20.5,78},{-20.5,92},{-88,92}},
          color={127,0,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));

      connect(bone.Fuel_FractUseDelay, busConnector.bone_Fuel_FractUseDelay)        annotation (
         Line(
          points={{-61,42},{-20,42},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(brain.Fuel_FractUseDelay, busConnector.brain_Fuel_FractUseDelay)
        annotation (Line(
          points={{19,40},{46,40},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(fat.Fuel_FractUseDelay, busConnector.fat_Fuel_FractUseDelay)     annotation (
          Line(
          points={{-61,-48},{-20,-48},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(GITract.Fuel_FractUseDelay, busConnector.GITract_Fuel_FractUseDelay)
        annotation (Line(
          points={{19,8},{46,8},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(kidney.Fuel_FractUseDelay, busConnector.kidney_Fuel_FractUseDelay)
        annotation (Line(
          points={{19,-20},{46,-20},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(leftHeart.Fuel_FractUseDelay, busConnector.leftHeart_Fuel_FractUseDelay)
        annotation (Line(
          points={{19,-50},{46,-50},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(liver.Fuel_FractUseDelay, busConnector.liver_Fuel_FractUseDelay)
        annotation (Line(
          points={{19,74},{46,74},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(otherTissue.Fuel_FractUseDelay, busConnector.otherTissue_Fuel_FractUseDelay)
        annotation (Line(
          points={{-61,12},{-20,12},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(respiratoryMuscle.Fuel_FractUseDelay, busConnector.respiratoryMuscle_Fuel_FractUseDelay)
        annotation (Line(
          points={{-61,-18},{-20,-18},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(rightHeart.Fuel_FractUseDelay, busConnector.rightHeart_Fuel_FractUseDelay)
        annotation (Line(
          points={{19,-80},{46,-80},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skin.Fuel_FractUseDelay, busConnector.skin_Fuel_FractUseDelay)     annotation (
         Line(
          points={{-61,-78},{-20,-78},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skeletalMuscle.Fuel_FractUseDelay, busConnector.skeletalMuscle_Fuel_FractUseDelay)
        annotation (Line(
          points={{-61,74},{-20.5,74},{-20.5,92},{-88,92}},
          color={127,0,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));

      connect(bone.CellProteinAA, busConnector.CellProteinAA)       annotation (
         Line(
          points={{-61,34},{-20,34},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(brain.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{19,32},{46,32},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(fat.CellProteinAA, busConnector.CellProteinAA)     annotation (
          Line(
          points={{-61,-56},{-20,-56},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(GITract.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{19,0},{46,0},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(kidney.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{19,-28},{46,-28},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(leftHeart.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{19,-58},{46,-58},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(liver.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{19,66},{46,66},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(otherTissue.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{-61,4},{-20,4},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(respiratoryMuscle.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{-61,-26},{-20,-26},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(rightHeart.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{19,-88},{46,-88},{46,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skin.CellProteinAA, busConnector.CellProteinAA)     annotation (
         Line(
          points={{-61,-86},{-20,-86},{-20,92},{-88,92}},
          color={0,127,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));
      connect(skeletalMuscle.CellProteinAA, busConnector.CellProteinAA)
        annotation (Line(
          points={{-61,66},{-20.5,66},{-20.5,92},{-88,92}},
          color={127,0,0},
          smooth=Smooth.None), Text(
          string="%second",
          index=1,
          extent={{5,2},{5,2}}));

    connect(bone.StructureEffect, busConnector.bone_StructureEffect) annotation (Line(
          points={{-68,30},{-20,30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain.StructureEffect, busConnector.brain_StructureEffect) annotation (Line(
          points={{12,28},{-20,28},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(fat.StructureEffect, busConnector.fat_StructureEffect) annotation (Line(
          points={{-68,-60},{-20,-60},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(GITract.StructureEffect, busConnector.GITract_StructureEffect) annotation (Line(
          points={{12,-4},{-20,-4},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(kidney.StructureEffect, busConnector.kidney_StructureEffect) annotation (Line(
          points={{12,-32},{-20,-32},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(leftHeart.StructureEffect, busConnector.leftHeart_StructureEffect) annotation (Line(
          points={{12,-62},{-20,-62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(liver.StructureEffect, busConnector.liver_StructureEffect) annotation (Line(
          points={{12,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(otherTissue.StructureEffect, busConnector.otherTissue_StructureEffect) annotation (Line(
          points={{-68,0},{-20,0},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(rightHeart.StructureEffect, busConnector.rightHeart_StructureEffect) annotation (Line(
          points={{12,-92},{-20,-92},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(respiratoryMuscle.StructureEffect, busConnector.respiratoryMuscle_StructureEffect) annotation (Line(
          points={{-68,-30},{-20,-30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skin.StructureEffect, busConnector.skin_StructureEffect) annotation (Line(
          points={{-68,-90},{-20,-90},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skeletalMuscle.StructureEffect, busConnector.skeletalMuscle_StructureEffect) annotation (Line(
          points={{-68,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));

    connect(bone.StructureEffect, busConnector.Bone_StructureEffect) annotation (Line(
          points={{-68,30},{-20,30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain.StructureEffect, busConnector.Brain_StructureEffect) annotation (Line(
          points={{12,28},{-20,28},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(fat.StructureEffect, busConnector.Fat_StructureEffect) annotation (Line(
          points={{-68,-60},{-20,-60},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(kidney.StructureEffect, busConnector.Kidney_StructureEffect) annotation (Line(
          points={{12,-32},{-20,-32},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(leftHeart.StructureEffect, busConnector.LeftHeart_StructureEffect) annotation (Line(
          points={{12,-62},{-20,-62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(liver.StructureEffect, busConnector.Liver_StructureEffect) annotation (Line(
          points={{12,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(otherTissue.StructureEffect, busConnector.OtherTissue_StructureEffect) annotation (Line(
          points={{-68,0},{-20,0},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(rightHeart.StructureEffect, busConnector.RightHeart_StructureEffect) annotation (Line(
          points={{12,-92},{-20,-92},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(respiratoryMuscle.StructureEffect, busConnector.RespiratoryMuscle_StructureEffect) annotation (Line(
          points={{-68,-30},{-20,-30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skin.StructureEffect, busConnector.Skin_StructureEffect) annotation (Line(
          points={{-68,-90},{-20,-90},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skeletalMuscle.StructureEffect, busConnector.SkeletalMuscle_StructureEffect) annotation (Line(
          points={{-68,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));

     connect(bone.FunctionEffect, busConnector.bone_FunctionEffect) annotation (Line(
          points={{-72,30},{-20,30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain.FunctionEffect, busConnector.brain_FunctionEffect) annotation (Line(
          points={{8,28},{-20,28},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(fat.FunctionEffect, busConnector.fat_FunctionEffect) annotation (Line(
          points={{-72,-60},{-20,-60},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(GITract.FunctionEffect, busConnector.GITract_FunctionEffect) annotation (Line(
          points={{8,-4},{-20,-4},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(kidney.FunctionEffect, busConnector.kidney_FunctionEffect) annotation (Line(
          points={{8,-32},{-20,-32},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(leftHeart.FunctionEffect, busConnector.leftHeart_FunctionEffect) annotation (Line(
          points={{8,-62},{-20,-62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(liver.FunctionEffect, busConnector.liver_FunctionEffect) annotation (Line(
          points={{8,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(otherTissue.FunctionEffect, busConnector.otherTissue_FunctionEffect) annotation (Line(
          points={{-72,0},{-20,0},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(rightHeart.FunctionEffect, busConnector.rightHeart_FunctionEffect) annotation (Line(
          points={{8,-92},{-20,-92},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(respiratoryMuscle.FunctionEffect, busConnector.respiratoryMuscle_FunctionEffect) annotation (Line(
          points={{-72,-30},{-20,-30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skin.FunctionEffect, busConnector.skin_FunctionEffect) annotation (Line(
          points={{-72,-90},{-20,-90},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skeletalMuscle.FunctionEffect, busConnector.skeletalMuscle_FunctionEffect) annotation (Line(
          points={{-72,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));

    connect(bone.FunctionEffect, busConnector.BoneFunctionEffect) annotation (Line(
          points={{-72,30},{-20,30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain.FunctionEffect, busConnector.BrainFunctionEffect) annotation (Line(
          points={{8,28},{-20,28},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(fat.FunctionEffect, busConnector.FatFunctionEffect) annotation (Line(
          points={{-72,-60},{-20,-60},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(GITract.FunctionEffect, busConnector.GITractFunctionEffect) annotation (Line(
          points={{8,-4},{-20,-4},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(kidney.FunctionEffect, busConnector.KidneyFunctionEffect) annotation (Line(
          points={{8,-32},{-20,-32},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(leftHeart.FunctionEffect, busConnector.LeftHeartFunctionEffect) annotation (Line(
          points={{8,-62},{-20,-62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(liver.FunctionEffect, busConnector.LiverFunctionEffect) annotation (Line(
          points={{8,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(otherTissue.FunctionEffect, busConnector.OtherTissueFunctionEffect) annotation (Line(
          points={{-72,0},{-20,0},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(rightHeart.FunctionEffect, busConnector.RightHeartFunctionEffect) annotation (Line(
          points={{8,-92},{-20,-92},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(respiratoryMuscle.FunctionEffect, busConnector.RespiratoryMuscleFunctionEffect) annotation (Line(
          points={{-72,-30},{-20,-30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skin.FunctionEffect, busConnector.SkinFunctionEffect) annotation (Line(
          points={{-72,-90},{-20,-90},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skeletalMuscle.FunctionEffect, busConnector.SkeletalMuscleFunctionEffect) annotation (Line(
          points={{-72,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));

    connect(bone.FunctionFailed, busConnector.bone.Function_Failed) annotation (Line(
          points={{-64,30},{-20,30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(brain.FunctionFailed, busConnector.brain.Function_Failed) annotation (Line(
          points={{16,28},{-20,28},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(GITract.FunctionFailed, busConnector.GITract.Function_Failed) annotation (Line(
          points={{16,-4},{-20,-4},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(fat.FunctionFailed, busConnector.fat.Function_Failed) annotation (Line(
          points={{-64,-60},{-20,-60},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(kidney.FunctionFailed, busConnector.Kidney_Function_Failed) annotation (Line(
          points={{16,-32},{-20,-32},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(leftHeart.FunctionFailed, busConnector.LeftHeart_Function_Failed) annotation (Line(
          points={{16,-62},{-20,-62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(liver.FunctionFailed, busConnector.Liver_Function_Failed) annotation (Line(
          points={{16,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(otherTissue.FunctionFailed, busConnector.otherTissue.Function_Failed) annotation (Line(
          points={{-64,0},{-20,0},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(rightHeart.FunctionFailed, busConnector.RightHeart_Function_Failed) annotation (Line(
          points={{16,-92},{-20,-92},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(respiratoryMuscle.FunctionFailed, busConnector.respiratoryMuscle.Function_Failed) annotation (Line(
          points={{-64,-30},{-20,-30},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skin.FunctionFailed, busConnector.Skin_Function_Failed) annotation (Line(
          points={{-64,-90},{-20,-90},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));
     connect(skeletalMuscle.FunctionFailed, busConnector.skeletalMuscle.Function_Failed) annotation (Line(
          points={{-64,62},{-20,62},{-20,92},{-88,92}},
          color={0,0,127},
          smooth=Smooth.None));

      connect(brain.FunctionEffect, patientStatus.BrainFunctionEffect)
        annotation (Line(
          points={{8,28},{8,26},{74,26}},
          color={0,0,127},
          smooth=Smooth.None));
      annotation (Icon(coordinateSystem(preserveAspectRatio=true, extent={{-100,
                -100},{100,100}}), graphics={                 Text(
              extent={{-152,-102},{150,-138}},
              lineColor={0,0,255},
              fillColor={255,255,255},
              fillPattern=FillPattern.Solid,
              textString="%name")}),
        Documentation(info="<html>
<p>BE_interstitial is base excess in the interstitium of the tissue. The standard value is 0, when strong acid concentration increase, then BE value decrease with the same concentration. </p>
<p>Meaning might be interpreted like what amount of hydrogen iont must be added to sollution if the end poit of titration will be pH=7.4 and pCO2=5.3kPa.</p>
<p>For any tissue can be simplified with difference of lactate concentration from its normal value.</p>
</html>",     revisions="<html>
<p>Marek Matejak, 24.12.2009</p>
</html>"));
    end TissuesFitness;

    model Failed
      parameter Real effectAtFailing=0.2;
      parameter Real effectAtRevitaling=0.4;

      Modelica.Blocks.Interfaces.RealInput FunctionEffect
                                                   annotation (Placement(
            transformation(extent={{-118,-20},{-78,20}}), iconTransformation(extent=
               {{-120,-20},{-80,20}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             Failed(start=false) annotation (Placement(transformation(
              extent={{80,-20},{120,20}}), iconTransformation(extent={{80,-20},{120,
                20}})));
      Boolean a(start=false);
      Boolean b(start=true);
      Boolean c(start=false);
    //initial equation
    //  c=false;
    equation
      a=FunctionEffect<effectAtFailing;
      b=FunctionEffect>effectAtRevitaling;
      c=pre(Failed);
      Failed=a or ( c and ( not b));
    end Failed;

    model PatientStatus
      extends Physiolibrary.Icons.StatusNormal;
      Normal normal
        annotation (Placement(transformation(extent={{-66,34},{-46,54}})));
      Confused confused(                          nOut=2, nIn=2)
        annotation (Placement(transformation(extent={{-24,34},{-4,54}})));
      Modelica.StateGraph.TransitionWithSignal worse1 "He's like confused.
"     annotation (Placement(transformation(extent={{-44,34},{-24,54}})));
      Modelica.StateGraph.TransitionWithSignal better "Now he's feeling better.
"     annotation (Placement(transformation(extent={{-24,84},{-44,64}})));
      Impaired impaired(                          nIn=2, nOut=2)
        annotation (Placement(transformation(extent={{28,34},{48,54}})));
      Comatose comatose(                          nIn=2, nOut=2)
        annotation (Placement(transformation(extent={{88,-52},{68,-32}})));
      NotBreathing notBreathing(                      nOut=2, nIn=3)
        annotation (Placement(transformation(extent={{44,-52},{24,-32}})));
      MayBeDead mayBeDead(                         nOut=2)
        annotation (Placement(transformation(extent={{-12,-52},{-32,-32}})));
      IsReallyDead isReallyDead
        annotation (Placement(transformation(extent={{-64,-52},{-84,-32}})));
      Modelica.Blocks.Interfaces.RealInput BrainFunctionEffect
                                                   annotation (Placement(
            transformation(extent={{-104,86},{-94,96}}),  iconTransformation(extent=
               {{-120,-20},{-80,20}})));
      Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold(threshold=0.8)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=90,
            origin={-34,24})));
      Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold1(threshold=0.6)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=90,
            origin={14,24})));
      Modelica.StateGraph.TransitionWithSignal worse2 "He can't talk wery well ...
"     annotation (Placement(transformation(extent={{4,34},{24,54}})));
      Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold2(threshold=0.4)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=90,
            origin={62,24})));
      Modelica.StateGraph.TransitionWithSignal worse3 "Your patient is not conscious!
"     annotation (Placement(transformation(extent={{52,34},{72,54}})));
      Modelica.StateGraph.TransitionWithSignal worse4 "Your patient is not conscious!
"     annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={60,-42})));
      Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold3(threshold=0.2)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={60,-22})));
      Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold4(threshold=0.1)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={6,-22})));
      Modelica.StateGraph.TransitionWithSignal worse5 "Your patient is not conscious!
"     annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={6,-42})));
      Modelica.Blocks.Logical.LessEqualThreshold lessEqualThreshold5(threshold=0)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={-50,-22})));
      Modelica.StateGraph.TransitionWithSignal worse6 "Your patient is not conscious!
"     annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=180,
            origin={-50,-42})));
      Modelica.StateGraph.TransitionWithSignal better2 "Your patient seems to be conscious again.
"     annotation (Placement(transformation(extent={{72,84},{52,64}})));
      Modelica.StateGraph.TransitionWithSignal better3 "Your patient is breathing again.
"     annotation (Placement(transformation(extent={{52,-82},{72,-62}})));
      Modelica.StateGraph.TransitionWithSignal better4
      "Wait. Your patient is not dead! "
        annotation (Placement(transformation(extent={{-4,-82},{16,-62}})));
      Modelica.Blocks.Logical.GreaterEqualThreshold lessEqualThreshold6(threshold=0.2)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=90,
            origin={6,-92})));
      Modelica.Blocks.Logical.GreaterEqualThreshold lessEqualThreshold7(threshold=0.4)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=90,
            origin={62,-92})));
      Modelica.Blocks.Logical.GreaterEqualThreshold lessEqualThreshold8(threshold=0.6)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={62,94})));
      Modelica.Blocks.Logical.GreaterEqualThreshold lessEqualThreshold9(threshold=0.95)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={-34,94})));
      Modelica.StateGraph.TransitionWithSignal better5
      "Wait. Your patient is not dead!"
        annotation (Placement(transformation(extent={{-60,-82},{-40,-62}})));
      Modelica.Blocks.Logical.GreaterEqualThreshold lessEqualThreshold10(threshold=0.2)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=90,
            origin={-50,-90})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_NORMAL
        annotation (Placement(transformation(extent={{-54,22},{-44,32}}),
            iconTransformation(extent={{100,100},{140,140}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_CONFUSED
        annotation (Placement(transformation(extent={{-10,22},{0,32}}),
            iconTransformation(extent={{100,60},{140,100}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_IMPAIRED
        annotation (Placement(transformation(extent={{42,22},{52,32}}),
            iconTransformation(extent={{100,20},{140,60}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_COMATOUS
        annotation (Placement(transformation(extent={{80,-64},{90,-54}}),
            iconTransformation(extent={{100,-20},{140,20}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_NOT_BREATHING
        annotation (Placement(transformation(extent={{30,-64},{40,-54}}),
            iconTransformation(extent={{100,-60},{140,-20}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_MAY_BE_DEAD
        annotation (Placement(transformation(extent={{-24,-64},{-14,-54}}),
            iconTransformation(extent={{100,-100},{140,-60}})));
      Modelica.Blocks.Interfaces.BooleanOutput
                                             IS_REALLY_DEAD
        annotation (Placement(transformation(extent={{-78,-64},{-68,-54}}),
            iconTransformation(extent={{100,-140},{140,-100}})));
      Modelica.StateGraph.TransitionWithSignal better1 "Your patient seems to be conscious again.
"     annotation (Placement(transformation(extent={{24,84},{4,64}})));
      Modelica.Blocks.Logical.GreaterEqualThreshold lessEqualThreshold11(
          threshold=0.8)
        annotation (Placement(transformation(
            extent={{-4,-4},{4,4}},
            rotation=270,
            origin={14,94})));
    equation
      connect(normal.outPort[1], worse1.inPort) annotation (Line(
          points={{-45.5,44},{-38,44}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(worse1.outPort, confused.inPort[1]) annotation (Line(
          points={{-32.5,44},{-28.75,44},{-28.75,44.5},{-25,44.5}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(better.outPort, normal.inPort[1]) annotation (Line(
          points={{-35.5,74},{-76,74},{-76,44},{-67,44}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(lessEqualThreshold.y, worse1.condition) annotation (Line(
          points={{-34,28.4},{-34,32}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,19.2},{-34,19.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold1.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,19.2},{14,19.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(lessEqualThreshold1.y, worse2.condition) annotation (Line(
          points={{14,28.4},{14,32}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(confused.outPort[1], worse2.inPort) annotation (Line(
          points={{-3.5,44.25},{3.25,44.25},{3.25,44},{10,44}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(worse2.outPort, impaired.inPort[1]) annotation (Line(
          points={{15.5,44},{21.25,44},{21.25,44.5},{27,44.5}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold2.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,19.2},{62,19.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(lessEqualThreshold2.y, worse3.condition) annotation (Line(
          points={{62,28.4},{62,32}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(impaired.outPort[1], worse3.inPort) annotation (Line(
          points={{48.5,44.25},{53.25,44.25},{53.25,44},{58,44}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(worse3.outPort, comatose.inPort[1]) annotation (Line(
          points={{63.5,44},{96,44},{96,-41.5},{89,-41.5}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(lessEqualThreshold3.y, worse4.condition) annotation (Line(
          points={{60,-26.4},{60,-30}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold3.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,-17.2},{60,-17.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(lessEqualThreshold4.y, worse5.condition) annotation (Line(
          points={{6,-26.4},{6,-27.3},{6,-27.3},{6,-28.2},{6,-30},{6,-30}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(lessEqualThreshold5.y, worse6.condition) annotation (Line(
          points={{-50,-26.4},{-50,-30}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold4.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,-17.2},{6,-17.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold5.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,-17.2},{-50,-17.2}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(notBreathing.outPort[1], worse5.inPort) annotation (Line(
          points={{23.5,-41.75},{10.75,-41.75},{10.75,-42},{10,-42}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(worse5.outPort, mayBeDead.inPort[1]) annotation (Line(
          points={{4.5,-42},{-11,-42}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(mayBeDead.outPort[1], worse6.inPort) annotation (Line(
          points={{-32.5,-41.75},{-45.25,-41.75},{-45.25,-42},{-46,-42}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(worse6.outPort, isReallyDead.inPort[1]) annotation (Line(
          points={{-51.5,-42},{-63,-42}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(lessEqualThreshold6.y, better4.condition) annotation (Line(
          points={{6,-87.6},{6,-84}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(mayBeDead.outPort[2], better4.inPort) annotation (Line(
          points={{-32.5,-42.25},{-36,-42.25},{-36,-72},{2,-72}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(better4.outPort, notBreathing.inPort[2]) annotation (Line(
          points={{7.5,-72},{14,-72},{14,-64},{48,-64},{48,-42},{45,-42}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold6.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,-96.8},{6,-96.8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold7.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,-96.8},{62,-96.8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(lessEqualThreshold7.y, better3.condition) annotation (Line(
          points={{62,-87.6},{62,-84}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(notBreathing.outPort[2], better3.inPort) annotation (Line(
          points={{23.5,-42.25},{22,-42.25},{22,-72},{58,-72}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(better3.outPort, comatose.inPort[2]) annotation (Line(
          points={{63.5,-72},{70,-72},{70,-64},{96,-64},{96,-42.5},{89,-42.5}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(comatose.outPort[2], better2.inPort) annotation (Line(
          points={{67.5,-42.25},{66,-42.25},{66,0},{82,0},{82,74},{66,74}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(better2.outPort, impaired.inPort[2]) annotation (Line(
          points={{60.5,74},{22,74},{22,43.5},{27,43.5}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(lessEqualThreshold8.y, better2.condition) annotation (Line(
          points={{62,89.6},{62,86}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(lessEqualThreshold8.u, BrainFunctionEffect) annotation (Line(
          points={{62,98.8},{-90,98.8},{-90,91},{-99,91}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(better.condition, lessEqualThreshold9.y) annotation (Line(
          points={{-34,86},{-34,89.6}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold9.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,98.8},{-34,98.8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(normal.active, IS_NORMAL) annotation (Line(
          points={{-56,33},{-56,27},{-49,27}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(confused.active, IS_CONFUSED) annotation (Line(
          points={{-14,33},{-14,27},{-5,27}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(impaired.active, IS_IMPAIRED) annotation (Line(
          points={{38,33},{38,27},{47,27}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(comatose.active, IS_COMATOUS) annotation (Line(
          points={{78,-53},{78,-59},{85,-59}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(notBreathing.active, IS_NOT_BREATHING) annotation (Line(
          points={{34,-53},{34,-59},{35,-59}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(IS_MAY_BE_DEAD, mayBeDead.active) annotation (Line(
          points={{-19,-59},{-22,-59},{-22,-53}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(isReallyDead.active, IS_REALLY_DEAD) annotation (Line(
          points={{-74,-53},{-74,-59},{-73,-59}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(better5.condition, lessEqualThreshold10.y) annotation (Line(
          points={{-50,-84},{-50,-85.6}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(BrainFunctionEffect, lessEqualThreshold10.u) annotation (Line(
          points={{-99,91},{-90,91},{-90,-96},{-50,-96},{-50,-94.8}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(comatose.outPort[1], worse4.inPort) annotation (Line(
          points={{67.5,-41.75},{65.75,-41.75},{65.75,-42},{64,-42}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(worse4.outPort, notBreathing.inPort[1]) annotation (Line(
          points={{58.5,-42},{59.75,-42},{59.75,-41.3333},{45,-41.3333}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(confused.outPort[2], better.inPort) annotation (Line(
          points={{-3.5,43.75},{0,43.75},{0,74},{-30,74}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(better5.outPort, notBreathing.inPort[3]) annotation (Line(
          points={{-48.5,-72},{-44,-72},{-44,-64},{48,-64},{48,-42.6667},{45,
            -42.6667}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(isReallyDead.outPort[1], better5.inPort) annotation (Line(
          points={{-84.5,-42},{-86,-42},{-86,-72},{-54,-72}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(lessEqualThreshold11.y, better1.condition)
                                                        annotation (Line(
          points={{14,89.6},{14,86}},
          color={255,0,255},
          smooth=Smooth.None));
      connect(lessEqualThreshold11.u, BrainFunctionEffect)
                                                          annotation (Line(
          points={{14,98.8},{-90,98.8},{-90,91},{-99,91}},
          color={0,0,127},
          smooth=Smooth.None));
      connect(impaired.outPort[2], better1.inPort) annotation (Line(
          points={{48.5,43.75},{52,43.75},{52,74},{18,74}},
          color={0,0,0},
          smooth=Smooth.None));
      connect(better1.outPort, confused.inPort[2]) annotation (Line(
          points={{12.5,74},{-25,74},{-25,43.5}},
          color={0,0,0},
          smooth=Smooth.None));
    end PatientStatus;

    block Normal
      extends Modelica.StateGraph.InitialStepWithSignal;
      extends Physiolibrary.Icons.StatusNormal;
    end Normal;

    block Confused
      extends Modelica.StateGraph.StepWithSignal;
      extends Physiolibrary.Icons.StatusConfused;
    end Confused;

    block Impaired
      extends Modelica.StateGraph.StepWithSignal;
      extends Physiolibrary.Icons.StatusImpaired;
    end Impaired;

    block Comatose
      extends Modelica.StateGraph.StepWithSignal;
      extends Physiolibrary.Icons.StatusComatose;
    end Comatose;

    block NotBreathing
      extends Modelica.StateGraph.StepWithSignal;
      extends Physiolibrary.Icons.StatusNotBreathing;
    end NotBreathing;

    block MayBeDead
      extends Modelica.StateGraph.StepWithSignal;
      extends Physiolibrary.Icons.StatusMayBeDead;
    end MayBeDead;

    block IsReallyDead
      extends Modelica.StateGraph.StepWithSignal;
      extends Physiolibrary.Icons.StatusIsReallyDead;
    end IsReallyDead;

    package Tissues
      model TissueFitness

        Physiolibrary.Types.RealIO.FractionOutput FunctionEffect   annotation (Placement(transformation(
                extent={{56,-14},{68,-2}}),  iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={-20,-120})));
        Physiolibrary.Types.RealIO.FractionOutput StructureEffect                         annotation (Placement(
              transformation(extent={{-8,-34},{8,-18}}),  iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={20,-120})));

        Physiolibrary.Types.RealIO.pHInput pH_intracellular
                                         annotation (Placement(transformation(extent={{-84,42},
                  {-72,54}}),           iconTransformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,80})));
        Physiolibrary.Types.RealIO.TemperatureInput T(
                                        final displayUnit="degC")
        "tissue temperature"             annotation (Placement(transformation(extent={{-104,66},
                  {-92,78}}),           iconTransformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,40})));

        Physiolibrary.Types.RealIO.FractionInput Fuel_FractUseDelay                        annotation (Placement(transformation(extent={{-96,54},
                  {-84,66}}),           iconTransformation(extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,0})));

        Physiolibrary.Types.RealIO.AmountOfSubstanceInput
                                                      CellProteinAA(final displayUnit=
             "mol") annotation (Placement(transformation(extent={{-2,30},{8,40}}),
              iconTransformation(
              extent={{-10,-10},{10,10}},
              rotation=180,
              origin={90,-80})));

      Physiolibrary.Blocks.Factors.Spline PhOnStructure(data={{6.5,0.1,0},{6.6,
            0.0,0}})
        annotation (Placement(transformation(extent={{-64,14},{-44,36}})));
      Physiolibrary.Blocks.Factors.Spline FuelOnStructure(data={{0.5,0.05,0},{
            0.8,0.00,0}})
        annotation (Placement(transformation(extent={{-64,0},{-44,20}})));
      Physiolibrary.Blocks.Factors.Spline TemperatureOnStructure(data={{44.0 + 273.15,
              0.00,0},{46.0 + 273.15,0.05,0}})
        annotation (Placement(transformation(extent={{-64,-14},{-44,6}})));
      Physiolibrary.Types.Constants.FrequencyConst            Constant(k(
            displayUnit="1/min") = 0.016666666666667)
        annotation (Placement(transformation(extent={{-66,34},{-58,42}})));
        Modelica.Blocks.Math.Feedback feedback
          annotation (Placement(transformation(extent={{-64,-16},{-44,-36}})));
        Modelica.Blocks.Continuous.Integrator integrator(y_start=1, k=1)
          annotation (Placement(transformation(extent={{-38,-36},{-18,-16}})));
      Physiolibrary.Blocks.Factors.Spline PhOnFunction(data={{6.6,0.0,0},{6.7,
            1.0,0}})
        annotation (Placement(transformation(extent={{20,38},{40,58}})));
      Physiolibrary.Blocks.Factors.Spline ProteinOnFunction(data={{3000.0,0.0,0},
            {5200.0,1.0,0}}, Xscale=1e-3/Substances.AminoAcids.mw)
        annotation (Placement(transformation(extent={{20,24},{40,46}})));
      Physiolibrary.Blocks.Factors.Spline FuelOnFunction(data={{0.0,0.0,0},{0.9,
            1.0,0}})
        annotation (Placement(transformation(extent={{20,50},{40,70}})));
      Physiolibrary.Blocks.Factors.Spline TemperatureOnFunction(data={{10 + 273.15,0.0,
              0},{37 + 273.15,1.0,0.12},{40 + 273.15,1.5,0},{46 + 273.15,0.0,0}})
        annotation (Placement(transformation(extent={{20,62},{40,82}})));
      Physiolibrary.Types.Constants.FractionConst             Constant1(k=1)
        annotation (Placement(transformation(extent={{20,78},{28,86}})));
      Physiolibrary.Blocks.Factors.Normalization StructureEff
        annotation (Placement(transformation(extent={{20,10},{40,30}})));
        Failed failed
          annotation (Placement(transformation(extent={{44,-70},{64,-50}})));
        Modelica.Blocks.Interfaces.BooleanOutput
                                               FunctionFailed
                                                        annotation (Placement(
              transformation(extent={{76,-66},{88,-54}}), iconTransformation(
              extent={{-20,-20},{20,20}},
              rotation=270,
              origin={60,-120})));
      Physiolibrary.Types.Constants.FrequencyConst            Constant2(k=0)
        annotation (Placement(transformation(extent={{-86,-30},{-78,-22}})));
      equation

        connect(PhOnStructure.u, pH_intracellular)
                                                  annotation (Line(
            points={{-62,25},{-70,25},{-70,48},{-78,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FuelOnStructure.u, Fuel_FractUseDelay) annotation (Line(
            points={{-62,10},{-82,10},{-82,60},{-90,60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TemperatureOnStructure.u, T) annotation (Line(
            points={{-62,-4},{-92,-4},{-92,72},{-98,72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(PhOnStructure.y, FuelOnStructure.yBase) annotation (Line(
            points={{-54,20.6},{-54,12}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FuelOnStructure.y, TemperatureOnStructure.yBase) annotation (Line(
            points={{-54,6},{-54,-2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant.y, PhOnStructure.yBase) annotation (Line(
            points={{-57,38},{-54,38},{-54,27.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TemperatureOnStructure.y, feedback.u2) annotation (Line(
            points={{-54,-8},{-54,-18}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(feedback.y, integrator.u) annotation (Line(
            points={{-45,-26},{-40,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(integrator.y, StructureEffect) annotation (Line(
            points={{-17,-26},{0,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(pH_intracellular, PhOnFunction.u)
                                                 annotation (Line(
            points={{-78,48},{22,48}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(CellProteinAA, ProteinOnFunction.u) annotation (Line(
            points={{3,35},{22,35}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Fuel_FractUseDelay, FuelOnFunction.u) annotation (Line(
            points={{-90,60},{22,60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(T, TemperatureOnFunction.u) annotation (Line(
            points={{-98,72},{22,72}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(TemperatureOnFunction.y, FuelOnFunction.yBase) annotation (Line(
            points={{30,68},{30,62}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(FuelOnFunction.y, PhOnFunction.yBase) annotation (Line(
            points={{30,56},{30,50}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(PhOnFunction.y, ProteinOnFunction.yBase) annotation (Line(
            points={{30,44},{30,37.2}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(Constant1.y, TemperatureOnFunction.yBase) annotation (Line(
            points={{29,82},{30,82},{30,74}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(integrator.y, StructureEff.u) annotation (Line(
            points={{-17,-26},{-12,-26},{-12,20},{22,20}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(ProteinOnFunction.y, StructureEff.yBase) annotation (Line(
            points={{30,30.6},{30,22}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(StructureEff.y, FunctionEffect) annotation (Line(
            points={{30,16},{30,-8},{62,-8}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(StructureEff.y, failed.FunctionEffect) annotation (Line(
            points={{30,16},{30,-60},{44,-60}},
            color={0,0,127},
            smooth=Smooth.None));
        connect(failed.Failed, FunctionFailed) annotation (Line(
            points={{64,-60},{82,-60}},
            color={255,0,255},
            smooth=Smooth.None));
        connect(Constant2.y, feedback.u1) annotation (Line(
            points={{-77,-26},{-62,-26}},
            color={0,0,127},
            smooth=Smooth.None));
        annotation ( Icon(coordinateSystem(
                preserveAspectRatio=false, extent={{-100,-100},{100,100}}),
              graphics={Rectangle(extent={{-100,100},{100,-100}}, lineColor={0,
                    0,255})}));
      end TissueFitness;

      model SkeletalMuscle
        extends TissueFitness;
        extends Physiolibrary.Icons.SkeletalMuscle;
      end SkeletalMuscle;

      model Bone
        extends TissueFitness;
        extends Physiolibrary.Icons.Bone;
      end Bone;

      model OtherTissue
        extends TissueFitness;
        extends Physiolibrary.Icons.OtherTissue;
      end OtherTissue;

      model RespiratoryMuscle
        extends TissueFitness;
        extends Physiolibrary.Icons.RespiratoryMuscle;
      end RespiratoryMuscle;

      model Fat
        extends TissueFitness;
        extends Physiolibrary.Icons.Fat;
      end Fat;

      model Skin
        extends TissueFitness(TemperatureOnFunction(data={{10.0+273.15,0.0,0},{29.5+273.15,
                1.0,0.12},{40.0+273.15,1.5,0},{46.0+273.15,0.0,0}}));
        extends Physiolibrary.Icons.Skin;
      end Skin;

      model Liver
        extends TissueFitness;
        extends Physiolibrary.Icons.Liver;
      end Liver;

      model Brain
        extends TissueFitness;
        extends Physiolibrary.Icons.Brain;
      end Brain;

      model GITract
        extends TissueFitness;
        extends Physiolibrary.Icons.GITract;
      end GITract;

      model Kidney
        extends TissueFitness;
        extends Physiolibrary.Icons.Kidney;
      end Kidney;

      model LeftHeart
        extends TissueFitness;
        extends Physiolibrary.Icons.LeftHeart;
      end LeftHeart;

      model RightHeart
        extends TissueFitness;
        extends Physiolibrary.Icons.RightHeart;
      end RightHeart;
    end Tissues;

    package IO_Bus
        extends Physiolibrary.Types.IO_Bus;
      redeclare model extends Variables

      T.Fraction Bone_StructureEffect(varName="Bone-Structure.Effect")
        "Bone tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,10},{-30,16}})));
      T.Fraction brain_FunctionEffect(varName="Brain-Function.Effect")
        "Brain tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,20},{-30,26}})));
      T.Fraction Brain_StructureEffect(varName="Brain-Structure.Effect")
        "Brain tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,30},{-30,36}})));
      T.Fraction FatFunctionEffect(varName="Fat-Function.Effect")
        "Fat tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,40},{-30,46}})));
      T.Fraction Fat_StructureEffect(varName="Fat-Structure.Effect")
        "Fat tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,50},{-30,56}})));
      T.Fraction GITractFunctionEffect(varName="GITract-Function.Effect")
        "GITract tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,60},{-30,66}})));
      T.Fraction GITract_StructureEffect(varName="GITract-Structure.Effect")
        "GITract tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,70},{-30,76}})));
      T.Fraction KidneyFunctionEffect(varName="Kidney-Function.Effect")
        "Kidney tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,80},{-30,86}})));
      //T.Fraction KidneyFunction_Effect(varName="Kidney-Function.Effect")
      //    "Kidney tissue function effect. []"
      //annotation (Placement(transformation(extent={{-36,90},{-30,96}})));
      T.Fraction Kidney_StructureEffect(varName="Kidney-Structure.Effect")
        "Kidney tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,100},{-30,106}})));
      T.Fraction LeftHeart_StructureEffect(varName="LeftHeart-Structure.Effect")
        "LeftHeart tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,110},{-30,116}})));
      T.Fraction LiverFunctionEffect(varName="Liver-Function.Effect")
        "Liver tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,120},{-30,126}})));
      T.Fraction Liver_StructureEffect(varName="Liver-Structure.Effect")
        "Liver tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,130},{-30,136}})));
      T.Fraction OtherTissueFunctionEffect(varName="OtherTissue-Function.Effect")
        "OtherTissue tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,140},{-30,146}})));
      T.Fraction OtherTissue_StructureEffect(varName="OtherTissue-Structure.Effect")
        "OtherTissue tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,150},{-30,156}})));
      T.Fraction RespiratoryMuscleFunctionEffect(varName="RespiratoryMuscle-Function.Effect")
        "RespiratoryMuscle tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,160},{-30,166}})));
      T.Fraction RespiratoryMuscle_StructureEffect(varName="RespiratoryMuscle-Structure.Effect")
        "RespiratoryMuscle tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,170},{-30,176}})));
      T.Fraction RightHeart_StructureEffect(varName="RightHeart-Structure.Effect")
        "RightHeart tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,180},{-30,186}})));
      T.Fraction SkeletalMuscle_StructureEffect(varName="SkeletalMuscle-Structure.Effect")
        "SkeletalMuscle tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,190},{-30,196}})));
      T.Fraction Skin_StructureEffect(varName="Skin-Structure.Effect")
        "Skin tissue structural damage effect. []"
      annotation (Placement(transformation(extent={{-36,200},{-30,206}})));
      BooleanVariable Bone_Function_Failed(varName="Bone-Function.Failed")
        "Bone function failture if true."
      annotation (Placement(transformation(extent={{-36,210},{-30,216}})));
      BooleanVariable Brain_Function_Failed(varName="Brain-Function.Failed")
        "Brain function failture if true."
      annotation (Placement(transformation(extent={{-36,220},{-30,226}})));
      BooleanVariable Fat_Function_Failed(varName="Fat-Function.Failed")
        "Fat function failture if true."
      annotation (Placement(transformation(extent={{-36,230},{-30,236}})));
      BooleanVariable GITract_Function_Failed(varName="GITract-Function.Failed")
        "GITract function failture if true."
      annotation (Placement(transformation(extent={{-36,240},{-30,246}})));
      BooleanVariable Kidney_Function_Failed(varName="Kidney-Function.Failed")
        "Kidney function failture if true."
      annotation (Placement(transformation(extent={{-36,250},{-30,256}})));
      BooleanVariable LeftHeart_Function_Failed(varName="LeftHeart-Function.Failed")
        "LeftHeart function failture if true."
      annotation (Placement(transformation(extent={{-36,260},{-30,266}})));
      BooleanVariable Liver_Function_Failed(varName="Liver-Function.Failed")
        "Liver function failture if true."
      annotation (Placement(transformation(extent={{-36,270},{-30,276}})));
      BooleanVariable OtherTissue_Function_Failed(varName="OtherTissue-Function.Failed")
        "OtherTissue function failture if true."
      annotation (Placement(transformation(extent={{-36,280},{-30,286}})));
      BooleanVariable RespiratoryMuscle_Function_Failed(varName="RespiratoryMuscle-Function.Failed")
        "RespiratoryMuscle function failture if true."
      annotation (Placement(transformation(extent={{-36,290},{-30,296}})));
      BooleanVariable RightHeart_Function_Failed(varName="RightHeart-Function.Failed")
        "RightHeart function failture if true."
      annotation (Placement(transformation(extent={{-36,300},{-30,306}})));
      BooleanVariable SkeletalMuscle_Function_Failed(varName="SkeletalMuscle-Function.Failed")
        "SkeletalMuscle function failture if true."
      annotation (Placement(transformation(extent={{-36,310},{-30,316}})));
      BooleanVariable Skin_Function_Failed(varName="Skin-Function.Failed")
        "Skin function failture if true."
      annotation (Placement(transformation(extent={{-36,320},{-30,326}})));
      T.Fraction skin_FunctionEffect(varName=
              "Skin-Function.Effect") "Skin tissue function effect. []"
      annotation (Placement(transformation(extent={{-36,2},{-30,8}})));
      equation
      connect(Bone_StructureEffect.y, busConnector.Bone_StructureEffect) annotation (Line(
       points={{-29.7,13},{90,13},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(brain_FunctionEffect.y, busConnector.brain_FunctionEffect) annotation (Line(
       points={{-29.7,23},{90,23},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Brain_StructureEffect.y, busConnector.Brain_StructureEffect) annotation (Line(
       points={{-29.7,33},{90,33},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(FatFunctionEffect.y, busConnector.FatFunctionEffect) annotation (Line(
       points={{-29.7,43},{90,43},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Fat_StructureEffect.y, busConnector.Fat_StructureEffect) annotation (Line(
       points={{-29.7,53},{90,53},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GITractFunctionEffect.y, busConnector.GITractFunctionEffect) annotation (Line(
       points={{-29.7,63},{90,63},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GITract_StructureEffect.y, busConnector.GITract_StructureEffect) annotation (Line(
       points={{-29.7,73},{90,73},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(KidneyFunctionEffect.y, busConnector.KidneyFunctionEffect) annotation (Line(
       points={{-29.7,83},{90,83},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Kidney_StructureEffect.y, busConnector.Kidney_StructureEffect) annotation (Line(
       points={{-29.7,103},{90,103},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LeftHeart_StructureEffect.y, busConnector.LeftHeart_StructureEffect) annotation (Line(
       points={{-29.7,113},{90,113},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LiverFunctionEffect.y, busConnector.LiverFunctionEffect) annotation (Line(
       points={{-29.7,123},{90,123},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Liver_StructureEffect.y, busConnector.Liver_StructureEffect) annotation (Line(
       points={{-29.7,133},{90,133},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(OtherTissueFunctionEffect.y, busConnector.OtherTissueFunctionEffect) annotation (Line(
       points={{-29.7,143},{90,143},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(OtherTissue_StructureEffect.y, busConnector.OtherTissue_StructureEffect) annotation (Line(
       points={{-29.7,153},{90,153},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(RespiratoryMuscleFunctionEffect.y, busConnector.RespiratoryMuscleFunctionEffect) annotation (Line(
       points={{-29.7,163},{90,163},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(RespiratoryMuscle_StructureEffect.y, busConnector.RespiratoryMuscle_StructureEffect) annotation (Line(
       points={{-29.7,173},{90,173},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(RightHeart_StructureEffect.y, busConnector.RightHeart_StructureEffect) annotation (Line(
       points={{-29.7,183},{90,183},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(SkeletalMuscle_StructureEffect.y, busConnector.SkeletalMuscle_StructureEffect) annotation (Line(
       points={{-29.7,193},{90,193},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Skin_StructureEffect.y, busConnector.Skin_StructureEffect) annotation (Line(
       points={{-29.7,203},{90,203},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Bone_Function_Failed.y, busConnector.bone.Function_Failed) annotation (Line(
       points={{-29.7,213},{90,213},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Brain_Function_Failed.y, busConnector.brain.Function_Failed) annotation (Line(
       points={{-29.7,223},{90,223},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Fat_Function_Failed.y, busConnector.fat.Function_Failed) annotation (Line(
       points={{-29.7,233},{90,233},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(GITract_Function_Failed.y, busConnector.GITract.Function_Failed) annotation (Line(
       points={{-29.7,243},{90,243},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Kidney_Function_Failed.y, busConnector.Kidney_Function_Failed) annotation (Line(
       points={{-29.7,253},{90,253},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(LeftHeart_Function_Failed.y, busConnector.LeftHeart_Function_Failed) annotation (Line(
       points={{-29.7,263},{90,263},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Liver_Function_Failed.y, busConnector.Liver_Function_Failed) annotation (Line(
       points={{-29.7,273},{90,273},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(OtherTissue_Function_Failed.y, busConnector.otherTissue.Function_Failed) annotation (Line(
       points={{-29.7,283},{90,283},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(RespiratoryMuscle_Function_Failed.y, busConnector.respiratoryMuscle.Function_Failed) annotation (Line(
       points={{-29.7,293},{90,293},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(RightHeart_Function_Failed.y, busConnector.RightHeart_Function_Failed) annotation (Line(
       points={{-29.7,303},{90,303},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(SkeletalMuscle_Function_Failed.y, busConnector.skeletalMuscle.Function_Failed) annotation (Line(
       points={{-29.7,313},{90,313},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
      connect(Skin_Function_Failed.y, busConnector.Skin_Function_Failed) annotation (Line(
       points={{-29.7,323},{90,323},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));

        connect(skin_FunctionEffect.y, busConnector.skin_FunctionEffect)
          annotation (Line(
            points={{-29.7,5},{25.15,5},{25.15,-2},{90,-2}},
            color={0,0,127},
            smooth=Smooth.None), Text(
            string="%second",
            index=1,
            extent={{6,3},{6,3}}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -100},{100,100}}), graphics={
              Text(
                extent={{18,100},{100,62}},
                lineColor={0,0,0},
                textString="vars"),
              Text(
                extent={{-124,-90},{118,-124}},
                lineColor={0,0,255},
                textString="%name")}));
      end Variables;

      model Status_test
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile     setup
          annotation (Placement(transformation(extent={{-16,-104},{4,-84}})));
        Physiomodel.Water.IO_Bus.InputFromFile water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.TissuesFitness status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{30,-46},{44,-32}}), iconTransformation(
              extent={{-40,-20},{0,20}})));
      Physiomodel.Status.IO_Bus.OutputComparison outputComparison
        annotation (Placement(transformation(extent={{72,-74},{92,-54}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-94},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-94},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-94},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-94},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-94},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-94},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{43.2,-60.8},{-6,-60.8},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector, busConnector) annotation (Line(
            points={{43.2,-60.8},{37,-60.8},{37,-39}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      connect(status.busConnector, outputComparison.busConnector) annotation (
          Line(
          points={{43.2,-60.8},{62,-60.8},{62,-64},{82,-64}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      end Status_test;

      model Status_test_SI
        import Physiomodel;
      Physiomodel.CardioVascular.IO_Bus.InputFromFile_SI cardioVascularSystem
          annotation (Placement(transformation(extent={{40,72},{60,94}})));
        Physiomodel.Metabolism.IO_Bus.InputFromFile nutrientsAndMetabolism
          annotation (Placement(transformation(extent={{-88,60},{-68,80}})));
        Physiomodel.Electrolytes.IO_Bus.InputFromFile_SI electrolytes
          annotation (Placement(transformation(extent={{74,-34},{94,-14}})));
        Physiomodel.Hormones.IO_Bus.InputFromFile_SI hormones
          annotation (Placement(transformation(extent={{40,6},{60,26}})));
        Physiomodel.Nerves.IO_Bus.InputFromFile_SI nerves
          annotation (Placement(transformation(extent={{74,38},{94,58}})));
        Physiomodel.Setup.IO_Bus.InputFromFile_SI     setup
          annotation (Placement(transformation(extent={{-16,-104},{4,-84}})));
        Physiomodel.Water.IO_Bus.InputFromFile_SI water
          annotation (Placement(transformation(extent={{-86,-6},{-66,14}})));
        Physiomodel.Proteins.IO_Bus.InputFromFile_SI proteins
          annotation (Placement(transformation(extent={{-48,-28},{-28,-8}})));
        Physiomodel.Status.TissuesFitness status
          annotation (Placement(transformation(extent={{42,-80},{62,-60}})));
        Physiomodel.Gases.IO_Bus.InputFromFile_SI gases
          annotation (Placement(transformation(extent={{-76,-64},{-56,-44}})));
        Physiomodel.Heat.IO_Bus.InputFromFile_SI heat
          annotation (Placement(transformation(extent={{-28,30},{-48,50}})));
      Physiolibrary.Types.BusConnector busConnector annotation (Placement(
            transformation(extent={{30,-46},{44,-32}}), iconTransformation(
              extent={{-40,-20},{0,20}})));
      Physiomodel.Status.IO_Bus.OutputComparison_SI outputComparison_SI
        annotation (Placement(transformation(extent={{74,-76},{94,-56}})));
      equation
        connect(setup.busConnector,hormones. busConnector) annotation (Line(
            points={{-6,-94},{-6,16},{50,16}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,proteins. busConnector) annotation (Line(
            points={{-6,-94},{-6,-18},{-38,-18}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,cardioVascularSystem. busConnector)
                                                      annotation (Line(
            points={{-6,-94},{-6,83},{50,83}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nutrientsAndMetabolism. busConnector)
          annotation (Line(
            points={{-6,-94},{-6,70},{-78,70}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,water. busConnector) annotation (Line(
            points={{-6,-94},{-6,4},{-76,4}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(setup.busConnector,nerves. busConnector) annotation (Line(
            points={{-6,-94},{-6,48},{84,48}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector,setup. busConnector)         annotation (Line(
            points={{43.2,-60.8},{-6,-60.8},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(electrolytes.busConnector,setup. busConnector) annotation (Line(
            points={{84,-24},{-6,-24},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(gases.busConnector,setup. busConnector) annotation (Line(
            points={{-66,-54},{-6,-54},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(heat.busConnector,setup. busConnector) annotation (Line(
            points={{-38,40},{-6,40},{-6,-94}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
        connect(status.busConnector, busConnector) annotation (Line(
            points={{43.2,-60.8},{37,-60.8},{37,-39}},
            color={0,0,255},
            thickness=0.5,
            smooth=Smooth.None));
      connect(status.busConnector, outputComparison_SI.busConnector)
        annotation (Line(
          points={{43.2,-60.8},{64,-60.8},{64,-66},{84,-66}},
          color={0,0,255},
          thickness=0.5,
          smooth=Smooth.None));
      end Status_test_SI;
    end IO_Bus;

    annotation (Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>

<tr>
<td><p>Date of:</p></td>
<td><p>2008-2015</p></td>
</tr>
<tr>
<td><p>References:</p></td>
<td><p>Tom Coleman: HumMod 1.6, University of Mississippi Medical Center</p></td>
</tr>
</table>
<p>Copyright &copy; 2008-2015 Marek Matejak, Charles University in Prague.</p>
</html>"));
  end Status;


  annotation (uses(Modelica(version="3.2.1"), Physiolibrary(version="2.3.1")),                           Documentation(revisions="<html>
<table cellspacing=\"2\" cellpadding=\"0\" border=\"0\"><tr>
<td><p>Author:</p></td>
<td><p>Marek Matejak</p></td>
</tr>
<tr>
<td><p>License:</p></td>
<td><p><a href=\"http://www.physiomodel.org/license.html\">Physiomodel License 1.0</a> </p></td>
</tr>
</table>
<p><br>Copyright &copy; 2008-2015 Marek Matejak. All rights reserved.</p>
</html>"),
  version="1.0.0");
end Physiomodel;
